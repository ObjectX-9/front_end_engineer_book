---
group:
  title: 2.è™šæ‹Ÿåˆ—è¡¨
  order: 1
title: è™šæ‹Ÿåˆ—è¡¨çš„å‡ ç§å®ç°æ–¹å¼
order: 1
# è¿™ä¸ªå¯ä»¥å°†å†™çš„ç»„ä»¶è®¾ç½®ä¸ºdemoåœ¨å³ä¾§å±•ç¤º
# demo: /
---

# è™šæ‹Ÿåˆ—è¡¨çš„å‡ ç§å®ç°æ–¹å¼
## ğŸ¥‘ å®ç°æ•ˆæœ&ä»£ç 
[åœ¨çº¿demoä½“éªŒ](https://github.com/ObjectX-9/react_demo)

## å®šé«˜

![2024-05-25 19.39.29.gif](./assets/å®šé«˜.gif)

## ä¸å®šé«˜

![2024-05-25 19.40.10.gif](./assets/ä¸å®šé«˜.gif)

## åŠ¨æ€é«˜åº¦

![2024-05-25 19.40.47.gif](./assets/åŠ¨æ€é«˜åº¦.gif)

# å·¥ç¨‹åŒ–
æœ¬ç³»åˆ—æ˜¯ä¸€ä¸ªä»0åˆ°1çš„å®ç°è¿‡ç¨‹ï¼Œå¦‚æœæ‚¨æœ‰è€å¿ƒè·Ÿç€å®ç°ï¼Œæ‚¨å¯ä»¥å®ç°ä¸€ä¸ªå®Œæ•´çš„`react18 + ts5 + webpack5 + ä»£ç è´¨é‡&ä»£ç é£æ ¼æ£€æµ‹&è‡ªåŠ¨ä¿®å¤ + storybook8 + rollup + git action`å®ç°çš„ä¸€ä¸ªå®Œæ•´çš„ç»„ä»¶åº“æ¨¡æ¿é¡¹ç›®ã€‚å¦‚æœæ‚¨ä¸æ‰“ç®—è‡ªå·±é…ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥clone[ç»„ä»¶åº“ä»“åº“](https://github.com/ObjectX-9/react_demo)åˆ‡æ¢åˆ°`rollup_comp`åˆ†æ”¯å³æ˜¯å®Œæ•´çš„é¡¹ç›®ï¼Œå½“å‰å®ç°å·²ç»è¶³å¤Ÿä¸ªäººä½¿ç”¨ï¼Œåç»­æˆ‘ä»¬ä¼šæ–°å¢webpack5ä¼˜åŒ–ã€æŒ‰éœ€åŠ è½½ç»„ä»¶ã€å®ç°ä¸€äº›å¸¸è§çš„ç»„ä»¶å°è£…ï¼šåŒ…æ‹¬ä½†ä¸é™äºæ‹–æ‹½æ’åºã€ç€‘å¸ƒæµã€ç©¿æ¢­æ¡†ã€å¼¹çª—ç­‰  
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘é¡¹ç›®æ­å»ºç¯‡-é¡¹ç›®åˆå§‹åŒ–&prettierã€eslintã€stylelintã€lint-stagedã€husky](https://juejin.cn/post/7353504333999505408)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘é¡¹ç›®æ­å»ºç¯‡-é…ç½®changelogã€webpack5æ‰“åŒ…](https://juejin.cn/post/7353561676091097103)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘é¡¹ç›®æ­å»ºç¯‡-å¼•å…¥reactã€tsã€babelè§£æes6+ã€é…ç½®css module](https://juejin.cn/post/7353963878541246504)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ç»„ä»¶åº“æ­å»ºç¯‡-å¼•å…¥storybookã€rollupæ‰“åŒ…ç»„ä»¶ã€æœ¬åœ°æµ‹è¯•ç»„ä»¶åº“](https://juejin.cn/post/7355026320088989733)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘åŒ…ç®¡ç†å™¨ç¯‡-ä¸‰å¤§åŒ…ç®¡ç†å™¨ã€npmå·¥ç¨‹ç®¡ç†ã€npmå‘å¸ƒæµç¨‹](https://juejin.cn/post/7356175306937466916)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘è‡ªåŠ¨åŒ–ç¯‡-Github ActionåŸºæœ¬ä½¿ç”¨ã€è‡ªåŠ¨éƒ¨ç½²ç»„ä»¶åº“æ–‡æ¡£ã€github3DæŒ‡æ ‡ç»Ÿè®¡](https://juejin.cn/post/7356815857078157331)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘è‡ªåŠ¨åŒ–ç¯‡-æ‰‹å†™è„šæœ¬ä¸€é”®è‡ªåŠ¨tagã€å‘åŒ…ã€å¼•å¯¼ç™»å½•npm](https://juejin.cn/post/7366601730426159144)

**å¸¸è§ç»„ä»¶å®ç°**
*   [ã€ç»„ä»¶å®ç°ç¯‡ã€‘"ä»é›¶ä½¿ç”¨reactæ‰“é€ ç€‘å¸ƒæµçš„å››ç§æ–¹å¼ï¼šå®Œç¾å±•ç¤ºåŠ¨æ€å›¾ç‰‡æµ"](https://juejin.cn/post/7370513151052021787)
*   [ã€ç»„ä»¶å®ç°ç¯‡ã€‘å®šé«˜ã€ä¸å®šé«˜ã€åŠ¨æ€é«˜åº¦è™šæ‹Ÿåˆ—è¡¨å®ç°](https://juejin.cn/post/7372488623944728585)

# ä¸€ã€è™šæ‹Ÿåˆ—è¡¨
## ä»€ä¹ˆæ˜¯è™šæ‹Ÿåˆ—è¡¨
`è™šæ‹Ÿåˆ—è¡¨`å…¶å®æ˜¯æŒ‰éœ€æ˜¾ç¤ºçš„ä¸€ç§å®ç°ï¼Œå³åªå¯¹`å¯è§åŒºåŸŸ`è¿›è¡Œæ¸²æŸ“ï¼Œå¯¹`éå¯è§åŒºåŸŸ`ä¸­çš„æ•°æ®ä¸æ¸²æŸ“æˆ–éƒ¨åˆ†æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯è®¾ç½®ç¼“å†²åŒºï¼Œä»è€Œè¾¾åˆ°æé«˜çš„æ¸²æŸ“æ€§èƒ½ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœªæ»šåŠ¨çš„æ—¶å€™ä¸Šç¼“å†²åŒºæ˜¯æ²¡æœ‰çš„ï¼Œè™šæ‹Ÿåˆ—è¡¨æœ‰ä¸‰ç§æƒ…å†µ
+ å®šé«˜è™šæ‹Ÿåˆ—è¡¨ï¼Œæ¯ä¸€é¡¹çš„é«˜åº¦å›ºå®šï¼Œå¯ä»¥å¾ˆå®¹æ˜“è®¡ç®—
+ ä¸å®šé«˜è™šæ‹Ÿåˆ—è¡¨ï¼Œæ¯ä¸€é¡¹çš„é«˜åº¦æ˜¯ä¸å›ºå®šçš„ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“æ•´ä¸ªåˆ—è¡¨çš„é«˜åº¦æ•°ç»„
+ åŠ¨æ€é«˜åº¦è™šæ‹Ÿåˆ—è¡¨ï¼Œæ¯ä¸€é¡¹çš„é«˜åº¦åœ¨æ¸²æŸ“æ—¶ç¡®è®¤

å¯¹äºæ‰€æœ‰è™šæ‹Ÿåˆ—è¡¨è€Œè¨€ï¼Œæˆ‘ä»¬çš„å®ç°è€ƒè™‘çš„éƒ½æ˜¯å¦‚ä½•è®¡ç®—å‡ºå¯è§†åŒºåŸŸçš„èŠ‚ç‚¹ç´¢å¼•èŒƒå›´ï¼Œå³`[startIndex, endIndex]`ï¼Œç„¶ååŠ ä¸Šç¼“å†²åŒºçš„å¤§å°ï¼Œå°†æ­¤èŒƒå›´å†…çš„èŠ‚ç‚¹æ¸²æŸ“åˆ°å®¹å™¨ä¸­ï¼Œæˆ‘ä»¬æœ€æ ¹æœ¬çš„ç›®çš„æ˜¯è®¡ç®—èµ·å§‹ç´¢å¼•`startIndex`å’Œç»ˆæ­¢ç´¢å¼•`endIndex`ã€‚
![image-20240615143123946](./assets/image-20240615143123946.png)



## 1.å®šé«˜è™šæ‹Ÿåˆ—è¡¨
### å›¾ç¤º
![image-20240615143130304](./assets/image-20240615143130304.png)
### åŸç†

![image-20240615143138122](./assets/image-20240615143138122.png)

å®šé«˜æ˜¯æœ€ç®€å•çš„ï¼Œ`itemSize`å€¼æ˜¯å›ºå®šçš„æˆ‘ä»¬å¯ä»¥ç›´æ¥æ±‚å‡ºæˆ‘ä»¬éœ€è¦çš„å‡ ä¸ªå€¼ï¼Œå³å¦‚ä¸‹å‡ ä¸ªå€¼ï¼š
-   åˆ—è¡¨æ€»é«˜åº¦: åˆ—è¡¨æ€»é«˜åº¦æ˜¯ç”¨äºæ˜¾ç¤ºæ»šåŠ¨æ¡çš„
```js
totalListHeight = data.length * itemSize
```
-   å¯è§†åŒºåŸŸèƒ½æ˜¾ç¤ºçš„itemæ•°é‡: ä¸»è¦æ˜¯ç”¨äºï¼Œåœ¨è®¡ç®—å‡º`startIndex`åè®¡ç®—å‡º`endIndex`
```js
visibleAreaItemsNum = Math.ceil(listHeight / itemSize)
```

-   æ•°æ®çš„èµ·å§‹ç´¢å¼•: ç”±äºé«˜åº¦å›ºå®šï¼Œèµ·å§‹ç´¢å¼•å¯ä»¥æ ¹æ®æ»šåŠ¨æ‰çš„é«˜åº¦`scrollTop`ç›´æ¥è®¡ç®—å‡º
```js
startIndex = Math.floor(scrollTop / itemSize)
```

-   æ•°æ®çš„ç»“æŸç´¢å¼•: æ ¹æ®èµ·å§‹ç´¢å¼•å’Œå¯è§†åŒºåŸŸæ˜¾ç¤ºçš„itemæ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¡ç®—å‡ºç»“æŸç´¢å¼•
```js
endIndex = startIndex + visibleAreaItemsNum
```

-   åˆ—è¡¨æ˜¾ç¤ºæ•°æ®ä¸ºï¼ŒåŠ ä¸Šäº†ç¼“å†²åŒºåŸŸ
```js
visibleData = data.slice(startIndex - bufferNum, endIndex + bufferNum)
```
### å®ç°
#### è™šæ‹Ÿåˆ—è¡¨çš„åŸºæœ¬ç»“æ„
`fixedHeightContainer`å®¹å™¨è‡ªå®šä¹‰å®½é«˜ï¼Œ`contentContainer`å®¹å™¨ç”¨äºæ’‘èµ·æ»šåŠ¨æ¡
```tsx
// å®šé«˜
const fixedHeightRender = (options: VirtualListProps) => {
	const {itemHeight = 50, itemSumCount = 1000, listWidth, listHeight} = options;
	// è®°å½•æ»šåŠ¨æ‰çš„é«˜åº¦
	const [scrollTop, setScrollTop] = useState<number>(0);
	// è‡ªå®šä¹‰çš„åˆ—è¡¨é«˜åº¦
	const customContainerStyle: CSSProperties = {
		position: 'relative',
		width: listWidth ?? 400,
		height: listHeight ?? 600,
	};
	// 1000ä¸ªå…ƒç´ æ’‘èµ·ç›’å­çš„å®é™…é«˜åº¦
	const contentStyle: CSSProperties = {
		height: itemHeight * itemSumCount,
		width: '100%',
	};
	// å½“è§¦å‘æ»šåŠ¨å°±é‡æ–°è®¡ç®—
	const scrollHandle = (event: React.UIEvent<HTMLElement>) => {
		const {scrollTop} = event.currentTarget;
		setScrollTop(scrollTop);
	};

	return (
		<div
                className={style.fixedHeightContainer}
                style={customContainerStyle}
                onScroll={scrollHandle}>
                <div className={style.contentContainer} style={contentStyle}>
                        {getCurShowChild(options)}
                </div>
		</div>
	);
};
```
#### æ ·å¼
```less
.fixedHeightContainer {
	display: block;
	width: 400px;
	height: 600px;
	overflow: auto;
	border: 1px solid tan;

	.contentContainer {
		display: block;
	}
}
```
#### å®ç°æ ¸å¿ƒæ–¹æ³•
è§£é‡Šéƒ½åœ¨æ³¨é‡Šä¸­ï¼Œå°±æ˜¯å®ç°åŸç†ä¸­çš„æè¿°ï¼Œçº¯è®¡ç®—
```js
const getCurShowChild = (options: VirtualListProps) => {
    const {itemHeight = 50, itemSumCount = 1000, listHeight = 600} = options;
    // å¯è§†åŒºèµ·å§‹ç´¢å¼•
    const startIndex = Math.floor(scrollTop / itemHeight);
    // ä¸Šç¼“å†²åŒºèµ·å§‹ç´¢å¼•
    const finialStartIndex = Math.max(0, startIndex - 2);
    // å¯è§†åŒºèƒ½å±•ç¤ºçš„å…ƒç´ çš„æœ€å¤§ä¸ªæ•°
    const numVisible = Math.ceil(listHeight / itemHeight);
    // ä¸‹ç¼“å†²åŒºç»“æŸç´¢å¼•
    const finialEndIndex = Math.min(itemSumCount, startIndex + numVisible + 2);
    const items = [];
    // æ ¹æ®ä¸Šé¢è®¡ç®—çš„ç´¢å¼•å€¼ï¼Œä¸æ–­æ·»åŠ å…ƒç´ ç»™container
    for (let i = finialStartIndex; i < finialEndIndex; i++) {
            items.push(
                    ChildItem({
                            childHeight: itemHeight,
                            childIndex: i,
                    }),
            );
    }
    return items;
};
```

### æ•ˆæœ
[åœ¨çº¿demoä½“éªŒ](https://zhuling904.github.io/react_demo/?path=/story/%E9%80%9A%E7%94%A8-virtuallist%E8%99%9A%E6%8B%9F%E5%88%97%E8%A1%A8--fixed-height)

![2024-05-25 19.39.29.gif](./assets/å®šé«˜.gif)

## 2.ä¸å®šé«˜è™šæ‹Ÿåˆ—è¡¨
### å›¾ç¤º
å› ä¸ºæ¯ä¸€é¡¹çš„é«˜åº¦ä¸å›ºå®šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„`startIndex`å’Œ`visibleAreaItemsNum`æ— æ³•ç›´æ¥æ ¹æ®é¡¹ç›®é«˜åº¦ç›´æ¥è®¡ç®—å‡ºæ¥ï¼Œä¹Ÿå°±æ„å‘³ç€`endIndex`æˆ‘ä»¬ä¹Ÿè®¡ç®—ä¸å‡ºæ¥

![image-20240615143310445](./assets/image-20240615143310445.png)

### åŸç†
**æˆ‘ä»¬æœ‰ä»€ä¹ˆï¼Ÿ**
+ ä¸€ä¸ªåŒ…å«æ‰€æœ‰å®¹å™¨é«˜åº¦çš„é«˜åº¦åˆ—è¡¨ï¼Ÿ


**çŸ¥é“è¿™ä¸ªèƒ½åšä»€ä¹ˆï¼Ÿ**
+ å¯ä»¥çŸ¥é“æ€»å®¹å™¨çš„é«˜åº¦


**æˆ‘ä»¬éœ€è¦ä»€ä¹ˆï¼Ÿ**
+ ç¬¬ä¸€ï¼šå¯è§†åŒºåŸŸï¼šæˆ‘ä»¬çš„ç›®æ ‡ä»ç„¶æ˜¯å¦‚ä½•è®¡ç®—å‡ºå¯è§†åŒºåŸŸçš„èŠ‚ç‚¹ç´¢å¼•èŒƒå›´ï¼Œå³`[startIndex, endIndex]`ï¼Œç„¶ååŠ ä¸Šç¼“å†²åŒºçš„å¤§å°ï¼Œå°†æ­¤èŒƒå›´å†…çš„èŠ‚ç‚¹æ¸²æŸ“åˆ°å®¹å™¨ä¸­ï¼Œæˆ‘ä»¬æœ€æ ¹æœ¬çš„ç›®çš„æ˜¯è®¡ç®—èµ·å§‹ç´¢å¼•`startIndex`å’Œç»ˆæ­¢ç´¢å¼•`endIndex`ã€‚
+ ç¬¬äºŒï¼šå®¹å™¨çš„æ€»é«˜åº¦ï¼šæˆ‘ä»¬æ— éœ€ç²¾ç¡®è®¡ç®—å…¨éƒ¨æ•°æ®å®¹å™¨åˆ°åº•æœ‰å¤šé«˜ï¼Œéœ€è¦éœ€è¦è¿™ä¸ªæ˜¯ã€æ˜¯å› ä¸ºéœ€è¦æ»šåŠ¨æ¡ï¼Œæ»šåŠ¨åŒºåŸŸã€‚æˆ‘ä»¬å¯ä»¥ç®€å•ç»™å‡ºä¸€ä¸ªç²—ç•¥çš„é«˜åº¦

**å¦‚ä½•è®¡ç®—**
æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„ä¿å­˜å·²ç»å±•ç¤ºè¿‡çš„itemçš„é«˜åº¦ï¼Œåç§»å€¼ä¿¡æ¯å¦‚ä¸‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¡ç®—å‡ºèµ·å§‹ç´¢å¼•ï¼Œç»ˆæ­¢ç´¢å¼•äº†
```js
// æ¯ä¸€é¡¹çš„æ•°æ®ç»“æ„
interface MeasuredDataMap {
	height: number;
	topOffset: number;
}

// ç¼“å­˜æ˜ å°„çš„æ•°æ®ç»“æ„
interface MeasuredDataList {
	measuredDataMap: MeasuredDataMap[];
        // å½“å‰å·²ç»è®°å½•çš„æœ€åä¸€ä¸ªindex
	LastMeasuredItemIndex: number;
}

const measuredData: MeasuredDataList = {
        measuredDataMap: [],
        LastMeasuredItemIndex: -1,
};
```

![image-20240615143316122](./assets/image-20240615143316122.png)

-   é¢„æµ‹åˆ—è¡¨æ€»é«˜åº¦: æˆ‘ä»¬æ— éœ€è·å–ç²¾ç¡®çš„å…¨éƒ¨æ•°é‡çš„å®¹å™¨é«˜åº¦ï¼Œä»…éœ€è¦é€šè¿‡å½“å‰å·²è®°å½•çš„æ€»é«˜åº¦+å½“å‰æœªè®°å½•çš„æ€»é«˜åº¦ï¼Œé¢„ä¼°åˆ—è¡¨æ€»é«˜åº¦
```js
const totalEstimatedHeight =
			measuredHeight + unMeasuredItemsCount * defaultItemHeight;
```
-   æœ€å¤§ç´¢å¼•åç§»å€¼: ç°åœ¨æˆ‘ä»¬æ— æ³•é€šè¿‡åˆ—è¡¨é¡¹é«˜åº¦ç›´æ¥ç®—å‡ºï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡èµ·å§‹é¡¹çš„åç§»å€¼åŠ ä¸Šåˆ—è¡¨çš„æ€»é«˜åº¦ï¼Œè®¡ç®—å‡ºæœ€å¤§åç§»å€¼ï¼Œä»è€Œè®¡ç®—å‡ºç»“æŸç´¢å¼•ã€‚
```js
const maxOffset = startItem.topOffset + listHeight;
```

-   æ•°æ®çš„èµ·å§‹ç´¢å¼•: æˆ‘ä»¬å¯ä»¥é€šè¿‡äºŒåˆ†æ³•åœ¨å·²ç»è®°å½•çš„é¡¹ä¸­æ‰¾åˆ°`topOffset >= srcollTop`çš„é¡¹å°±æ˜¯ç¬¬ä¸€é¡¹
```js
const getStartIndex = (options: VirtualListProps, scrollOffset: number) => {
    const {itemSumCount = 1000} = options;
    let low = 0;
    let high = itemSumCount - 1;

    while (low <= high) {
            const mid = Math.floor((low + high) / 2);
            const currentOffset = getItemMetaData(mid).topOffset;
            if (currentOffset === scrollOffset) {
                    return mid;
            } else if (currentOffset < scrollOffset) {
                    low = mid + 1;
            } else {
                    high = mid - 1;
            }
    }
    return low;
};
```

-   æ•°æ®çš„ç»“æŸç´¢å¼•: ä»`startItem`ä¸€ç›´éå†åŠ ä¸Šæ¯ä¸€é¡¹çš„`height`ï¼Œç›´åˆ°`topOffset >= maxOffset`ï¼Œå°±æ˜¯ç»“æŸé¡¹çš„ç´¢å¼•
```js
// æŸ¥æ‰¾ç»ˆæ­¢ç´¢å¼•ï¼šé€šè¿‡èµ·å§‹itemçš„topOffset+è‡ªå®šä¹‰çš„listHeightå¯ä»¥è®¡ç®—å‡ºå½“å‰èƒ½æ˜¾ç¤ºçš„æœ€å¤§åç§»å€¼maxOffset
// ä»startItemä¸€ç›´éå†åŠ ä¸Šheightï¼Œç›´åˆ°offset >= maxOffset
const getEndIndex = (options: VirtualListProps, startIndex: number) => {
    const {listHeight = 600, itemSumCount = 1000} = options;
    const startItem = getItemMetaData(startIndex);
    const maxOffset = startItem.topOffset + listHeight;
    let offset = startItem.topOffset + startItem.height;
    let endIndex = startIndex;

    while (offset <= maxOffset && endIndex < itemSumCount - 1) {
            endIndex++;
            const currentItem = getItemMetaData(endIndex);
            offset += currentItem.height;
    }
    return endIndex;
};

```
### å®ç°
#### å®šä¹‰ç¼“å­˜æ•°æ®ç»“æ„
```js
// ä½¿ç”¨useRefä¿å­˜itemHeightListï¼Œç¡®ä¿åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ä¸å˜
const itemHeightListRef = useRef<number[]>(
        new Array(itemSumCount).fill(0).map(() => {
                return itemHeight + Math.round(Math.random() * itemHeight);
        }),
);
const getItemHeightByIndex = (index: number) =>
        itemHeightListRef.current[index];

const measuredData: MeasuredDataList = {
        measuredDataMap: [],
        LastMeasuredItemIndex: -1,
};
```

#### è·å–æ¯ä¸€é¡¹çš„æ•°æ®
æ ¹æ®`LastMeasuredItemIndex`
+ å¦‚æœå°äº`LastMeasuredItemIndex`çš„éƒ½æ˜¯è¢«ç¼“å­˜è¿‡çš„é¡¹ï¼Œç›´æ¥è·å–
+ å¦‚æœå¤§äº`LastMeasuredItemIndex`åˆ™æ˜¯æœªè¢«ç¼“å­˜è¿‡çš„é¡¹ï¼Œä»`LastMeasuredItemIndex`å¼€å§‹ï¼Œéå†åˆ°`index`ï¼Œå°†éå†çš„æ‰€æœ‰é¡¹çš„`height`ç›¸åŠ ï¼Œå³ä¸ºå½“å‰é¡¹çš„`index`
```js
// LastMeasuredItemIndexæ˜¯å·²ç»è¢«è®°å½•çš„æ»šåŠ¨åˆ°çš„æœ€å¤§ç´¢å¼•ï¼Œå¦‚æœæ˜¯å¤§äºLastMeasuredItemIndexï¼Œ
// åˆ™å¯ä»¥é€šè¿‡ä¸€é¡¹ä¸€é¡¹çš„ç›¸åŠ ï¼ŒåŠ åˆ°indexå°±æ˜¯å½“å‰é¡¹çš„æœ€å¤§åç§»å€¼
const getItemMetaData = (index: number) => {
        const {measuredDataMap, LastMeasuredItemIndex} = measuredData;
        if (index > LastMeasuredItemIndex) {
                let topOffset = 0;
                // å…ˆè·å–åˆ°æœ€åº•éƒ¨æ–°å¢çš„ä¸€é¡¹çš„topOffset
                if (LastMeasuredItemIndex >= 0) {
                        const lastMeasuredItem = measuredDataMap[LastMeasuredItemIndex];
                        topOffset += lastMeasuredItem.topOffset + lastMeasuredItem.height;
                }
                // éå†è®°å½•ï¼Œç›´åˆ°index
                for (let i = LastMeasuredItemIndex + 1; i <= index; i++) {
                        const currentItemSize = getItemHeightByIndex(i);
                        measuredDataMap[i] = {height: currentItemSize, topOffset};
                        topOffset += currentItemSize;
                }
                measuredData.LastMeasuredItemIndex = index;
        }
        return measuredDataMap[index];
};

```

#### è·å–å¼€å§‹ç´¢å¼•
æŸ¥æ‰¾èµ·å§‹ç´¢å¼•ï¼Œä»è®°å½•çš„æ•°æ®ç»“æ„ä¸­æŸ¥æ‰¾ï¼Œç¬¬ä¸€é¡¹å°±æ˜¯`topOffset >= srcollTop`
è¿™é‡Œæˆ‘ä»¬ç”¨äºŒåˆ†æ³•è¿›è¡Œä¼˜åŒ–
```js
const getStartIndex = (options: VirtualListProps, scrollOffset: number) => {
    const {itemSumCount = 1000} = options;
    let low = 0;
    let high = itemSumCount - 1;

    while (low <= high) {
            const mid = Math.floor((low + high) / 2);
            const currentOffset = getItemMetaData(mid).topOffset;
            if (currentOffset === scrollOffset) {
                    return mid;
            } else if (currentOffset < scrollOffset) {
                    low = mid + 1;
            } else {
                    high = mid - 1;
            }
    }
    return low;
};
```

#### è·å–ç»“æŸç´¢å¼•
æˆ‘ä»¬è™½ç„¶ä¸çŸ¥é“å¯è§†åŒºèƒ½æ˜¾ç¤ºå¤šå°‘ä¸ªåˆ—è¡¨é¡¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ ¹æ®ç¬¬ä¸€ä¸ªçš„åç§»å€¼åŠ ä¸Šè™šæ‹Ÿåˆ—è¡¨çš„é«˜åº¦ï¼Œè®¡ç®—å‡ºæœ€å¤§åç§»å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŸ¥æ‰¾ç»ˆæ­¢ç´¢å¼•ï¼šé€šè¿‡èµ·å§‹itemçš„`topOffset`+è‡ªå®šä¹‰çš„`listHeight`å¯ä»¥è®¡ç®—å‡ºå½“å‰èƒ½æ˜¾ç¤ºçš„æœ€å¤§åç§»å€¼`maxOffset`ï¼Œä»`startItem`ä¸€ç›´éå†åŠ ä¸Š`height`ï¼Œç›´åˆ°`offset >= maxOffset`å°±æ˜¯ç»“æŸç´¢å¼•çš„ä½ç½®
```js
const getEndIndex = (options: VirtualListProps, startIndex: number) => {
    const {listHeight = 600, itemSumCount = 1000} = options;
    const startItem = getItemMetaData(startIndex);
    const maxOffset = startItem.topOffset + listHeight;
    let offset = startItem.topOffset + startItem.height;
    let endIndex = startIndex;

    while (offset <= maxOffset && endIndex < itemSumCount - 1) {
            endIndex++;
            const currentItem = getItemMetaData(endIndex);
            offset += currentItem.height;
    }
    return endIndex;
};

```
#### å¯è§†åŒºé¡¹ç›®è·å–
```js
// è·å–å½“å‰å¯ç°å®çš„èŒƒå›´
const getChildShowRange = (
        options: VirtualListProps,
        scrollOffset: number,
) => {
        const {itemSumCount = 1000, bufferNum = 4} = options;
        const startIndex = getStartIndex(options, scrollOffset);
        const endIndex = getEndIndex(options, startIndex);
        return {
                bufferStartIndex: Math.max(0, startIndex - bufferNum),
                bufferEndIndex: Math.min(itemSumCount - 1, endIndex + bufferNum),
                startIndex,
                endIndex,
        };
};

const getCurShowChild = (options: VirtualListProps, scrollTop: number) => {
        const items = [];
        const {bufferStartIndex, bufferEndIndex} = getChildShowRange(
                options,
                scrollTop,
        );
        for (let i = bufferStartIndex; i <= bufferEndIndex; i++) {
                const item = getItemMetaData(i);
                const itemStyle: CSSProperties = {
                        position: 'absolute',
                        height: item.height,
                        width: '100%',
                        top: item.topOffset,
                };
                items.push(<ChildItem key={i} childIndex={i} itemStyle={itemStyle} />);
        }
        console.log('âœ… ~ measuredData:', measuredData);

        return items;
};
```
### æ•ˆæœ
[åœ¨çº¿demoä½“éªŒ](https://zhuling904.github.io/react_demo/?path=/story/%E9%80%9A%E7%94%A8-virtuallist%E8%99%9A%E6%8B%9F%E5%88%97%E8%A1%A8--uncertain-height)

![2024-05-25 19.40.10.gif](./assets/ä¸å®šé«˜.gif)

## 3.åŠ¨æ€é«˜åº¦è™šæ‹Ÿåˆ—è¡¨
### å›¾ç¤º
å¤§éƒ¨åˆ†åŸç†æ˜¯è·Ÿä¸å®šé«˜ä¸€è‡´çš„ï¼ŒåŒºåˆ«æ˜¯æˆ‘ä»¬è¿ä¸€ä¸ªé«˜åº¦åˆ—è¡¨éƒ½æ²¡æœ‰ï¼Œæ— æ³•çŸ¥é“æ¯ä¸€é¡¹çš„é«˜åº¦æ˜¯å¤šå°‘ï¼Œæ¯ä¸€é¡¹çš„é«˜åº¦æ˜¯åœ¨æ¸²æŸ“æ—¶ç¡®å®šçš„ï¼Œä¸ºäº†é˜²æ­¢æŠ–åŠ¨ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªé»˜è®¤é«˜åº¦ã€‚
![image-20240615143354271](./assets/image-20240615143354271.png)
### åŸç†
åŸç†ä¸»è¦æ˜¯è®¾ç½®å…ˆè®¾ç½®ä¸€ä¸ªé»˜è®¤çš„é«˜åº¦ï¼Œå¹¶è®°å½•åˆ°ç¼“å­˜æ•°æ®ç»“æ„ä¸­ï¼Œæˆ‘ä»¬å»ç›‘å¬èŠ‚ç‚¹çš„é«˜åº¦å˜æ¢ï¼Œåœ¨å‘ç”Ÿå˜åŒ–åé‡æ–°è®¡ç®—ç¼“å­˜æ•°æ®ï¼Œç„¶åæ›´æ–°åˆ—è¡¨ã€‚
### å®ç°
#### å®šä¹‰é»˜è®¤é«˜åº¦
åœ¨ä¸å®šé«˜çš„åŸºç¡€ä¸Šæˆ‘ä»¬æ›´æ”¹ä»£ç å¦‚ä¸‹
è¿™é‡Œæˆ‘ä»¬ç”¨çš„éƒ½æ˜¯é»˜è®¤é«˜åº¦ï¼Œå› ä¸ºåé¢æ¸²æŸ“æ—¶ç›‘å¬èŠ‚ç‚¹å˜åŒ–ä¼šæ›´æ–°ç¼“å­˜æ•°æ®
```js
// è·å–æ¯ä¸€é¡¹çš„å…ƒæ•°æ®
const getItemMetaData = (index: number) => {
    const {measuredDataMap, LastMeasuredItemIndex} = measuredData;
    // å¦‚æœindexå¤§äºå½“å‰è®°å½•çš„æœ€å¤§å€¼ï¼ŒæŒ¨ä¸ªè®¡ç®—åˆ°indexå»ï¼Œç”¨top+heightä¸€ä¸ªä¸€ä¸ªè®¡ç®—
    if (index > LastMeasuredItemIndex) {
        let topOffset =
                LastMeasuredItemIndex >= 0
                        ? measuredDataMap[LastMeasuredItemIndex].topOffset +
                                measuredDataMap[LastMeasuredItemIndex].height : 0;
        for (let i = LastMeasuredItemIndex + 1; i <= index; i++) {
                // è¿™é‡Œç”¨çš„éƒ½æ˜¯é»˜è®¤é«˜åº¦ï¼Œå› ä¸ºåé¢æ¸²æŸ“æ—¶ä¼šæ›´æ–°ç¼“å­˜æ•°æ®
                measuredDataMap[i] = {height: 50, topOffset};
                topOffset += 50;
        }
        measuredData.LastMeasuredItemIndex = index;
    }
    return measuredDataMap[index];
};
```
#### åŠ¨æ€è·å–ä»»æ„é«˜åº¦çš„é¡¹ç›®
è¿™é‡Œæ‰€æœ‰é¡¹ç›®çš„é«˜åº¦éƒ½æ˜¯é€šè¿‡`getOneChildItem`åœ¨æ¸²æŸ“çš„æ—¶å€™åŠ¨æ€è·å–åˆ°çš„ã€‚
```js
// è·å–ä»»æ„é«˜åº¦çš„item
const getRandomHeightItem = (() => {
	let items: ReactNode[] | null = null;
	return () => {
		if (items) return items;
		items = [];
		const itemCount = 1000;
		for (let i = 0; i < itemCount; i++) {
			const height = 30 + Math.floor(Math.random() * 30);
			const style = {
				height,
				width: '100%',
			};
			items.push(<ChildItem key={i} childIndex={i} itemStyle={style} />);
		}
		return items;
	};
})();

// åŠ¨æ€è·å–å­é›†
const DynamicChildItem = (options: DynamicChildItemProps) => {
	const {itemStyle, getChildItem, onSizeChange, childIndex} = options;
	const childRef = useRef(null);
	const resizeObserverRef = useRef<ResizeObserver | null>(null);

	useEffect(() => {
		const domNode = childRef.current;
		if (domNode) {
			if (!resizeObserverRef.current) {
				resizeObserverRef.current = new ResizeObserver(() => {
					onSizeChange(childIndex, domNode);
				});
			}
			resizeObserverRef.current.observe(domNode);
		}
		return () => {
			if (resizeObserverRef.current && domNode) {
				resizeObserverRef.current.unobserve(domNode);
			}
		};
	}, [childIndex, onSizeChange]);

	return (
		<div ref={childRef} style={itemStyle}>
			{getChildItem(childIndex)}
		</div>
	);
};

const getOneChildItem = (index: number) => getRandomHeightItem()[index];
```
è°ƒç”¨
```js
// æ ¹æ®å½“å‰æ˜¾ç¤ºèŒƒå›´ï¼Œæ’å…¥èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹é€šè¿‡getOneChildItemåŠ¨æ€è·å–
const getCurShowChild = (scrollTop: number) => {
    const items = [];
    const {bufferStartIndex, bufferEndIndex} = getChildShowRange(scrollTop);
    for (let i = bufferStartIndex; i <= bufferEndIndex; i++) {
            const item = getItemMetaData(i);
            const itemStyle: CSSProperties = {
                    position: 'absolute',
                    height: item.height,
                    width: '100%',
                    top: item.topOffset,
            };
            items.push(
                    <DynamicChildItem
                            key={`${i}${item.topOffset}`}
                            childIndex={i}
                            getChildItem={getOneChildItem}
                            onSizeChange={sizeChangeHandle}
                            itemStyle={itemStyle}
                    />,
            );
    }
    return items;
};

```

#### ç›‘å¬èŠ‚ç‚¹å®½é«˜å˜åŒ–
é€šè¿‡ç›‘å¬èŠ‚ç‚¹çš„å°ºå¯¸å˜åŒ–å»æ›´æ–°ç¼“å­˜æ•°æ®ï¼Œç„¶åè§¦å‘è™šæ‹Ÿåˆ—è¡¨é‡æ–°æ¸²æŸ“ï¼Œå®ç°åŠ¨æ€é«˜åº¦æ¸²æŸ“
```js
useEffect(() => {
    const domNode = childRef.current;
    if (domNode) {
            if (!resizeObserverRef.current) {
                    resizeObserverRef.current = new ResizeObserver(() => {
                            onSizeChange(childIndex, domNode);
                    });
            }
            resizeObserverRef.current.observe(domNode);
    }
    return () => {
            if (resizeObserverRef.current && domNode) {
                    resizeObserverRef.current.unobserve(domNode);
            }
    };
}, [childIndex, onSizeChange]);


// ç›‘å¬èŠ‚ç‚¹å°ºå¯¸å˜åŒ–ï¼Œæ›´æ–°measuredDataMapï¼Œè§¦å‘é‡æ–°æ¸²æŸ“
const sizeChangeHandle = (index: number, domNode: HTMLDivElement) => {
    const height = (domNode.children[0] as HTMLDivElement).offsetHeight;
    const {measuredDataMap, LastMeasuredItemIndex} = measuredData;
    measuredDataMap[index].height = height;
    let offset = 0;
    // é‡æ–°è®¡ç®—åç§»å€¼
    for (let i = 0; i <= LastMeasuredItemIndex; i++) {
            measuredDataMap[i].topOffset = offset;
            offset += measuredDataMap[i].height;
    }
    domNode.style.height = height + 'px';
    // è§¦å‘åˆ—è¡¨çš„ä¸€æ¬¡æ›´æ–°
    setNeedUpdate(true);
};
```
### æ•ˆæœ
[åœ¨çº¿demoä½“éªŒ](https://zhuling904.github.io/react_demo/?path=/story/%E9%80%9A%E7%94%A8-virtuallist%E8%99%9A%E6%8B%9F%E5%88%97%E8%A1%A8--dynamic-height)

![2024-05-25 19.40.47.gif](./assets/åŠ¨æ€é«˜åº¦.gif)

# å‚è€ƒæ–‡ç« 
+ [ã€Œå‰ç«¯è¿›é˜¶ã€é«˜æ€§èƒ½æ¸²æŸ“åä¸‡æ¡æ•°æ®(è™šæ‹Ÿåˆ—è¡¨)](https://juejin.cn/post/6844903982742110216?searchId=202405151054293D6A8B7D5246CA76F132)
+ [è™šæ‹Ÿåˆ—è¡¨ï¼Œæˆ‘çœŸçš„ä¼šäº†ï¼ï¼ï¼](https://juejin.cn/post/7085941958228574215?searchId=202405151054293D6A8B7D5246CA76F132)
+ [ä¸‰ç§è™šæ‹Ÿåˆ—è¡¨åŸç†ä¸å®ç°](https://juejin.cn/post/7232856799170805820?searchId=20240525194501C3EF4D0CAEAB585C40C9#heading-17)

# ğŸ æ¨èé˜…è¯»
## å·¥ç¨‹åŒ–
æœ¬ç³»åˆ—æ˜¯ä¸€ä¸ªä»0åˆ°1çš„å®ç°è¿‡ç¨‹ï¼Œå¦‚æœæ‚¨æœ‰è€å¿ƒè·Ÿç€å®ç°ï¼Œæ‚¨å¯ä»¥å®ç°ä¸€ä¸ªå®Œæ•´çš„`react18 + ts5 + webpack5 + ä»£ç è´¨é‡&ä»£ç é£æ ¼æ£€æµ‹&è‡ªåŠ¨ä¿®å¤ + storybook8 + rollup + git action`å®ç°çš„ä¸€ä¸ªå®Œæ•´çš„ç»„ä»¶åº“æ¨¡æ¿é¡¹ç›®ã€‚å¦‚æœæ‚¨ä¸æ‰“ç®—è‡ªå·±é…ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥clone[ç»„ä»¶åº“ä»“åº“](https://github.com/zhuling904/react_demo/tree/rollup_comp)åˆ‡æ¢åˆ°`rollup_comp`åˆ†æ”¯å³æ˜¯å®Œæ•´çš„é¡¹ç›®ï¼Œå½“å‰å®ç°å·²ç»è¶³å¤Ÿä¸ªäººä½¿ç”¨ï¼Œåç»­æˆ‘ä»¬ä¼šæ–°å¢webpack5ä¼˜åŒ–ã€æŒ‰éœ€åŠ è½½ç»„ä»¶ã€å®ç°ä¸€äº›å¸¸è§çš„ç»„ä»¶å°è£…ï¼šåŒ…æ‹¬ä½†ä¸é™äºæ‹–æ‹½æ’åºã€ç€‘å¸ƒæµã€ç©¿æ¢­æ¡†ã€å¼¹çª—ç­‰  
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘é¡¹ç›®æ­å»ºç¯‡-é¡¹ç›®åˆå§‹åŒ–&prettierã€eslintã€stylelintã€lint-stagedã€husky](https://juejin.cn/post/7353504333999505408)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘é¡¹ç›®æ­å»ºç¯‡-é…ç½®changelogã€webpack5æ‰“åŒ…](https://juejin.cn/post/7353561676091097103)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘é¡¹ç›®æ­å»ºç¯‡-å¼•å…¥reactã€tsã€babelè§£æes6+ã€é…ç½®css module](https://juejin.cn/post/7353963878541246504)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ç»„ä»¶åº“æ­å»ºç¯‡-å¼•å…¥storybookã€rollupæ‰“åŒ…ç»„ä»¶ã€æœ¬åœ°æµ‹è¯•ç»„ä»¶åº“](https://juejin.cn/post/7355026320088989733)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘åŒ…ç®¡ç†å™¨ç¯‡-ä¸‰å¤§åŒ…ç®¡ç†å™¨ã€npmå·¥ç¨‹ç®¡ç†ã€npmå‘å¸ƒæµç¨‹](https://juejin.cn/post/7356175306937466916)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘è‡ªåŠ¨åŒ–ç¯‡-Github ActionåŸºæœ¬ä½¿ç”¨ã€è‡ªåŠ¨éƒ¨ç½²ç»„ä»¶åº“æ–‡æ¡£ã€github3DæŒ‡æ ‡ç»Ÿè®¡](https://juejin.cn/post/7356815857078157331)
*   [ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘è‡ªåŠ¨åŒ–ç¯‡-æ‰‹å†™è„šæœ¬ä¸€é”®è‡ªåŠ¨tagã€å‘åŒ…ã€å¼•å¯¼ç™»å½•npm](https://juejin.cn/post/7366601730426159144)
## å¸¸è§ç»„ä»¶å®ç°
*   [ã€ç»„ä»¶å®ç°ç¯‡ã€‘"ä»é›¶ä½¿ç”¨reactæ‰“é€ ç€‘å¸ƒæµçš„å››ç§æ–¹å¼ï¼šå®Œç¾å±•ç¤ºåŠ¨æ€å›¾ç‰‡æµ"](https://juejin.cn/post/7370513151052021787)
*   [ã€ç»„ä»¶å®ç°ç¯‡ã€‘å®šé«˜ã€ä¸å®šé«˜ã€åŠ¨æ€é«˜åº¦è™šæ‹Ÿåˆ—è¡¨å®ç°](https://juejin.cn/spost/7372488623944728585#heading-36)
## é¢è¯•æ‰‹å†™ç³»åˆ—
*   [å‰ç«¯é¢è¯•æ‰‹å†™å¿…å¤‡ã€å®ç°å¸¸è§å…«å¤§æ•°æ®ç»“æ„ä¸€ã€‘](https://juejin.cn/post/7353504333999505408)
*   [æ‰‹å†™å“ˆå¸Œè¡¨ã€é“¶å››æœ«å°¾ï¼Œä½ ä¸Šå²¸äº†å—ï¼Ÿã€‘å“ˆå¸Œè¡¨ï¼Œå¿«é€Ÿè®¡ç®—ã€å‡åŒ€åˆ†å¸ƒã€æ‰©å®¹å®ç°](https://juejin.cn/post/7359877430340157503)
*   [ã€å‰ç«¯é¢è¯•æ‰‹å†™å¿…å¤‡ã€‘æ ‘ğŸŒ²&å®ç°æ ‘ç»“æ„](https://juejin.cn/post/7370513151052038171)
## reactå®ç°åŸç†ç³»åˆ—
*   [ã€reactåŸç†å®è·µã€‘ä½¿ç”¨babelæ‰‹æ“æ¢ç´¢ä¸‹jsxçš„åŸç†](https://juejin.cn/spost/7360512664316117026)
*   [ã€å–‚é¥­å¼è°ƒè¯•reactæºç ã€‘ä¸Šæ‰‹è°ƒè¯•æºç æ¢ç©¶jsxåŸç†](https://juejin.cn/spost/7361284455535345699)
*   [ã€ä¸Šæ‰‹è°ƒè¯•æºç ç³»åˆ—ã€‘å›¾è§£reactå‡ ä¸ªæ ¸å¿ƒåŒ…ä¹‹é—´çš„å…³è”](https://juejin.cn/spost/7363220284503097354#heading-0)
*   [ã€ä¸Šæ‰‹è°ƒè¯•æºç ç³»åˆ—ã€‘reactå¯åŠ¨æµç¨‹ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºä¸‰å¤§å…¨å±€å¯¹è±¡](https://juejin.cn/post/7363193808521199655#heading-1)
## å…¶ä»–
*   [å·¥ä½œæµã€æ•ˆç‡å°æŠ€å·§ã€‘è®©alfredå¸®æˆ‘å¯åŠ¨æ‰€æœ‰é¡¹ç›®ï¼Œnice](https://juejin.cn/post/7358709354424860707)
*   [GPT4å‰ç«¯é£Ÿç”¨æŒ‡å—](https://juejin.cn/post/7352045198854406183)



# ğŸ‹ å†™åœ¨æœ€å

å¦‚æœæ‚¨çœ‹åˆ°è¿™é‡Œäº†ï¼Œå¹¶ä¸”è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå¸Œæœ›æ‚¨èƒ½å¤Ÿç‚¹èµğŸ‘å’Œæ”¶è—â­æ”¯æŒä¸€ä¸‹ä½œè€…ğŸ™‡ğŸ™‡ğŸ™‡ï¼Œæ„Ÿè°¢ğŸºğŸºï¼å¦‚æœæ–‡ä¸­æœ‰ä»»ä½•ä¸å‡†ç¡®ä¹‹å¤„ï¼Œä¹Ÿæ¬¢è¿æ‚¨æŒ‡æ­£ï¼Œå…±åŒè¿›æ­¥ã€‚æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼ŒæœŸå¾…æ‚¨çš„ç‚¹èµğŸ‘å’Œæ”¶è—â­ï¼

æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å…³æ³¨ä¸‹æˆ‘çš„å…¬ä¼—å·ObjectXå‰ç«¯å®éªŒå®¤


ğŸŒŸ å°‘èµ°å¼¯è·¯ | ObjectXå‰ç«¯å®éªŒå®¤ ğŸ› ï¸ã€Œç²¾é€‰èµ„æºï½œå®æˆ˜ç»éªŒï½œæŠ€æœ¯æ´è§ã€

