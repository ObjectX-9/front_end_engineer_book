<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://s21.ax1x.com/2024/06/14/pkdLxmt.png"
    />
    <link rel="stylesheet" href="/front_end_engineer_book/umi.4c36f7fa.css" />
    <script>
      window.routerBase = "/front_end_engineer_book/";
    </script>
    <script>
      //! umi version: 3.5.17
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.indexOf(e) > -1 ? e : r[0]
        );
      })();
    </script>
    <title>4.react+ts环境搭建</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/01docs/00actual_combat/04react_ts" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false" data-use-bg="false" style="padding-bottom:50px;overflow:unset;background-size:cover"><div class="__dumi-default-navbar" data-mode="site" data-is-home="false" style="background-color:#212121"><button class="__dumi-default-navbar-toggle"></button><div class="logo_wrapper"><a class="__dumi-default-navbar-logo" href="/front_end_engineer_book//"><img src="https://s21.ax1x.com/2024/06/14/pkdLxmt.png" alt="ObjectX前端工程化实践"/><span class="label">ObjectX前端工程化实践</span></a><div class="search_wrapper"><div class="__dumi-default-search" data-is-home="false"><svg width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="1.0" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="主页-登录页" transform="translate(-337.000000, -20.000000)"><g id="顶部导航" transform="translate(28.000000, 0.000000)"><g id="编组-3" transform="translate(309.000000, 20.000000)"><rect id="矩形" opacity="0.0848214286" x="0" y="0" width="24" height="24"></rect><path d="M7.63246763,7.63246763 C9.80909114,5.45584412 13.3380951,5.45584412 15.5147186,7.63246763 C17.5003311,9.61808009 17.6745798,12.7291297 16.0374649,14.9122691 L17.7667903,16.6407545 C18.0777366,16.9517007 18.0777366,17.4558441 17.7667903,17.7667903 C17.4558441,18.0777366 16.9517007,18.0777366 16.6407545,17.7667903 L14.9122691,16.0374649 C12.7291297,17.6745798 9.61808009,17.5003311 7.63246763,15.5147186 C5.45584412,13.3380951 5.45584412,9.80909114 7.63246763,7.63246763 Z M14.3886828,8.75850349 C12.8339517,7.20377241 10.3132346,7.20377241 8.75850349,8.75850349 C7.20377241,10.3132346 7.20377241,12.8339517 8.75850349,14.3886828 C10.3132346,15.9434138 12.8339517,15.9434138 14.3886828,14.3886828 C15.9434138,12.8339517 15.9434138,10.3132346 14.3886828,8.75850349 Z" id="形状结合" fill="#666666" fill-rule="nonzero"></path></g></g></g></g></svg><input type="search" class="__dumi-default-search-input" placeholder="search document..." value=""/><ul></ul></div></div></div><span><nav class="navbar_links"><span class="navbar_links-item"><a aria-current="page" class="active" href="/front_end_engineer_book//01docs">🚀 工程化实践指南</a></span><span class="navbar_links-item"><a href="/front_end_engineer_book//02comp">📚 常见组件实现</a></span><span class="navbar_links-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/ObjectX-9/front_end_engineer_book">⭐️GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></span></div><ul role="slug-list" class="__dumi-default-layout-toc"><li role="slug-list-title">4.react+ts环境搭建</li><li title="支持react" data-depth="1"><a href="#支持react" class="active"><span>支持react</span></a></li><li title="安装babel支持tsx" data-depth="1"><a href="#安装babel支持tsx" class=""><span>安装babel支持tsx</span></a></li><li title="支持js文件中使用jsx语法" data-depth="2"><a href="#支持js文件中使用jsx语法" class=""><span>支持js文件中使用jsx语法</span></a></li><li title="支持tsx文件的解析" data-depth="2"><a href="#支持tsx文件的解析" class=""><span>支持tsx文件的解析</span></a></li><li title="tsx 语法测试" data-depth="2"><a href="#tsx-语法测试" class=""><span>tsx 语法测试</span></a></li><li title="增加类型声明" data-depth="1"><a href="#增加类型声明" class=""><span>增加类型声明</span></a></li><li title="增加图片、文件等模块的类型声明" data-depth="1"><a href="#增加图片、文件等模块的类型声明" class=""><span>增加图片、文件等模块的类型声明</span></a></li><li title="baseUrl&amp;paths&amp;配置别名" data-depth="1"><a href="#baseurlpaths配置别名" class=""><span>baseUrl&amp;paths&amp;配置别名</span></a></li><li title="配置css module" data-depth="1"><a href="#配置css-module" class=""><span>配置css module</span></a></li><li title="配置es6+转es5" data-depth="1"><a href="#配置es6转es5" class=""><span>配置es6+转es5</span></a></li><li title="🍋 写在最后" data-depth="1"><a href="#-写在最后" class=""><span>🍋 写在最后</span></a></li></ul><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://s21.ax1x.com/2024/06/14/pkdLxmt.png&#x27;)" href="/front_end_engineer_book//"></a><h1>ObjectX前端工程化实践</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a aria-current="page" class="active" href="/front_end_engineer_book//01docs">🚀 工程化实践指南</a></li><li><a href="/front_end_engineer_book//02comp">📚 常见组件实现</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/ObjectX-9/front_end_engineer_book">⭐️GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><ul class="ant-menu ant-menu-root ant-menu-inline ant-menu-light" role="menu" tabindex="0" data-menu-list="true"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">00实战搭建&amp;部署篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat"><span>0.更新日志</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/01init"><span>1.项目初始化&amp;配置</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/02code_specification"><span>2.代码规范</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/03code_quarity"><span>3.代码质量</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-selected ant-menu-item-only-child"><span class="ant-menu-title-content"><a aria-current="page" class="active" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts"><span>4.react+ts环境搭建</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/05changelog"><span>5.更新日志changelog</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/06webpack5_basic_config"><span>6.webpack5基本配置</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/07comp_constructor"><span>7.组件库搭建</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/08page_manage"><span>8.三大包管理器&amp;npm工程化&amp;发布流程</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/09git_action"><span>9.Github Action、部署组件库文档</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish"><span>10.自动化篇-手写脚本一键自动tag、发包、引导登录npm</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">01详解-项目搭建篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/01project_construction"><span>项目搭建篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">02详解-项目打包篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/02project_build"><span>项目打包篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">03详解-组件库搭建篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/03comp_construction"><span>组件库搭建篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">04详解-包管理器篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/04package_manager"><span>包管理器篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">05详解-项目自动化篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/05auto_op"><span>项目自动化篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">06详解-项目部署篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/06project_deploy"><span>项目部署篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">07详解-脚手架搭建篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/07cli"><span>脚手架搭建篇总览</span></a></span></li></ul></li></ul><div style="display:none" aria-hidden="true"></div></ul></div></div><div class="__dumi-default-layout-content"><div class="__dumi-default-mobile-content"><article><div class="__dumi-default-content-header markdown no-desc"><h1>4.react+ts环境搭建</h1></div><div class="markdown"><h1 id="支持react"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#支持react"><span class="icon icon-link"></span></a>支持react</h1><p>安装 react 和 react-dom ：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">yarn add react@18.2.0 react-dom@18.2.0 -S</span></div></pre></div><p>-S 相当于 --save ， -D 相当于 --save-dev 。</p><p>其实安装了这两个包就已经能使用 jsx 语法了，我们在 src/index.js 中输入以下代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f" data-45-js-token="import-0-0">import</span><span class="token plain"> </span><span class="token imports maybe-class-name" data-45-js-token="React-0-7">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f" data-45-js-token="from-0-13">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-45-js-token="&#x27;react&#x27;-0-18">&#x27;react&#x27;</span><span class="token punctuation" style="color:#393A34" data-45-js-token=";-0-25">;</span><span class="token plain" data-45-js-token="-0-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-45-js-token="-1-0"></span><span class="token keyword module" style="color:#00009f" data-45-js-token="import-1-0">import</span><span class="token plain"> </span><span class="token imports maybe-class-name" data-45-js-token="ReactDOM-1-7">ReactDOM</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f" data-45-js-token="from-1-16">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-45-js-token="&#x27;react-dom&#x27;-1-21">&#x27;react-dom&#x27;</span><span class="token punctuation" style="color:#393A34" data-45-js-token=";-1-32">;</span><span class="token plain" data-45-js-token="-1-33"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-45-js-token="-2-0"></span><span class="token keyword module" style="color:#00009f" data-45-js-token="import-2-0">import</span><span class="token plain"> </span><span class="token imports maybe-class-name" data-45-js-token="App-2-7">App</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f" data-45-js-token="from-2-11">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-45-js-token="&#x27;./app&#x27;-2-16">&#x27;./app&#x27;</span><span class="token punctuation" style="color:#393A34" data-45-js-token=";-2-23">;</span><span class="token plain" data-45-js-token="-2-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-45-js-token="-3-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-45-js-token="-4-0"></span><span class="token maybe-class-name" data-45-js-token="ReactDOM-4-0">ReactDOM</span><span class="token punctuation" style="color:#393A34" data-45-js-token=".-4-8">.</span><span class="token method function property-access" style="color:#d73a49" data-45-js-token="render-4-9">render</span><span class="token punctuation" style="color:#393A34" data-45-js-token="(-4-15">(</span><span class="token operator" style="color:#393A34" data-45-js-token="&lt;-4-16">&lt;</span><span class="token maybe-class-name" data-45-js-token="App-4-17">App</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-45-js-token="/-4-21">/</span><span class="token operator" style="color:#393A34" data-45-js-token="&gt;-4-22">&gt;</span><span class="token punctuation" style="color:#393A34" data-45-js-token=",-4-23">,</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa" data-45-js-token="document-4-25">document</span><span class="token punctuation" style="color:#393A34" data-45-js-token=".-4-33">.</span><span class="token method function property-access" style="color:#d73a49" data-45-js-token="querySelector-4-34">querySelector</span><span class="token punctuation" style="color:#393A34" data-45-js-token="(-4-47">(</span><span class="token string" style="color:#e3116c" data-45-js-token="&#x27;#root&#x27;-4-48">&#x27;#root&#x27;</span><span class="token punctuation" style="color:#393A34" data-45-js-token=")-4-55">)</span><span class="token punctuation" style="color:#393A34" data-45-js-token=")-4-56">)</span><span class="token punctuation" style="color:#393A34" data-45-js-token=";-4-57">;</span></div></pre></div><p>在src/app.js中输入</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">import React from &#x27;react&#x27;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-46-unknown-token="-1-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function App() {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	return &lt;div className=&#x27;App&#x27;&gt;React18 + Ts5 + webpack5 开发模板搭建&lt;/div&gt;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-46-unknown-token="}-4-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-46-unknown-token="-5-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">export default App;</span></div></pre></div><p>修改入口文件</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">entry: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">		app: resolve(PROJECT_PATH, &#x27;./src/index.js&#x27;),</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-47-unknown-token="},-2-0">	},</span></div></pre></div><p>这时候运行<code>yarn run start</code>会发生报错，这是因为react不能识别jsx语法，这个时候我们就需要babel了，我们后面会有一篇文章专门介绍babel，这里知道如何配置即可</p><p><img src="/front_end_engineer_book/static/image-20240615120446101.62a3708e.png" alt="image-20240615120446101"/></p><h1 id="安装babel支持tsx"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#安装babel支持tsx"><span class="icon icon-link"></span></a>安装babel支持tsx</h1><h2 id="支持js文件中使用jsx语法"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#支持js文件中使用jsx语法"><span class="icon icon-link"></span></a>支持js文件中使用jsx语法</h2><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">yarn add babel-loader@9.1.3 @babel/core@7.24.0 @babel/preset-react@7.23.3 -D</span></div></pre></div><p>babel-loader 使用 babel 解析文件；@babel/core 是 babel 的核心模块；@babel/preset-react 转译 jsx 语法。</p><p>在根目录下新建 .babelrc 文件，输入以下代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain" data-49-unknown-token="{-0-0">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  &quot;presets&quot;: [&quot;@babel/preset-react&quot;]</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-49-unknown-token="}-2-0">}</span></div></pre></div><p>presets 是一些列插件集合。比如 @babel/preset-react 一般情况下会包含 @babel/plugin-syntax-jsx 、 @babel/plugin-transform-react-jsx 、 @babel/plugin-transform-react-display-name 这几个 babel 插件。</p><p>接下来打开我们的 webpack.common.js 文件，增加以下代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain" data-50-js-token="module-0-0">module</span><span class="token operator" style="color:#393A34" data-50-js-token=":-0-6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-50-js-token="{-0-8">{</span><span class="token plain" data-50-js-token="-0-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-50-js-token="rules-1-0">		rules</span><span class="token operator" style="color:#393A34" data-50-js-token=":-1-7">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-50-js-token="[-1-9">[</span><span class="token plain" data-50-js-token="-1-10"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-50-js-token="-2-0">			</span><span class="token punctuation" style="color:#393A34" data-50-js-token="{-2-3">{</span><span class="token plain" data-50-js-token="-2-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-50-js-token="test-3-0">				test</span><span class="token operator" style="color:#393A34" data-50-js-token=":-3-8">:</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa" data-50-js-token="/-3-10">/</span><span class="token regex regex-source language-regex" style="color:#36acaa" data-50-js-token="\.(tsx?|js)$-3-11">\.(tsx?|js)$</span><span class="token regex regex-delimiter" style="color:#36acaa" data-50-js-token="/-3-23">/</span><span class="token punctuation" style="color:#393A34" data-50-js-token=",-3-24">,</span><span class="token plain" data-50-js-token="-3-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-50-js-token="loader-4-0">				loader</span><span class="token operator" style="color:#393A34" data-50-js-token=":-4-10">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-50-js-token="&#x27;babel-loader&#x27;-4-12">&#x27;babel-loader&#x27;</span><span class="token punctuation" style="color:#393A34" data-50-js-token=",-4-26">,</span><span class="token plain" data-50-js-token="-4-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-50-js-token="options-5-0">				options</span><span class="token operator" style="color:#393A34" data-50-js-token=":-5-11">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-50-js-token="{-5-13">{</span><span class="token plain" data-50-js-token="cacheDirectory-5-14">cacheDirectory</span><span class="token operator" style="color:#393A34" data-50-js-token=":-5-28">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa" data-50-js-token="true-5-30">true</span><span class="token punctuation" style="color:#393A34" data-50-js-token="}-5-34">}</span><span class="token punctuation" style="color:#393A34" data-50-js-token=",-5-35">,</span><span class="token plain" data-50-js-token="-5-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-50-js-token="exclude-6-0">				exclude</span><span class="token operator" style="color:#393A34" data-50-js-token=":-6-11">:</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa" data-50-js-token="/-6-13">/</span><span class="token regex regex-source language-regex" style="color:#36acaa" data-50-js-token="node_modules-6-14">node_modules</span><span class="token regex regex-delimiter" style="color:#36acaa" data-50-js-token="/-6-26">/</span><span class="token punctuation" style="color:#393A34" data-50-js-token=",-6-27">,</span><span class="token plain" data-50-js-token="-6-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-50-js-token="-7-0">			</span><span class="token punctuation" style="color:#393A34" data-50-js-token="}-7-3">}</span><span class="token punctuation" style="color:#393A34" data-50-js-token=",-7-4">,</span><span class="token plain" data-50-js-token="-7-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-50-js-token="-8-0">		</span><span class="token punctuation" style="color:#393A34" data-50-js-token="]-8-2">]</span><span class="token punctuation" style="color:#393A34" data-50-js-token=",-8-3">,</span><span class="token plain" data-50-js-token="-8-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-50-js-token="-9-0">	</span><span class="token punctuation" style="color:#393A34" data-50-js-token="}-9-1">}</span><span class="token punctuation" style="color:#393A34" data-50-js-token=",-9-2">,</span></div></pre></div><p>这里因为我们在配置eslint的时候就已经配置过ts了，所以直接就检测tsx就行了，不用jsx了。</p><p>现在直接<code>yarn run start</code>看效果，跟之前是一样的</p><p><img src="/front_end_engineer_book/static/image-20240615120458874.0e92ff05.png" alt="image-20240615120458874"/>现在我们把<code>src/index.js</code>改为<code>index.tsx</code>, <code>src/app.js</code>改为<code>app.tsx</code>，然后更改webpack打包入口为<code>index.tsx</code>，这时候vscode会报错，因为之前我们只是支持了react，但是并没有配置ts识别react等</p><p><img src="/front_end_engineer_book/static/image-20240615120505497.a66e7639.png" alt="image-20240615120505497"/></p><h2 id="支持tsx文件的解析"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#支持tsx文件的解析"><span class="icon icon-link"></span></a>支持tsx文件的解析</h2><p><a target="_blank" rel="noopener noreferrer" href="https://babeljs.io/docs/babel-preset-typescript">@babel/preset-typescript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是 babel 的一个 preset，它编译 ts 的过程很粗暴，它直接去掉 ts 的类型声明，然后再用其他 babel 插件进行编译，所以它很快。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">yarn add @babel/preset-typescript@7.23.3 -D</span></div></pre></div><p>然后修改 .babelrc ：</p><div class="__dumi-default-code-block"><pre class="prism-code language-json" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34" data-52-json-token="{-0-0">{</span><span class="token plain" data-52-json-token="-0-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa" data-52-json-token="&quot;presets&quot;-1-2">&quot;presets&quot;</span><span class="token operator" style="color:#393A34" data-52-json-token=":-1-11">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-52-json-token="[-1-13">[</span><span class="token string" style="color:#e3116c" data-52-json-token="&quot;@babel/preset-react&quot;-1-14">&quot;@babel/preset-react&quot;</span><span class="token punctuation" style="color:#393A34" data-52-json-token=",-1-35">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-52-json-token="&quot;@babel/preset-typescript&quot;-1-37">&quot;@babel/preset-typescript&quot;</span><span class="token punctuation" style="color:#393A34" data-52-json-token="]-1-63">]</span><span class="token plain" data-52-json-token="-1-64"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-52-json-token="-2-0"></span><span class="token punctuation" style="color:#393A34" data-52-json-token="}-2-0">}</span></div></pre></div><p>presets 的执行顺序是从后到前的。根据以上代码的 babel 配置，会先执行 @babel/preset-typescript ，然后再执行 @babel/preset-react 。</p><h2 id="tsx-语法测试"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#tsx-语法测试"><span class="icon icon-link"></span></a>tsx 语法测试</h2><p>这时候我们运行<code>yarn run start</code>编译代码是会报错的，因为我们只改了入口为tsx，但是引入app.tsx的时候我们省略了.tsx的后缀。这里如果你把后缀加上，它也能正常运行，但是我们不这么做，我们更改一下webpack的配置，增加</p><p><img src="/front_end_engineer_book/static/image-20240615120520358.1d872f8f.png" alt="image-20240615120520358"/></p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">module.exports = {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  entry: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    app: resolve(PROJECT_PATH, &#x27;./src/index.tsx&#x27;),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  resolve: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    extensions: [&#x27;.tsx&#x27;, &#x27;.ts&#x27;, &#x27;.js&#x27;, &#x27;.json&#x27;],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  },</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-53-unknown-token="}-7-0">}</span></div></pre></div><p>就可以不加文件后缀名了。webpack 会按照定义的后缀名的顺序依次处理文件，比如上文配置 [&#x27;.tsx&#x27;, &#x27;.ts&#x27;, &#x27;.js&#x27;, &#x27;.json&#x27;] ，webpack 会先尝试加上 .tsx 后缀，看找得到文件不，如果找不到就依次尝试进行查找，所以我们在配置时尽量把最常用到的后缀放到最前面，可以缩短查找时间。</p><p>这个时候再进行 <code>yarn run start</code> ，页面就能正确输出了。</p><p><img src="/front_end_engineer_book/static/image-20240615120530769.a072584a.png" alt="image-20240615120530769"/></p><h1 id="增加类型声明"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#增加类型声明"><span class="icon icon-link"></span></a>增加类型声明</h1><p>虽然现在已经可以正常输出了，但是vscode还是给我们报了几个错，无法找到类型声明文件</p><p><img src="/front_end_engineer_book/static/image-20240615120539845.4aa61be7.png" alt="image-20240615120539845"/></p><p>我们安装</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">yarn add @types/react@18.2.66 @types/react-dom@18.2.22 -D</span></div></pre></div><p>安装完成之后react就不再报错了</p><p><img src="/front_end_engineer_book/static/image-20240615120546173.7519bde6.png" alt="image-20240615120546173"/></p><p>这时候index.tsx中仍然有一个报错，原因是react18之后，<code>ReactDom.render</code>已经被弃用了需要用createRoot来替代。</p><p><img src="/front_end_engineer_book/static/image-20240615120554628.f4920994.png" alt="image-20240615120554628"/></p><p>我们更改<code>index.tsx</code>的代码</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f" data-55-js-token="import-0-0">import</span><span class="token plain"> </span><span class="token imports maybe-class-name" data-55-js-token="React-0-7">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f" data-55-js-token="from-0-13">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-55-js-token="&#x27;react&#x27;-0-18">&#x27;react&#x27;</span><span class="token punctuation" style="color:#393A34" data-55-js-token=";-0-25">;</span><span class="token plain" data-55-js-token="-0-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="-1-0"></span><span class="token keyword module" style="color:#00009f" data-55-js-token="import-1-0">import</span><span class="token plain"> </span><span class="token imports maybe-class-name" data-55-js-token="ReactDOM-1-7">ReactDOM</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f" data-55-js-token="from-1-16">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-55-js-token="&#x27;react-dom/client&#x27;-1-21">&#x27;react-dom/client&#x27;</span><span class="token punctuation" style="color:#393A34" data-55-js-token=";-1-39">;</span><span class="token plain" data-55-js-token="-1-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="-2-0"></span><span class="token keyword module" style="color:#00009f" data-55-js-token="import-2-0">import</span><span class="token plain"> </span><span class="token imports maybe-class-name" data-55-js-token="App-2-7">App</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f" data-55-js-token="from-2-11">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-55-js-token="&#x27;./app&#x27;-2-16">&#x27;./app&#x27;</span><span class="token punctuation" style="color:#393A34" data-55-js-token=";-2-23">;</span><span class="token plain" data-55-js-token="-2-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-55-js-token="-3-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="-4-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 获取你的 HTML 文件中的根 DOM 元素</span><span class="token plain" data-55-js-token="-4-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="-5-0"></span><span class="token keyword" style="color:#00009f" data-55-js-token="const-5-0">const</span><span class="token plain"> container </span><span class="token operator" style="color:#393A34" data-55-js-token="=-5-16">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa" data-55-js-token="document-5-18">document</span><span class="token punctuation" style="color:#393A34" data-55-js-token=".-5-26">.</span><span class="token method function property-access" style="color:#d73a49" data-55-js-token="getElementById-5-27">getElementById</span><span class="token punctuation" style="color:#393A34" data-55-js-token="(-5-41">(</span><span class="token string" style="color:#e3116c" data-55-js-token="&#x27;root&#x27;-5-42">&#x27;root&#x27;</span><span class="token punctuation" style="color:#393A34" data-55-js-token=")-5-48">)</span><span class="token punctuation" style="color:#393A34" data-55-js-token=";-5-49">;</span><span class="token plain" data-55-js-token="-5-50"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-55-js-token="-6-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="-7-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 非空断言，确保 container 不是 null</span><span class="token plain" data-55-js-token="-7-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="-8-0"></span><span class="token keyword control-flow" style="color:#00009f" data-55-js-token="if-8-0">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-55-js-token="(-8-3">(</span><span class="token plain">container </span><span class="token operator" style="color:#393A34" data-55-js-token="!==-8-14">!==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f" data-55-js-token="null-8-18">null</span><span class="token punctuation" style="color:#393A34" data-55-js-token=")-8-22">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-55-js-token="{-8-24">{</span><span class="token plain" data-55-js-token="-8-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="-9-0">	</span><span class="token keyword" style="color:#00009f" data-55-js-token="const-9-1">const</span><span class="token plain"> root </span><span class="token operator" style="color:#393A34" data-55-js-token="=-9-12">=</span><span class="token plain"> </span><span class="token maybe-class-name" data-55-js-token="ReactDOM-9-14">ReactDOM</span><span class="token punctuation" style="color:#393A34" data-55-js-token=".-9-22">.</span><span class="token method function property-access" style="color:#d73a49" data-55-js-token="createRoot-9-23">createRoot</span><span class="token punctuation" style="color:#393A34" data-55-js-token="(-9-33">(</span><span class="token plain" data-55-js-token="container-9-34">container</span><span class="token punctuation" style="color:#393A34" data-55-js-token=")-9-43">)</span><span class="token punctuation" style="color:#393A34" data-55-js-token=";-9-44">;</span><span class="token plain" data-55-js-token="-9-45"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="root-10-0">	root</span><span class="token punctuation" style="color:#393A34" data-55-js-token=".-10-5">.</span><span class="token method function property-access" style="color:#d73a49" data-55-js-token="render-10-6">render</span><span class="token punctuation" style="color:#393A34" data-55-js-token="(-10-12">(</span><span class="token operator" style="color:#393A34" data-55-js-token="&lt;-10-13">&lt;</span><span class="token maybe-class-name" data-55-js-token="App-10-14">App</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-55-js-token="/-10-18">/</span><span class="token operator" style="color:#393A34" data-55-js-token="&gt;-10-19">&gt;</span><span class="token punctuation" style="color:#393A34" data-55-js-token=")-10-20">)</span><span class="token punctuation" style="color:#393A34" data-55-js-token=";-10-21">;</span><span class="token plain" data-55-js-token="-10-22"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="-11-0"></span><span class="token punctuation" style="color:#393A34" data-55-js-token="}-11-0">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-55-js-token="else-11-2">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-55-js-token="{-11-7">{</span><span class="token plain" data-55-js-token="-11-8"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="-12-0">	</span><span class="token console class-name" data-55-js-token="console-12-1">console</span><span class="token punctuation" style="color:#393A34" data-55-js-token=".-12-8">.</span><span class="token method function property-access" style="color:#d73a49" data-55-js-token="error-12-9">error</span><span class="token punctuation" style="color:#393A34" data-55-js-token="(-12-14">(</span><span class="token string" style="color:#e3116c">&#x27;Failed to find the root element&#x27;</span><span class="token punctuation" style="color:#393A34" data-55-js-token=")-12-48">)</span><span class="token punctuation" style="color:#393A34" data-55-js-token=";-12-49">;</span><span class="token plain" data-55-js-token="-12-50"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-55-js-token="-13-0"></span><span class="token punctuation" style="color:#393A34" data-55-js-token="}-13-0">}</span></div></pre></div><p>这里解释下为什么react18要使用createRoot替换ReactDOM.render，</p><p>createRoot 是 React 18 引入的一个 API，它是 Concurrent Mode 的入口点之一。Concurrent Mode 是一组新的功能，使 React 能够同时处理多个优先级的工作，从而优化渲染性能和用户体验。以下是 createRoot 的一些特点：</p><ul><li><p>启用并发特性：createRoot 允许你启用 React 的并发渲染能力。在并发模式下，React 可以打断和恢复渲染工作，这允许高优先级的更新（如用户输入）能够打断低优先级的渲染（如数据的预加载）。因此，对于用户互动和应用的响应性来说，这是一个显著的提升。</p></li><li><p>更好的错误和中断处理：Concurrent Mode 还改进了错误处理机制，使得 React 在面临错误时更为稳健。此外，由于 React 能够分块处理更新，当执行长时间的更新时，应用不会冻结，而是能够保持交互性。</p></li><li><p>自动批处理：在并发模式下，React 会更智能地批处理更新，从而减少渲染次数，以及与渲染相关的浏览器工作量，这可以显著提高性能。</p></li><li><p>Transition 提升体验：React 18 引入的新特性中，包括了 startTransition API，这是 Concurrent Mode 的一个重要部分。startTransition 允许你标记某些更新为“过渡”，与立即重要的更新分开，这样即使这些更新可能导致较长的加载时间，用户也不会感觉到应用变得卡顿不响应，因为主要的界面操作（例如输入、点击等）仍然能够快速响应。</p></li><li><p>更一致的状态更新：在之前的 React 版本（无并发模式）中，状态更新可以是同步的，也可以是异步的，这取决于事件处理器（例如点击事件）执行时的上下文。现在，通过 createRoot 与并发模式，React 统一了更新的行为，让状态更新预测变得更容易。</p></li></ul><p>而ReactDOM.render 方法是 React 老版本中用来将 React 组件挂载到 DOM 节点的传统方法。该方法在 React 18 之前一直是挂载 React 应用的标准方式。然而，随着 React 18 的发布和新的并发功能的引入，ReactDOM.render 方法在某些方面显得不够用，并且具有些许局限性。以下是 ReactDOM.render 的一些缺点：</p><ul><li><p>不支持并发特性：ReactDOM.render 方法不支持 React 18 引入的并发特性。它无法利用并发模式（Concurrent Mode）提供的新特性，如并发渲染、任务的中断和恢复、自动批处理、优先级管理等。</p></li><li><p>同步更新：ReactDOM.render 方法会导致组件状态的更新和 DOM 的更新以同步的方式发生。这在某些情况下会影响性能，尤其是在执行大量计算或处理复杂更新的时候，可能会导致用户界面变得卡顿。</p></li><li><p>批处理局限性虽然 React 在某些情况下会尝试自动批处理状态更新，但在 ReactDOM.render 使用的传统模式下，React 的自动批处理能力受限于事件处理函数的上下文。这使得在非事件处理代码中执行的更新不一定会自动批处理，从而可能导致额外的渲染和性能不足。</p></li><li><p>状态更新不一致：在传统渲染模式下，根据更新发生的上下文，React 状态更新可能是同步的，也可能是异步的。这造成了一定的预测困难，使得开发者可能需要进行额外的工作来确保组件的行为如期望的那样。</p></li><li><p>渲染优化受限：传统的 ReactDOM.render 方法在处理更新和优化渲染性能方面的能力有限。在一些复杂的更新场景中，开发者可能需要手动进行优化，比如防止不必要的渲染，这要求更多的编码和性能调优工作。</p></li><li><p>过渡API不可用：使用 ReactDOM.render 的代码不能利用 startTransition 这样的过渡 API 来区分不紧急的更新，从而改善用户在加载新内容或执行计算密集型任务时的体验。</p></li><li><p>错误和中断处理较弱：在并发模式之外，React 组件的错误边界和中断处理能力较弱，这可能使得应用对错误条件和长时间执行任务的响应不够鲁棒。</p></li></ul><h1 id="增加图片、文件等模块的类型声明"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#增加图片、文件等模块的类型声明"><span class="icon icon-link"></span></a>增加图片、文件等模块的类型声明</h1><p>现在大部分的环境搭建我们已经搞定了，但是如果你在 app.tsx中引入一个图片，你会发现它有报错，没有类型声明，这里我们还需要配置一下文件的类型声明。以后如果你安装的第三方模块没有@type/xxx的包，也可以使用同样的方式解决</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f" data-56-js-token="import-0-0">import</span><span class="token plain"> </span><span class="token imports maybe-class-name" data-56-js-token="React-0-7">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f" data-56-js-token="from-0-13">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-56-js-token="&#x27;react&#x27;-0-18">&#x27;react&#x27;</span><span class="token punctuation" style="color:#393A34" data-56-js-token=";-0-25">;</span><span class="token plain" data-56-js-token="-0-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-56-js-token="-1-0"></span><span class="token keyword module" style="color:#00009f" data-56-js-token="import-1-0">import</span><span class="token plain"> </span><span class="token imports" data-56-js-token="img-1-7">img</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f" data-56-js-token="from-1-11">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-56-js-token="&#x27;../javascript.png&#x27;-1-16">&#x27;../javascript.png&#x27;</span><span class="token punctuation" style="color:#393A34" data-56-js-token=";-1-35">;</span><span class="token plain" data-56-js-token="-1-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-56-js-token="-2-0"></span><span class="token keyword" style="color:#00009f" data-56-js-token="function-2-0">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49" data-56-js-token="App-2-9">App</span><span class="token punctuation" style="color:#393A34" data-56-js-token="(-2-12">(</span><span class="token punctuation" style="color:#393A34" data-56-js-token=")-2-13">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-56-js-token="{-2-15">{</span><span class="token plain" data-56-js-token="-2-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-56-js-token="-3-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-56-js-token="return-3-1">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-56-js-token="(-3-8">(</span><span class="token plain" data-56-js-token="-3-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-56-js-token="-4-0">		</span><span class="token operator" style="color:#393A34" data-56-js-token="&lt;-4-2">&lt;</span><span class="token operator" style="color:#393A34" data-56-js-token="&gt;-4-3">&gt;</span><span class="token plain" data-56-js-token="-4-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-56-js-token="-5-0">			</span><span class="token operator" style="color:#393A34" data-56-js-token="&lt;-5-3">&lt;</span><span class="token plain">div className</span><span class="token operator" style="color:#393A34" data-56-js-token="=-5-17">=</span><span class="token string" style="color:#e3116c" data-56-js-token="&#x27;App&#x27;-5-18">&#x27;App&#x27;</span><span class="token operator" style="color:#393A34" data-56-js-token="&gt;-5-23">&gt;</span><span class="token maybe-class-name" data-56-js-token="React18-5-24">React18</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-56-js-token="+-5-32">+</span><span class="token plain"> </span><span class="token maybe-class-name" data-56-js-token="Ts5-5-34">Ts5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-56-js-token="+-5-38">+</span><span class="token plain"> webpack5 开发模板搭建</span><span class="token operator" style="color:#393A34" data-56-js-token="&lt;-5-55">&lt;</span><span class="token operator" style="color:#393A34" data-56-js-token="/-5-56">/</span><span class="token plain" data-56-js-token="div-5-57">div</span><span class="token operator" style="color:#393A34" data-56-js-token="&gt;-5-60">&gt;</span><span class="token punctuation" style="color:#393A34" data-56-js-token=";-5-61">;</span><span class="token plain" data-56-js-token="-5-62"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-56-js-token="-6-0">			</span><span class="token operator" style="color:#393A34" data-56-js-token="&lt;-6-3">&lt;</span><span class="token plain">img src</span><span class="token operator" style="color:#393A34" data-56-js-token="=-6-11">=</span><span class="token punctuation" style="color:#393A34" data-56-js-token="{-6-12">{</span><span class="token plain" data-56-js-token="img-6-13">img</span><span class="token punctuation" style="color:#393A34" data-56-js-token="}-6-16">}</span><span class="token operator" style="color:#393A34" data-56-js-token="&gt;-6-17">&gt;</span><span class="token operator" style="color:#393A34" data-56-js-token="&lt;-6-18">&lt;</span><span class="token operator" style="color:#393A34" data-56-js-token="/-6-19">/</span><span class="token plain" data-56-js-token="img-6-20">img</span><span class="token operator" style="color:#393A34" data-56-js-token="&gt;-6-23">&gt;</span><span class="token plain" data-56-js-token="-6-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-56-js-token="-7-0">		</span><span class="token operator" style="color:#393A34" data-56-js-token="&lt;-7-2">&lt;</span><span class="token operator" style="color:#393A34" data-56-js-token="/-7-3">/</span><span class="token operator" style="color:#393A34" data-56-js-token="&gt;-7-4">&gt;</span><span class="token plain" data-56-js-token="-7-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-56-js-token="-8-0">	</span><span class="token punctuation" style="color:#393A34" data-56-js-token=")-8-1">)</span><span class="token punctuation" style="color:#393A34" data-56-js-token=";-8-2">;</span><span class="token plain" data-56-js-token="-8-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-56-js-token="-9-0"></span><span class="token punctuation" style="color:#393A34" data-56-js-token="}-9-0">}</span><span class="token plain" data-56-js-token="-9-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-56-js-token="-10-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-56-js-token="-11-0"></span><span class="token keyword module" style="color:#00009f" data-56-js-token="export-11-0">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f" data-56-js-token="default-11-7">default</span><span class="token plain"> </span><span class="token maybe-class-name" data-56-js-token="App-11-15">App</span><span class="token punctuation" style="color:#393A34" data-56-js-token=";-11-18">;</span></div></pre></div><p><img src="/front_end_engineer_book/static/image-20240615120607359.b5bb58fe.png" alt="image-20240615120607359"/></p><p>只是会有ts报错但是不影响打包，我们配置下文件的类型声明，在根目录下创建typings/file.d.ts文件输入</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.svg&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const path: string;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default path;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-3-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-57-unknown-token="-4-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.bmp&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const path: string;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default path;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-8-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-57-unknown-token="-9-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.gif&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const path: string;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default path;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-13-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-57-unknown-token="-14-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.jpg&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const path: string;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default path;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-18-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-57-unknown-token="-19-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.jpeg&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const path: string;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default path;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-23-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-57-unknown-token="-24-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.png&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const path: string;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default path;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-28-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-57-unknown-token="-29-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.css&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const classes: Record&lt;string, string&gt;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default classes;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-33-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-57-unknown-token="-34-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.scss&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const classes: Record&lt;string, string&gt;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default classes;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-38-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-57-unknown-token="-39-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.sass&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const classes: Record&lt;string, string&gt;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default classes;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-43-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-57-unknown-token="-44-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.styl&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const classes: Record&lt;string, string&gt;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default classes;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-48-0">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-57-unknown-token="-49-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">// 继续保持你已有的 .less 声明</span></div><div class="token-line" style="color:#393A34"><span class="token plain">declare module &#x27;*.less&#x27; {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	const content: Record&lt;string, string&gt;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">	export default content;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-57-unknown-token="}-54-0">}</span></div></pre></div><p>修改tsconfig.json文件增加如下，可以看到报错就消失了。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">&quot;include&quot;: [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">		&quot;src/**/*&quot;, // 这将包括 src 目录下的所有文件</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-58-unknown-token="&quot;typings/**/*&quot;-2-0">		&quot;typings/**/*&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-58-unknown-token="]-3-0">	]</span></div></pre></div><p><img src="/front_end_engineer_book/static/image-20240615120621561.6024af54.png" alt="image-20240615120621561"/></p><h1 id="baseurlpaths配置别名"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#baseurlpaths配置别名"><span class="icon icon-link"></span></a>baseUrl&amp;paths&amp;配置别名</h1><p>目的是不使用<code>../../../</code>去导入组件，配置完成之后，我们可以使用如下方式导入组件，这样就方便多了</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">import Header from &#x27;@components/Header&#x27;</span></div></pre></div><p>首先需要防止eslint报错，</p><p><img src="/front_end_engineer_book/static/image-20240615120630210.8b694f00.png" alt="image-20240615120630210"/></p><p>这个时候需要改 .eslintrc.js 文件的配置了，首先得安装 eslint-import-resolver-typescript ：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">yarn add eslint-import-resolver-typescript@3.6.1 -D</span></div></pre></div><p>然后在 .eslintrc.js 文件的 setting 字段修改为以下代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">settings: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  &#x27;import/resolver&#x27;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    node: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      extensions: [&#x27;.tsx&#x27;, &#x27;.ts&#x27;, &#x27;.js&#x27;, &#x27;.json&#x27;],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    typescript: {},</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  },</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-61-unknown-token="},-7-0">},</span></div></pre></div><p>是的，只需要添加 typescript: <!-- -->{<!-- -->}<!-- --> 即可，这时候再去看已经没有报错了。并且是index的文件可以直接不用写，只需要到header层就行了。 但是上面我们完成的工作仅仅是对于编辑器来说可识别这个路径映射，我们需要在 webpack.common.js 中的 resolve.alias 添加相同的映射规则配置：</p><p>webpack.common.js，配置webpack可以让我们正确打包</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">resolve: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    extensions: [&quot;.tsx&quot;, &quot;.ts&quot;, &quot;.js&quot;, &quot;.json&quot;],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    alias: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      &quot;@src&quot;: resolve(PROJECT_PATH, &quot;./src&quot;),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      &quot;@components&quot;: resolve(PROJECT_PATH, &quot;./src/components&quot;),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      &quot;@utils&quot;: resolve(PROJECT_PATH, &quot;./src/utils&quot;),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  },</span></div></pre></div><p>tsconfig.json，配置ts可以给我们开发提示。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">&quot;paths&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">			// 路径映射，与 baseUrl 关联</span></div><div class="token-line" style="color:#393A34"><span class="token plain">			&quot;@src/*&quot;: [&quot;src/*&quot;],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">			&quot;@components/*&quot;: [&quot;src/components/*&quot;],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">			&quot;@utils/*&quot;: [&quot;src/utils/*&quot;]</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-63-unknown-token="},-5-0">		},</span></div></pre></div><h1 id="配置css-module"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#配置css-module"><span class="icon icon-link"></span></a>配置css module</h1><p>我想要使用如下的方式导入less文件并使用</p><p><img src="/front_end_engineer_book/static/image-20240615120642612.7cbc882c.png" alt="image-20240615120642612"/></p><p>我们需要开启css模块化，请注意，对于模块化的方式，通常会使用 .module.less 作为文件后缀，以区分模块化的样式文件和全局的样式文件。所以less文件名需要改为<code>xxxx.module.less</code></p><p>更改webpack配置，之前设置的是false</p><p><img src="/front_end_engineer_book/static/image-20240615120649960.c5b1ff2e.png" alt="image-20240615120649960"/></p><p>这样配置就OK了，模块化也生效了。</p><p><img src="/front_end_engineer_book/static/image-20240615120702538.c3eae2b7.png" alt="image-20240615120702538"/></p><p>但是这个名字让我们看不出有任何规律，这里是可以更改配置的，配置规则如下 在 modules 对象中，localIdentName 是生成类名的模板字符串，它可以包含以下占位符：</p><ul><li>[local]：原始的类名。</li><li>[path]：文件的相对路径。</li><li>[name]：文件名。</li><li>[hash:base64]：内容的 base64 哈希。</li><li>[hash:base64:length]：长度限制的内容哈希。</li><li>[folder]：文件所在的文件夹名。 例如，localIdentName: &#x27;[path][name]__[local]--[hash:base64:5]&#x27; 可能产生下面这样的类名：src-components-MyComponent__header--1a2b3c.</li></ul><p>我们的配置如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">const getCssLoaders = (importLoaders) =&gt; [</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-64-unknown-token="&#x27;style-loader&#x27;,-1-0">	&#x27;style-loader&#x27;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-64-unknown-token="{-2-0">	{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">		loader: &#x27;css-loader&#x27;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">		options: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">			modules: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">				localIdentName: &#x27;[local]__[hash:base64:5]&#x27;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-64-unknown-token="},-7-0">			},</span></div><div class="token-line" style="color:#393A34"><span class="token plain">			sourceMap: isDev,</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-64-unknown-token="importLoaders,-9-0">			importLoaders,</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-64-unknown-token="},-10-0">		},</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-64-unknown-token="},-11-0">	},</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-64-unknown-token="&#x27;postcss-loader&#x27;,-12-0">	&#x27;postcss-loader&#x27;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-64-unknown-token="];-13-0">];</span></div></pre></div><p><img src="/front_end_engineer_book/static/image-20240615120715598.9d2a20df.png" alt="image-20240615120715598"/></p><h1 id="配置es6转es5"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#配置es6转es5"><span class="icon icon-link"></span></a>配置es6+转es5</h1><p>之前我们已经使用 babel 去解析 react 语法和 typescript 语法了，但是目前我们所做的也仅仅如此，你在代码中用到的 ES6+ 语法编译之后依然全部保留，然而不是所有浏览器都能支持 ES6+ 语法的，这时候就需要<code>@babel/preset-env</code>，它会根据设置的目标浏览器环境（browserslist）找出所需的插件去转译 ES6+ 语法。比如 const 或 let 转译为 var 。</p><p>但是遇到 Promise 或 .includes 这种新的 es 特性，是没办法转译到 es5 的，除非我们把这中新的语言特性的实现注入到打包后的文件中，不就行了吗？我们借助 <code>@babel/plugin-transform-runtime</code> 这个插件，它和 @babel/preset-env 一样都能提供 ES 新API 的垫片，都可实现按需加载，但前者不会污染原型链。</p><p>比如我们先将webpack的模式更改为<code>development</code>，在Header组件中增加一点es6的逻辑，比如箭头函数</p><p><img src="/front_end_engineer_book/static/image-20240615120722829.15d0fd8c.png" alt="image-20240615120722829"/></p><p>这时候我们打包看看，打包结果中，箭头函数并没有转换</p><p><img src="/front_end_engineer_book/static/image-20240615120729476.681a75e3.png" alt="image-20240615120729476"/></p><p>现在我们配置下es6+转换成es5</p><p>另外，babel 在编译每一个模块的时候在需要的时候会插入一些辅助函数例如 _extend ，每一个需要的模块都会生成这个辅助函数，显而易见这会增加代码的冗余，<code>@babel/plugin-transform-runtime</code> 这个插件会将所有的辅助函数都从 <code>@babel/runtime-corejs3</code> 导入（我们下面使用 corejs3），从而减少冗余性。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">yarn add  @babel/preset-env@7.24.0 @babel/plugin-transform-runtime@7.24.0 -D</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-65-unknown-token="-1-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">yarn add @babel/runtime-corejs3@7.24.0 -S</span></div></pre></div><blockquote><p>注意： @babel/runtime-corejs3 的安装为生产依赖。 修改 .babelre 如下：</p></blockquote><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain" data-66-unknown-token="{-0-0">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  &quot;presets&quot;: [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      &quot;@babel/preset-env&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // 防止babel将任何模块类型都转译成CommonJS类型，导致tree-shaking失效问题</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;modules&quot;: false</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;@babel/preset-react&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;@babel/preset-typescript&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  ],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  &quot;plugins&quot;: [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      &quot;@babel/plugin-transform-runtime&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;corejs&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          &quot;version&quot;: 3,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          &quot;proposals&quot;: true</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;useESModules&quot;: true</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  ]</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-66-unknown-token="}-24-0">}</span></div></pre></div><p>可以看到，箭头函数已经被转换了，这里我们只需要知道如何配置即可，后序我们会专门对babel写一篇文章来介绍一下使用、原理等</p><p><img src="/front_end_engineer_book/static/image-20240615120736915.83e99974.png" alt="image-20240615120736915"/></p><h1 id="-写在最后"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/04react_ts#-写在最后"><span class="icon icon-link"></span></a>🍋 写在最后</h1><p>如果你看到这里了，并且觉得这篇文章对您有所帮助，希望你能够点赞👍和收藏⭐支持一下作者🙇🙇🙇，感谢🍺🍺！如果文中有任何不准确之处，也欢迎您指正，共同进步。感谢您的阅读，期待您的点赞👍和收藏⭐！</p><p>感兴趣的同学可以关注下我的公众号ObjectX前端实验室</p><p>🌟 少走弯路 | ObjectX前端实验室 🛠️「精选资源｜实战经验｜技术洞见」</p></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="Last update: ">6/15/2024 07:19:04</span></div></article></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/front_end_engineer_book/umi.9ab99bfd.js"></script>
  </body>
</html>
