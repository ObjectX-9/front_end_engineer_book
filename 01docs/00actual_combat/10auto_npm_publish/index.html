<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://s21.ax1x.com/2024/06/14/pkdLxmt.png"
    />
    <link rel="stylesheet" href="/front_end_engineer_book/umi.4c36f7fa.css" />
    <script>
      window.routerBase = "/front_end_engineer_book/";
    </script>
    <script>
      //! umi version: 3.5.17
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.indexOf(e) > -1 ? e : r[0]
        );
      })();
    </script>
    <title>10.自动化篇-手写脚本一键自动tag、发包、引导登录npm</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/01docs/00actual_combat/10auto_npm_publish" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false" data-use-bg="false" style="padding-bottom:50px;overflow:unset;background-size:cover"><div class="__dumi-default-navbar" data-mode="site" data-is-home="false" style="background-color:#212121"><button class="__dumi-default-navbar-toggle"></button><div class="logo_wrapper"><a class="__dumi-default-navbar-logo" href="/front_end_engineer_book//"><img src="https://s21.ax1x.com/2024/06/14/pkdLxmt.png" alt="ObjectX前端工程化实践"/><span class="label">ObjectX前端工程化实践</span></a><div class="search_wrapper"><div class="__dumi-default-search" data-is-home="false"><svg width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="1.0" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="主页-登录页" transform="translate(-337.000000, -20.000000)"><g id="顶部导航" transform="translate(28.000000, 0.000000)"><g id="编组-3" transform="translate(309.000000, 20.000000)"><rect id="矩形" opacity="0.0848214286" x="0" y="0" width="24" height="24"></rect><path d="M7.63246763,7.63246763 C9.80909114,5.45584412 13.3380951,5.45584412 15.5147186,7.63246763 C17.5003311,9.61808009 17.6745798,12.7291297 16.0374649,14.9122691 L17.7667903,16.6407545 C18.0777366,16.9517007 18.0777366,17.4558441 17.7667903,17.7667903 C17.4558441,18.0777366 16.9517007,18.0777366 16.6407545,17.7667903 L14.9122691,16.0374649 C12.7291297,17.6745798 9.61808009,17.5003311 7.63246763,15.5147186 C5.45584412,13.3380951 5.45584412,9.80909114 7.63246763,7.63246763 Z M14.3886828,8.75850349 C12.8339517,7.20377241 10.3132346,7.20377241 8.75850349,8.75850349 C7.20377241,10.3132346 7.20377241,12.8339517 8.75850349,14.3886828 C10.3132346,15.9434138 12.8339517,15.9434138 14.3886828,14.3886828 C15.9434138,12.8339517 15.9434138,10.3132346 14.3886828,8.75850349 Z" id="形状结合" fill="#666666" fill-rule="nonzero"></path></g></g></g></g></svg><input type="search" class="__dumi-default-search-input" placeholder="search document..." value=""/><ul></ul></div></div></div><span><nav class="navbar_links"><span class="navbar_links-item"><a aria-current="page" class="active" href="/front_end_engineer_book//01docs">🚀 工程化实践指南</a></span><span class="navbar_links-item"><a href="/front_end_engineer_book//02comp">📚 常见组件实现</a></span><span class="navbar_links-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/ObjectX-9/front_end_engineer_book">⭐️GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></span></div><ul role="slug-list" class="__dumi-default-layout-toc"><li role="slug-list-title">10.自动化篇-手写脚本一键自动tag、发包、引导登录npm</li><li title="🍑 一、新增脚本文件&amp;命令&amp;核心流程" data-depth="1"><a href="#-一、新增脚本文件命令核心流程" class="active"><span>🍑 一、新增脚本文件&amp;命令&amp;核心流程</span></a></li><li title="🥑 二、获取当前已经发布的最新的的版本号" data-depth="1"><a href="#🥑-二、获取当前已经发布的最新的的版本号" class=""><span>🥑 二、获取当前已经发布的最新的的版本号</span></a></li><li title="🍒 三、实现显示选择界面" data-depth="1"><a href="#-三、实现显示选择界面" class=""><span>🍒 三、实现显示选择界面</span></a></li><li title="1.inquirer的基本使用" data-depth="2"><a href="#1inquirer的基本使用" class=""><span>1.inquirer的基本使用</span></a></li><li title="2.实现我们需要的界面" data-depth="2"><a href="#2实现我们需要的界面" class=""><span>2.实现我们需要的界面</span></a></li><li title="🥝 四、实现将新版本号写入package.json" data-depth="1"><a href="#🥝-四、实现将新版本号写入packagejson" class=""><span>🥝 四、实现将新版本号写入package.json</span></a></li><li title="🍐 五、实现Git标记tag并推送远端" data-depth="1"><a href="#-五、实现git标记tag并推送远端" class=""><span>🍐 五、实现Git标记tag并推送远端</span></a></li><li title="🍉 六、实现设置npm源" data-depth="1"><a href="#-六、实现设置npm源" class=""><span>🍉 六、实现设置npm源</span></a></li><li title="1.保存旧的npm源并更新" data-depth="2"><a href="#1保存旧的npm源并更新" class=""><span>1.保存旧的npm源并更新</span></a></li><li title="2.检测是否已经登录npm" data-depth="2"><a href="#2检测是否已经登录npm" class=""><span>2.检测是否已经登录npm</span></a></li><li title="3.发布到npm" data-depth="2"><a href="#3发布到npm" class=""><span>3.发布到npm</span></a></li><li title="4.恢复npm源" data-depth="2"><a href="#4恢复npm源" class=""><span>4.恢复npm源</span></a></li><li title="完整代码&amp;代码仓库" data-depth="1"><a href="#完整代码代码仓库" class=""><span>完整代码&amp;代码仓库</span></a></li><li title="🍎 推荐阅读" data-depth="1"><a href="#-推荐阅读" class=""><span>🍎 推荐阅读</span></a></li><li title="面试手写系列" data-depth="2"><a href="#面试手写系列" class=""><span>面试手写系列</span></a></li><li title="react实现原理系列" data-depth="2"><a href="#react实现原理系列" class=""><span>react实现原理系列</span></a></li><li title="其他" data-depth="2"><a href="#其他" class=""><span>其他</span></a></li><li title="🍋 写在最后" data-depth="1"><a href="#-写在最后" class=""><span>🍋 写在最后</span></a></li></ul><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://s21.ax1x.com/2024/06/14/pkdLxmt.png&#x27;)" href="/front_end_engineer_book//"></a><h1>ObjectX前端工程化实践</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a aria-current="page" class="active" href="/front_end_engineer_book//01docs">🚀 工程化实践指南</a></li><li><a href="/front_end_engineer_book//02comp">📚 常见组件实现</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/ObjectX-9/front_end_engineer_book">⭐️GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><ul class="ant-menu ant-menu-root ant-menu-inline ant-menu-light" role="menu" tabindex="0" data-menu-list="true"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">00实战搭建&amp;部署篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat"><span>0.更新日志</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/01init"><span>1.项目初始化&amp;配置</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/02code_specification"><span>2.代码规范</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/03code_quarity"><span>3.代码质量</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/04react_ts"><span>4.react+ts环境搭建</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/05changelog"><span>5.更新日志changelog</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/06webpack5_basic_config"><span>6.webpack5基本配置</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/07comp_constructor"><span>7.组件库搭建</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/08page_manage"><span>8.三大包管理器&amp;npm工程化&amp;发布流程</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/00actual_combat/09git_action"><span>9.Github Action、部署组件库文档</span></a></span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-selected ant-menu-item-only-child"><span class="ant-menu-title-content"><a aria-current="page" class="active" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish"><span>10.自动化篇-手写脚本一键自动tag、发包、引导登录npm</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">01详解-项目搭建篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/01project_construction"><span>项目搭建篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">02详解-项目打包篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/02project_build"><span>项目打包篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">03详解-组件库搭建篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/03comp_construction"><span>组件库搭建篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">04详解-包管理器篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/04package_manager"><span>包管理器篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">05详解-项目自动化篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/05auto_op"><span>项目自动化篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">06详解-项目部署篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/06project_deploy"><span>项目部署篇总览</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">07详解-脚手架搭建篇</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//01docs/07cli"><span>脚手架搭建篇总览</span></a></span></li></ul></li></ul><div style="display:none" aria-hidden="true"></div></ul></div></div><div class="__dumi-default-layout-content"><div class="__dumi-default-mobile-content"><article><div class="__dumi-default-content-header markdown no-desc"><h1>10.自动化篇-手写脚本一键自动tag、发包、引导登录npm</h1></div><div class="markdown"><h1 id="-一、新增脚本文件命令核心流程"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#-一、新增脚本文件命令核心流程"><span class="icon icon-link"></span></a>🍑 一、新增脚本文件&amp;命令&amp;核心流程</h1><p>在项目的<code>src/scripts</code>目录下新增文件，增加<code>release.js</code>文件，文件内容如下</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic" data-166-js-token="/**-0-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 主函数入口</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-166-js-token="-2-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-166-js-token="-3-0"></span><span class="token keyword" style="color:#00009f" data-166-js-token="async-3-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-166-js-token="function-3-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-166-js-token="main-3-15">main</span><span class="token punctuation" style="color:#393A34" data-166-js-token="(-3-19">(</span><span class="token punctuation" style="color:#393A34" data-166-js-token=")-3-20">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-166-js-token="{-3-22">{</span><span class="token plain" data-166-js-token="-3-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-166-js-token="-4-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-166-js-token="try-4-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-166-js-token="{-4-5">{</span><span class="token plain" data-166-js-token="-4-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-166-js-token="-5-0">		</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-166-js-token="-6-0">	</span><span class="token punctuation" style="color:#393A34" data-166-js-token="}-6-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-166-js-token="catch-6-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-166-js-token="(-6-9">(</span><span class="token plain" data-166-js-token="error-6-10">error</span><span class="token punctuation" style="color:#393A34" data-166-js-token=")-6-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-166-js-token="{-6-17">{</span><span class="token plain" data-166-js-token="-6-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-166-js-token="-7-0">		</span><span class="token console class-name" data-166-js-token="console-7-2">console</span><span class="token punctuation" style="color:#393A34" data-166-js-token=".-7-9">.</span><span class="token method function property-access" style="color:#d73a49" data-166-js-token="error-7-10">error</span><span class="token punctuation" style="color:#393A34" data-166-js-token="(-7-15">(</span><span class="token string" style="color:#e3116c">&#x27;❌ 发生错误:&#x27;</span><span class="token punctuation" style="color:#393A34" data-166-js-token=",-7-25">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-166-js-token=")-7-32">)</span><span class="token punctuation" style="color:#393A34" data-166-js-token=";-7-33">;</span><span class="token plain" data-166-js-token="-7-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-166-js-token="-8-0">	</span><span class="token punctuation" style="color:#393A34" data-166-js-token="}-8-1">}</span><span class="token plain" data-166-js-token="-8-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-166-js-token="-9-0"></span><span class="token punctuation" style="color:#393A34" data-166-js-token="}-9-0">}</span><span class="token plain" data-166-js-token="-9-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-166-js-token="-10-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-166-js-token="-11-0"></span><span class="token function" style="color:#d73a49" data-166-js-token="main-11-0">main</span><span class="token punctuation" style="color:#393A34" data-166-js-token="(-11-4">(</span><span class="token punctuation" style="color:#393A34" data-166-js-token=")-11-5">)</span><span class="token punctuation" style="color:#393A34" data-166-js-token=";-11-6">;</span></div></pre></div><p>在项目的<code>package.json</code>中增加如下命令，后续我们使用<code>npm run release</code>一键更新npm版本、Git缓存更改、自动标记tag、自动发布到npm。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c" data-167-js-token="&quot;release&quot;-0-0">&quot;release&quot;</span><span class="token operator" style="color:#393A34" data-167-js-token=":-0-9">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;node ./scripts/release.js&quot;</span></div></pre></div><p>核心流程伪代码如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-168-js-token="let-0-0">let</span><span class="token plain"> newVersion </span><span class="token operator" style="color:#393A34" data-168-js-token="=-0-15">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-168-js-token="getNewVersion-0-17">getNewVersion</span><span class="token punctuation" style="color:#393A34" data-168-js-token="(-0-30">(</span><span class="token punctuation" style="color:#393A34" data-168-js-token=")-0-31">)</span><span class="token punctuation" style="color:#393A34" data-168-js-token=";-0-32">;</span><span class="token plain" data-168-js-token="-0-33"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-1-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 更新版本号</span><span class="token plain" data-168-js-token="-1-8"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-2-0"></span><span class="token function" style="color:#d73a49" data-168-js-token="updateVersion-2-0">updateVersion</span><span class="token punctuation" style="color:#393A34" data-168-js-token="(-2-13">(</span><span class="token plain" data-168-js-token="newVersion-2-14">newVersion</span><span class="token punctuation" style="color:#393A34" data-168-js-token=")-2-24">)</span><span class="token punctuation" style="color:#393A34" data-168-js-token=";-2-25">;</span><span class="token plain" data-168-js-token="-2-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-3-0"></span><span class="token comment" style="color:#999988;font-style:italic">// git增加tag并提交</span><span class="token plain" data-168-js-token="-3-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-4-0"></span><span class="token function" style="color:#d73a49" data-168-js-token="gitOperations-4-0">gitOperations</span><span class="token punctuation" style="color:#393A34" data-168-js-token="(-4-13">(</span><span class="token plain" data-168-js-token="newVersion-4-14">newVersion</span><span class="token punctuation" style="color:#393A34" data-168-js-token=")-4-24">)</span><span class="token punctuation" style="color:#393A34" data-168-js-token=";-4-25">;</span><span class="token plain" data-168-js-token="-4-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-5-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 设置npm源</span><span class="token plain" data-168-js-token="-5-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-6-0"></span><span class="token keyword" style="color:#00009f" data-168-js-token="const-6-0">const</span><span class="token plain"> oldRegistryUrl </span><span class="token operator" style="color:#393A34" data-168-js-token="=-6-21">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-168-js-token="await-6-23">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-168-js-token="setNpmRegistry-6-29">setNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-168-js-token="(-6-43">(</span><span class="token punctuation" style="color:#393A34" data-168-js-token=")-6-44">)</span><span class="token punctuation" style="color:#393A34" data-168-js-token=";-6-45">;</span><span class="token plain" data-168-js-token="-6-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-7-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 检测是否已经登录npm</span><span class="token plain" data-168-js-token="-7-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-8-0"></span><span class="token keyword control-flow" style="color:#00009f" data-168-js-token="await-8-0">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-168-js-token="ensureNpmLoggedIn-8-6">ensureNpmLoggedIn</span><span class="token punctuation" style="color:#393A34" data-168-js-token="(-8-23">(</span><span class="token punctuation" style="color:#393A34" data-168-js-token=")-8-24">)</span><span class="token punctuation" style="color:#393A34" data-168-js-token=";-8-25">;</span><span class="token plain" data-168-js-token="-8-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-9-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 发布到npm</span><span class="token plain" data-168-js-token="-9-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-10-0"></span><span class="token keyword control-flow" style="color:#00009f" data-168-js-token="await-10-0">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-168-js-token="publishToNpm-10-6">publishToNpm</span><span class="token punctuation" style="color:#393A34" data-168-js-token="(-10-18">(</span><span class="token punctuation" style="color:#393A34" data-168-js-token=")-10-19">)</span><span class="token punctuation" style="color:#393A34" data-168-js-token=";-10-20">;</span><span class="token plain" data-168-js-token="-10-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-11-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 恢复npm源</span><span class="token plain" data-168-js-token="-11-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-168-js-token="-12-0"></span><span class="token keyword control-flow" style="color:#00009f" data-168-js-token="await-12-0">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-168-js-token="restoreNpmRegistry-12-6">restoreNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-168-js-token="(-12-24">(</span><span class="token plain" data-168-js-token="oldRegistryUrl-12-25">oldRegistryUrl</span><span class="token punctuation" style="color:#393A34" data-168-js-token=")-12-39">)</span><span class="token punctuation" style="color:#393A34" data-168-js-token=";-12-40">;</span></div></pre></div><h1 id="🥑-二、获取当前已经发布的最新的的版本号"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#🥑-二、获取当前已经发布的最新的的版本号"><span class="icon icon-link"></span></a>🥑 二、获取当前已经发布的最新的的版本号</h1><p><code>npm show $<!-- -->{<!-- -->packageName<!-- -->}<!-- --> version</code> 是一个用于检索指定 npm 包的最新版本信息的命令。通过运行这个命令，可以查看指定包的最新版本号。</p><ul><li><code>$<!-- -->{<!-- -->packageName<!-- -->}</code>：这里是指要查找的 npm 包的名称。</li></ul><p>举个例子，如果要查看包名为<code>inquirer</code>的最新版本号</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">npm show inquirer version</span></div></pre></div><p>运行以上命令后，npm 将返回<code>inquirer</code>包的最新版本号</p><p><img src="/front_end_engineer_book/static/image-20240615124130011.2e5a5279.png" alt="image-20240615124130011"/></p><p>实现函数如下</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-170-js-token="const-0-0">const</span><span class="token plain"> exec </span><span class="token operator" style="color:#393A34" data-170-js-token="=-0-11">=</span><span class="token plain"> util</span><span class="token punctuation" style="color:#393A34" data-170-js-token=".-0-17">.</span><span class="token method function property-access" style="color:#d73a49" data-170-js-token="promisify-0-18">promisify</span><span class="token punctuation" style="color:#393A34" data-170-js-token="(-0-27">(</span><span class="token function" style="color:#d73a49" data-170-js-token="require-0-28">require</span><span class="token punctuation" style="color:#393A34" data-170-js-token="(-0-35">(</span><span class="token string" style="color:#e3116c" data-170-js-token="&#x27;child_process&#x27;-0-36">&#x27;child_process&#x27;</span><span class="token punctuation" style="color:#393A34" data-170-js-token=")-0-51">)</span><span class="token punctuation" style="color:#393A34" data-170-js-token=".-0-52">.</span><span class="token property-access" data-170-js-token="exec-0-53">exec</span><span class="token punctuation" style="color:#393A34" data-170-js-token=")-0-57">)</span><span class="token punctuation" style="color:#393A34" data-170-js-token=";-0-58">;</span><span class="token plain" data-170-js-token="-0-59"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-1-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-170-js-token="/**-1-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 获取最新版本号</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns Promise</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-170-js-token="-4-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-5-0"></span><span class="token keyword" style="color:#00009f" data-170-js-token="async-5-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-170-js-token="function-5-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-170-js-token="getLatestVersion-5-15">getLatestVersion</span><span class="token punctuation" style="color:#393A34" data-170-js-token="(-5-31">(</span><span class="token punctuation" style="color:#393A34" data-170-js-token=")-5-32">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-170-js-token="{-5-34">{</span><span class="token plain" data-170-js-token="-5-35"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-6-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-170-js-token="try-6-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-170-js-token="{-6-5">{</span><span class="token plain" data-170-js-token="-6-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-7-0">		</span><span class="token keyword" style="color:#00009f" data-170-js-token="const-7-2">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-170-js-token="{-7-8">{</span><span class="token plain" data-170-js-token="stdout-7-9">stdout</span><span class="token punctuation" style="color:#393A34" data-170-js-token="}-7-15">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-170-js-token="=-7-17">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-170-js-token="await-7-19">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-170-js-token="exec-7-25">exec</span><span class="token punctuation" style="color:#393A34" data-170-js-token="(-7-29">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-170-js-token="`-7-30">`</span><span class="token template-string string" style="color:#e3116c">npm show </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-170-js-token="${-7-40">${</span><span class="token template-string interpolation" data-170-js-token="packageName-7-42">packageName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-170-js-token="}-7-53">}</span><span class="token template-string string" style="color:#e3116c"> version</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-170-js-token="`-7-62">`</span><span class="token punctuation" style="color:#393A34" data-170-js-token=")-7-63">)</span><span class="token punctuation" style="color:#393A34" data-170-js-token=";-7-64">;</span><span class="token plain" data-170-js-token="-7-65"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-8-0">		</span><span class="token keyword" style="color:#00009f" data-170-js-token="const-8-2">const</span><span class="token plain"> latestVersion </span><span class="token operator" style="color:#393A34" data-170-js-token="=-8-22">=</span><span class="token plain"> stdout</span><span class="token punctuation" style="color:#393A34" data-170-js-token=".-8-30">.</span><span class="token method function property-access" style="color:#d73a49" data-170-js-token="trim-8-31">trim</span><span class="token punctuation" style="color:#393A34" data-170-js-token="(-8-35">(</span><span class="token punctuation" style="color:#393A34" data-170-js-token=")-8-36">)</span><span class="token punctuation" style="color:#393A34" data-170-js-token=".-8-37">.</span><span class="token method function property-access" style="color:#d73a49" data-170-js-token="replace-8-38">replace</span><span class="token punctuation" style="color:#393A34" data-170-js-token="(-8-45">(</span><span class="token regex regex-delimiter" style="color:#36acaa" data-170-js-token="/-8-46">/</span><span class="token regex regex-source language-regex" style="color:#36acaa" data-170-js-token="^v-8-47">^v</span><span class="token regex regex-delimiter" style="color:#36acaa" data-170-js-token="/-8-49">/</span><span class="token punctuation" style="color:#393A34" data-170-js-token=",-8-50">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-170-js-token="&#x27;&#x27;-8-52">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34" data-170-js-token=")-8-54">)</span><span class="token punctuation" style="color:#393A34" data-170-js-token=";-8-55">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 删除可能存在的前导 v</span><span class="token plain" data-170-js-token="-8-71"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-9-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-170-js-token="return-9-2">return</span><span class="token plain"> latestVersion</span><span class="token punctuation" style="color:#393A34" data-170-js-token=";-9-22">;</span><span class="token plain" data-170-js-token="-9-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-10-0">	</span><span class="token punctuation" style="color:#393A34" data-170-js-token="}-10-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-170-js-token="catch-10-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-170-js-token="(-10-9">(</span><span class="token plain" data-170-js-token="error-10-10">error</span><span class="token punctuation" style="color:#393A34" data-170-js-token=")-10-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-170-js-token="{-10-17">{</span><span class="token plain" data-170-js-token="-10-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-11-0">		</span><span class="token console class-name" data-170-js-token="console-11-2">console</span><span class="token punctuation" style="color:#393A34" data-170-js-token=".-11-9">.</span><span class="token method function property-access" style="color:#d73a49" data-170-js-token="error-11-10">error</span><span class="token punctuation" style="color:#393A34" data-170-js-token="(-11-15">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-170-js-token="`-11-16">`</span><span class="token template-string string" style="color:#e3116c">❌ 获取最新版本失败: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-170-js-token="${-11-29">${</span><span class="token template-string interpolation" data-170-js-token="error-11-31">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-170-js-token=".-11-36">.</span><span class="token template-string interpolation" data-170-js-token="message-11-37">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-170-js-token="}-11-44">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-170-js-token="`-11-45">`</span><span class="token punctuation" style="color:#393A34" data-170-js-token=")-11-46">)</span><span class="token punctuation" style="color:#393A34" data-170-js-token=";-11-47">;</span><span class="token plain" data-170-js-token="-11-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-12-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-170-js-token="throw-12-2">throw</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-170-js-token=";-12-13">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 抛出错误，以便可以在调用此函数的地方捕获并处理</span><span class="token plain" data-170-js-token="-12-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-13-0">	</span><span class="token punctuation" style="color:#393A34" data-170-js-token="}-13-1">}</span><span class="token plain" data-170-js-token="-13-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-170-js-token="-14-0"></span><span class="token punctuation" style="color:#393A34" data-170-js-token="}-14-0">}</span></div></pre></div><p>解释下</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-171-js-token="const-0-0">const</span><span class="token plain"> exec </span><span class="token operator" style="color:#393A34" data-171-js-token="=-0-11">=</span><span class="token plain"> util</span><span class="token punctuation" style="color:#393A34" data-171-js-token=".-0-17">.</span><span class="token method function property-access" style="color:#d73a49" data-171-js-token="promisify-0-18">promisify</span><span class="token punctuation" style="color:#393A34" data-171-js-token="(-0-27">(</span><span class="token function" style="color:#d73a49" data-171-js-token="require-0-28">require</span><span class="token punctuation" style="color:#393A34" data-171-js-token="(-0-35">(</span><span class="token string" style="color:#e3116c" data-171-js-token="&#x27;child_process&#x27;-0-36">&#x27;child_process&#x27;</span><span class="token punctuation" style="color:#393A34" data-171-js-token=")-0-51">)</span><span class="token punctuation" style="color:#393A34" data-171-js-token=".-0-52">.</span><span class="token property-access" data-171-js-token="exec-0-53">exec</span><span class="token punctuation" style="color:#393A34" data-171-js-token=")-0-57">)</span><span class="token punctuation" style="color:#393A34" data-171-js-token=";-0-58">;</span></div></pre></div><p>这行代码的作用是将 <code>Node.js</code> 中的回调风格的函数转换为 <code>Promise</code> 风格的函数，使得可以更方便地处理异步操作。</p><p>具体解释如下：</p><ol><li><code>require(&#x27;child_process&#x27;).exec</code>：这里是通过 <code>require</code> 函数引入 <code>node</code> 核心模块 <code>child_process</code> 中的 <code>exec</code> 方法，<code>exec</code> 方法用于在子进程中执行 <code>shell</code> 命令。</li><li><code>util.promisify</code>：这是 <code>node</code> 中的 <code>util</code> 模块提供的方法，用于将一个遵循回调函数规则的方法转换成返回 Promise 的函数。这里将 <code>child_process.exec</code> 方法转换为 <code>Promise</code> 风格的方法。</li><li><code>const exec = util.promisify(require(&#x27;child_process&#x27;).exec);</code>：将经过 <code>util.promisify</code> 处理后的 <code>child_process.exec</code> 方法赋值给一个新的常量 <code>exec</code>，从而创建了一个返回 <code>Promise</code> 的新函数 <code>exec</code>。</li></ol><p>我们更改主函数如下:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic" data-172-js-token="/**-0-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 主函数入口</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-172-js-token="-2-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-172-js-token="-3-0"></span><span class="token keyword" style="color:#00009f" data-172-js-token="async-3-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-172-js-token="function-3-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-172-js-token="main-3-15">main</span><span class="token punctuation" style="color:#393A34" data-172-js-token="(-3-19">(</span><span class="token punctuation" style="color:#393A34" data-172-js-token=")-3-20">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-172-js-token="{-3-22">{</span><span class="token plain" data-172-js-token="-3-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-172-js-token="-4-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-172-js-token="try-4-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-172-js-token="{-4-5">{</span><span class="token plain" data-172-js-token="-4-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-172-js-token="-5-0">		</span><span class="token keyword" style="color:#00009f" data-172-js-token="const-5-2">const</span><span class="token plain"> latestVersion </span><span class="token operator" style="color:#393A34" data-172-js-token="=-5-22">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-172-js-token="await-5-24">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-172-js-token="getLatestVersion-5-30">getLatestVersion</span><span class="token punctuation" style="color:#393A34" data-172-js-token="(-5-46">(</span><span class="token punctuation" style="color:#393A34" data-172-js-token=")-5-47">)</span><span class="token punctuation" style="color:#393A34" data-172-js-token=";-5-48">;</span><span class="token plain" data-172-js-token="-5-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-172-js-token="-6-0">	</span><span class="token punctuation" style="color:#393A34" data-172-js-token="}-6-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-172-js-token="catch-6-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-172-js-token="(-6-9">(</span><span class="token plain" data-172-js-token="error-6-10">error</span><span class="token punctuation" style="color:#393A34" data-172-js-token=")-6-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-172-js-token="{-6-17">{</span><span class="token plain" data-172-js-token="-6-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-172-js-token="-7-0">		</span><span class="token console class-name" data-172-js-token="console-7-2">console</span><span class="token punctuation" style="color:#393A34" data-172-js-token=".-7-9">.</span><span class="token method function property-access" style="color:#d73a49" data-172-js-token="error-7-10">error</span><span class="token punctuation" style="color:#393A34" data-172-js-token="(-7-15">(</span><span class="token string" style="color:#e3116c">&#x27;❌ 发生错误:&#x27;</span><span class="token punctuation" style="color:#393A34" data-172-js-token=",-7-25">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-172-js-token=")-7-32">)</span><span class="token punctuation" style="color:#393A34" data-172-js-token=";-7-33">;</span><span class="token plain" data-172-js-token="-7-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-172-js-token="-8-0">	</span><span class="token punctuation" style="color:#393A34" data-172-js-token="}-8-1">}</span><span class="token plain" data-172-js-token="-8-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-172-js-token="-9-0"></span><span class="token punctuation" style="color:#393A34" data-172-js-token="}-9-0">}</span><span class="token plain" data-172-js-token="-9-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-172-js-token="-10-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-172-js-token="-11-0"></span><span class="token function" style="color:#d73a49" data-172-js-token="main-11-0">main</span><span class="token punctuation" style="color:#393A34" data-172-js-token="(-11-4">(</span><span class="token punctuation" style="color:#393A34" data-172-js-token=")-11-5">)</span><span class="token punctuation" style="color:#393A34" data-172-js-token=";-11-6">;</span></div></pre></div><h1 id="-三、实现显示选择界面"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#-三、实现显示选择界面"><span class="icon icon-link"></span></a>🍒 三、实现显示选择界面</h1><h2 id="1inquirer的基本使用"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#1inquirer的基本使用"><span class="icon icon-link"></span></a>1.<code>inquirer</code>的基本使用</h2><p>这里使用的是<code>inquirer</code>库，<strong><code>Inquirer</code></strong> 用于创建交互式命令行界面。它提供了丰富的方式来与用户进行交互，例如提问问题、接收用户输入并根据用户的响应执行相应的操作。</p><p>以下是使用 <strong>Inquirer</strong> 的基本步骤：</p><ol><li><p><strong>安装 Inquirer</strong>：首先需要在项目中安装 <code>Inquirer</code> 模块。可以使用以下命令通过 npm 进行安装：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">npm install inquirer</span></div></pre></div></li><li><p><strong>引入 Inquirer 模块</strong>：在项目中引入 Inquirer 模块，以便在代码中使用它：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">const inquirer = require(&#x27;inquirer&#x27;);</span></div></pre></div></li><li><p><strong>创建问题数组</strong>：通过创建一系列问题的数组来定义需要向用户提出的问题。每个问题可以包括类型、消息、选择项等属性。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-175-js-token="const-0-0">const</span><span class="token plain"> questions </span><span class="token operator" style="color:#393A34" data-175-js-token="=-0-16">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-175-js-token="[-0-18">[</span><span class="token plain" data-175-js-token="-0-19"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34" data-175-js-token="{-1-2">{</span><span class="token plain" data-175-js-token="-1-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    type</span><span class="token operator" style="color:#393A34" data-175-js-token=":-2-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-175-js-token="&#x27;input&#x27;-2-10">&#x27;input&#x27;</span><span class="token punctuation" style="color:#393A34" data-175-js-token=",-2-17">,</span><span class="token plain" data-175-js-token="-2-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token operator" style="color:#393A34" data-175-js-token=":-3-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-175-js-token="&#x27;username&#x27;-3-10">&#x27;username&#x27;</span><span class="token punctuation" style="color:#393A34" data-175-js-token=",-3-20">,</span><span class="token plain" data-175-js-token="-3-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    message</span><span class="token operator" style="color:#393A34" data-175-js-token=":-4-11">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-175-js-token="&#x27;请输入您的用户名：&#x27;-4-13">&#x27;请输入您的用户名：&#x27;</span><span class="token plain" data-175-js-token="-4-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34" data-175-js-token="}-5-2">}</span><span class="token punctuation" style="color:#393A34" data-175-js-token=",-5-3">,</span><span class="token plain" data-175-js-token="-5-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34" data-175-js-token="{-6-2">{</span><span class="token plain" data-175-js-token="-6-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    type</span><span class="token operator" style="color:#393A34" data-175-js-token=":-7-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-175-js-token="&#x27;list&#x27;-7-10">&#x27;list&#x27;</span><span class="token punctuation" style="color:#393A34" data-175-js-token=",-7-16">,</span><span class="token plain" data-175-js-token="-7-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token operator" style="color:#393A34" data-175-js-token=":-8-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-175-js-token="&#x27;color&#x27;-8-10">&#x27;color&#x27;</span><span class="token punctuation" style="color:#393A34" data-175-js-token=",-8-17">,</span><span class="token plain" data-175-js-token="-8-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    message</span><span class="token operator" style="color:#393A34" data-175-js-token=":-9-11">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-175-js-token="&#x27;请选择您喜欢的颜色：&#x27;-9-13">&#x27;请选择您喜欢的颜色：&#x27;</span><span class="token punctuation" style="color:#393A34" data-175-js-token=",-9-25">,</span><span class="token plain" data-175-js-token="-9-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    choices</span><span class="token operator" style="color:#393A34" data-175-js-token=":-10-11">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-175-js-token="[-10-13">[</span><span class="token string" style="color:#e3116c" data-175-js-token="&#x27;红色&#x27;-10-14">&#x27;红色&#x27;</span><span class="token punctuation" style="color:#393A34" data-175-js-token=",-10-18">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-175-js-token="&#x27;蓝色&#x27;-10-20">&#x27;蓝色&#x27;</span><span class="token punctuation" style="color:#393A34" data-175-js-token=",-10-24">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-175-js-token="&#x27;绿色&#x27;-10-26">&#x27;绿色&#x27;</span><span class="token punctuation" style="color:#393A34" data-175-js-token="]-10-30">]</span><span class="token plain" data-175-js-token="-10-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34" data-175-js-token="}-11-2">}</span><span class="token plain" data-175-js-token="-11-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-175-js-token="-12-0"></span><span class="token punctuation" style="color:#393A34" data-175-js-token="]-12-0">]</span><span class="token punctuation" style="color:#393A34" data-175-js-token=";-12-1">;</span></div></pre></div></li><li><p><strong>使用 Inquirer 提出问题</strong>：调用 <code>inquirer.prompt()</code> 方法并传入问题数组来开始与用户交互。用户将依次回答每个问题。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain" data-176-js-token="inquirer-0-0">inquirer</span><span class="token punctuation" style="color:#393A34" data-176-js-token=".-0-8">.</span><span class="token method function property-access" style="color:#d73a49" data-176-js-token="prompt-0-9">prompt</span><span class="token punctuation" style="color:#393A34" data-176-js-token="(-0-15">(</span><span class="token plain" data-176-js-token="questions-0-16">questions</span><span class="token punctuation" style="color:#393A34" data-176-js-token=")-0-25">)</span><span class="token plain" data-176-js-token="-0-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34" data-176-js-token=".-1-2">.</span><span class="token method function property-access" style="color:#d73a49" data-176-js-token="then-1-3">then</span><span class="token punctuation" style="color:#393A34" data-176-js-token="(-1-7">(</span><span class="token parameter" data-176-js-token="answers-1-8">answers</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-176-js-token="=&gt;-1-16">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-176-js-token="{-1-19">{</span><span class="token plain" data-176-js-token="-1-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name" data-176-js-token="console-2-4">console</span><span class="token punctuation" style="color:#393A34" data-176-js-token=".-2-11">.</span><span class="token method function property-access" style="color:#d73a49" data-176-js-token="log-2-12">log</span><span class="token punctuation" style="color:#393A34" data-176-js-token="(-2-15">(</span><span class="token string" style="color:#e3116c" data-176-js-token="&#x27;您输入的用户名是：&#x27;-2-16">&#x27;您输入的用户名是：&#x27;</span><span class="token punctuation" style="color:#393A34" data-176-js-token=",-2-27">,</span><span class="token plain"> answers</span><span class="token punctuation" style="color:#393A34" data-176-js-token=".-2-36">.</span><span class="token property-access" data-176-js-token="username-2-37">username</span><span class="token punctuation" style="color:#393A34" data-176-js-token=")-2-45">)</span><span class="token punctuation" style="color:#393A34" data-176-js-token=";-2-46">;</span><span class="token plain" data-176-js-token="-2-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name" data-176-js-token="console-3-4">console</span><span class="token punctuation" style="color:#393A34" data-176-js-token=".-3-11">.</span><span class="token method function property-access" style="color:#d73a49" data-176-js-token="log-3-12">log</span><span class="token punctuation" style="color:#393A34" data-176-js-token="(-3-15">(</span><span class="token string" style="color:#e3116c" data-176-js-token="&#x27;您选择的颜色是：&#x27;-3-16">&#x27;您选择的颜色是：&#x27;</span><span class="token punctuation" style="color:#393A34" data-176-js-token=",-3-26">,</span><span class="token plain"> answers</span><span class="token punctuation" style="color:#393A34" data-176-js-token=".-3-35">.</span><span class="token property-access" data-176-js-token="color-3-36">color</span><span class="token punctuation" style="color:#393A34" data-176-js-token=")-3-41">)</span><span class="token punctuation" style="color:#393A34" data-176-js-token=";-3-42">;</span><span class="token plain" data-176-js-token="-3-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34" data-176-js-token="}-4-2">}</span><span class="token punctuation" style="color:#393A34" data-176-js-token=")-4-3">)</span><span class="token plain" data-176-js-token="-4-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34" data-176-js-token=".-5-2">.</span><span class="token keyword control-flow" style="color:#00009f" data-176-js-token="catch-5-3">catch</span><span class="token punctuation" style="color:#393A34" data-176-js-token="(-5-8">(</span><span class="token parameter" data-176-js-token="error-5-9">error</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-176-js-token="=&gt;-5-15">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-176-js-token="{-5-18">{</span><span class="token plain" data-176-js-token="-5-19"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name" data-176-js-token="console-6-4">console</span><span class="token punctuation" style="color:#393A34" data-176-js-token=".-6-11">.</span><span class="token method function property-access" style="color:#d73a49" data-176-js-token="error-6-12">error</span><span class="token punctuation" style="color:#393A34" data-176-js-token="(-6-17">(</span><span class="token string" style="color:#e3116c" data-176-js-token="&#x27;交互过程中出错：&#x27;-6-18">&#x27;交互过程中出错：&#x27;</span><span class="token punctuation" style="color:#393A34" data-176-js-token=",-6-28">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-176-js-token=")-6-35">)</span><span class="token punctuation" style="color:#393A34" data-176-js-token=";-6-36">;</span><span class="token plain" data-176-js-token="-6-37"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34" data-176-js-token="}-7-2">}</span><span class="token punctuation" style="color:#393A34" data-176-js-token=")-7-3">)</span><span class="token punctuation" style="color:#393A34" data-176-js-token=";-7-4">;</span></div></pre></div></li></ol><h2 id="2实现我们需要的界面"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#2实现我们需要的界面"><span class="icon icon-link"></span></a>2.实现我们需要的界面</h2><p>之前我们已经介绍过了<a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7356175306937466916">npm的工程管理命令<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这里函数的逻辑就根据选择的版本类型，根据上面获取到的当前最新版包计算出新发布的版本信息。</p><p><img src="/front_end_engineer_book/static/image-20240615124136615.68bf300c.png" alt="image-20240615124136615"/></p><p>代码如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic" data-177-js-token="/**-0-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 命令行显示逻辑</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} latestVersion</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-177-js-token="-3-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-4-0"></span><span class="token keyword" style="color:#00009f" data-177-js-token="async-4-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-177-js-token="function-4-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-177-js-token="displayOptions-4-15">displayOptions</span><span class="token punctuation" style="color:#393A34" data-177-js-token="(-4-29">(</span><span class="token parameter" data-177-js-token="latestVersion-4-30">latestVersion</span><span class="token punctuation" style="color:#393A34" data-177-js-token=")-4-43">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-4-45">{</span><span class="token plain" data-177-js-token="-4-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-5-0">	</span><span class="token console class-name" data-177-js-token="console-5-1">console</span><span class="token punctuation" style="color:#393A34" data-177-js-token=".-5-8">.</span><span class="token method function property-access" style="color:#d73a49" data-177-js-token="log-5-9">log</span><span class="token punctuation" style="color:#393A34" data-177-js-token="(-5-12">(</span><span class="token string" style="color:#e3116c">&#x27;✅ 发包脚本启动【自动更新版本号、自动发布到npm】&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=")-5-41">)</span><span class="token punctuation" style="color:#393A34" data-177-js-token=";-5-42">;</span><span class="token plain" data-177-js-token="-5-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-6-0">	</span><span class="token console class-name" data-177-js-token="console-6-1">console</span><span class="token punctuation" style="color:#393A34" data-177-js-token=".-6-8">.</span><span class="token method function property-access" style="color:#d73a49" data-177-js-token="log-6-9">log</span><span class="token punctuation" style="color:#393A34" data-177-js-token="(-6-12">(</span><span class="token string" style="color:#e3116c">&#x27;!!! 使用前请确保仓库内已经是可发布状态&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=")-6-36">)</span><span class="token punctuation" style="color:#393A34" data-177-js-token=";-6-37">;</span><span class="token plain" data-177-js-token="-6-38"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-7-0">	</span><span class="token keyword" style="color:#00009f" data-177-js-token="const-7-1">const</span><span class="token plain"> currentVersion </span><span class="token operator" style="color:#393A34" data-177-js-token="=-7-22">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-177-js-token="parseVersion-7-24">parseVersion</span><span class="token punctuation" style="color:#393A34" data-177-js-token="(-7-36">(</span><span class="token plain" data-177-js-token="latestVersion-7-37">latestVersion</span><span class="token punctuation" style="color:#393A34" data-177-js-token=")-7-50">)</span><span class="token punctuation" style="color:#393A34" data-177-js-token=";-7-51">;</span><span class="token plain" data-177-js-token="-7-52"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-8-0">	</span><span class="token keyword" style="color:#00009f" data-177-js-token="const-8-1">const</span><span class="token plain"> choices </span><span class="token operator" style="color:#393A34" data-177-js-token="=-8-15">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-177-js-token="[-8-17">[</span><span class="token plain" data-177-js-token="-8-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-9-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-9-2">{</span><span class="token plain" data-177-js-token="-9-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="name-10-0">			name</span><span class="token operator" style="color:#393A34" data-177-js-token=":-10-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-10-9">`</span><span class="token template-string string" style="color:#e3116c">Major【大版本】 (</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="${-10-22">${</span><span class="token template-string interpolation function" style="color:#d73a49" data-177-js-token="parseInt-10-24">parseInt</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token="(-10-32">(</span><span class="token template-string interpolation" data-177-js-token="currentVersion-10-33">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token=".-10-47">.</span><span class="token template-string interpolation" data-177-js-token="major-10-48">major</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token=")-10-53">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34" data-177-js-token="+-10-55">+</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa" data-177-js-token="1-10-57">1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="}-10-58">}</span><span class="token template-string string" style="color:#e3116c" data-177-js-token=".0.0)-10-59">.0.0)</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-10-64">`</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-10-65">,</span><span class="token plain" data-177-js-token="-10-66"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="value-11-0">			value</span><span class="token operator" style="color:#393A34" data-177-js-token=":-11-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;major&#x27;-11-10">&#x27;major&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-11-17">,</span><span class="token plain" data-177-js-token="-11-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-12-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-12-2">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-12-3">,</span><span class="token plain" data-177-js-token="-12-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-13-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-13-2">{</span><span class="token plain" data-177-js-token="-13-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="name-14-0">			name</span><span class="token operator" style="color:#393A34" data-177-js-token=":-14-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-14-9">`</span><span class="token template-string string" style="color:#e3116c">Minor【小版本】 (</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="${-14-22">${</span><span class="token template-string interpolation" data-177-js-token="currentVersion-14-24">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token=".-14-38">.</span><span class="token template-string interpolation" data-177-js-token="major-14-39">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="}-14-44">}</span><span class="token template-string string" style="color:#e3116c" data-177-js-token=".-14-45">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="${-14-46">${</span><span class="token template-string interpolation function" style="color:#d73a49" data-177-js-token="parseInt-14-48">parseInt</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token="(-14-56">(</span><span class="token template-string interpolation" data-177-js-token="currentVersion-14-57">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token=".-14-71">.</span><span class="token template-string interpolation" data-177-js-token="minor-14-72">minor</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token=")-14-77">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34" data-177-js-token="+-14-79">+</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa" data-177-js-token="1-14-81">1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="}-14-82">}</span><span class="token template-string string" style="color:#e3116c" data-177-js-token=".0)-14-83">.0)</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-14-86">`</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-14-87">,</span><span class="token plain" data-177-js-token="-14-88"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="value-15-0">			value</span><span class="token operator" style="color:#393A34" data-177-js-token=":-15-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;minor&#x27;-15-10">&#x27;minor&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-15-17">,</span><span class="token plain" data-177-js-token="-15-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-16-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-16-2">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-16-3">,</span><span class="token plain" data-177-js-token="-16-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-17-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-17-2">{</span><span class="token plain" data-177-js-token="-17-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="name-18-0">			name</span><span class="token operator" style="color:#393A34" data-177-js-token=":-18-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-18-9">`</span><span class="token template-string string" style="color:#e3116c">Patch【修订版本】 (</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="${-18-23">${</span><span class="token template-string interpolation" data-177-js-token="currentVersion-18-25">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token=".-18-39">.</span><span class="token template-string interpolation" data-177-js-token="major-18-40">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="}-18-45">}</span><span class="token template-string string" style="color:#e3116c" data-177-js-token=".-18-46">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="${-18-47">${</span><span class="token template-string interpolation" data-177-js-token="currentVersion-18-49">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token=".-18-63">.</span><span class="token template-string interpolation" data-177-js-token="minor-18-64">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="}-18-69">}</span><span class="token template-string string" style="color:#e3116c" data-177-js-token=".-18-70">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="${-18-71">${</span><span class="token template-string interpolation function" style="color:#d73a49" data-177-js-token="parseInt-18-73">parseInt</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token="(-18-81">(</span><span class="token template-string interpolation" data-177-js-token="currentVersion-18-82">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token=".-18-96">.</span><span class="token template-string interpolation" data-177-js-token="patch-18-97">patch</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-177-js-token=")-18-102">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34" data-177-js-token="+-18-104">+</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa" data-177-js-token="1-18-106">1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-177-js-token="}-18-107">}</span><span class="token template-string string" style="color:#e3116c" data-177-js-token=")-18-108">)</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-18-109">`</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-18-110">,</span><span class="token plain" data-177-js-token="-18-111"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="value-19-0">			value</span><span class="token operator" style="color:#393A34" data-177-js-token=":-19-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;patch&#x27;-19-10">&#x27;patch&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-19-17">,</span><span class="token plain" data-177-js-token="-19-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-20-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-20-2">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-20-3">,</span><span class="token plain" data-177-js-token="-20-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-21-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-21-2">{</span><span class="token plain" data-177-js-token="name-21-3">name</span><span class="token operator" style="color:#393A34" data-177-js-token=":-21-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-21-9">`</span><span class="token template-string string" style="color:#e3116c" data-177-js-token="Prepatch【预发修订版本】-21-10">Prepatch【预发修订版本】</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-21-26">`</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-21-27">,</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34" data-177-js-token=":-21-34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;prepatch&#x27;-21-36">&#x27;prepatch&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-21-46">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-21-47">,</span><span class="token plain" data-177-js-token="-21-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-22-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-22-2">{</span><span class="token plain" data-177-js-token="name-22-3">name</span><span class="token operator" style="color:#393A34" data-177-js-token=":-22-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-22-9">`</span><span class="token template-string string" style="color:#e3116c" data-177-js-token="Preminor【预发小版本】-22-10">Preminor【预发小版本】</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-22-25">`</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-22-26">,</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34" data-177-js-token=":-22-33">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;preminor&#x27;-22-35">&#x27;preminor&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-22-45">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-22-46">,</span><span class="token plain" data-177-js-token="-22-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-23-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-23-2">{</span><span class="token plain" data-177-js-token="name-23-3">name</span><span class="token operator" style="color:#393A34" data-177-js-token=":-23-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-23-9">`</span><span class="token template-string string" style="color:#e3116c" data-177-js-token="Premajor【预发大版本】-23-10">Premajor【预发大版本】</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-23-25">`</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-23-26">,</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34" data-177-js-token=":-23-33">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;premajor&#x27;-23-35">&#x27;premajor&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-23-45">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-23-46">,</span><span class="token plain" data-177-js-token="-23-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-24-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-24-2">{</span><span class="token plain" data-177-js-token="name-24-3">name</span><span class="token operator" style="color:#393A34" data-177-js-token=":-24-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-24-9">`</span><span class="token template-string string" style="color:#e3116c" data-177-js-token="Prerelease【预发版】-24-10">Prerelease【预发版】</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-24-25">`</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-24-26">,</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34" data-177-js-token=":-24-33">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;prerelease&#x27;-24-35">&#x27;prerelease&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-24-47">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-24-48">,</span><span class="token plain" data-177-js-token="-24-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-25-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-25-2">{</span><span class="token plain" data-177-js-token="name-25-3">name</span><span class="token operator" style="color:#393A34" data-177-js-token=":-25-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-25-9">`</span><span class="token template-string string" style="color:#e3116c">Specific version【指定版本】</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-177-js-token="`-25-32">`</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-25-33">,</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34" data-177-js-token=":-25-40">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;specific&#x27;-25-42">&#x27;specific&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-25-52">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-25-53">,</span><span class="token plain" data-177-js-token="-25-54"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-26-0">	</span><span class="token punctuation" style="color:#393A34" data-177-js-token="]-26-1">]</span><span class="token punctuation" style="color:#393A34" data-177-js-token=";-26-2">;</span><span class="token plain" data-177-js-token="-26-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-177-js-token="-27-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="inquirer-28-0">	inquirer</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-29-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token=".-29-2">.</span><span class="token method function property-access" style="color:#d73a49" data-177-js-token="prompt-29-3">prompt</span><span class="token punctuation" style="color:#393A34" data-177-js-token="(-29-9">(</span><span class="token punctuation" style="color:#393A34" data-177-js-token="[-29-10">[</span><span class="token plain" data-177-js-token="-29-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-30-0">			</span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-30-3">{</span><span class="token plain" data-177-js-token="-30-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="type-31-0">				type</span><span class="token operator" style="color:#393A34" data-177-js-token=":-31-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;list&#x27;-31-10">&#x27;list&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-31-16">,</span><span class="token plain" data-177-js-token="-31-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="name-32-0">				name</span><span class="token operator" style="color:#393A34" data-177-js-token=":-32-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;releaseType&#x27;-32-10">&#x27;releaseType&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-32-23">,</span><span class="token plain" data-177-js-token="-32-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="message-33-0">				message</span><span class="token operator" style="color:#393A34" data-177-js-token=":-33-11">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;请选择版本号的更新类型:&#x27;-33-13">&#x27;请选择版本号的更新类型:&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-33-27">,</span><span class="token plain" data-177-js-token="-33-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="choices-34-0">				choices</span><span class="token operator" style="color:#393A34" data-177-js-token=":-34-11">:</span><span class="token plain"> choices</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-34-20">,</span><span class="token plain" data-177-js-token="-34-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-35-0">			</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-35-3">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-35-4">,</span><span class="token plain" data-177-js-token="-35-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-36-0">			</span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-36-3">{</span><span class="token plain" data-177-js-token="-36-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="type-37-0">				type</span><span class="token operator" style="color:#393A34" data-177-js-token=":-37-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;input&#x27;-37-10">&#x27;input&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-37-17">,</span><span class="token plain" data-177-js-token="-37-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="name-38-0">				name</span><span class="token operator" style="color:#393A34" data-177-js-token=":-38-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;specificVersion&#x27;-38-10">&#x27;specificVersion&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-38-27">,</span><span class="token plain" data-177-js-token="-38-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="message-39-0">				message</span><span class="token operator" style="color:#393A34" data-177-js-token=":-39-11">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;输入具体的版本号:&#x27;-39-13">&#x27;输入具体的版本号:&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-39-24">,</span><span class="token plain" data-177-js-token="-39-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-40-0">				</span><span class="token function-variable function" style="color:#d73a49" data-177-js-token="when-40-4">when</span><span class="token operator" style="color:#393A34" data-177-js-token=":-40-8">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-177-js-token="(-40-10">(</span><span class="token parameter" data-177-js-token="answers-40-11">answers</span><span class="token punctuation" style="color:#393A34" data-177-js-token=")-40-18">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-177-js-token="=&gt;-40-20">=&gt;</span><span class="token plain"> answers</span><span class="token punctuation" style="color:#393A34" data-177-js-token=".-40-30">.</span><span class="token property-access" data-177-js-token="releaseType-40-31">releaseType</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-177-js-token="===-40-43">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;specific&#x27;-40-47">&#x27;specific&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-40-57">,</span><span class="token plain" data-177-js-token="-40-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-41-0">				</span><span class="token function-variable function" style="color:#d73a49" data-177-js-token="validate-41-4">validate</span><span class="token operator" style="color:#393A34" data-177-js-token=":-41-12">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-177-js-token="(-41-14">(</span><span class="token parameter" data-177-js-token="input-41-15">input</span><span class="token punctuation" style="color:#393A34" data-177-js-token=")-41-20">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-177-js-token="=&gt;-41-22">=&gt;</span><span class="token plain" data-177-js-token="-41-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-42-0">					</span><span class="token regex regex-delimiter" style="color:#36acaa" data-177-js-token="/-42-5">/</span><span class="token regex regex-source language-regex" style="color:#36acaa" data-177-js-token="\d+\.\d+\.\d+(-\w+\.\d+)?-42-6">\d+\.\d+\.\d+(-\w+\.\d+)?</span><span class="token regex regex-delimiter" style="color:#36acaa" data-177-js-token="/-42-31">/</span><span class="token punctuation" style="color:#393A34" data-177-js-token=".-42-32">.</span><span class="token method function property-access" style="color:#d73a49" data-177-js-token="test-42-33">test</span><span class="token punctuation" style="color:#393A34" data-177-js-token="(-42-37">(</span><span class="token plain" data-177-js-token="input-42-38">input</span><span class="token punctuation" style="color:#393A34" data-177-js-token=")-42-43">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-177-js-token="||-42-45">||</span><span class="token plain" data-177-js-token="-42-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-43-0">					</span><span class="token string" style="color:#e3116c" data-177-js-token="&#x27;版本号必须符合语义化版本控制规范。&#x27;-43-5">&#x27;版本号必须符合语义化版本控制规范。&#x27;</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-43-24">,</span><span class="token plain" data-177-js-token="-43-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-44-0">			</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-44-3">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=",-44-4">,</span><span class="token plain" data-177-js-token="-44-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-45-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="]-45-2">]</span><span class="token punctuation" style="color:#393A34" data-177-js-token=")-45-3">)</span><span class="token plain" data-177-js-token="-45-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-46-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token=".-46-2">.</span><span class="token method function property-access" style="color:#d73a49" data-177-js-token="then-46-3">then</span><span class="token punctuation" style="color:#393A34" data-177-js-token="(-46-7">(</span><span class="token keyword" style="color:#00009f" data-177-js-token="async-46-8">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-177-js-token="(-46-14">(</span><span class="token parameter" data-177-js-token="answers-46-15">answers</span><span class="token punctuation" style="color:#393A34" data-177-js-token=")-46-22">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-177-js-token="=&gt;-46-24">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-177-js-token="{-46-27">{</span><span class="token plain" data-177-js-token="-46-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO：选择后的处理逻辑</span><span class="token plain" data-177-js-token="-47-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-48-0">		</span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-48-2">}</span><span class="token punctuation" style="color:#393A34" data-177-js-token=")-48-3">)</span><span class="token punctuation" style="color:#393A34" data-177-js-token=";-48-4">;</span><span class="token plain" data-177-js-token="-48-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-177-js-token="-49-0"></span><span class="token punctuation" style="color:#393A34" data-177-js-token="}-49-0">}</span></div></pre></div><h1 id="🥝-四、实现将新版本号写入packagejson"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#🥝-四、实现将新版本号写入packagejson"><span class="icon icon-link"></span></a>🥝 四、实现将新版本号写入<code>package.json</code></h1><p>这里我们区分正常版本发布和预发布两种</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-178-js-token="let-0-0">let</span><span class="token plain"> newVersion </span><span class="token operator" style="color:#393A34" data-178-js-token="=-0-15">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-178-js-token="&#x27;&#x27;-0-17">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34" data-178-js-token=";-0-19">;</span><span class="token plain" data-178-js-token="-0-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-178-js-token="-1-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 指定版本号，自己指定的版本号</span><span class="token plain" data-178-js-token="-1-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-178-js-token="-2-0"></span><span class="token keyword control-flow" style="color:#00009f" data-178-js-token="if-2-0">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-178-js-token="(-2-3">(</span><span class="token plain" data-178-js-token="answers-2-4">answers</span><span class="token punctuation" style="color:#393A34" data-178-js-token=".-2-11">.</span><span class="token property-access" data-178-js-token="releaseType-2-12">releaseType</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-178-js-token="===-2-24">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-178-js-token="&#x27;specific&#x27;-2-28">&#x27;specific&#x27;</span><span class="token punctuation" style="color:#393A34" data-178-js-token=")-2-38">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-178-js-token="{-2-40">{</span><span class="token plain" data-178-js-token="-2-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        newVersion </span><span class="token operator" style="color:#393A34" data-178-js-token="=-3-19">=</span><span class="token plain"> answers</span><span class="token punctuation" style="color:#393A34" data-178-js-token=".-3-28">.</span><span class="token property-access" data-178-js-token="specificVersion-3-29">specificVersion</span><span class="token punctuation" style="color:#393A34" data-178-js-token=";-3-44">;</span><span class="token plain" data-178-js-token="-3-45"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-178-js-token="-4-0"></span><span class="token punctuation" style="color:#393A34" data-178-js-token="}-4-0">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-178-js-token="else-4-2">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-178-js-token="if-4-7">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-178-js-token="(-4-10">(</span><span class="token punctuation" style="color:#393A34" data-178-js-token="[-4-11">[</span><span class="token string" style="color:#e3116c" data-178-js-token="&#x27;major&#x27;-4-12">&#x27;major&#x27;</span><span class="token punctuation" style="color:#393A34" data-178-js-token=",-4-19">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-178-js-token="&#x27;minor&#x27;-4-21">&#x27;minor&#x27;</span><span class="token punctuation" style="color:#393A34" data-178-js-token=",-4-28">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-178-js-token="&#x27;patch&#x27;-4-30">&#x27;patch&#x27;</span><span class="token punctuation" style="color:#393A34" data-178-js-token="]-4-37">]</span><span class="token punctuation" style="color:#393A34" data-178-js-token=".-4-38">.</span><span class="token method function property-access" style="color:#d73a49" data-178-js-token="includes-4-39">includes</span><span class="token punctuation" style="color:#393A34" data-178-js-token="(-4-47">(</span><span class="token plain" data-178-js-token="answers-4-48">answers</span><span class="token punctuation" style="color:#393A34" data-178-js-token=".-4-55">.</span><span class="token property-access" data-178-js-token="releaseType-4-56">releaseType</span><span class="token punctuation" style="color:#393A34" data-178-js-token=")-4-67">)</span><span class="token punctuation" style="color:#393A34" data-178-js-token=")-4-68">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-178-js-token="{-4-70">{</span><span class="token plain" data-178-js-token="-4-71"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 非预发版本，上面计算出来的值</span><span class="token plain" data-178-js-token="-5-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        currentVersion</span><span class="token punctuation" style="color:#393A34" data-178-js-token="[-6-22">[</span><span class="token plain" data-178-js-token="answers-6-23">answers</span><span class="token punctuation" style="color:#393A34" data-178-js-token=".-6-30">.</span><span class="token property-access" data-178-js-token="releaseType-6-31">releaseType</span><span class="token punctuation" style="color:#393A34" data-178-js-token="]-6-42">]</span><span class="token operator" style="color:#393A34" data-178-js-token="++-6-43">++</span><span class="token punctuation" style="color:#393A34" data-178-js-token=";-6-45">;</span><span class="token plain" data-178-js-token="-6-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        newVersion </span><span class="token operator" style="color:#393A34" data-178-js-token="=-7-19">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-178-js-token="`-7-21">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-178-js-token="${-7-22">${</span><span class="token template-string interpolation" data-178-js-token="currentVersion-7-24">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-178-js-token=".-7-38">.</span><span class="token template-string interpolation" data-178-js-token="major-7-39">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-178-js-token="}-7-44">}</span><span class="token template-string string" style="color:#e3116c" data-178-js-token=".-7-45">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-178-js-token="${-7-46">${</span><span class="token template-string interpolation" data-178-js-token="currentVersion-7-48">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-178-js-token=".-7-62">.</span><span class="token template-string interpolation" data-178-js-token="minor-7-63">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-178-js-token="}-7-68">}</span><span class="token template-string string" style="color:#e3116c" data-178-js-token=".-7-69">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-178-js-token="${-7-70">${</span><span class="token template-string interpolation" data-178-js-token="currentVersion-7-72">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-178-js-token=".-7-86">.</span><span class="token template-string interpolation" data-178-js-token="patch-7-87">patch</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-178-js-token="}-7-92">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-178-js-token="`-7-93">`</span><span class="token punctuation" style="color:#393A34" data-178-js-token=";-7-94">;</span><span class="token plain" data-178-js-token="-7-95"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-178-js-token="-8-0"></span><span class="token punctuation" style="color:#393A34" data-178-js-token="}-8-0">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-178-js-token="else-8-2">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-178-js-token="{-8-7">{</span><span class="token plain" data-178-js-token="-8-8"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 预发布版本，也是上面的计算逻辑，这里我们提出来了</span><span class="token plain" data-178-js-token="-9-35"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        newVersion </span><span class="token operator" style="color:#393A34" data-178-js-token="=-10-19">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-178-js-token="getPreReleaseVersion-10-21">getPreReleaseVersion</span><span class="token punctuation" style="color:#393A34" data-178-js-token="(-10-41">(</span><span class="token plain" data-178-js-token="currentVersion-10-42">currentVersion</span><span class="token punctuation" style="color:#393A34" data-178-js-token=",-10-56">,</span><span class="token plain"> answers</span><span class="token punctuation" style="color:#393A34" data-178-js-token=".-10-65">.</span><span class="token property-access" data-178-js-token="releaseType-10-66">releaseType</span><span class="token punctuation" style="color:#393A34" data-178-js-token=")-10-77">)</span><span class="token punctuation" style="color:#393A34" data-178-js-token=";-10-78">;</span><span class="token plain" data-178-js-token="-10-79"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-178-js-token="-11-0"></span><span class="token punctuation" style="color:#393A34" data-178-js-token="}-11-0">}</span><span class="token plain" data-178-js-token="-11-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-178-js-token="-12-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 更新版本号，写入到`package.json`中</span><span class="token plain" data-178-js-token="-12-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-178-js-token="-13-0"></span><span class="token function" style="color:#d73a49" data-178-js-token="updateVersion-13-0">updateVersion</span><span class="token punctuation" style="color:#393A34" data-178-js-token="(-13-13">(</span><span class="token plain" data-178-js-token="newVersion-13-14">newVersion</span><span class="token punctuation" style="color:#393A34" data-178-js-token=")-13-24">)</span><span class="token punctuation" style="color:#393A34" data-178-js-token=";-13-25">;</span></div></pre></div><p>预发布版本计算，个人开发一般也不用这种，但是我们还是实现一下</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic" data-179-js-token="/**-0-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 检测是否是预发布版本</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} version</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-179-js-token="-3-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-179-js-token="-4-0"></span><span class="token keyword" style="color:#00009f" data-179-js-token="function-4-0">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-179-js-token="isPreRelease-4-9">isPreRelease</span><span class="token punctuation" style="color:#393A34" data-179-js-token="(-4-21">(</span><span class="token parameter" data-179-js-token="version-4-22">version</span><span class="token punctuation" style="color:#393A34" data-179-js-token=")-4-29">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-179-js-token="{-4-31">{</span><span class="token plain" data-179-js-token="-4-32"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-179-js-token="-5-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-179-js-token="return-5-1">return</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa" data-179-js-token="/-5-8">/</span><span class="token regex regex-source language-regex" style="color:#36acaa" data-179-js-token="--5-9">-</span><span class="token regex regex-delimiter" style="color:#36acaa" data-179-js-token="/-5-10">/</span><span class="token punctuation" style="color:#393A34" data-179-js-token=".-5-11">.</span><span class="token method function property-access" style="color:#d73a49" data-179-js-token="test-5-12">test</span><span class="token punctuation" style="color:#393A34" data-179-js-token="(-5-16">(</span><span class="token plain" data-179-js-token="version-5-17">version</span><span class="token punctuation" style="color:#393A34" data-179-js-token=")-5-24">)</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-5-25">;</span><span class="token plain" data-179-js-token="-5-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-179-js-token="-6-0"></span><span class="token punctuation" style="color:#393A34" data-179-js-token="}-6-0">}</span><span class="token plain" data-179-js-token="-6-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-179-js-token="-7-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-179-js-token="-8-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-179-js-token="/**-8-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 获取预发布版本号</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} currentVersion</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} type</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-179-js-token="-12-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-179-js-token="-13-0"></span><span class="token keyword" style="color:#00009f" data-179-js-token="function-13-0">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-179-js-token="getPreReleaseVersion-13-9">getPreReleaseVersion</span><span class="token punctuation" style="color:#393A34" data-179-js-token="(-13-29">(</span><span class="token parameter" data-179-js-token="currentVersion-13-30">currentVersion</span><span class="token parameter punctuation" style="color:#393A34" data-179-js-token=",-13-44">,</span><span class="token parameter"> type</span><span class="token punctuation" style="color:#393A34" data-179-js-token=")-13-50">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-179-js-token="{-13-52">{</span><span class="token plain" data-179-js-token="-13-53"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-179-js-token="let-14-4">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-179-js-token="{-14-8">{</span><span class="token plain" data-179-js-token="major-14-9">major</span><span class="token punctuation" style="color:#393A34" data-179-js-token=",-14-14">,</span><span class="token plain"> minor</span><span class="token punctuation" style="color:#393A34" data-179-js-token=",-14-21">,</span><span class="token plain"> patch</span><span class="token punctuation" style="color:#393A34" data-179-js-token=",-14-28">,</span><span class="token plain"> preReleaseLabel</span><span class="token punctuation" style="color:#393A34" data-179-js-token=",-14-45">,</span><span class="token plain"> preReleaseVersion</span><span class="token punctuation" style="color:#393A34" data-179-js-token="}-14-64">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-179-js-token="=-14-66">=</span><span class="token plain" data-179-js-token="-14-67"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            currentVersion</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-15-26">;</span><span class="token plain" data-179-js-token="-15-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-179-js-token="switch-16-4">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-179-js-token="(-16-11">(</span><span class="token plain" data-179-js-token="type-16-12">type</span><span class="token punctuation" style="color:#393A34" data-179-js-token=")-16-16">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-179-js-token="{-16-18">{</span><span class="token plain" data-179-js-token="-16-19"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-179-js-token="case-17-8">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-179-js-token="&#x27;prepatch&#x27;-17-13">&#x27;prepatch&#x27;</span><span class="token operator" style="color:#393A34" data-179-js-token=":-17-23">:</span><span class="token plain" data-179-js-token="-17-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                patch </span><span class="token operator" style="color:#393A34" data-179-js-token="+=-18-22">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-179-js-token="1-18-25">1</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-18-26">;</span><span class="token plain" data-179-js-token="-18-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-179-js-token="return-19-16">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-19-23">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-19-24">${</span><span class="token template-string interpolation" data-179-js-token="major-19-26">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-19-31">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".-19-32">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-19-33">${</span><span class="token template-string interpolation" data-179-js-token="minor-19-35">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-19-40">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".-19-41">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-19-42">${</span><span class="token template-string interpolation" data-179-js-token="patch-19-44">patch</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-19-49">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token="-0-19-50">-0</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-19-52">`</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-19-53">;</span><span class="token plain" data-179-js-token="-19-54"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-179-js-token="case-20-8">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-179-js-token="&#x27;preminor&#x27;-20-13">&#x27;preminor&#x27;</span><span class="token operator" style="color:#393A34" data-179-js-token=":-20-23">:</span><span class="token plain" data-179-js-token="-20-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                minor </span><span class="token operator" style="color:#393A34" data-179-js-token="+=-21-22">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-179-js-token="1-21-25">1</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-21-26">;</span><span class="token plain" data-179-js-token="-21-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-179-js-token="return-22-16">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-22-23">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-22-24">${</span><span class="token template-string interpolation" data-179-js-token="major-22-26">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-22-31">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".-22-32">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-22-33">${</span><span class="token template-string interpolation" data-179-js-token="minor-22-35">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-22-40">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".0-0-22-41">.0-0</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-22-45">`</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-22-46">;</span><span class="token plain" data-179-js-token="-22-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-179-js-token="case-23-8">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-179-js-token="&#x27;premajor&#x27;-23-13">&#x27;premajor&#x27;</span><span class="token operator" style="color:#393A34" data-179-js-token=":-23-23">:</span><span class="token plain" data-179-js-token="-23-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                major </span><span class="token operator" style="color:#393A34" data-179-js-token="+=-24-22">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-179-js-token="1-24-25">1</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-24-26">;</span><span class="token plain" data-179-js-token="-24-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-179-js-token="return-25-16">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-25-23">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-25-24">${</span><span class="token template-string interpolation" data-179-js-token="major-25-26">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-25-31">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".0.0-0-25-32">.0.0-0</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-25-38">`</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-25-39">;</span><span class="token plain" data-179-js-token="-25-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-179-js-token="case-26-8">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-179-js-token="&#x27;prerelease&#x27;-26-13">&#x27;prerelease&#x27;</span><span class="token operator" style="color:#393A34" data-179-js-token=":-26-25">:</span><span class="token plain" data-179-js-token="-26-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-179-js-token="if-27-16">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-179-js-token="(-27-19">(</span><span class="token function" style="color:#d73a49" data-179-js-token="isPreRelease-27-20">isPreRelease</span><span class="token punctuation" style="color:#393A34" data-179-js-token="(-27-32">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-27-33">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-27-34">${</span><span class="token template-string interpolation" data-179-js-token="major-27-36">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-27-41">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".-27-42">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-27-43">${</span><span class="token template-string interpolation" data-179-js-token="minor-27-45">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-27-50">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".-27-51">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-27-52">${</span><span class="token template-string interpolation" data-179-js-token="patch-27-54">patch</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-27-59">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-27-60">`</span><span class="token punctuation" style="color:#393A34" data-179-js-token=")-27-61">)</span><span class="token punctuation" style="color:#393A34" data-179-js-token=")-27-62">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-179-js-token="{-27-64">{</span><span class="token plain" data-179-js-token="-27-65"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        preReleaseVersion </span><span class="token operator" style="color:#393A34" data-179-js-token="=-28-42">=</span><span class="token plain"> preReleaseVersion </span><span class="token operator" style="color:#393A34" data-179-js-token="||-28-62">||</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-179-js-token="0-28-65">0</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-28-66">;</span><span class="token plain" data-179-js-token="-28-67"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword control-flow" style="color:#00009f" data-179-js-token="return-29-24">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-29-31">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-29-32">${</span><span class="token template-string interpolation" data-179-js-token="major-29-34">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-29-39">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".-29-40">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-29-41">${</span><span class="token template-string interpolation" data-179-js-token="minor-29-43">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-29-48">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".-29-49">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-29-50">${</span><span class="token template-string interpolation" data-179-js-token="patch-29-52">patch</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-29-57">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token="--29-58">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-29-59">${</span><span class="token template-string interpolation">preReleaseLabel </span><span class="token template-string interpolation operator" style="color:#393A34" data-179-js-token="||-29-77">||</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c" data-179-js-token="&#x27;beta&#x27;-29-80">&#x27;beta&#x27;</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-29-86">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".-29-87">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-29-88">${</span><span class="token template-string interpolation">preReleaseVersion </span><span class="token template-string interpolation operator" style="color:#393A34" data-179-js-token="+-29-108">+</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa" data-179-js-token="1-29-110">1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-29-111">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-29-112">`</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-29-113">;</span><span class="token plain" data-179-js-token="-29-114"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34" data-179-js-token="}-30-16">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-179-js-token="else-30-18">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-179-js-token="{-30-23">{</span><span class="token plain" data-179-js-token="-30-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword control-flow" style="color:#00009f" data-179-js-token="return-31-24">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-31-31">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-31-32">${</span><span class="token template-string interpolation" data-179-js-token="major-31-34">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-31-39">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".-31-40">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-31-41">${</span><span class="token template-string interpolation" data-179-js-token="minor-31-43">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-31-48">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token=".-31-49">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-31-50">${</span><span class="token template-string interpolation" data-179-js-token="patch-31-52">patch</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-31-57">}</span><span class="token template-string string" style="color:#e3116c" data-179-js-token="-beta.0-31-58">-beta.0</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-31-65">`</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-31-66">;</span><span class="token plain" data-179-js-token="-31-67"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34" data-179-js-token="}-32-16">}</span><span class="token plain" data-179-js-token="-32-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword module" style="color:#00009f" data-179-js-token="default-33-8">default</span><span class="token operator" style="color:#393A34" data-179-js-token=":-33-15">:</span><span class="token plain" data-179-js-token="-33-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-179-js-token="throw-34-16">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-179-js-token="new-34-22">new</span><span class="token plain"> </span><span class="token class-name" data-179-js-token="Error-34-26">Error</span><span class="token punctuation" style="color:#393A34" data-179-js-token="(-34-31">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-34-32">`</span><span class="token template-string string" style="color:#e3116c">❌ 不支持的预发布版本类型: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="${-34-48">${</span><span class="token template-string interpolation" data-179-js-token="type-34-50">type</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-179-js-token="}-34-54">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-179-js-token="`-34-55">`</span><span class="token punctuation" style="color:#393A34" data-179-js-token=")-34-56">)</span><span class="token punctuation" style="color:#393A34" data-179-js-token=";-34-57">;</span><span class="token plain" data-179-js-token="-34-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-179-js-token="}-35-4">}</span><span class="token plain" data-179-js-token="-35-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-179-js-token="-36-0"></span><span class="token punctuation" style="color:#393A34" data-179-js-token="}-36-0">}</span></div></pre></div><p>写入到<code>package.json</code>中</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic" data-180-js-token="/**-0-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 更新版本号</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} newVersion</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-180-js-token="-3-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-180-js-token="-4-0"></span><span class="token keyword" style="color:#00009f" data-180-js-token="function-4-0">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-180-js-token="updateVersion-4-9">updateVersion</span><span class="token punctuation" style="color:#393A34" data-180-js-token="(-4-22">(</span><span class="token parameter" data-180-js-token="newVersion-4-23">newVersion</span><span class="token punctuation" style="color:#393A34" data-180-js-token=")-4-33">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-180-js-token="{-4-35">{</span><span class="token plain" data-180-js-token="-4-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-180-js-token="packageJson-5-0">	packageJson</span><span class="token punctuation" style="color:#393A34" data-180-js-token=".-5-12">.</span><span class="token property-access" data-180-js-token="version-5-13">version</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-180-js-token="=-5-21">=</span><span class="token plain"> newVersion</span><span class="token punctuation" style="color:#393A34" data-180-js-token=";-5-33">;</span><span class="token plain" data-180-js-token="-5-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-180-js-token="fs-6-0">	fs</span><span class="token punctuation" style="color:#393A34" data-180-js-token=".-6-3">.</span><span class="token method function property-access" style="color:#d73a49" data-180-js-token="writeFileSync-6-4">writeFileSync</span><span class="token punctuation" style="color:#393A34" data-180-js-token="(-6-17">(</span><span class="token plain" data-180-js-token="packageJsonPath-6-18">packageJsonPath</span><span class="token punctuation" style="color:#393A34" data-180-js-token=",-6-33">,</span><span class="token plain"> </span><span class="token known-class-name class-name" data-180-js-token="JSON-6-35">JSON</span><span class="token punctuation" style="color:#393A34" data-180-js-token=".-6-39">.</span><span class="token method function property-access" style="color:#d73a49" data-180-js-token="stringify-6-40">stringify</span><span class="token punctuation" style="color:#393A34" data-180-js-token="(-6-49">(</span><span class="token plain" data-180-js-token="packageJson-6-50">packageJson</span><span class="token punctuation" style="color:#393A34" data-180-js-token=",-6-61">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f" data-180-js-token="null-6-63">null</span><span class="token punctuation" style="color:#393A34" data-180-js-token=",-6-67">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-180-js-token="2-6-69">2</span><span class="token punctuation" style="color:#393A34" data-180-js-token=")-6-70">)</span><span class="token punctuation" style="color:#393A34" data-180-js-token=")-6-71">)</span><span class="token punctuation" style="color:#393A34" data-180-js-token=";-6-72">;</span><span class="token plain" data-180-js-token="-6-73"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-180-js-token="-7-0">	</span><span class="token console class-name" data-180-js-token="console-7-1">console</span><span class="token punctuation" style="color:#393A34" data-180-js-token=".-7-8">.</span><span class="token method function property-access" style="color:#d73a49" data-180-js-token="log-7-9">log</span><span class="token punctuation" style="color:#393A34" data-180-js-token="(-7-12">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-180-js-token="`-7-13">`</span><span class="token template-string string" style="color:#e3116c">✅ 版本号已更新为 </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-180-js-token="${-7-24">${</span><span class="token template-string interpolation" data-180-js-token="newVersion-7-26">newVersion</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-180-js-token="}-7-36">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-180-js-token="`-7-37">`</span><span class="token punctuation" style="color:#393A34" data-180-js-token=")-7-38">)</span><span class="token punctuation" style="color:#393A34" data-180-js-token=";-7-39">;</span><span class="token plain" data-180-js-token="-7-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-180-js-token="-8-0"></span><span class="token punctuation" style="color:#393A34" data-180-js-token="}-8-0">}</span></div></pre></div><h1 id="-五、实现git标记tag并推送远端"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#-五、实现git标记tag并推送远端"><span class="icon icon-link"></span></a>🍐 五、实现Git标记tag并推送远端</h1><p>这里使用的是当前分支，需要当前分支是否关联了远端分支，如果未关联，我们给他关联上，关联完成后我们给他标记tag并推送到远端。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic" data-181-js-token="/**-0-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 标记tag</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} newVersion</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-181-js-token="-3-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-4-0"></span><span class="token keyword" style="color:#00009f" data-181-js-token="function-4-0">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-181-js-token="gitOperations-4-9">gitOperations</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-4-22">(</span><span class="token parameter" data-181-js-token="newVersion-4-23">newVersion</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-4-33">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-4-35">{</span><span class="token plain" data-181-js-token="-4-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-5-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-181-js-token="try-5-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-5-5">{</span><span class="token plain" data-181-js-token="-5-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="process-6-0">		process</span><span class="token punctuation" style="color:#393A34" data-181-js-token=".-6-9">.</span><span class="token method function property-access" style="color:#d73a49" data-181-js-token="chdir-6-10">chdir</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-6-15">(</span><span class="token plain" data-181-js-token="projectRootPath-6-16">projectRootPath</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-6-31">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-6-32">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Change the current working directory to project root</span><span class="token plain" data-181-js-token="-6-89"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-181-js-token="-7-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-8-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 获取当前分支名称</span><span class="token plain" data-181-js-token="-8-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-9-0">		</span><span class="token keyword" style="color:#00009f" data-181-js-token="const-9-2">const</span><span class="token plain"> branchName </span><span class="token operator" style="color:#393A34" data-181-js-token="=-9-19">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-181-js-token="execSync-9-21">execSync</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-9-29">(</span><span class="token string" style="color:#e3116c">&#x27;git rev-parse --abbrev-ref HEAD&#x27;</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-9-63">)</span><span class="token plain" data-181-js-token="-9-64"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-10-0">			</span><span class="token punctuation" style="color:#393A34" data-181-js-token=".-10-3">.</span><span class="token method function property-access" style="color:#d73a49" data-181-js-token="toString-10-4">toString</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-10-12">(</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-10-13">)</span><span class="token plain" data-181-js-token="-10-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-11-0">			</span><span class="token punctuation" style="color:#393A34" data-181-js-token=".-11-3">.</span><span class="token method function property-access" style="color:#d73a49" data-181-js-token="trim-11-4">trim</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-11-8">(</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-11-9">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-11-10">;</span><span class="token plain" data-181-js-token="-11-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-181-js-token="-12-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-13-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 检查是否有设置 upstream（远程跟踪分支）</span><span class="token plain" data-181-js-token="-13-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-14-0">		</span><span class="token keyword" style="color:#00009f" data-181-js-token="let-14-2">let</span><span class="token plain"> setUpstream </span><span class="token operator" style="color:#393A34" data-181-js-token="=-14-18">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa" data-181-js-token="false-14-20">false</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-14-25">;</span><span class="token plain" data-181-js-token="-14-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-15-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-181-js-token="try-15-2">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-15-6">{</span><span class="token plain" data-181-js-token="-15-7"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-16-0">			</span><span class="token function" style="color:#d73a49" data-181-js-token="execSync-16-3">execSync</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-16-11">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-16-12">`</span><span class="token template-string string" style="color:#e3116c">git rev-parse --abbrev-ref --symbolic-full-name @{u}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-16-65">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-16-66">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-16-67">;</span><span class="token plain" data-181-js-token="-16-68"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-17-0">		</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-17-2">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-181-js-token="catch-17-4">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-17-10">(</span><span class="token plain" data-181-js-token="error-17-11">error</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-17-16">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-17-18">{</span><span class="token plain" data-181-js-token="-17-19"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-18-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// 如果没有设置 upstream，为远程的同名分支设置 upstream</span><span class="token plain" data-181-js-token="-18-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-19-0">			</span><span class="token keyword" style="color:#00009f" data-181-js-token="const-19-3">const</span><span class="token plain"> remoteBranchExists </span><span class="token operator" style="color:#393A34" data-181-js-token="=-19-28">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-181-js-token="execSync-19-30">execSync</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-19-38">(</span><span class="token plain" data-181-js-token="-19-39"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-20-0">				</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-20-4">`</span><span class="token template-string string" style="color:#e3116c">git ls-remote --heads origin </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="${-20-34">${</span><span class="token template-string interpolation" data-181-js-token="branchName-20-36">branchName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="}-20-46">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-20-47">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=",-20-48">,</span><span class="token plain" data-181-js-token="-20-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-21-0">			</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-21-3">)</span><span class="token plain" data-181-js-token="-21-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-22-0">				</span><span class="token punctuation" style="color:#393A34" data-181-js-token=".-22-4">.</span><span class="token method function property-access" style="color:#d73a49" data-181-js-token="toString-22-5">toString</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-22-13">(</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-22-14">)</span><span class="token plain" data-181-js-token="-22-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-23-0">				</span><span class="token punctuation" style="color:#393A34" data-181-js-token=".-23-4">.</span><span class="token method function property-access" style="color:#d73a49" data-181-js-token="trim-23-5">trim</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-23-9">(</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-23-10">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-23-11">;</span><span class="token plain" data-181-js-token="-23-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-24-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-181-js-token="if-24-3">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-24-6">(</span><span class="token plain" data-181-js-token="remoteBranchExists-24-7">remoteBranchExists</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-24-25">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-24-27">{</span><span class="token plain" data-181-js-token="-24-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-25-0">				</span><span class="token function" style="color:#d73a49" data-181-js-token="execSync-25-4">execSync</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-25-12">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-25-13">`</span><span class="token template-string string" style="color:#e3116c">git branch --set-upstream-to=origin/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="${-25-50">${</span><span class="token template-string interpolation" data-181-js-token="branchName-25-52">branchName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="}-25-62">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-25-63">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-25-64">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-25-65">;</span><span class="token plain" data-181-js-token="-25-66"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-26-0">			</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-26-3">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-181-js-token="else-26-5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-26-10">{</span><span class="token plain" data-181-js-token="-26-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-27-0">				</span><span class="token console class-name" data-181-js-token="console-27-4">console</span><span class="token punctuation" style="color:#393A34" data-181-js-token=".-27-11">.</span><span class="token method function property-access" style="color:#d73a49" data-181-js-token="error-27-12">error</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-27-17">(</span><span class="token plain" data-181-js-token="-27-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-28-0">					</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-28-5">`</span><span class="token template-string string" style="color:#e3116c">❌ 远程分支 &#x27;origin/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="${-28-21">${</span><span class="token template-string interpolation" data-181-js-token="branchName-28-23">branchName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="}-28-33">}</span><span class="token template-string string" style="color:#e3116c">&#x27; 不存在，无法设置 upstream。</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-28-54">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=",-28-55">,</span><span class="token plain" data-181-js-token="-28-56"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-29-0">				</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-29-4">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-29-5">;</span><span class="token plain" data-181-js-token="-29-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-30-0">				</span><span class="token keyword control-flow" style="color:#00009f" data-181-js-token="return-30-4">return</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-30-10">;</span><span class="token plain" data-181-js-token="-30-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-31-0">			</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-31-3">}</span><span class="token plain" data-181-js-token="-31-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">			setUpstream </span><span class="token operator" style="color:#393A34" data-181-js-token="=-32-15">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa" data-181-js-token="true-32-17">true</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-32-21">;</span><span class="token plain" data-181-js-token="-32-22"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-33-0">		</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-33-2">}</span><span class="token plain" data-181-js-token="-33-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-181-js-token="-34-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-35-0">		</span><span class="token function" style="color:#d73a49" data-181-js-token="execSync-35-2">execSync</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-35-10">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-35-11">`</span><span class="token template-string string" style="color:#e3116c">git add .</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-35-21">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=",-35-22">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-35-24">{</span><span class="token plain" data-181-js-token="stdio-35-25">stdio</span><span class="token operator" style="color:#393A34" data-181-js-token=":-35-30">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-181-js-token="&#x27;inherit&#x27;-35-32">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-35-41">}</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-35-42">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-35-43">;</span><span class="token plain" data-181-js-token="-35-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-36-0">		</span><span class="token function" style="color:#d73a49" data-181-js-token="execSync-36-2">execSync</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-36-10">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-36-11">`</span><span class="token template-string string" style="color:#e3116c">git commit -m &quot;chore(release): </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="${-36-43">${</span><span class="token template-string interpolation" data-181-js-token="newVersion-36-45">newVersion</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="}-36-55">}</span><span class="token template-string string" style="color:#e3116c" data-181-js-token="&quot;-36-56">&quot;</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-36-57">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=",-36-58">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-36-60">{</span><span class="token plain" data-181-js-token="-36-61"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="stdio-37-0">			stdio</span><span class="token operator" style="color:#393A34" data-181-js-token=":-37-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-181-js-token="&#x27;inherit&#x27;-37-10">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-181-js-token=",-37-19">,</span><span class="token plain" data-181-js-token="-37-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-38-0">		</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-38-2">}</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-38-3">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-38-4">;</span><span class="token plain" data-181-js-token="-38-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-39-0">		</span><span class="token function" style="color:#d73a49" data-181-js-token="execSync-39-2">execSync</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-39-10">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-39-11">`</span><span class="token template-string string" style="color:#e3116c">git tag v</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="${-39-21">${</span><span class="token template-string interpolation" data-181-js-token="newVersion-39-23">newVersion</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="}-39-33">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-39-34">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=",-39-35">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-39-37">{</span><span class="token plain" data-181-js-token="stdio-39-38">stdio</span><span class="token operator" style="color:#393A34" data-181-js-token=":-39-43">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-181-js-token="&#x27;inherit&#x27;-39-45">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-39-54">}</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-39-55">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-39-56">;</span><span class="token plain" data-181-js-token="-39-57"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-181-js-token="-40-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-41-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 推送改动到远程分支</span><span class="token plain" data-181-js-token="-41-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-42-0">		</span><span class="token function" style="color:#d73a49" data-181-js-token="execSync-42-2">execSync</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-42-10">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-42-11">`</span><span class="token template-string string" style="color:#e3116c">git push</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-42-20">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=",-42-21">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-42-23">{</span><span class="token plain" data-181-js-token="stdio-42-24">stdio</span><span class="token operator" style="color:#393A34" data-181-js-token=":-42-29">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-181-js-token="&#x27;inherit&#x27;-42-31">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-42-40">}</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-42-41">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-42-42">;</span><span class="token plain" data-181-js-token="-42-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-43-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-181-js-token="if-43-2">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-43-5">(</span><span class="token plain" data-181-js-token="setUpstream-43-6">setUpstream</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-43-17">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-43-19">{</span><span class="token plain" data-181-js-token="-43-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-44-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// 如果之前没有 upstream，并且我们为其设置了 upstream，现在也推送它</span><span class="token plain" data-181-js-token="-44-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-45-0">			</span><span class="token function" style="color:#d73a49" data-181-js-token="execSync-45-3">execSync</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-45-11">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-45-12">`</span><span class="token template-string string" style="color:#e3116c">git push --set-upstream origin </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="${-45-44">${</span><span class="token template-string interpolation" data-181-js-token="branchName-45-46">branchName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="}-45-56">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-45-57">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=",-45-58">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-45-60">{</span><span class="token plain" data-181-js-token="-45-61"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="stdio-46-0">				stdio</span><span class="token operator" style="color:#393A34" data-181-js-token=":-46-9">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-181-js-token="&#x27;inherit&#x27;-46-11">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-181-js-token=",-46-20">,</span><span class="token plain" data-181-js-token="-46-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-47-0">			</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-47-3">}</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-47-4">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-47-5">;</span><span class="token plain" data-181-js-token="-47-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-48-0">		</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-48-2">}</span><span class="token plain" data-181-js-token="-48-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-49-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 推送tag到远程</span><span class="token plain" data-181-js-token="-49-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-50-0">		</span><span class="token function" style="color:#d73a49" data-181-js-token="execSync-50-2">execSync</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-50-10">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-50-11">`</span><span class="token template-string string" style="color:#e3116c">git push origin v</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="${-50-29">${</span><span class="token template-string interpolation" data-181-js-token="newVersion-50-31">newVersion</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="}-50-41">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-50-42">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=",-50-43">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-50-45">{</span><span class="token plain" data-181-js-token="stdio-50-46">stdio</span><span class="token operator" style="color:#393A34" data-181-js-token=":-50-51">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-181-js-token="&#x27;inherit&#x27;-50-53">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-50-62">}</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-50-63">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-50-64">;</span><span class="token plain" data-181-js-token="-50-65"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-181-js-token="-51-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-52-0">		</span><span class="token console class-name" data-181-js-token="console-52-2">console</span><span class="token punctuation" style="color:#393A34" data-181-js-token=".-52-9">.</span><span class="token method function property-access" style="color:#d73a49" data-181-js-token="log-52-10">log</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-52-13">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-52-14">`</span><span class="token template-string string" style="color:#e3116c">✅ Git tag v</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="${-52-26">${</span><span class="token template-string interpolation" data-181-js-token="newVersion-52-28">newVersion</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="}-52-38">}</span><span class="token template-string string" style="color:#e3116c"> 已标记</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-52-43">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-52-44">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-52-45">;</span><span class="token plain" data-181-js-token="-52-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-53-0">	</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-53-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-181-js-token="catch-53-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-53-9">(</span><span class="token plain" data-181-js-token="error-53-10">error</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-53-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-181-js-token="{-53-17">{</span><span class="token plain" data-181-js-token="-53-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-54-0">		</span><span class="token console class-name" data-181-js-token="console-54-2">console</span><span class="token punctuation" style="color:#393A34" data-181-js-token=".-54-9">.</span><span class="token method function property-access" style="color:#d73a49" data-181-js-token="error-54-10">error</span><span class="token punctuation" style="color:#393A34" data-181-js-token="(-54-15">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-54-16">`</span><span class="token template-string string" style="color:#e3116c">❌ Git 操作失败: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="${-54-29">${</span><span class="token template-string interpolation" data-181-js-token="error-54-31">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-181-js-token=".-54-36">.</span><span class="token template-string interpolation" data-181-js-token="message-54-37">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-181-js-token="}-54-44">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-181-js-token="`-54-45">`</span><span class="token punctuation" style="color:#393A34" data-181-js-token=")-54-46">)</span><span class="token punctuation" style="color:#393A34" data-181-js-token=";-54-47">;</span><span class="token plain" data-181-js-token="-54-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-55-0">	</span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-55-1">}</span><span class="token plain" data-181-js-token="-55-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-181-js-token="-56-0"></span><span class="token punctuation" style="color:#393A34" data-181-js-token="}-56-0">}</span></div></pre></div><h1 id="-六、实现设置npm源"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#-六、实现设置npm源"><span class="icon icon-link"></span></a>🍉 六、实现设置<code>npm</code>源</h1><p>处理这个是因为我们可能使用<code>nrm</code>更改过<code>npm</code>的源，或者使用<code>.npmrc</code>，时候如果不更换会无法登录或者脚本执行流程正确，比如改成淘宝的之类，源不对没法发布，我们先记录当前<code>npm</code>源，检测是否已经登录<code>npm</code>、未登录提示登录、发布包、然后恢复<code>npm</code>源</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 设置npm源</span><span class="token plain" data-182-js-token="-0-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-182-js-token="-1-0"></span><span class="token keyword" style="color:#00009f" data-182-js-token="const-1-0">const</span><span class="token plain"> oldRegistryUrl </span><span class="token operator" style="color:#393A34" data-182-js-token="=-1-21">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-182-js-token="await-1-23">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-182-js-token="setNpmRegistry-1-29">setNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-182-js-token="(-1-43">(</span><span class="token punctuation" style="color:#393A34" data-182-js-token=")-1-44">)</span><span class="token punctuation" style="color:#393A34" data-182-js-token=";-1-45">;</span><span class="token plain" data-182-js-token="-1-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-182-js-token="-2-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 检测是否已经登录npm</span><span class="token plain" data-182-js-token="-2-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-182-js-token="-3-0"></span><span class="token keyword control-flow" style="color:#00009f" data-182-js-token="await-3-0">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-182-js-token="ensureNpmLoggedIn-3-6">ensureNpmLoggedIn</span><span class="token punctuation" style="color:#393A34" data-182-js-token="(-3-23">(</span><span class="token punctuation" style="color:#393A34" data-182-js-token=")-3-24">)</span><span class="token punctuation" style="color:#393A34" data-182-js-token=";-3-25">;</span><span class="token plain" data-182-js-token="-3-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-182-js-token="-4-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 发布到npm</span><span class="token plain" data-182-js-token="-4-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-182-js-token="-5-0"></span><span class="token keyword control-flow" style="color:#00009f" data-182-js-token="await-5-0">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-182-js-token="publishToNpm-5-6">publishToNpm</span><span class="token punctuation" style="color:#393A34" data-182-js-token="(-5-18">(</span><span class="token punctuation" style="color:#393A34" data-182-js-token=")-5-19">)</span><span class="token punctuation" style="color:#393A34" data-182-js-token=";-5-20">;</span><span class="token plain" data-182-js-token="-5-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-182-js-token="-6-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 恢复npm源</span><span class="token plain" data-182-js-token="-6-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-182-js-token="-7-0"></span><span class="token keyword control-flow" style="color:#00009f" data-182-js-token="await-7-0">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-182-js-token="restoreNpmRegistry-7-6">restoreNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-182-js-token="(-7-24">(</span><span class="token plain" data-182-js-token="oldRegistryUrl-7-25">oldRegistryUrl</span><span class="token punctuation" style="color:#393A34" data-182-js-token=")-7-39">)</span><span class="token punctuation" style="color:#393A34" data-182-js-token=";-7-40">;</span></div></pre></div><h2 id="1保存旧的npm源并更新"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#1保存旧的npm源并更新"><span class="icon icon-link"></span></a>1.保存旧的<code>npm</code>源并更新</h2><p>主要就是先<code>npm config get registry</code>，然后在<code>npm config set registry</code>，如果是私域的<code>npm</code>，你可以更改这里的<code>url</code>，或者直接扩展这个脚本，改成询问的方式，使用<code>nrm</code>切换</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic" data-183-js-token="/**-0-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 设置npm的registry到指定的URL，并返回旧的registry</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Promise&lt;string&gt;} 当成功时返回旧的registry URL</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-183-js-token="-3-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-183-js-token="-4-0"></span><span class="token keyword" style="color:#00009f" data-183-js-token="async-4-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-183-js-token="function-4-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-183-js-token="setNpmRegistry-4-15">setNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-4-29">(</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-4-30">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-183-js-token="{-4-32">{</span><span class="token plain" data-183-js-token="-4-33"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-183-js-token="try-5-4">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-183-js-token="{-5-8">{</span><span class="token plain" data-183-js-token="-5-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-183-js-token="const-6-12">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-183-js-token="{-6-18">{</span><span class="token plain" data-183-js-token="stdout-6-19">stdout</span><span class="token operator" style="color:#393A34" data-183-js-token=":-6-25">:</span><span class="token plain"> getRegistryStdout</span><span class="token punctuation" style="color:#393A34" data-183-js-token="}-6-44">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-183-js-token="=-6-46">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-183-js-token="await-6-48">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-183-js-token="exec-6-54">exec</span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-6-58">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-6-59">`</span><span class="token template-string string" style="color:#e3116c">npm config get registry</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-6-83">`</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-6-84">)</span><span class="token punctuation" style="color:#393A34" data-183-js-token=";-6-85">;</span><span class="token plain" data-183-js-token="-6-86"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-183-js-token="const-7-12">const</span><span class="token plain"> oldNpmRegistry </span><span class="token operator" style="color:#393A34" data-183-js-token="=-7-33">=</span><span class="token plain"> getRegistryStdout</span><span class="token punctuation" style="color:#393A34" data-183-js-token=".-7-52">.</span><span class="token method function property-access" style="color:#d73a49" data-183-js-token="trim-7-53">trim</span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-7-57">(</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-7-58">)</span><span class="token punctuation" style="color:#393A34" data-183-js-token=";-7-59">;</span><span class="token plain" data-183-js-token="-7-60"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-183-js-token="-8-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-183-js-token="const-9-12">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa" data-183-js-token="NPM_REGISTRY_URL-9-18">NPM_REGISTRY_URL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-183-js-token="=-9-35">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-183-js-token="&#x27;https://registry.npmjs.org/&#x27;-9-37">&#x27;https://registry.npmjs.org/&#x27;</span><span class="token punctuation" style="color:#393A34" data-183-js-token=";-9-66">;</span><span class="token plain" data-183-js-token="-9-67"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f" data-183-js-token="await-10-12">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-183-js-token="exec-10-18">exec</span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-10-22">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-10-23">`</span><span class="token template-string string" style="color:#e3116c">npm config set registry </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-183-js-token="${-10-48">${</span><span class="token template-string interpolation constant" style="color:#36acaa" data-183-js-token="NPM_REGISTRY_URL-10-50">NPM_REGISTRY_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-183-js-token="}-10-66">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-10-67">`</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-10-68">)</span><span class="token punctuation" style="color:#393A34" data-183-js-token=";-10-69">;</span><span class="token plain" data-183-js-token="-10-70"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-183-js-token="-11-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token console class-name" data-183-js-token="console-12-12">console</span><span class="token punctuation" style="color:#393A34" data-183-js-token=".-12-19">.</span><span class="token method function property-access" style="color:#d73a49" data-183-js-token="log-12-20">log</span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-12-23">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-12-24">`</span><span class="token template-string string" style="color:#e3116c">✅ npm registry已设置为: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-183-js-token="${-12-45">${</span><span class="token template-string interpolation constant" style="color:#36acaa" data-183-js-token="NPM_REGISTRY_URL-12-47">NPM_REGISTRY_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-183-js-token="}-12-63">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-12-64">`</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-12-65">)</span><span class="token punctuation" style="color:#393A34" data-183-js-token=";-12-66">;</span><span class="token plain" data-183-js-token="-12-67"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f" data-183-js-token="return-13-12">return</span><span class="token plain"> oldNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-183-js-token=";-13-33">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 返回旧的registry，以便后续可以恢复</span><span class="token plain" data-183-js-token="-13-59"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-183-js-token="}-14-4">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-183-js-token="catch-14-6">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-14-12">(</span><span class="token plain" data-183-js-token="error-14-13">error</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-14-18">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-183-js-token="{-14-20">{</span><span class="token plain" data-183-js-token="-14-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f" data-183-js-token="if-15-12">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-15-15">(</span><span class="token plain" data-183-js-token="error-15-16">error</span><span class="token punctuation" style="color:#393A34" data-183-js-token=".-15-21">.</span><span class="token property-access" data-183-js-token="stdout-15-22">stdout</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-15-28">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-183-js-token="{-15-30">{</span><span class="token plain" data-183-js-token="-15-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token console class-name" data-183-js-token="console-16-20">console</span><span class="token punctuation" style="color:#393A34" data-183-js-token=".-16-27">.</span><span class="token method function property-access" style="color:#d73a49" data-183-js-token="error-16-28">error</span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-16-33">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-16-34">`</span><span class="token template-string string" style="color:#e3116c">❌ 设置npm registry stdout输出流: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-183-js-token="${-16-63">${</span><span class="token template-string interpolation" data-183-js-token="error-16-65">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-183-js-token=".-16-70">.</span><span class="token template-string interpolation" data-183-js-token="stdout-16-71">stdout</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-183-js-token="}-16-77">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-16-78">`</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-16-79">)</span><span class="token punctuation" style="color:#393A34" data-183-js-token=";-16-80">;</span><span class="token plain" data-183-js-token="-16-81"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-183-js-token="}-17-12">}</span><span class="token plain" data-183-js-token="-17-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f" data-183-js-token="if-18-12">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-18-15">(</span><span class="token plain" data-183-js-token="error-18-16">error</span><span class="token punctuation" style="color:#393A34" data-183-js-token=".-18-21">.</span><span class="token property-access" data-183-js-token="stderr-18-22">stderr</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-18-28">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-183-js-token="{-18-30">{</span><span class="token plain" data-183-js-token="-18-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token console class-name" data-183-js-token="console-19-20">console</span><span class="token punctuation" style="color:#393A34" data-183-js-token=".-19-27">.</span><span class="token method function property-access" style="color:#d73a49" data-183-js-token="error-19-28">error</span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-19-33">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-19-34">`</span><span class="token template-string string" style="color:#e3116c">❌ 设置npm registry stderr出错: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-183-js-token="${-19-62">${</span><span class="token template-string interpolation" data-183-js-token="error-19-64">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-183-js-token=".-19-69">.</span><span class="token template-string interpolation" data-183-js-token="stderr-19-70">stderr</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-183-js-token="}-19-76">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-19-77">`</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-19-78">)</span><span class="token punctuation" style="color:#393A34" data-183-js-token=";-19-79">;</span><span class="token plain" data-183-js-token="-19-80"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-183-js-token="}-20-12">}</span><span class="token plain" data-183-js-token="-20-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token console class-name" data-183-js-token="console-21-12">console</span><span class="token punctuation" style="color:#393A34" data-183-js-token=".-21-19">.</span><span class="token method function property-access" style="color:#d73a49" data-183-js-token="error-21-20">error</span><span class="token punctuation" style="color:#393A34" data-183-js-token="(-21-25">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-21-26">`</span><span class="token template-string string" style="color:#e3116c">❌ 设置npm registry中发生错误: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-183-js-token="${-21-50">${</span><span class="token template-string interpolation" data-183-js-token="error-21-52">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-183-js-token=".-21-57">.</span><span class="token template-string interpolation" data-183-js-token="message-21-58">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-183-js-token="}-21-65">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-183-js-token="`-21-66">`</span><span class="token punctuation" style="color:#393A34" data-183-js-token=")-21-67">)</span><span class="token punctuation" style="color:#393A34" data-183-js-token=";-21-68">;</span><span class="token plain" data-183-js-token="-21-69"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f" data-183-js-token="throw-22-12">throw</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-183-js-token=";-22-23">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 抛出错误以供调用者处理</span><span class="token plain" data-183-js-token="-22-39"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-183-js-token="}-23-4">}</span><span class="token plain" data-183-js-token="-23-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-183-js-token="-24-0"></span><span class="token punctuation" style="color:#393A34" data-183-js-token="}-24-0">}</span></div></pre></div><h2 id="2检测是否已经登录npm"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#2检测是否已经登录npm"><span class="icon icon-link"></span></a>2.检测是否已经登录<code>npm</code></h2><p>之前的文章中我们已经介绍过，未登录<code>npm</code>是无法发包的，但是自动化的脚本对于这种敏感信息引导用户手动登录比较安全，这里我们通过<code>npm whoami</code>命令判断用户是否登录，如果未登录，引导用户登录</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic" data-184-js-token="/**-0-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 确保用户已登录npm</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Promise&lt;string&gt;} 返回已登录用户的名称或抛出错误</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-184-js-token="-3-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-184-js-token="-4-0"></span><span class="token keyword" style="color:#00009f" data-184-js-token="async-4-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-184-js-token="function-4-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-184-js-token="ensureNpmLoggedIn-4-15">ensureNpmLoggedIn</span><span class="token punctuation" style="color:#393A34" data-184-js-token="(-4-32">(</span><span class="token punctuation" style="color:#393A34" data-184-js-token=")-4-33">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-184-js-token="{-4-35">{</span><span class="token plain" data-184-js-token="-4-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f" data-184-js-token="try-5-8">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-184-js-token="{-5-12">{</span><span class="token plain" data-184-js-token="-5-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f" data-184-js-token="const-6-16">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-184-js-token="{-6-22">{</span><span class="token plain" data-184-js-token="stdout-6-23">stdout</span><span class="token punctuation" style="color:#393A34" data-184-js-token="}-6-29">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-184-js-token="=-6-31">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-184-js-token="await-6-33">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-184-js-token="exec-6-39">exec</span><span class="token punctuation" style="color:#393A34" data-184-js-token="(-6-43">(</span><span class="token string" style="color:#e3116c">&#x27;npm whoami&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=")-6-56">)</span><span class="token punctuation" style="color:#393A34" data-184-js-token=";-6-57">;</span><span class="token plain" data-184-js-token="-6-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token console class-name" data-184-js-token="console-7-16">console</span><span class="token punctuation" style="color:#393A34" data-184-js-token=".-7-23">.</span><span class="token method function property-access" style="color:#d73a49" data-184-js-token="log-7-24">log</span><span class="token punctuation" style="color:#393A34" data-184-js-token="(-7-27">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-184-js-token="`-7-28">`</span><span class="token template-string string" style="color:#e3116c">✅ 检测到您已作为</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-184-js-token="${-7-38">${</span><span class="token template-string interpolation" data-184-js-token="stdout-7-40">stdout</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-184-js-token=".-7-46">.</span><span class="token template-string interpolation function" style="color:#d73a49" data-184-js-token="trim-7-47">trim</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-184-js-token="(-7-51">(</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-184-js-token=")-7-52">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-184-js-token="}-7-53">}</span><span class="token template-string string" style="color:#e3116c" data-184-js-token="登录到npm-7-54">登录到npm</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-184-js-token="`-7-60">`</span><span class="token punctuation" style="color:#393A34" data-184-js-token=")-7-61">)</span><span class="token punctuation" style="color:#393A34" data-184-js-token=";-7-62">;</span><span class="token plain" data-184-js-token="-7-63"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-184-js-token="return-8-16">return</span><span class="token plain"> stdout</span><span class="token punctuation" style="color:#393A34" data-184-js-token=".-8-29">.</span><span class="token method function property-access" style="color:#d73a49" data-184-js-token="trim-8-30">trim</span><span class="token punctuation" style="color:#393A34" data-184-js-token="(-8-34">(</span><span class="token punctuation" style="color:#393A34" data-184-js-token=")-8-35">)</span><span class="token punctuation" style="color:#393A34" data-184-js-token=";-8-36">;</span><span class="token plain" data-184-js-token="-8-37"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34" data-184-js-token="}-9-8">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-184-js-token="catch-9-10">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-184-js-token="(-9-16">(</span><span class="token plain" data-184-js-token="error-9-17">error</span><span class="token punctuation" style="color:#393A34" data-184-js-token=")-9-22">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-184-js-token="{-9-24">{</span><span class="token plain" data-184-js-token="-9-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token console class-name" data-184-js-token="console-10-16">console</span><span class="token punctuation" style="color:#393A34" data-184-js-token=".-10-23">.</span><span class="token method function property-access" style="color:#d73a49" data-184-js-token="error-10-24">error</span><span class="token punctuation" style="color:#393A34" data-184-js-token="(-10-29">(</span><span class="token string" style="color:#e3116c">&#x27;❌ 您似乎还没有登录到npm。请登录后继续。&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=")-10-54">)</span><span class="token punctuation" style="color:#393A34" data-184-js-token=";-10-55">;</span><span class="token plain" data-184-js-token="-10-56"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f" data-184-js-token="const-11-16">const</span><span class="token plain"> answers </span><span class="token operator" style="color:#393A34" data-184-js-token="=-11-30">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-184-js-token="await-11-32">await</span><span class="token plain"> inquirer</span><span class="token punctuation" style="color:#393A34" data-184-js-token=".-11-46">.</span><span class="token method function property-access" style="color:#d73a49" data-184-js-token="prompt-11-47">prompt</span><span class="token punctuation" style="color:#393A34" data-184-js-token="(-11-53">(</span><span class="token punctuation" style="color:#393A34" data-184-js-token="[-11-54">[</span><span class="token plain" data-184-js-token="-11-55"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34" data-184-js-token="{-12-24">{</span><span class="token plain" data-184-js-token="-12-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                type</span><span class="token operator" style="color:#393A34" data-184-js-token=":-13-36">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-184-js-token="&#x27;input&#x27;-13-38">&#x27;input&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-13-45">,</span><span class="token plain" data-184-js-token="-13-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                name</span><span class="token operator" style="color:#393A34" data-184-js-token=":-14-36">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-184-js-token="&#x27;username&#x27;-14-38">&#x27;username&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-14-48">,</span><span class="token plain" data-184-js-token="-14-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                message</span><span class="token operator" style="color:#393A34" data-184-js-token=":-15-39">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-184-js-token="&#x27;请输入您的npm用户名:&#x27;-15-41">&#x27;请输入您的npm用户名:&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-15-55">,</span><span class="token plain" data-184-js-token="-15-56"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34" data-184-js-token="}-16-24">}</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-16-25">,</span><span class="token plain" data-184-js-token="-16-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34" data-184-js-token="{-17-24">{</span><span class="token plain" data-184-js-token="-17-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                type</span><span class="token operator" style="color:#393A34" data-184-js-token=":-18-36">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-184-js-token="&#x27;password&#x27;-18-38">&#x27;password&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-18-48">,</span><span class="token plain" data-184-js-token="-18-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                name</span><span class="token operator" style="color:#393A34" data-184-js-token=":-19-36">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-184-js-token="&#x27;password&#x27;-19-38">&#x27;password&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-19-48">,</span><span class="token plain" data-184-js-token="-19-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                message</span><span class="token operator" style="color:#393A34" data-184-js-token=":-20-39">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-184-js-token="&#x27;请输入您的npm密码:&#x27;-20-41">&#x27;请输入您的npm密码:&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-20-54">,</span><span class="token plain" data-184-js-token="-20-55"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34" data-184-js-token="}-21-24">}</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-21-25">,</span><span class="token plain" data-184-js-token="-21-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34" data-184-js-token="{-22-24">{</span><span class="token plain" data-184-js-token="-22-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                type</span><span class="token operator" style="color:#393A34" data-184-js-token=":-23-36">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-184-js-token="&#x27;input&#x27;-23-38">&#x27;input&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-23-45">,</span><span class="token plain" data-184-js-token="-23-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                name</span><span class="token operator" style="color:#393A34" data-184-js-token=":-24-36">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-184-js-token="&#x27;email&#x27;-24-38">&#x27;email&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-24-45">,</span><span class="token plain" data-184-js-token="-24-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                message</span><span class="token operator" style="color:#393A34" data-184-js-token=":-25-39">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-184-js-token="&#x27;请输入您的npm邮箱地址:&#x27;-25-41">&#x27;请输入您的npm邮箱地址:&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-25-56">,</span><span class="token plain" data-184-js-token="-25-57"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34" data-184-js-token="}-26-24">}</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-26-25">,</span><span class="token plain" data-184-js-token="-26-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34" data-184-js-token="]-27-16">]</span><span class="token punctuation" style="color:#393A34" data-184-js-token=")-27-17">)</span><span class="token punctuation" style="color:#393A34" data-184-js-token=";-27-18">;</span><span class="token plain" data-184-js-token="-27-19"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-184-js-token="-28-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 以下操作依赖于能够自动化的输入命令到npm login（在这个假设下编写）</span><span class="token plain" data-184-js-token="-29-56"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 实际操作中这可能需要特殊处理，例如通过node-pty实现自动输入</span><span class="token plain" data-184-js-token="-30-52"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f" data-184-js-token="const-31-16">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-184-js-token="{-31-22">{</span><span class="token plain" data-184-js-token="stdout-31-23">stdout</span><span class="token operator" style="color:#393A34" data-184-js-token=":-31-29">:</span><span class="token plain"> loginStdout</span><span class="token punctuation" style="color:#393A34" data-184-js-token="}-31-42">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-184-js-token="=-31-44">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-184-js-token="await-31-46">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-184-js-token="exec-31-52">exec</span><span class="token punctuation" style="color:#393A34" data-184-js-token="(-31-56">(</span><span class="token plain" data-184-js-token="-31-57"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-184-js-token="`-32-24">`</span><span class="token template-string string" style="color:#e3116c">echo &quot;</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-184-js-token="${-32-31">${</span><span class="token template-string interpolation" data-184-js-token="answers-32-33">answers</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-184-js-token=".-32-40">.</span><span class="token template-string interpolation" data-184-js-token="username-32-41">username</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-184-js-token="}-32-49">}</span><span class="token template-string string" style="color:#e3116c" data-184-js-token="\n-32-50">\n</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-184-js-token="${-32-52">${</span><span class="token template-string interpolation" data-184-js-token="answers-32-54">answers</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-184-js-token=".-32-61">.</span><span class="token template-string interpolation" data-184-js-token="password-32-62">password</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-184-js-token="}-32-70">}</span><span class="token template-string string" style="color:#e3116c" data-184-js-token="\n-32-71">\n</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-184-js-token="${-32-73">${</span><span class="token template-string interpolation" data-184-js-token="answers-32-75">answers</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-184-js-token=".-32-82">.</span><span class="token template-string interpolation" data-184-js-token="email-32-83">email</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-184-js-token="}-32-88">}</span><span class="token template-string string" style="color:#e3116c">\n&quot; | npm login</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-184-js-token="`-32-104">`</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-32-105">,</span><span class="token plain" data-184-js-token="-32-106"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34" data-184-js-token=")-33-16">)</span><span class="token punctuation" style="color:#393A34" data-184-js-token=";-33-17">;</span><span class="token plain" data-184-js-token="-33-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token console class-name" data-184-js-token="console-34-16">console</span><span class="token punctuation" style="color:#393A34" data-184-js-token=".-34-23">.</span><span class="token method function property-access" style="color:#d73a49" data-184-js-token="log-34-24">log</span><span class="token punctuation" style="color:#393A34" data-184-js-token="(-34-27">(</span><span class="token string" style="color:#e3116c">&#x27;✅ 登录输出流loginStdout&#x27;</span><span class="token punctuation" style="color:#393A34" data-184-js-token=",-34-48">,</span><span class="token plain"> loginStdout</span><span class="token punctuation" style="color:#393A34" data-184-js-token=")-34-61">)</span><span class="token punctuation" style="color:#393A34" data-184-js-token=";-34-62">;</span><span class="token plain" data-184-js-token="-34-63"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-184-js-token="return-35-16">return</span><span class="token plain"> answers</span><span class="token punctuation" style="color:#393A34" data-184-js-token=".-35-30">.</span><span class="token property-access" data-184-js-token="username-35-31">username</span><span class="token punctuation" style="color:#393A34" data-184-js-token=";-35-39">;</span><span class="token plain" data-184-js-token="-35-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34" data-184-js-token="}-36-8">}</span><span class="token plain" data-184-js-token="-36-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-184-js-token="-37-0"></span><span class="token punctuation" style="color:#393A34" data-184-js-token="}-37-0">}</span></div></pre></div><h2 id="3发布到npm"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#3发布到npm"><span class="icon icon-link"></span></a>3.发布到<code>npm</code></h2><p>使用<code>npm publish</code>命令发布。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic" data-185-js-token="/**-0-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 异步地发布到npm</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Promise&lt;void&gt;}</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-185-js-token="-3-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-4-0"></span><span class="token keyword" style="color:#00009f" data-185-js-token="async-4-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-185-js-token="function-4-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-185-js-token="publishToNpm-4-15">publishToNpm</span><span class="token punctuation" style="color:#393A34" data-185-js-token="(-4-27">(</span><span class="token punctuation" style="color:#393A34" data-185-js-token=")-4-28">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-185-js-token="{-4-30">{</span><span class="token plain" data-185-js-token="-4-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-5-0">	</span><span class="token console class-name" data-185-js-token="console-5-1">console</span><span class="token punctuation" style="color:#393A34" data-185-js-token=".-5-8">.</span><span class="token method function property-access" style="color:#d73a49" data-185-js-token="log-5-9">log</span><span class="token punctuation" style="color:#393A34" data-185-js-token="(-5-12">(</span><span class="token string" style="color:#e3116c">&#x27;🚀🚀🚀 正在发布到 npm...&#x27;</span><span class="token punctuation" style="color:#393A34" data-185-js-token=")-5-34">)</span><span class="token punctuation" style="color:#393A34" data-185-js-token=";-5-35">;</span><span class="token plain" data-185-js-token="-5-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-185-js-token="-6-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-7-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-185-js-token="try-7-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-185-js-token="{-7-5">{</span><span class="token plain" data-185-js-token="-7-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-8-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 这里可以添加对newVersion的使用，例如修改package.json中的版本号</span><span class="token plain" data-185-js-token="-8-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-9-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 如果newVersion参数确实需要被用于发布特定版本，这里应该加入对版本号处理的逻辑</span><span class="token plain" data-185-js-token="-9-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-10-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 例如使用 npm version 命令来更新项目的版本号</span><span class="token plain" data-185-js-token="-10-33"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-185-js-token="-11-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-12-0">		</span><span class="token keyword" style="color:#00009f" data-185-js-token="const-12-2">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-185-js-token="{-12-8">{</span><span class="token plain" data-185-js-token="stdout-12-9">stdout</span><span class="token punctuation" style="color:#393A34" data-185-js-token=",-12-15">,</span><span class="token plain"> stderr</span><span class="token punctuation" style="color:#393A34" data-185-js-token="}-12-23">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-185-js-token="=-12-25">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-185-js-token="await-12-27">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-185-js-token="exec-12-33">exec</span><span class="token punctuation" style="color:#393A34" data-185-js-token="(-12-37">(</span><span class="token string" style="color:#e3116c">&#x27;npm publish&#x27;</span><span class="token punctuation" style="color:#393A34" data-185-js-token=")-12-51">)</span><span class="token punctuation" style="color:#393A34" data-185-js-token=";-12-52">;</span><span class="token plain" data-185-js-token="-12-53"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-185-js-token="-13-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-14-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-185-js-token="if-14-2">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-185-js-token="(-14-5">(</span><span class="token plain" data-185-js-token="stderr-14-6">stderr</span><span class="token punctuation" style="color:#393A34" data-185-js-token=")-14-12">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-185-js-token="{-14-14">{</span><span class="token plain" data-185-js-token="-14-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-15-0">			</span><span class="token console class-name" data-185-js-token="console-15-3">console</span><span class="token punctuation" style="color:#393A34" data-185-js-token=".-15-10">.</span><span class="token method function property-access" style="color:#d73a49" data-185-js-token="log-15-11">log</span><span class="token punctuation" style="color:#393A34" data-185-js-token="(-15-14">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-185-js-token="`-15-15">`</span><span class="token template-string string" style="color:#e3116c">✅ 发布输出流stderr: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-185-js-token="${-15-31">${</span><span class="token template-string interpolation" data-185-js-token="stderr-15-33">stderr</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-185-js-token="}-15-39">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-185-js-token="`-15-40">`</span><span class="token punctuation" style="color:#393A34" data-185-js-token=")-15-41">)</span><span class="token punctuation" style="color:#393A34" data-185-js-token=";-15-42">;</span><span class="token plain" data-185-js-token="-15-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-16-0">		</span><span class="token punctuation" style="color:#393A34" data-185-js-token="}-16-2">}</span><span class="token plain" data-185-js-token="-16-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-185-js-token="-17-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-18-0">		</span><span class="token console class-name" data-185-js-token="console-18-2">console</span><span class="token punctuation" style="color:#393A34" data-185-js-token=".-18-9">.</span><span class="token method function property-access" style="color:#d73a49" data-185-js-token="log-18-10">log</span><span class="token punctuation" style="color:#393A34" data-185-js-token="(-18-13">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-185-js-token="`-18-14">`</span><span class="token template-string string" style="color:#e3116c">🎉🎉🎉 npm包发布成功: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-185-js-token="${-18-32">${</span><span class="token template-string interpolation" data-185-js-token="stdout-18-34">stdout</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-185-js-token="}-18-40">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-185-js-token="`-18-41">`</span><span class="token punctuation" style="color:#393A34" data-185-js-token=")-18-42">)</span><span class="token punctuation" style="color:#393A34" data-185-js-token=";-18-43">;</span><span class="token plain" data-185-js-token="-18-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-19-0">	</span><span class="token punctuation" style="color:#393A34" data-185-js-token="}-19-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-185-js-token="catch-19-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-185-js-token="(-19-9">(</span><span class="token plain" data-185-js-token="error-19-10">error</span><span class="token punctuation" style="color:#393A34" data-185-js-token=")-19-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-185-js-token="{-19-17">{</span><span class="token plain" data-185-js-token="-19-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-20-0">		</span><span class="token console class-name" data-185-js-token="console-20-2">console</span><span class="token punctuation" style="color:#393A34" data-185-js-token=".-20-9">.</span><span class="token method function property-access" style="color:#d73a49" data-185-js-token="error-20-10">error</span><span class="token punctuation" style="color:#393A34" data-185-js-token="(-20-15">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-185-js-token="`-20-16">`</span><span class="token template-string string" style="color:#e3116c">❌ 发布失败: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-185-js-token="${-20-25">${</span><span class="token template-string interpolation" data-185-js-token="error-20-27">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-185-js-token=".-20-32">.</span><span class="token template-string interpolation" data-185-js-token="message-20-33">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-185-js-token="}-20-40">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-185-js-token="`-20-41">`</span><span class="token punctuation" style="color:#393A34" data-185-js-token=")-20-42">)</span><span class="token punctuation" style="color:#393A34" data-185-js-token=";-20-43">;</span><span class="token plain" data-185-js-token="-20-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-21-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-185-js-token="throw-21-2">throw</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-185-js-token=";-21-13">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 抛出错误以供调用方处理</span><span class="token plain" data-185-js-token="-21-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-22-0">	</span><span class="token punctuation" style="color:#393A34" data-185-js-token="}-22-1">}</span><span class="token plain" data-185-js-token="-22-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-185-js-token="-23-0"></span><span class="token punctuation" style="color:#393A34" data-185-js-token="}-23-0">}</span></div></pre></div><h2 id="4恢复npm源"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#4恢复npm源"><span class="icon icon-link"></span></a>4.恢复<code>npm</code>源</h2><p>根据之前保存的旧的<code>npm</code>源，还原</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic" data-186-js-token="/**-0-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 恢复npm的registry为旧的URL</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Promise&lt;void&gt;}</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-186-js-token="-3-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-186-js-token="-4-0"></span><span class="token keyword" style="color:#00009f" data-186-js-token="async-4-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-186-js-token="function-4-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-186-js-token="restoreNpmRegistry-4-15">restoreNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-4-33">(</span><span class="token parameter" data-186-js-token="oldNpmRegistry-4-34">oldNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-4-48">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="{-4-50">{</span><span class="token plain" data-186-js-token="-4-51"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-186-js-token="if-5-4">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-5-7">(</span><span class="token plain" data-186-js-token="oldNpmRegistry-5-8">oldNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-5-22">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="{-5-24">{</span><span class="token plain" data-186-js-token="-5-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f" data-186-js-token="try-6-8">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="{-6-12">{</span><span class="token plain" data-186-js-token="-6-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-186-js-token="await-7-16">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-186-js-token="exec-7-22">exec</span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-7-26">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-7-27">`</span><span class="token template-string string" style="color:#e3116c">npm config set registry </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-186-js-token="${-7-52">${</span><span class="token template-string interpolation" data-186-js-token="oldNpmRegistry-7-54">oldNpmRegistry</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-186-js-token="}-7-68">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-7-69">`</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-7-70">)</span><span class="token punctuation" style="color:#393A34" data-186-js-token=";-7-71">;</span><span class="token plain" data-186-js-token="-7-72"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token console class-name" data-186-js-token="console-8-16">console</span><span class="token punctuation" style="color:#393A34" data-186-js-token=".-8-23">.</span><span class="token method function property-access" style="color:#d73a49" data-186-js-token="log-8-24">log</span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-8-27">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-8-28">`</span><span class="token template-string string" style="color:#e3116c">✅ npm registry已恢复为: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-186-js-token="${-8-49">${</span><span class="token template-string interpolation" data-186-js-token="oldNpmRegistry-8-51">oldNpmRegistry</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-186-js-token="}-8-65">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-8-66">`</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-8-67">)</span><span class="token punctuation" style="color:#393A34" data-186-js-token=";-8-68">;</span><span class="token plain" data-186-js-token="-8-69"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34" data-186-js-token="}-9-8">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-186-js-token="catch-9-10">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-9-16">(</span><span class="token plain" data-186-js-token="error-9-17">error</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-9-22">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="{-9-24">{</span><span class="token plain" data-186-js-token="-9-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-186-js-token="if-10-16">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-10-19">(</span><span class="token plain" data-186-js-token="error-10-20">error</span><span class="token punctuation" style="color:#393A34" data-186-js-token=".-10-25">.</span><span class="token property-access" data-186-js-token="stdout-10-26">stdout</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-10-32">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="{-10-34">{</span><span class="token plain" data-186-js-token="-10-35"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token console class-name" data-186-js-token="console-11-24">console</span><span class="token punctuation" style="color:#393A34" data-186-js-token=".-11-31">.</span><span class="token method function property-access" style="color:#d73a49" data-186-js-token="error-11-32">error</span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-11-37">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-11-38">`</span><span class="token template-string string" style="color:#e3116c">✅ 恢复npm registry输出流: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-186-js-token="${-11-60">${</span><span class="token template-string interpolation" data-186-js-token="error-11-62">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-186-js-token=".-11-67">.</span><span class="token template-string interpolation" data-186-js-token="stdout-11-68">stdout</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-186-js-token="}-11-74">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-11-75">`</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-11-76">)</span><span class="token punctuation" style="color:#393A34" data-186-js-token=";-11-77">;</span><span class="token plain" data-186-js-token="-11-78"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34" data-186-js-token="}-12-16">}</span><span class="token plain" data-186-js-token="-12-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-186-js-token="if-13-16">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-13-19">(</span><span class="token plain" data-186-js-token="error-13-20">error</span><span class="token punctuation" style="color:#393A34" data-186-js-token=".-13-25">.</span><span class="token property-access" data-186-js-token="stderr-13-26">stderr</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-13-32">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="{-13-34">{</span><span class="token plain" data-186-js-token="-13-35"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token console class-name" data-186-js-token="console-14-24">console</span><span class="token punctuation" style="color:#393A34" data-186-js-token=".-14-31">.</span><span class="token method function property-access" style="color:#d73a49" data-186-js-token="error-14-32">error</span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-14-37">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-14-38">`</span><span class="token template-string string" style="color:#e3116c">❌ 恢复npm registry出错: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-186-js-token="${-14-59">${</span><span class="token template-string interpolation" data-186-js-token="error-14-61">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-186-js-token=".-14-66">.</span><span class="token template-string interpolation" data-186-js-token="stderr-14-67">stderr</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-186-js-token="}-14-73">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-14-74">`</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-14-75">)</span><span class="token punctuation" style="color:#393A34" data-186-js-token=";-14-76">;</span><span class="token plain" data-186-js-token="-14-77"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34" data-186-js-token="}-15-16">}</span><span class="token plain" data-186-js-token="-15-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token console class-name" data-186-js-token="console-16-16">console</span><span class="token punctuation" style="color:#393A34" data-186-js-token=".-16-23">.</span><span class="token method function property-access" style="color:#d73a49" data-186-js-token="error-16-24">error</span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-16-29">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-16-30">`</span><span class="token template-string string" style="color:#e3116c">❌ 恢复npm registry中发生错误: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-186-js-token="${-16-54">${</span><span class="token template-string interpolation" data-186-js-token="error-16-56">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-186-js-token=".-16-61">.</span><span class="token template-string interpolation" data-186-js-token="message-16-62">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-186-js-token="}-16-69">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-16-70">`</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-16-71">)</span><span class="token punctuation" style="color:#393A34" data-186-js-token=";-16-72">;</span><span class="token plain" data-186-js-token="-16-73"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-186-js-token="throw-17-16">throw</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-186-js-token=";-17-27">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 抛出错误以供调用方处理</span><span class="token plain" data-186-js-token="-17-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34" data-186-js-token="}-18-8">}</span><span class="token plain" data-186-js-token="-18-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-186-js-token="}-19-4">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-186-js-token="else-19-6">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-186-js-token="{-19-11">{</span><span class="token plain" data-186-js-token="-19-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name" data-186-js-token="console-20-8">console</span><span class="token punctuation" style="color:#393A34" data-186-js-token=".-20-15">.</span><span class="token method function property-access" style="color:#d73a49" data-186-js-token="error-20-16">error</span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-20-21">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-20-22">`</span><span class="token template-string string" style="color:#e3116c">❌ 未找到旧的npm registry，无法恢复。</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-20-48">`</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-20-49">)</span><span class="token punctuation" style="color:#393A34" data-186-js-token=";-20-50">;</span><span class="token plain" data-186-js-token="-20-51"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f" data-186-js-token="throw-21-8">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-186-js-token="new-21-14">new</span><span class="token plain"> </span><span class="token class-name" data-186-js-token="Error-21-18">Error</span><span class="token punctuation" style="color:#393A34" data-186-js-token="(-21-23">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-21-24">`</span><span class="token template-string string" style="color:#e3116c">❌ 未找到旧的npm registry，无法恢复。</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-186-js-token="`-21-50">`</span><span class="token punctuation" style="color:#393A34" data-186-js-token=")-21-51">)</span><span class="token punctuation" style="color:#393A34" data-186-js-token=";-21-52">;</span><span class="token plain" data-186-js-token="-21-53"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-186-js-token="}-22-4">}</span><span class="token plain" data-186-js-token="-22-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-186-js-token="-23-0"></span><span class="token punctuation" style="color:#393A34" data-186-js-token="}-23-0">}</span></div></pre></div><h1 id="完整代码代码仓库"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#完整代码代码仓库"><span class="icon icon-link"></span></a>完整代码&amp;代码仓库</h1><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/zhuling904/react_demo/tree/rollup_comp">组件库仓库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>切换到<code>rollup_comp</code>分支即是完整的项目，脚本已上传</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-187-js-token="const-0-0">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-0-6">{</span><span class="token plain" data-187-js-token="execSync-0-7">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-0-15">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-0-17">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="require-0-19">require</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-0-26">(</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;child_process&#x27;-0-27">&#x27;child_process&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-0-42">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-0-43">;</span><span class="token plain" data-187-js-token="-0-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-1-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="const-1-0">const</span><span class="token plain"> util </span><span class="token operator" style="color:#393A34" data-187-js-token="=-1-11">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="require-1-13">require</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-1-20">(</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;util&#x27;-1-21">&#x27;util&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-1-27">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-1-28">;</span><span class="token plain" data-187-js-token="-1-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-2-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 改为异步：包裹返回promise</span><span class="token plain" data-187-js-token="-2-19"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-3-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-4-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="const-4-0">const</span><span class="token plain"> fs </span><span class="token operator" style="color:#393A34" data-187-js-token="=-4-9">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="require-4-11">require</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-4-18">(</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;fs&#x27;-4-19">&#x27;fs&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-4-23">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-4-24">;</span><span class="token plain" data-187-js-token="-4-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-5-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="const-5-0">const</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34" data-187-js-token="=-5-11">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="require-5-13">require</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-5-20">(</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;path&#x27;-5-21">&#x27;path&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-5-27">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-5-28">;</span><span class="token plain" data-187-js-token="-5-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-6-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="const-6-0">const</span><span class="token plain"> inquirer </span><span class="token operator" style="color:#393A34" data-187-js-token="=-6-15">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="require-6-17">require</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-6-24">(</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;inquirer&#x27;-6-25">&#x27;inquirer&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-6-35">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-6-36">;</span><span class="token plain" data-187-js-token="-6-37"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-7-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="const-7-0">const</span><span class="token plain"> exec </span><span class="token operator" style="color:#393A34" data-187-js-token="=-7-11">=</span><span class="token plain"> util</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-7-17">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="promisify-7-18">promisify</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-7-27">(</span><span class="token function" style="color:#d73a49" data-187-js-token="require-7-28">require</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-7-35">(</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;child_process&#x27;-7-36">&#x27;child_process&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-7-51">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-7-52">.</span><span class="token property-access" data-187-js-token="exec-7-53">exec</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-7-57">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-7-58">;</span><span class="token plain" data-187-js-token="-7-59"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-8-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-9-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="const-9-0">const</span><span class="token plain"> projectRootPath </span><span class="token operator" style="color:#393A34" data-187-js-token="=-9-22">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-9-28">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="join-9-29">join</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-9-33">(</span><span class="token plain" data-187-js-token="__dirname-9-34">__dirname</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-9-43">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;..&#x27;-9-45">&#x27;..&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-9-49">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-9-50">;</span><span class="token plain" data-187-js-token="-9-51"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-10-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="const-10-0">const</span><span class="token plain"> packageJsonPath </span><span class="token operator" style="color:#393A34" data-187-js-token="=-10-22">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-10-28">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="join-10-29">join</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-10-33">(</span><span class="token plain" data-187-js-token="projectRootPath-10-34">projectRootPath</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-10-49">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;package.json&#x27;-10-51">&#x27;package.json&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-10-65">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-10-66">;</span><span class="token plain" data-187-js-token="-10-67"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-11-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="const-11-0">const</span><span class="token plain"> packageJson </span><span class="token operator" style="color:#393A34" data-187-js-token="=-11-18">=</span><span class="token plain"> </span><span class="token known-class-name class-name" data-187-js-token="JSON-11-20">JSON</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-11-24">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="parse-11-25">parse</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-11-30">(</span><span class="token plain" data-187-js-token="fs-11-31">fs</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-11-33">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="readFileSync-11-34">readFileSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-11-46">(</span><span class="token plain" data-187-js-token="packageJsonPath-11-47">packageJsonPath</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-11-62">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;utf8&#x27;-11-64">&#x27;utf8&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-11-70">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-11-71">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-11-72">;</span><span class="token plain" data-187-js-token="-11-73"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-12-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="const-12-0">const</span><span class="token plain"> packageName </span><span class="token operator" style="color:#393A34" data-187-js-token="=-12-18">=</span><span class="token plain"> packageJson</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-12-31">.</span><span class="token property-access" data-187-js-token="name-12-32">name</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-12-36">;</span><span class="token plain" data-187-js-token="-12-37"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-13-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-14-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-14-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 解析版本号</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} version</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-18-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-19-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="function-19-0">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="parseVersion-19-9">parseVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-19-21">(</span><span class="token parameter" data-187-js-token="version-19-22">version</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-19-29">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-19-31">{</span><span class="token plain" data-187-js-token="-19-32"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-20-0">	</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-20-1">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="[-20-7">[</span><span class="token plain" data-187-js-token="semver-20-8">semver</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-20-14">,</span><span class="token plain"> preReleaseTag </span><span class="token operator" style="color:#393A34" data-187-js-token="=-20-30">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;&#x27;-20-32">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="]-20-34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-20-36">=</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-20-45">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="split-20-46">split</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-20-51">(</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;-&#x27;-20-52">&#x27;-&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-20-55">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-20-56">;</span><span class="token plain" data-187-js-token="-20-57"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-21-0">	</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-21-1">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="[-21-7">[</span><span class="token plain" data-187-js-token="major-21-8">major</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-21-13">,</span><span class="token plain"> minor</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-21-20">,</span><span class="token plain"> patch</span><span class="token punctuation" style="color:#393A34" data-187-js-token="]-21-27">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-21-29">=</span><span class="token plain"> semver</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-21-37">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="split-21-38">split</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-21-43">(</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;.&#x27;-21-44">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-21-47">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-21-48">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="map-21-49">map</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-21-52">(</span><span class="token known-class-name class-name" data-187-js-token="Number-21-53">Number</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-21-59">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-21-60">;</span><span class="token plain" data-187-js-token="-21-61"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-22-0">	</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-22-1">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="[-22-7">[</span><span class="token plain" data-187-js-token="preReleaseLabel-22-8">preReleaseLabel</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-22-23">,</span><span class="token plain"> preReleaseVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="]-22-42">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-22-44">=</span><span class="token plain"> preReleaseTag</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-22-59">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="split-22-60">split</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-22-65">(</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;.&#x27;-22-66">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-22-69">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-22-70">;</span><span class="token plain" data-187-js-token="-22-71"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-23-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-23-1">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-23-8">{</span><span class="token plain" data-187-js-token="-23-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="major-24-0">		major</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-24-7">,</span><span class="token plain" data-187-js-token="-24-8"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="minor-25-0">		minor</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-25-7">,</span><span class="token plain" data-187-js-token="-25-8"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="patch-26-0">		patch</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-26-7">,</span><span class="token plain" data-187-js-token="-26-8"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="preReleaseLabel-27-0">		preReleaseLabel</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-27-17">,</span><span class="token plain" data-187-js-token="-27-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="preReleaseVersion-28-0">		preReleaseVersion</span><span class="token operator" style="color:#393A34" data-187-js-token=":-28-19">:</span><span class="token plain"> preReleaseVersion </span><span class="token operator" style="color:#393A34" data-187-js-token="?-28-39">?</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="parseInt-28-41">parseInt</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-28-49">(</span><span class="token plain" data-187-js-token="preReleaseVersion-28-50">preReleaseVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-28-67">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-187-js-token="10-28-69">10</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-28-71">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token=":-28-73">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-187-js-token="0-28-75">0</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-28-76">,</span><span class="token plain" data-187-js-token="-28-77"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-29-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-29-1">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-29-2">;</span><span class="token plain" data-187-js-token="-29-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-30-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-30-0">}</span><span class="token plain" data-187-js-token="-30-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-31-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-32-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-32-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 检测是否是预发布版本</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} version</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-35-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-36-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="function-36-0">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="isPreRelease-36-9">isPreRelease</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-36-21">(</span><span class="token parameter" data-187-js-token="version-36-22">version</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-36-29">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-36-31">{</span><span class="token plain" data-187-js-token="-36-32"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-37-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-37-1">return</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa" data-187-js-token="/-37-8">/</span><span class="token regex regex-source language-regex" style="color:#36acaa" data-187-js-token="--37-9">-</span><span class="token regex regex-delimiter" style="color:#36acaa" data-187-js-token="/-37-10">/</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-37-11">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="test-37-12">test</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-37-16">(</span><span class="token plain" data-187-js-token="version-37-17">version</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-37-24">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-37-25">;</span><span class="token plain" data-187-js-token="-37-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-38-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-38-0">}</span><span class="token plain" data-187-js-token="-38-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-39-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-40-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-40-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 获取预发布版本号</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} currentVersion</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} type</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-44-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-45-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="function-45-0">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="getPreReleaseVersion-45-9">getPreReleaseVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-45-29">(</span><span class="token parameter" data-187-js-token="currentVersion-45-30">currentVersion</span><span class="token parameter punctuation" style="color:#393A34" data-187-js-token=",-45-44">,</span><span class="token parameter"> type</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-45-50">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-45-52">{</span><span class="token plain" data-187-js-token="-45-53"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-46-0">	</span><span class="token keyword" style="color:#00009f" data-187-js-token="let-46-1">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-46-5">{</span><span class="token plain" data-187-js-token="major-46-6">major</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-46-11">,</span><span class="token plain"> minor</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-46-18">,</span><span class="token plain"> patch</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-46-25">,</span><span class="token plain"> preReleaseLabel</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-46-42">,</span><span class="token plain"> preReleaseVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-46-61">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-46-63">=</span><span class="token plain" data-187-js-token="-46-64"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="currentVersion-47-0">		currentVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-47-16">;</span><span class="token plain" data-187-js-token="-47-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-48-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="switch-48-1">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-48-8">(</span><span class="token plain" data-187-js-token="type-48-9">type</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-48-13">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-48-15">{</span><span class="token plain" data-187-js-token="-48-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-49-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="case-49-2">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;prepatch&#x27;-49-7">&#x27;prepatch&#x27;</span><span class="token operator" style="color:#393A34" data-187-js-token=":-49-17">:</span><span class="token plain" data-187-js-token="-49-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">			patch </span><span class="token operator" style="color:#393A34" data-187-js-token="+=-50-9">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-187-js-token="1-50-12">1</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-50-13">;</span><span class="token plain" data-187-js-token="-50-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-51-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-51-3">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-51-10">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-51-11">${</span><span class="token template-string interpolation" data-187-js-token="major-51-13">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-51-18">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-51-19">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-51-20">${</span><span class="token template-string interpolation" data-187-js-token="minor-51-22">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-51-27">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-51-28">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-51-29">${</span><span class="token template-string interpolation" data-187-js-token="patch-51-31">patch</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-51-36">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="-0-51-37">-0</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-51-39">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-51-40">;</span><span class="token plain" data-187-js-token="-51-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-52-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="case-52-2">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;preminor&#x27;-52-7">&#x27;preminor&#x27;</span><span class="token operator" style="color:#393A34" data-187-js-token=":-52-17">:</span><span class="token plain" data-187-js-token="-52-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">			minor </span><span class="token operator" style="color:#393A34" data-187-js-token="+=-53-9">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-187-js-token="1-53-12">1</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-53-13">;</span><span class="token plain" data-187-js-token="-53-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-54-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-54-3">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-54-10">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-54-11">${</span><span class="token template-string interpolation" data-187-js-token="major-54-13">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-54-18">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-54-19">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-54-20">${</span><span class="token template-string interpolation" data-187-js-token="minor-54-22">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-54-27">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".0-0-54-28">.0-0</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-54-32">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-54-33">;</span><span class="token plain" data-187-js-token="-54-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-55-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="case-55-2">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;premajor&#x27;-55-7">&#x27;premajor&#x27;</span><span class="token operator" style="color:#393A34" data-187-js-token=":-55-17">:</span><span class="token plain" data-187-js-token="-55-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">			major </span><span class="token operator" style="color:#393A34" data-187-js-token="+=-56-9">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-187-js-token="1-56-12">1</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-56-13">;</span><span class="token plain" data-187-js-token="-56-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-57-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-57-3">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-57-10">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-57-11">${</span><span class="token template-string interpolation" data-187-js-token="major-57-13">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-57-18">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".0.0-0-57-19">.0.0-0</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-57-25">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-57-26">;</span><span class="token plain" data-187-js-token="-57-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-58-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="case-58-2">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;prerelease&#x27;-58-7">&#x27;prerelease&#x27;</span><span class="token operator" style="color:#393A34" data-187-js-token=":-58-19">:</span><span class="token plain" data-187-js-token="-58-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-59-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-59-3">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-59-6">(</span><span class="token function" style="color:#d73a49" data-187-js-token="isPreRelease-59-7">isPreRelease</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-59-19">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-59-20">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-59-21">${</span><span class="token template-string interpolation" data-187-js-token="major-59-23">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-59-28">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-59-29">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-59-30">${</span><span class="token template-string interpolation" data-187-js-token="minor-59-32">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-59-37">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-59-38">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-59-39">${</span><span class="token template-string interpolation" data-187-js-token="patch-59-41">patch</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-59-46">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-59-47">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-59-48">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-59-49">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-59-51">{</span><span class="token plain" data-187-js-token="-59-52"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">				preReleaseVersion </span><span class="token operator" style="color:#393A34" data-187-js-token="=-60-22">=</span><span class="token plain"> preReleaseVersion </span><span class="token operator" style="color:#393A34" data-187-js-token="||-60-42">||</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-187-js-token="0-60-45">0</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-60-46">;</span><span class="token plain" data-187-js-token="-60-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-61-0">				</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-61-4">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-61-11">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-61-12">${</span><span class="token template-string interpolation" data-187-js-token="major-61-14">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-61-19">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-61-20">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-61-21">${</span><span class="token template-string interpolation" data-187-js-token="minor-61-23">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-61-28">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-61-29">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-61-30">${</span><span class="token template-string interpolation" data-187-js-token="patch-61-32">patch</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-61-37">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="--61-38">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-61-39">${</span><span class="token template-string interpolation">preReleaseLabel </span><span class="token template-string interpolation operator" style="color:#393A34" data-187-js-token="||-61-57">||</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c" data-187-js-token="&#x27;beta&#x27;-61-60">&#x27;beta&#x27;</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-61-66">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-61-67">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-61-68">${</span><span class="token template-string interpolation">preReleaseVersion </span><span class="token template-string interpolation operator" style="color:#393A34" data-187-js-token="+-61-88">+</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa" data-187-js-token="1-61-90">1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-61-91">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-61-92">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-61-93">;</span><span class="token plain" data-187-js-token="-61-94"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-62-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-62-3">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="else-62-5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-62-10">{</span><span class="token plain" data-187-js-token="-62-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-63-0">				</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-63-4">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-63-11">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-63-12">${</span><span class="token template-string interpolation" data-187-js-token="major-63-14">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-63-19">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-63-20">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-63-21">${</span><span class="token template-string interpolation" data-187-js-token="minor-63-23">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-63-28">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-63-29">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-63-30">${</span><span class="token template-string interpolation" data-187-js-token="patch-63-32">patch</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-63-37">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="-beta.0-63-38">-beta.0</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-63-45">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-63-46">;</span><span class="token plain" data-187-js-token="-63-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-64-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-64-3">}</span><span class="token plain" data-187-js-token="-64-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-65-0">		</span><span class="token keyword module" style="color:#00009f" data-187-js-token="default-65-2">default</span><span class="token operator" style="color:#393A34" data-187-js-token=":-65-9">:</span><span class="token plain" data-187-js-token="-65-10"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-66-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="throw-66-3">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-187-js-token="new-66-9">new</span><span class="token plain"> </span><span class="token class-name" data-187-js-token="Error-66-13">Error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-66-18">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-66-19">`</span><span class="token template-string string" style="color:#e3116c">❌ 不支持的预发布版本类型: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-66-35">${</span><span class="token template-string interpolation" data-187-js-token="type-66-37">type</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-66-41">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-66-42">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-66-43">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-66-44">;</span><span class="token plain" data-187-js-token="-66-45"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-67-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-67-1">}</span><span class="token plain" data-187-js-token="-67-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-68-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-68-0">}</span><span class="token plain" data-187-js-token="-68-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-69-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-70-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-70-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 获取最新版本号</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns Promise</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-73-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-74-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="async-74-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-187-js-token="function-74-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="getLatestVersion-74-15">getLatestVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-74-31">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-74-32">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-74-34">{</span><span class="token plain" data-187-js-token="-74-35"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-75-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="try-75-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-75-5">{</span><span class="token plain" data-187-js-token="-75-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-76-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-76-2">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-76-8">{</span><span class="token plain" data-187-js-token="stdout-76-9">stdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-76-15">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-76-17">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-76-19">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="exec-76-25">exec</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-76-29">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-76-30">`</span><span class="token template-string string" style="color:#e3116c">npm show </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-76-40">${</span><span class="token template-string interpolation" data-187-js-token="packageName-76-42">packageName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-76-53">}</span><span class="token template-string string" style="color:#e3116c"> version</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-76-62">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-76-63">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-76-64">;</span><span class="token plain" data-187-js-token="-76-65"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-77-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-77-2">const</span><span class="token plain"> latestVersion </span><span class="token operator" style="color:#393A34" data-187-js-token="=-77-22">=</span><span class="token plain"> stdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-77-30">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="trim-77-31">trim</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-77-35">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-77-36">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-77-37">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="replace-77-38">replace</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-77-45">(</span><span class="token regex regex-delimiter" style="color:#36acaa" data-187-js-token="/-77-46">/</span><span class="token regex regex-source language-regex" style="color:#36acaa" data-187-js-token="^v-77-47">^v</span><span class="token regex regex-delimiter" style="color:#36acaa" data-187-js-token="/-77-49">/</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-77-50">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;&#x27;-77-52">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-77-54">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-77-55">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 删除可能存在的前导 v</span><span class="token plain" data-187-js-token="-77-71"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-78-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-78-2">return</span><span class="token plain"> latestVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-78-22">;</span><span class="token plain" data-187-js-token="-78-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-79-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-79-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="catch-79-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-79-9">(</span><span class="token plain" data-187-js-token="error-79-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-79-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-79-17">{</span><span class="token plain" data-187-js-token="-79-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-80-0">		</span><span class="token console class-name" data-187-js-token="console-80-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-80-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-80-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-80-15">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-80-16">`</span><span class="token template-string string" style="color:#e3116c">❌ 获取最新版本失败: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-80-29">${</span><span class="token template-string interpolation" data-187-js-token="error-80-31">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-80-36">.</span><span class="token template-string interpolation" data-187-js-token="message-80-37">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-80-44">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-80-45">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-80-46">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-80-47">;</span><span class="token plain" data-187-js-token="-80-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-81-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="throw-81-2">throw</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-81-13">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 抛出错误，以便可以在调用此函数的地方捕获并处理</span><span class="token plain" data-187-js-token="-81-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-82-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-82-1">}</span><span class="token plain" data-187-js-token="-82-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-83-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-83-0">}</span><span class="token plain" data-187-js-token="-83-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-84-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-85-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-85-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 更新版本号</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} newVersion</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-88-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-89-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="function-89-0">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="updateVersion-89-9">updateVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-89-22">(</span><span class="token parameter" data-187-js-token="newVersion-89-23">newVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-89-33">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-89-35">{</span><span class="token plain" data-187-js-token="-89-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="packageJson-90-0">	packageJson</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-90-12">.</span><span class="token property-access" data-187-js-token="version-90-13">version</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-90-21">=</span><span class="token plain"> newVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-90-33">;</span><span class="token plain" data-187-js-token="-90-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="fs-91-0">	fs</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-91-3">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="writeFileSync-91-4">writeFileSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-91-17">(</span><span class="token plain" data-187-js-token="packageJsonPath-91-18">packageJsonPath</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-91-33">,</span><span class="token plain"> </span><span class="token known-class-name class-name" data-187-js-token="JSON-91-35">JSON</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-91-39">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="stringify-91-40">stringify</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-91-49">(</span><span class="token plain" data-187-js-token="packageJson-91-50">packageJson</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-91-61">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f" data-187-js-token="null-91-63">null</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-91-67">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-187-js-token="2-91-69">2</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-91-70">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-91-71">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-91-72">;</span><span class="token plain" data-187-js-token="-91-73"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-92-0">	</span><span class="token console class-name" data-187-js-token="console-92-1">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-92-8">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-92-9">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-92-12">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-92-13">`</span><span class="token template-string string" style="color:#e3116c">✅ 版本号已更新为 </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-92-24">${</span><span class="token template-string interpolation" data-187-js-token="newVersion-92-26">newVersion</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-92-36">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-92-37">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-92-38">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-92-39">;</span><span class="token plain" data-187-js-token="-92-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-93-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-93-0">}</span><span class="token plain" data-187-js-token="-93-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-94-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-95-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-95-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 确保用户已登录npm</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Promise&lt;string&gt;} 返回已登录用户的名称或抛出错误</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-98-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-99-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="async-99-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-187-js-token="function-99-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="ensureNpmLoggedIn-99-15">ensureNpmLoggedIn</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-99-32">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-99-33">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-99-35">{</span><span class="token plain" data-187-js-token="-99-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-100-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="try-100-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-100-5">{</span><span class="token plain" data-187-js-token="-100-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-101-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-101-2">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-101-8">{</span><span class="token plain" data-187-js-token="stdout-101-9">stdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-101-15">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-101-17">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-101-19">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="exec-101-25">exec</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-101-29">(</span><span class="token string" style="color:#e3116c">&#x27;npm whoami&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-101-42">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-101-43">;</span><span class="token plain" data-187-js-token="-101-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-102-0">		</span><span class="token console class-name" data-187-js-token="console-102-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-102-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-102-10">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-102-13">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-102-14">`</span><span class="token template-string string" style="color:#e3116c">✅ 检测到您已作为</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-102-24">${</span><span class="token template-string interpolation" data-187-js-token="stdout-102-26">stdout</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-102-32">.</span><span class="token template-string interpolation function" style="color:#d73a49" data-187-js-token="trim-102-33">trim</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token="(-102-37">(</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=")-102-38">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-102-39">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="登录到npm-102-40">登录到npm</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-102-46">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-102-47">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-102-48">;</span><span class="token plain" data-187-js-token="-102-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-103-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-103-2">return</span><span class="token plain"> stdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-103-15">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="trim-103-16">trim</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-103-20">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-103-21">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-103-22">;</span><span class="token plain" data-187-js-token="-103-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-104-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-104-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="catch-104-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-104-9">(</span><span class="token plain" data-187-js-token="error-104-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-104-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-104-17">{</span><span class="token plain" data-187-js-token="-104-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-105-0">		</span><span class="token console class-name" data-187-js-token="console-105-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-105-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-105-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-105-15">(</span><span class="token string" style="color:#e3116c">&#x27;❌ 您似乎还没有登录到npm。请登录后继续。&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-105-40">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-105-41">;</span><span class="token plain" data-187-js-token="-105-42"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-106-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-106-2">const</span><span class="token plain"> answers </span><span class="token operator" style="color:#393A34" data-187-js-token="=-106-16">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-106-18">await</span><span class="token plain"> inquirer</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-106-32">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="prompt-106-33">prompt</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-106-39">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token="[-106-40">[</span><span class="token plain" data-187-js-token="-106-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-107-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-107-3">{</span><span class="token plain" data-187-js-token="-107-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="type-108-0">				type</span><span class="token operator" style="color:#393A34" data-187-js-token=":-108-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;input&#x27;-108-10">&#x27;input&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-108-17">,</span><span class="token plain" data-187-js-token="-108-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="name-109-0">				name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-109-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;username&#x27;-109-10">&#x27;username&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-109-20">,</span><span class="token plain" data-187-js-token="-109-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="message-110-0">				message</span><span class="token operator" style="color:#393A34" data-187-js-token=":-110-11">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;请输入您的npm用户名:&#x27;-110-13">&#x27;请输入您的npm用户名:&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-110-27">,</span><span class="token plain" data-187-js-token="-110-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-111-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-111-3">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-111-4">,</span><span class="token plain" data-187-js-token="-111-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-112-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-112-3">{</span><span class="token plain" data-187-js-token="-112-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="type-113-0">				type</span><span class="token operator" style="color:#393A34" data-187-js-token=":-113-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;password&#x27;-113-10">&#x27;password&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-113-20">,</span><span class="token plain" data-187-js-token="-113-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="name-114-0">				name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-114-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;password&#x27;-114-10">&#x27;password&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-114-20">,</span><span class="token plain" data-187-js-token="-114-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="message-115-0">				message</span><span class="token operator" style="color:#393A34" data-187-js-token=":-115-11">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;请输入您的npm密码:&#x27;-115-13">&#x27;请输入您的npm密码:&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-115-26">,</span><span class="token plain" data-187-js-token="-115-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-116-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-116-3">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-116-4">,</span><span class="token plain" data-187-js-token="-116-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-117-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-117-3">{</span><span class="token plain" data-187-js-token="-117-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="type-118-0">				type</span><span class="token operator" style="color:#393A34" data-187-js-token=":-118-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;input&#x27;-118-10">&#x27;input&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-118-17">,</span><span class="token plain" data-187-js-token="-118-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="name-119-0">				name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-119-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;email&#x27;-119-10">&#x27;email&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-119-17">,</span><span class="token plain" data-187-js-token="-119-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="message-120-0">				message</span><span class="token operator" style="color:#393A34" data-187-js-token=":-120-11">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;请输入您的npm邮箱地址:&#x27;-120-13">&#x27;请输入您的npm邮箱地址:&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-120-28">,</span><span class="token plain" data-187-js-token="-120-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-121-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-121-3">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-121-4">,</span><span class="token plain" data-187-js-token="-121-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-122-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="]-122-2">]</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-122-3">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-122-4">;</span><span class="token plain" data-187-js-token="-122-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-123-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-124-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 以下操作依赖于能够自动化的输入命令到npm login（在这个假设下编写）</span><span class="token plain" data-187-js-token="-124-42"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-125-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 实际操作中这可能需要特殊处理，例如通过node-pty实现自动输入</span><span class="token plain" data-187-js-token="-125-38"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-126-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-126-2">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-126-8">{</span><span class="token plain" data-187-js-token="stdout-126-9">stdout</span><span class="token operator" style="color:#393A34" data-187-js-token=":-126-15">:</span><span class="token plain"> loginStdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-126-28">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-126-30">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-126-32">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="exec-126-38">exec</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-126-42">(</span><span class="token plain" data-187-js-token="-126-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-127-0">			</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-127-3">`</span><span class="token template-string string" style="color:#e3116c">echo &quot;</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-127-10">${</span><span class="token template-string interpolation" data-187-js-token="answers-127-12">answers</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-127-19">.</span><span class="token template-string interpolation" data-187-js-token="username-127-20">username</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-127-28">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="\n-127-29">\n</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-127-31">${</span><span class="token template-string interpolation" data-187-js-token="answers-127-33">answers</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-127-40">.</span><span class="token template-string interpolation" data-187-js-token="password-127-41">password</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-127-49">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="\n-127-50">\n</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-127-52">${</span><span class="token template-string interpolation" data-187-js-token="answers-127-54">answers</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-127-61">.</span><span class="token template-string interpolation" data-187-js-token="email-127-62">email</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-127-67">}</span><span class="token template-string string" style="color:#e3116c">\n&quot; | npm login</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-127-83">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-127-84">,</span><span class="token plain" data-187-js-token="-127-85"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-128-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-128-2">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-128-3">;</span><span class="token plain" data-187-js-token="-128-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-129-0">		</span><span class="token console class-name" data-187-js-token="console-129-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-129-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-129-10">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-129-13">(</span><span class="token string" style="color:#e3116c">&#x27;✅ 登录输出流loginStdout&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-129-34">,</span><span class="token plain"> loginStdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-129-47">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-129-48">;</span><span class="token plain" data-187-js-token="-129-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-130-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-130-2">return</span><span class="token plain"> answers</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-130-16">.</span><span class="token property-access" data-187-js-token="username-130-17">username</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-130-25">;</span><span class="token plain" data-187-js-token="-130-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-131-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-131-1">}</span><span class="token plain" data-187-js-token="-131-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-132-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-132-0">}</span><span class="token plain" data-187-js-token="-132-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-133-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-134-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-134-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 异步地发布到npm</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Promise&lt;void&gt;}</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-137-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-138-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="async-138-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-187-js-token="function-138-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="publishToNpm-138-15">publishToNpm</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-138-27">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-138-28">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-138-30">{</span><span class="token plain" data-187-js-token="-138-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-139-0">	</span><span class="token console class-name" data-187-js-token="console-139-1">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-139-8">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-139-9">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-139-12">(</span><span class="token string" style="color:#e3116c">&#x27;🚀🚀🚀 正在发布到 npm...&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-139-34">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-139-35">;</span><span class="token plain" data-187-js-token="-139-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-140-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-141-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="try-141-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-141-5">{</span><span class="token plain" data-187-js-token="-141-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-142-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 这里可以添加对newVersion的使用，例如修改package.json中的版本号</span><span class="token plain" data-187-js-token="-142-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-143-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 如果newVersion参数确实需要被用于发布特定版本，这里应该加入对版本号处理的逻辑</span><span class="token plain" data-187-js-token="-143-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-144-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 例如使用 npm version 命令来更新项目的版本号</span><span class="token plain" data-187-js-token="-144-33"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-145-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-146-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-146-2">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-146-8">{</span><span class="token plain" data-187-js-token="stdout-146-9">stdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-146-15">,</span><span class="token plain"> stderr</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-146-23">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-146-25">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-146-27">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="exec-146-33">exec</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-146-37">(</span><span class="token string" style="color:#e3116c">&#x27;npm publish&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-146-51">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-146-52">;</span><span class="token plain" data-187-js-token="-146-53"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-147-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-148-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-148-2">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-148-5">(</span><span class="token plain" data-187-js-token="stderr-148-6">stderr</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-148-12">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-148-14">{</span><span class="token plain" data-187-js-token="-148-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-149-0">			</span><span class="token console class-name" data-187-js-token="console-149-3">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-149-10">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-149-11">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-149-14">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-149-15">`</span><span class="token template-string string" style="color:#e3116c">✅ 发布输出流stderr: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-149-31">${</span><span class="token template-string interpolation" data-187-js-token="stderr-149-33">stderr</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-149-39">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-149-40">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-149-41">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-149-42">;</span><span class="token plain" data-187-js-token="-149-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-150-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-150-2">}</span><span class="token plain" data-187-js-token="-150-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-151-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-152-0">		</span><span class="token console class-name" data-187-js-token="console-152-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-152-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-152-10">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-152-13">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-152-14">`</span><span class="token template-string string" style="color:#e3116c">🎉🎉🎉 npm包发布成功: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-152-32">${</span><span class="token template-string interpolation" data-187-js-token="stdout-152-34">stdout</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-152-40">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-152-41">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-152-42">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-152-43">;</span><span class="token plain" data-187-js-token="-152-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-153-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-153-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="catch-153-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-153-9">(</span><span class="token plain" data-187-js-token="error-153-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-153-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-153-17">{</span><span class="token plain" data-187-js-token="-153-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-154-0">		</span><span class="token console class-name" data-187-js-token="console-154-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-154-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-154-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-154-15">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-154-16">`</span><span class="token template-string string" style="color:#e3116c">❌ 发布失败: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-154-25">${</span><span class="token template-string interpolation" data-187-js-token="error-154-27">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-154-32">.</span><span class="token template-string interpolation" data-187-js-token="message-154-33">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-154-40">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-154-41">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-154-42">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-154-43">;</span><span class="token plain" data-187-js-token="-154-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-155-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="throw-155-2">throw</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-155-13">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 抛出错误以供调用方处理</span><span class="token plain" data-187-js-token="-155-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-156-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-156-1">}</span><span class="token plain" data-187-js-token="-156-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-157-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-157-0">}</span><span class="token plain" data-187-js-token="-157-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-158-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-159-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-159-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 标记tag</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} newVersion</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-162-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-163-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="function-163-0">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="gitOperations-163-9">gitOperations</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-163-22">(</span><span class="token parameter" data-187-js-token="newVersion-163-23">newVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-163-33">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-163-35">{</span><span class="token plain" data-187-js-token="-163-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-164-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="try-164-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-164-5">{</span><span class="token plain" data-187-js-token="-164-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="process-165-0">		process</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-165-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="chdir-165-10">chdir</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-165-15">(</span><span class="token plain" data-187-js-token="projectRootPath-165-16">projectRootPath</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-165-31">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-165-32">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Change the current working directory to project root</span><span class="token plain" data-187-js-token="-165-89"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-166-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-167-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 获取当前分支名称</span><span class="token plain" data-187-js-token="-167-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-168-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-168-2">const</span><span class="token plain"> branchName </span><span class="token operator" style="color:#393A34" data-187-js-token="=-168-19">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="execSync-168-21">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-168-29">(</span><span class="token string" style="color:#e3116c">&#x27;git rev-parse --abbrev-ref HEAD&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-168-63">)</span><span class="token plain" data-187-js-token="-168-64"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-169-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-169-3">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="toString-169-4">toString</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-169-12">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-169-13">)</span><span class="token plain" data-187-js-token="-169-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-170-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-170-3">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="trim-170-4">trim</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-170-8">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-170-9">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-170-10">;</span><span class="token plain" data-187-js-token="-170-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-171-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-172-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 检查是否有设置 upstream（远程跟踪分支）</span><span class="token plain" data-187-js-token="-172-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-173-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="let-173-2">let</span><span class="token plain"> setUpstream </span><span class="token operator" style="color:#393A34" data-187-js-token="=-173-18">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa" data-187-js-token="false-173-20">false</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-173-25">;</span><span class="token plain" data-187-js-token="-173-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-174-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="try-174-2">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-174-6">{</span><span class="token plain" data-187-js-token="-174-7"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-175-0">			</span><span class="token function" style="color:#d73a49" data-187-js-token="execSync-175-3">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-175-11">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-175-12">`</span><span class="token template-string string" style="color:#e3116c">git rev-parse --abbrev-ref --symbolic-full-name @{u}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-175-65">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-175-66">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-175-67">;</span><span class="token plain" data-187-js-token="-175-68"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-176-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-176-2">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="catch-176-4">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-176-10">(</span><span class="token plain" data-187-js-token="error-176-11">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-176-16">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-176-18">{</span><span class="token plain" data-187-js-token="-176-19"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-177-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// 如果没有设置 upstream，为远程的同名分支设置 upstream</span><span class="token plain" data-187-js-token="-177-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-178-0">			</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-178-3">const</span><span class="token plain"> remoteBranchExists </span><span class="token operator" style="color:#393A34" data-187-js-token="=-178-28">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="execSync-178-30">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-178-38">(</span><span class="token plain" data-187-js-token="-178-39"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-179-0">				</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-179-4">`</span><span class="token template-string string" style="color:#e3116c">git ls-remote --heads origin </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-179-34">${</span><span class="token template-string interpolation" data-187-js-token="branchName-179-36">branchName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-179-46">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-179-47">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-179-48">,</span><span class="token plain" data-187-js-token="-179-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-180-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-180-3">)</span><span class="token plain" data-187-js-token="-180-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-181-0">				</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-181-4">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="toString-181-5">toString</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-181-13">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-181-14">)</span><span class="token plain" data-187-js-token="-181-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-182-0">				</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-182-4">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="trim-182-5">trim</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-182-9">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-182-10">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-182-11">;</span><span class="token plain" data-187-js-token="-182-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-183-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-183-3">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-183-6">(</span><span class="token plain" data-187-js-token="remoteBranchExists-183-7">remoteBranchExists</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-183-25">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-183-27">{</span><span class="token plain" data-187-js-token="-183-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-184-0">				</span><span class="token function" style="color:#d73a49" data-187-js-token="execSync-184-4">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-184-12">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-184-13">`</span><span class="token template-string string" style="color:#e3116c">git branch --set-upstream-to=origin/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-184-50">${</span><span class="token template-string interpolation" data-187-js-token="branchName-184-52">branchName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-184-62">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-184-63">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-184-64">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-184-65">;</span><span class="token plain" data-187-js-token="-184-66"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-185-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-185-3">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="else-185-5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-185-10">{</span><span class="token plain" data-187-js-token="-185-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-186-0">				</span><span class="token console class-name" data-187-js-token="console-186-4">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-186-11">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-186-12">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-186-17">(</span><span class="token plain" data-187-js-token="-186-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-187-0">					</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-187-5">`</span><span class="token template-string string" style="color:#e3116c">❌ 远程分支 &#x27;origin/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-187-21">${</span><span class="token template-string interpolation" data-187-js-token="branchName-187-23">branchName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-187-33">}</span><span class="token template-string string" style="color:#e3116c">&#x27; 不存在，无法设置 upstream。</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-187-54">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-187-55">,</span><span class="token plain" data-187-js-token="-187-56"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-188-0">				</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-188-4">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-188-5">;</span><span class="token plain" data-187-js-token="-188-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-189-0">				</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-189-4">return</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-189-10">;</span><span class="token plain" data-187-js-token="-189-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-190-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-190-3">}</span><span class="token plain" data-187-js-token="-190-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">			setUpstream </span><span class="token operator" style="color:#393A34" data-187-js-token="=-191-15">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa" data-187-js-token="true-191-17">true</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-191-21">;</span><span class="token plain" data-187-js-token="-191-22"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-192-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-192-2">}</span><span class="token plain" data-187-js-token="-192-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-193-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-194-0">		</span><span class="token function" style="color:#d73a49" data-187-js-token="execSync-194-2">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-194-10">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-194-11">`</span><span class="token template-string string" style="color:#e3116c">git add .</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-194-21">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-194-22">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-194-24">{</span><span class="token plain" data-187-js-token="stdio-194-25">stdio</span><span class="token operator" style="color:#393A34" data-187-js-token=":-194-30">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;inherit&#x27;-194-32">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-194-41">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-194-42">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-194-43">;</span><span class="token plain" data-187-js-token="-194-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-195-0">		</span><span class="token function" style="color:#d73a49" data-187-js-token="execSync-195-2">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-195-10">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-195-11">`</span><span class="token template-string string" style="color:#e3116c">git commit -m &quot;chore(release): </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-195-43">${</span><span class="token template-string interpolation" data-187-js-token="newVersion-195-45">newVersion</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-195-55">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="&quot;-195-56">&quot;</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-195-57">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-195-58">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-195-60">{</span><span class="token plain" data-187-js-token="-195-61"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="stdio-196-0">			stdio</span><span class="token operator" style="color:#393A34" data-187-js-token=":-196-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;inherit&#x27;-196-10">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-196-19">,</span><span class="token plain" data-187-js-token="-196-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-197-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-197-2">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-197-3">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-197-4">;</span><span class="token plain" data-187-js-token="-197-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-198-0">		</span><span class="token function" style="color:#d73a49" data-187-js-token="execSync-198-2">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-198-10">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-198-11">`</span><span class="token template-string string" style="color:#e3116c">git tag v</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-198-21">${</span><span class="token template-string interpolation" data-187-js-token="newVersion-198-23">newVersion</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-198-33">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-198-34">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-198-35">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-198-37">{</span><span class="token plain" data-187-js-token="stdio-198-38">stdio</span><span class="token operator" style="color:#393A34" data-187-js-token=":-198-43">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;inherit&#x27;-198-45">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-198-54">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-198-55">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-198-56">;</span><span class="token plain" data-187-js-token="-198-57"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-199-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-200-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 推送改动到远程分支</span><span class="token plain" data-187-js-token="-200-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-201-0">		</span><span class="token function" style="color:#d73a49" data-187-js-token="execSync-201-2">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-201-10">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-201-11">`</span><span class="token template-string string" style="color:#e3116c">git push</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-201-20">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-201-21">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-201-23">{</span><span class="token plain" data-187-js-token="stdio-201-24">stdio</span><span class="token operator" style="color:#393A34" data-187-js-token=":-201-29">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;inherit&#x27;-201-31">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-201-40">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-201-41">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-201-42">;</span><span class="token plain" data-187-js-token="-201-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-202-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-202-2">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-202-5">(</span><span class="token plain" data-187-js-token="setUpstream-202-6">setUpstream</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-202-17">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-202-19">{</span><span class="token plain" data-187-js-token="-202-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-203-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// 如果之前没有 upstream，并且我们为其设置了 upstream，现在也推送它</span><span class="token plain" data-187-js-token="-203-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-204-0">			</span><span class="token function" style="color:#d73a49" data-187-js-token="execSync-204-3">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-204-11">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-204-12">`</span><span class="token template-string string" style="color:#e3116c">git push --set-upstream origin </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-204-44">${</span><span class="token template-string interpolation" data-187-js-token="branchName-204-46">branchName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-204-56">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-204-57">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-204-58">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-204-60">{</span><span class="token plain" data-187-js-token="-204-61"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="stdio-205-0">				stdio</span><span class="token operator" style="color:#393A34" data-187-js-token=":-205-9">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;inherit&#x27;-205-11">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-205-20">,</span><span class="token plain" data-187-js-token="-205-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-206-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-206-3">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-206-4">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-206-5">;</span><span class="token plain" data-187-js-token="-206-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-207-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-207-2">}</span><span class="token plain" data-187-js-token="-207-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-208-0">		</span><span class="token comment" style="color:#999988;font-style:italic">// 推送tag到远程</span><span class="token plain" data-187-js-token="-208-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-209-0">		</span><span class="token function" style="color:#d73a49" data-187-js-token="execSync-209-2">execSync</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-209-10">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-209-11">`</span><span class="token template-string string" style="color:#e3116c">git push origin v</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-209-29">${</span><span class="token template-string interpolation" data-187-js-token="newVersion-209-31">newVersion</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-209-41">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-209-42">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-209-43">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-209-45">{</span><span class="token plain" data-187-js-token="stdio-209-46">stdio</span><span class="token operator" style="color:#393A34" data-187-js-token=":-209-51">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;inherit&#x27;-209-53">&#x27;inherit&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-209-62">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-209-63">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-209-64">;</span><span class="token plain" data-187-js-token="-209-65"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-210-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-211-0">		</span><span class="token console class-name" data-187-js-token="console-211-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-211-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-211-10">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-211-13">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-211-14">`</span><span class="token template-string string" style="color:#e3116c">✅ Git tag v</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-211-26">${</span><span class="token template-string interpolation" data-187-js-token="newVersion-211-28">newVersion</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-211-38">}</span><span class="token template-string string" style="color:#e3116c"> 已标记</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-211-43">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-211-44">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-211-45">;</span><span class="token plain" data-187-js-token="-211-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-212-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-212-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="catch-212-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-212-9">(</span><span class="token plain" data-187-js-token="error-212-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-212-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-212-17">{</span><span class="token plain" data-187-js-token="-212-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-213-0">		</span><span class="token console class-name" data-187-js-token="console-213-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-213-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-213-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-213-15">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-213-16">`</span><span class="token template-string string" style="color:#e3116c">❌ Git 操作失败: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-213-29">${</span><span class="token template-string interpolation" data-187-js-token="error-213-31">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-213-36">.</span><span class="token template-string interpolation" data-187-js-token="message-213-37">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-213-44">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-213-45">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-213-46">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-213-47">;</span><span class="token plain" data-187-js-token="-213-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-214-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-214-1">}</span><span class="token plain" data-187-js-token="-214-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-215-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-215-0">}</span><span class="token plain" data-187-js-token="-215-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-216-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-217-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-217-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 设置npm的registry到指定的URL，并返回旧的registry</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Promise&lt;string&gt;} 当成功时返回旧的registry URL</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-220-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-221-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="async-221-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-187-js-token="function-221-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="setNpmRegistry-221-15">setNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-221-29">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-221-30">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-221-32">{</span><span class="token plain" data-187-js-token="-221-33"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-222-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="try-222-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-222-5">{</span><span class="token plain" data-187-js-token="-222-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-223-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-223-2">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-223-8">{</span><span class="token plain" data-187-js-token="stdout-223-9">stdout</span><span class="token operator" style="color:#393A34" data-187-js-token=":-223-15">:</span><span class="token plain"> getRegistryStdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-223-34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-223-36">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-223-38">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="exec-223-44">exec</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-223-48">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-223-49">`</span><span class="token template-string string" style="color:#e3116c">npm config get registry</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-223-73">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-223-74">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-223-75">;</span><span class="token plain" data-187-js-token="-223-76"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-224-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-224-2">const</span><span class="token plain"> oldNpmRegistry </span><span class="token operator" style="color:#393A34" data-187-js-token="=-224-23">=</span><span class="token plain"> getRegistryStdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-224-42">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="trim-224-43">trim</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-224-47">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-224-48">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-224-49">;</span><span class="token plain" data-187-js-token="-224-50"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-225-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-226-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-226-2">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa" data-187-js-token="NPM_REGISTRY_URL-226-8">NPM_REGISTRY_URL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="=-226-25">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;https://registry.npmjs.org/&#x27;-226-27">&#x27;https://registry.npmjs.org/&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-226-56">;</span><span class="token plain" data-187-js-token="-226-57"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-227-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-227-2">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="exec-227-8">exec</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-227-12">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-227-13">`</span><span class="token template-string string" style="color:#e3116c">npm config set registry </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-227-38">${</span><span class="token template-string interpolation constant" style="color:#36acaa" data-187-js-token="NPM_REGISTRY_URL-227-40">NPM_REGISTRY_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-227-56">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-227-57">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-227-58">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-227-59">;</span><span class="token plain" data-187-js-token="-227-60"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-228-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-229-0">		</span><span class="token console class-name" data-187-js-token="console-229-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-229-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-229-10">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-229-13">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-229-14">`</span><span class="token template-string string" style="color:#e3116c">✅ npm registry已设置为: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-229-35">${</span><span class="token template-string interpolation constant" style="color:#36acaa" data-187-js-token="NPM_REGISTRY_URL-229-37">NPM_REGISTRY_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-229-53">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-229-54">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-229-55">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-229-56">;</span><span class="token plain" data-187-js-token="-229-57"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-230-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="return-230-2">return</span><span class="token plain"> oldNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-230-23">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 返回旧的registry，以便后续可以恢复</span><span class="token plain" data-187-js-token="-230-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-231-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-231-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="catch-231-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-231-9">(</span><span class="token plain" data-187-js-token="error-231-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-231-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-231-17">{</span><span class="token plain" data-187-js-token="-231-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-232-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-232-2">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-232-5">(</span><span class="token plain" data-187-js-token="error-232-6">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-232-11">.</span><span class="token property-access" data-187-js-token="stdout-232-12">stdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-232-18">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-232-20">{</span><span class="token plain" data-187-js-token="-232-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-233-0">			</span><span class="token console class-name" data-187-js-token="console-233-3">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-233-10">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-233-11">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-233-16">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-233-17">`</span><span class="token template-string string" style="color:#e3116c">❌ 设置npm registry stdout输出流: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-233-46">${</span><span class="token template-string interpolation" data-187-js-token="error-233-48">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-233-53">.</span><span class="token template-string interpolation" data-187-js-token="stdout-233-54">stdout</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-233-60">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-233-61">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-233-62">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-233-63">;</span><span class="token plain" data-187-js-token="-233-64"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-234-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-234-2">}</span><span class="token plain" data-187-js-token="-234-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-235-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-235-2">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-235-5">(</span><span class="token plain" data-187-js-token="error-235-6">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-235-11">.</span><span class="token property-access" data-187-js-token="stderr-235-12">stderr</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-235-18">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-235-20">{</span><span class="token plain" data-187-js-token="-235-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-236-0">			</span><span class="token console class-name" data-187-js-token="console-236-3">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-236-10">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-236-11">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-236-16">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-236-17">`</span><span class="token template-string string" style="color:#e3116c">❌ 设置npm registry stderr出错: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-236-45">${</span><span class="token template-string interpolation" data-187-js-token="error-236-47">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-236-52">.</span><span class="token template-string interpolation" data-187-js-token="stderr-236-53">stderr</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-236-59">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-236-60">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-236-61">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-236-62">;</span><span class="token plain" data-187-js-token="-236-63"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-237-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-237-2">}</span><span class="token plain" data-187-js-token="-237-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-238-0">		</span><span class="token console class-name" data-187-js-token="console-238-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-238-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-238-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-238-15">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-238-16">`</span><span class="token template-string string" style="color:#e3116c">❌ 设置npm registry中发生错误: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-238-40">${</span><span class="token template-string interpolation" data-187-js-token="error-238-42">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-238-47">.</span><span class="token template-string interpolation" data-187-js-token="message-238-48">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-238-55">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-238-56">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-238-57">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-238-58">;</span><span class="token plain" data-187-js-token="-238-59"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-239-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="throw-239-2">throw</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-239-13">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 抛出错误以供调用者处理</span><span class="token plain" data-187-js-token="-239-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-240-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-240-1">}</span><span class="token plain" data-187-js-token="-240-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-241-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-241-0">}</span><span class="token plain" data-187-js-token="-241-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-242-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-243-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-243-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 恢复npm的registry为旧的URL</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Promise&lt;void&gt;}</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-246-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-247-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="async-247-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-187-js-token="function-247-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="restoreNpmRegistry-247-15">restoreNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-247-33">(</span><span class="token parameter" data-187-js-token="oldNpmRegistry-247-34">oldNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-247-48">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-247-50">{</span><span class="token plain" data-187-js-token="-247-51"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-248-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-248-1">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-248-4">(</span><span class="token plain" data-187-js-token="oldNpmRegistry-248-5">oldNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-248-19">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-248-21">{</span><span class="token plain" data-187-js-token="-248-22"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-249-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="try-249-2">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-249-6">{</span><span class="token plain" data-187-js-token="-249-7"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-250-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-250-3">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="exec-250-9">exec</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-250-13">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-250-14">`</span><span class="token template-string string" style="color:#e3116c">npm config set registry </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-250-39">${</span><span class="token template-string interpolation" data-187-js-token="oldNpmRegistry-250-41">oldNpmRegistry</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-250-55">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-250-56">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-250-57">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-250-58">;</span><span class="token plain" data-187-js-token="-250-59"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-251-0">			</span><span class="token console class-name" data-187-js-token="console-251-3">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-251-10">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-251-11">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-251-14">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-251-15">`</span><span class="token template-string string" style="color:#e3116c">✅ npm registry已恢复为: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-251-36">${</span><span class="token template-string interpolation" data-187-js-token="oldNpmRegistry-251-38">oldNpmRegistry</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-251-52">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-251-53">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-251-54">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-251-55">;</span><span class="token plain" data-187-js-token="-251-56"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-252-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-252-2">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="catch-252-4">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-252-10">(</span><span class="token plain" data-187-js-token="error-252-11">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-252-16">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-252-18">{</span><span class="token plain" data-187-js-token="-252-19"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-253-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-253-3">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-253-6">(</span><span class="token plain" data-187-js-token="error-253-7">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-253-12">.</span><span class="token property-access" data-187-js-token="stdout-253-13">stdout</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-253-19">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-253-21">{</span><span class="token plain" data-187-js-token="-253-22"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-254-0">				</span><span class="token console class-name" data-187-js-token="console-254-4">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-254-11">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-254-12">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-254-17">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-254-18">`</span><span class="token template-string string" style="color:#e3116c">✅ 恢复npm registry输出流: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-254-40">${</span><span class="token template-string interpolation" data-187-js-token="error-254-42">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-254-47">.</span><span class="token template-string interpolation" data-187-js-token="stdout-254-48">stdout</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-254-54">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-254-55">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-254-56">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-254-57">;</span><span class="token plain" data-187-js-token="-254-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-255-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-255-3">}</span><span class="token plain" data-187-js-token="-255-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-256-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-256-3">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-256-6">(</span><span class="token plain" data-187-js-token="error-256-7">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-256-12">.</span><span class="token property-access" data-187-js-token="stderr-256-13">stderr</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-256-19">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-256-21">{</span><span class="token plain" data-187-js-token="-256-22"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-257-0">				</span><span class="token console class-name" data-187-js-token="console-257-4">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-257-11">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-257-12">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-257-17">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-257-18">`</span><span class="token template-string string" style="color:#e3116c">❌ 恢复npm registry出错: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-257-39">${</span><span class="token template-string interpolation" data-187-js-token="error-257-41">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-257-46">.</span><span class="token template-string interpolation" data-187-js-token="stderr-257-47">stderr</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-257-53">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-257-54">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-257-55">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-257-56">;</span><span class="token plain" data-187-js-token="-257-57"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-258-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-258-3">}</span><span class="token plain" data-187-js-token="-258-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-259-0">			</span><span class="token console class-name" data-187-js-token="console-259-3">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-259-10">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-259-11">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-259-16">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-259-17">`</span><span class="token template-string string" style="color:#e3116c">❌ 恢复npm registry中发生错误: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-259-41">${</span><span class="token template-string interpolation" data-187-js-token="error-259-43">error</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-259-48">.</span><span class="token template-string interpolation" data-187-js-token="message-259-49">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-259-56">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-259-57">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-259-58">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-259-59">;</span><span class="token plain" data-187-js-token="-259-60"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-260-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="throw-260-3">throw</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-260-14">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 抛出错误以供调用方处理</span><span class="token plain" data-187-js-token="-260-30"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-261-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-261-2">}</span><span class="token plain" data-187-js-token="-261-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-262-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-262-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="else-262-3">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-262-8">{</span><span class="token plain" data-187-js-token="-262-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-263-0">		</span><span class="token console class-name" data-187-js-token="console-263-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-263-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-263-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-263-15">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-263-16">`</span><span class="token template-string string" style="color:#e3116c">❌ 未找到旧的npm registry，无法恢复。</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-263-42">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-263-43">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-263-44">;</span><span class="token plain" data-187-js-token="-263-45"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-264-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="throw-264-2">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-187-js-token="new-264-8">new</span><span class="token plain"> </span><span class="token class-name" data-187-js-token="Error-264-12">Error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-264-17">(</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-264-18">`</span><span class="token template-string string" style="color:#e3116c">❌ 未找到旧的npm registry，无法恢复。</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-264-44">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-264-45">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-264-46">;</span><span class="token plain" data-187-js-token="-264-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-265-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-265-1">}</span><span class="token plain" data-187-js-token="-265-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-266-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-266-0">}</span><span class="token plain" data-187-js-token="-266-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-267-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-268-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-268-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 命令行显示逻辑</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} latestVersion</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-271-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-272-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="async-272-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-187-js-token="function-272-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="displayOptions-272-15">displayOptions</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-272-29">(</span><span class="token parameter" data-187-js-token="latestVersion-272-30">latestVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-272-43">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-272-45">{</span><span class="token plain" data-187-js-token="-272-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-273-0">	</span><span class="token console class-name" data-187-js-token="console-273-1">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-273-8">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-273-9">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-273-12">(</span><span class="token string" style="color:#e3116c">&#x27;✅ 发包脚本启动【自动更新版本号、自动发布到npm】&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-273-41">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-273-42">;</span><span class="token plain" data-187-js-token="-273-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-274-0">	</span><span class="token console class-name" data-187-js-token="console-274-1">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-274-8">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="log-274-9">log</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-274-12">(</span><span class="token string" style="color:#e3116c">&#x27;!!! 使用前请确保仓库内已经是可发布状态&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-274-36">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-274-37">;</span><span class="token plain" data-187-js-token="-274-38"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-275-0">	</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-275-1">const</span><span class="token plain"> currentVersion </span><span class="token operator" style="color:#393A34" data-187-js-token="=-275-22">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="parseVersion-275-24">parseVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-275-36">(</span><span class="token plain" data-187-js-token="latestVersion-275-37">latestVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-275-50">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-275-51">;</span><span class="token plain" data-187-js-token="-275-52"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-276-0">	</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-276-1">const</span><span class="token plain"> choices </span><span class="token operator" style="color:#393A34" data-187-js-token="=-276-15">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="[-276-17">[</span><span class="token plain" data-187-js-token="-276-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-277-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-277-2">{</span><span class="token plain" data-187-js-token="-277-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="name-278-0">			name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-278-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-278-9">`</span><span class="token template-string string" style="color:#e3116c">Major【大版本】 (</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-278-22">${</span><span class="token template-string interpolation function" style="color:#d73a49" data-187-js-token="parseInt-278-24">parseInt</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token="(-278-32">(</span><span class="token template-string interpolation" data-187-js-token="currentVersion-278-33">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-278-47">.</span><span class="token template-string interpolation" data-187-js-token="major-278-48">major</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=")-278-53">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34" data-187-js-token="+-278-55">+</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa" data-187-js-token="1-278-57">1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-278-58">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".0.0)-278-59">.0.0)</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-278-64">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-278-65">,</span><span class="token plain" data-187-js-token="-278-66"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="value-279-0">			value</span><span class="token operator" style="color:#393A34" data-187-js-token=":-279-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;major&#x27;-279-10">&#x27;major&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-279-17">,</span><span class="token plain" data-187-js-token="-279-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-280-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-280-2">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-280-3">,</span><span class="token plain" data-187-js-token="-280-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-281-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-281-2">{</span><span class="token plain" data-187-js-token="-281-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="name-282-0">			name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-282-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-282-9">`</span><span class="token template-string string" style="color:#e3116c">Minor【小版本】 (</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-282-22">${</span><span class="token template-string interpolation" data-187-js-token="currentVersion-282-24">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-282-38">.</span><span class="token template-string interpolation" data-187-js-token="major-282-39">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-282-44">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-282-45">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-282-46">${</span><span class="token template-string interpolation function" style="color:#d73a49" data-187-js-token="parseInt-282-48">parseInt</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token="(-282-56">(</span><span class="token template-string interpolation" data-187-js-token="currentVersion-282-57">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-282-71">.</span><span class="token template-string interpolation" data-187-js-token="minor-282-72">minor</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=")-282-77">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34" data-187-js-token="+-282-79">+</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa" data-187-js-token="1-282-81">1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-282-82">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".0)-282-83">.0)</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-282-86">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-282-87">,</span><span class="token plain" data-187-js-token="-282-88"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="value-283-0">			value</span><span class="token operator" style="color:#393A34" data-187-js-token=":-283-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;minor&#x27;-283-10">&#x27;minor&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-283-17">,</span><span class="token plain" data-187-js-token="-283-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-284-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-284-2">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-284-3">,</span><span class="token plain" data-187-js-token="-284-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-285-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-285-2">{</span><span class="token plain" data-187-js-token="-285-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="name-286-0">			name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-286-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-286-9">`</span><span class="token template-string string" style="color:#e3116c">Patch【修订版本】 (</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-286-23">${</span><span class="token template-string interpolation" data-187-js-token="currentVersion-286-25">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-286-39">.</span><span class="token template-string interpolation" data-187-js-token="major-286-40">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-286-45">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-286-46">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-286-47">${</span><span class="token template-string interpolation" data-187-js-token="currentVersion-286-49">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-286-63">.</span><span class="token template-string interpolation" data-187-js-token="minor-286-64">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-286-69">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-286-70">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-286-71">${</span><span class="token template-string interpolation function" style="color:#d73a49" data-187-js-token="parseInt-286-73">parseInt</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token="(-286-81">(</span><span class="token template-string interpolation" data-187-js-token="currentVersion-286-82">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-286-96">.</span><span class="token template-string interpolation" data-187-js-token="patch-286-97">patch</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=")-286-102">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34" data-187-js-token="+-286-104">+</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa" data-187-js-token="1-286-106">1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-286-107">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=")-286-108">)</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-286-109">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-286-110">,</span><span class="token plain" data-187-js-token="-286-111"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="value-287-0">			value</span><span class="token operator" style="color:#393A34" data-187-js-token=":-287-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;patch&#x27;-287-10">&#x27;patch&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-287-17">,</span><span class="token plain" data-187-js-token="-287-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-288-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-288-2">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-288-3">,</span><span class="token plain" data-187-js-token="-288-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-289-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-289-2">{</span><span class="token plain" data-187-js-token="name-289-3">name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-289-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-289-9">`</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="Prepatch【预发修订版本】-289-10">Prepatch【预发修订版本】</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-289-26">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-289-27">,</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34" data-187-js-token=":-289-34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;prepatch&#x27;-289-36">&#x27;prepatch&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-289-46">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-289-47">,</span><span class="token plain" data-187-js-token="-289-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-290-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-290-2">{</span><span class="token plain" data-187-js-token="name-290-3">name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-290-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-290-9">`</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="Preminor【预发小版本】-290-10">Preminor【预发小版本】</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-290-25">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-290-26">,</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34" data-187-js-token=":-290-33">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;preminor&#x27;-290-35">&#x27;preminor&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-290-45">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-290-46">,</span><span class="token plain" data-187-js-token="-290-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-291-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-291-2">{</span><span class="token plain" data-187-js-token="name-291-3">name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-291-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-291-9">`</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="Premajor【预发大版本】-291-10">Premajor【预发大版本】</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-291-25">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-291-26">,</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34" data-187-js-token=":-291-33">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;premajor&#x27;-291-35">&#x27;premajor&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-291-45">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-291-46">,</span><span class="token plain" data-187-js-token="-291-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-292-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-292-2">{</span><span class="token plain" data-187-js-token="name-292-3">name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-292-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-292-9">`</span><span class="token template-string string" style="color:#e3116c" data-187-js-token="Prerelease【预发版】-292-10">Prerelease【预发版】</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-292-25">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-292-26">,</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34" data-187-js-token=":-292-33">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;prerelease&#x27;-292-35">&#x27;prerelease&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-292-47">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-292-48">,</span><span class="token plain" data-187-js-token="-292-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-293-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-293-2">{</span><span class="token plain" data-187-js-token="name-293-3">name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-293-7">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-293-9">`</span><span class="token template-string string" style="color:#e3116c">Specific version【指定版本】</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-293-32">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-293-33">,</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34" data-187-js-token=":-293-40">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;specific&#x27;-293-42">&#x27;specific&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-293-52">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-293-53">,</span><span class="token plain" data-187-js-token="-293-54"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-294-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="]-294-1">]</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-294-2">;</span><span class="token plain" data-187-js-token="-294-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-295-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="inquirer-296-0">	inquirer</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-297-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-297-2">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="prompt-297-3">prompt</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-297-9">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token="[-297-10">[</span><span class="token plain" data-187-js-token="-297-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-298-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-298-3">{</span><span class="token plain" data-187-js-token="-298-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="type-299-0">				type</span><span class="token operator" style="color:#393A34" data-187-js-token=":-299-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;list&#x27;-299-10">&#x27;list&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-299-16">,</span><span class="token plain" data-187-js-token="-299-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="name-300-0">				name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-300-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;releaseType&#x27;-300-10">&#x27;releaseType&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-300-23">,</span><span class="token plain" data-187-js-token="-300-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="message-301-0">				message</span><span class="token operator" style="color:#393A34" data-187-js-token=":-301-11">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;请选择版本号的更新类型:&#x27;-301-13">&#x27;请选择版本号的更新类型:&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-301-27">,</span><span class="token plain" data-187-js-token="-301-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="choices-302-0">				choices</span><span class="token operator" style="color:#393A34" data-187-js-token=":-302-11">:</span><span class="token plain"> choices</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-302-20">,</span><span class="token plain" data-187-js-token="-302-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-303-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-303-3">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-303-4">,</span><span class="token plain" data-187-js-token="-303-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-304-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-304-3">{</span><span class="token plain" data-187-js-token="-304-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="type-305-0">				type</span><span class="token operator" style="color:#393A34" data-187-js-token=":-305-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;input&#x27;-305-10">&#x27;input&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-305-17">,</span><span class="token plain" data-187-js-token="-305-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="name-306-0">				name</span><span class="token operator" style="color:#393A34" data-187-js-token=":-306-8">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;specificVersion&#x27;-306-10">&#x27;specificVersion&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-306-27">,</span><span class="token plain" data-187-js-token="-306-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="message-307-0">				message</span><span class="token operator" style="color:#393A34" data-187-js-token=":-307-11">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;输入具体的版本号:&#x27;-307-13">&#x27;输入具体的版本号:&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-307-24">,</span><span class="token plain" data-187-js-token="-307-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-308-0">				</span><span class="token function-variable function" style="color:#d73a49" data-187-js-token="when-308-4">when</span><span class="token operator" style="color:#393A34" data-187-js-token=":-308-8">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-308-10">(</span><span class="token parameter" data-187-js-token="answers-308-11">answers</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-308-18">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-187-js-token="=&gt;-308-20">=&gt;</span><span class="token plain"> answers</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-308-30">.</span><span class="token property-access" data-187-js-token="releaseType-308-31">releaseType</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="===-308-43">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;specific&#x27;-308-47">&#x27;specific&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-308-57">,</span><span class="token plain" data-187-js-token="-308-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-309-0">				</span><span class="token function-variable function" style="color:#d73a49" data-187-js-token="validate-309-4">validate</span><span class="token operator" style="color:#393A34" data-187-js-token=":-309-12">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-309-14">(</span><span class="token parameter" data-187-js-token="input-309-15">input</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-309-20">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-187-js-token="=&gt;-309-22">=&gt;</span><span class="token plain" data-187-js-token="-309-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-310-0">					</span><span class="token regex regex-delimiter" style="color:#36acaa" data-187-js-token="/-310-5">/</span><span class="token regex regex-source language-regex" style="color:#36acaa" data-187-js-token="\d+\.\d+\.\d+(-\w+\.\d+)?-310-6">\d+\.\d+\.\d+(-\w+\.\d+)?</span><span class="token regex regex-delimiter" style="color:#36acaa" data-187-js-token="/-310-31">/</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-310-32">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="test-310-33">test</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-310-37">(</span><span class="token plain" data-187-js-token="input-310-38">input</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-310-43">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="||-310-45">||</span><span class="token plain" data-187-js-token="-310-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-311-0">					</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;版本号必须符合语义化版本控制规范。&#x27;-311-5">&#x27;版本号必须符合语义化版本控制规范。&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-311-24">,</span><span class="token plain" data-187-js-token="-311-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-312-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-312-3">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-312-4">,</span><span class="token plain" data-187-js-token="-312-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-313-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="]-313-2">]</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-313-3">)</span><span class="token plain" data-187-js-token="-313-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-314-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-314-2">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="then-314-3">then</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-314-7">(</span><span class="token keyword" style="color:#00009f" data-187-js-token="async-314-8">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-314-14">(</span><span class="token parameter" data-187-js-token="answers-314-15">answers</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-314-22">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-187-js-token="=&gt;-314-24">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-314-27">{</span><span class="token plain" data-187-js-token="-314-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-315-0">			</span><span class="token keyword" style="color:#00009f" data-187-js-token="let-315-3">let</span><span class="token plain"> newVersion </span><span class="token operator" style="color:#393A34" data-187-js-token="=-315-18">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;&#x27;-315-20">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-315-22">;</span><span class="token plain" data-187-js-token="-315-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-316-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// 指定版本号</span><span class="token plain" data-187-js-token="-316-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-317-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-317-3">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-317-6">(</span><span class="token plain" data-187-js-token="answers-317-7">answers</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-317-14">.</span><span class="token property-access" data-187-js-token="releaseType-317-15">releaseType</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-187-js-token="===-317-27">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;specific&#x27;-317-31">&#x27;specific&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-317-41">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-317-43">{</span><span class="token plain" data-187-js-token="-317-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">				newVersion </span><span class="token operator" style="color:#393A34" data-187-js-token="=-318-15">=</span><span class="token plain"> answers</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-318-24">.</span><span class="token property-access" data-187-js-token="specificVersion-318-25">specificVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-318-40">;</span><span class="token plain" data-187-js-token="-318-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-319-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-319-3">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="else-319-5">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="if-319-10">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-319-13">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token="[-319-14">[</span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;major&#x27;-319-15">&#x27;major&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-319-22">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;minor&#x27;-319-24">&#x27;minor&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-319-31">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-187-js-token="&#x27;patch&#x27;-319-33">&#x27;patch&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token="]-319-40">]</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-319-41">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="includes-319-42">includes</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-319-50">(</span><span class="token plain" data-187-js-token="answers-319-51">answers</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-319-58">.</span><span class="token property-access" data-187-js-token="releaseType-319-59">releaseType</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-319-70">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-319-71">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-319-73">{</span><span class="token plain" data-187-js-token="-319-74"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-320-0">				</span><span class="token comment" style="color:#999988;font-style:italic">// 非预发版本</span><span class="token plain" data-187-js-token="-320-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="currentVersion-321-0">				currentVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="[-321-18">[</span><span class="token plain" data-187-js-token="answers-321-19">answers</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-321-26">.</span><span class="token property-access" data-187-js-token="releaseType-321-27">releaseType</span><span class="token punctuation" style="color:#393A34" data-187-js-token="]-321-38">]</span><span class="token operator" style="color:#393A34" data-187-js-token="++-321-39">++</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-321-41">;</span><span class="token plain" data-187-js-token="-321-42"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">				newVersion </span><span class="token operator" style="color:#393A34" data-187-js-token="=-322-15">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-322-17">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-322-18">${</span><span class="token template-string interpolation" data-187-js-token="currentVersion-322-20">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-322-34">.</span><span class="token template-string interpolation" data-187-js-token="major-322-35">major</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-322-40">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-322-41">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-322-42">${</span><span class="token template-string interpolation" data-187-js-token="currentVersion-322-44">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-322-58">.</span><span class="token template-string interpolation" data-187-js-token="minor-322-59">minor</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-322-64">}</span><span class="token template-string string" style="color:#e3116c" data-187-js-token=".-322-65">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="${-322-66">${</span><span class="token template-string interpolation" data-187-js-token="currentVersion-322-68">currentVersion</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-187-js-token=".-322-82">.</span><span class="token template-string interpolation" data-187-js-token="patch-322-83">patch</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-187-js-token="}-322-88">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-187-js-token="`-322-89">`</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-322-90">;</span><span class="token plain" data-187-js-token="-322-91"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-323-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-323-3">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="else-323-5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-323-10">{</span><span class="token plain" data-187-js-token="-323-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-324-0">				</span><span class="token comment" style="color:#999988;font-style:italic">// 预发布版本</span><span class="token plain" data-187-js-token="-324-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">				newVersion </span><span class="token operator" style="color:#393A34" data-187-js-token="=-325-15">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="getPreReleaseVersion-325-17">getPreReleaseVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-325-37">(</span><span class="token plain" data-187-js-token="currentVersion-325-38">currentVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-325-52">,</span><span class="token plain"> answers</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-325-61">.</span><span class="token property-access" data-187-js-token="releaseType-325-62">releaseType</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-325-73">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-325-74">;</span><span class="token plain" data-187-js-token="-325-75"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-326-0">			</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-326-3">}</span><span class="token plain" data-187-js-token="-326-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-327-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// 更新版本号</span><span class="token plain" data-187-js-token="-327-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-328-0">			</span><span class="token function" style="color:#d73a49" data-187-js-token="updateVersion-328-3">updateVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-328-16">(</span><span class="token plain" data-187-js-token="newVersion-328-17">newVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-328-27">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-328-28">;</span><span class="token plain" data-187-js-token="-328-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-329-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// git增加tag并提交</span><span class="token plain" data-187-js-token="-329-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-330-0">			</span><span class="token function" style="color:#d73a49" data-187-js-token="gitOperations-330-3">gitOperations</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-330-16">(</span><span class="token plain" data-187-js-token="newVersion-330-17">newVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-330-27">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-330-28">;</span><span class="token plain" data-187-js-token="-330-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-331-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// 设置npm源</span><span class="token plain" data-187-js-token="-331-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-332-0">			</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-332-3">const</span><span class="token plain"> oldRegistryUrl </span><span class="token operator" style="color:#393A34" data-187-js-token="=-332-24">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-332-26">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="setNpmRegistry-332-32">setNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-332-46">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-332-47">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-332-48">;</span><span class="token plain" data-187-js-token="-332-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-333-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// 检测是否已经登录npm</span><span class="token plain" data-187-js-token="-333-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-334-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-334-3">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="ensureNpmLoggedIn-334-9">ensureNpmLoggedIn</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-334-26">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-334-27">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-334-28">;</span><span class="token plain" data-187-js-token="-334-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-335-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// 发布到npm</span><span class="token plain" data-187-js-token="-335-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-336-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-336-3">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="publishToNpm-336-9">publishToNpm</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-336-21">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-336-22">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-336-23">;</span><span class="token plain" data-187-js-token="-336-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-337-0">			</span><span class="token comment" style="color:#999988;font-style:italic">// 恢复npm源</span><span class="token plain" data-187-js-token="-337-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-338-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-338-3">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="restoreNpmRegistry-338-9">restoreNpmRegistry</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-338-27">(</span><span class="token plain" data-187-js-token="oldRegistryUrl-338-28">oldRegistryUrl</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-338-42">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-338-43">;</span><span class="token plain" data-187-js-token="-338-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-339-0">		</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-339-2">}</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-339-3">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-339-4">;</span><span class="token plain" data-187-js-token="-339-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-340-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-340-0">}</span><span class="token plain" data-187-js-token="-340-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-341-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-342-0"></span><span class="token comment" style="color:#999988;font-style:italic" data-187-js-token="/**-342-0">/**</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 主函数入口</span></div><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain" data-187-js-token="-344-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-345-0"></span><span class="token keyword" style="color:#00009f" data-187-js-token="async-345-0">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-187-js-token="function-345-6">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="main-345-15">main</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-345-19">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-345-20">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-345-22">{</span><span class="token plain" data-187-js-token="-345-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-346-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="try-346-1">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-346-5">{</span><span class="token plain" data-187-js-token="-346-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-347-0">		</span><span class="token keyword" style="color:#00009f" data-187-js-token="const-347-2">const</span><span class="token plain"> latestVersion </span><span class="token operator" style="color:#393A34" data-187-js-token="=-347-22">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-347-24">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="getLatestVersion-347-30">getLatestVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-347-46">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-347-47">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-347-48">;</span><span class="token plain" data-187-js-token="-347-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-348-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="await-348-2">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-187-js-token="displayOptions-348-8">displayOptions</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-348-22">(</span><span class="token plain" data-187-js-token="latestVersion-348-23">latestVersion</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-348-36">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-348-37">;</span><span class="token plain" data-187-js-token="-348-38"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-349-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-349-1">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-187-js-token="catch-349-3">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-349-9">(</span><span class="token plain" data-187-js-token="error-349-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-349-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-187-js-token="{-349-17">{</span><span class="token plain" data-187-js-token="-349-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-350-0">		</span><span class="token console class-name" data-187-js-token="console-350-2">console</span><span class="token punctuation" style="color:#393A34" data-187-js-token=".-350-9">.</span><span class="token method function property-access" style="color:#d73a49" data-187-js-token="error-350-10">error</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-350-15">(</span><span class="token string" style="color:#e3116c">&#x27;❌ 发生错误:&#x27;</span><span class="token punctuation" style="color:#393A34" data-187-js-token=",-350-25">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-350-32">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-350-33">;</span><span class="token plain" data-187-js-token="-350-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-351-0">	</span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-351-1">}</span><span class="token plain" data-187-js-token="-351-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-352-0"></span><span class="token punctuation" style="color:#393A34" data-187-js-token="}-352-0">}</span><span class="token plain" data-187-js-token="-352-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-187-js-token="-353-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-187-js-token="-354-0"></span><span class="token function" style="color:#d73a49" data-187-js-token="main-354-0">main</span><span class="token punctuation" style="color:#393A34" data-187-js-token="(-354-4">(</span><span class="token punctuation" style="color:#393A34" data-187-js-token=")-354-5">)</span><span class="token punctuation" style="color:#393A34" data-187-js-token=";-354-6">;</span></div></pre></div><h1 id="-推荐阅读"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#-推荐阅读"><span class="icon icon-link"></span></a>🍎 推荐阅读</h1><h2 id="面试手写系列"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#面试手写系列"><span class="icon icon-link"></span></a>面试手写系列</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7353504333999505408">前端面试手写必备【实现常见八大数据结构一】<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7359877430340157503">手写哈希表【银四末尾，你上岸了吗？】哈希表，快速计算、均匀分布、扩容实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h2 id="react实现原理系列"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#react实现原理系列"><span class="icon icon-link"></span></a>react实现原理系列</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/spost/7360512664316117026">【react原理实践】使用babel手搓探索下jsx的原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/spost/7361284455535345699">【喂饭式调试react源码】上手调试源码探究jsx原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/spost/7363220284503097354#heading-0">【上手调试源码系列】图解react几个核心包之间的关联<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7363193808521199655#heading-1">【上手调试源码系列】react启动流程，其实就是创建三大全局对象<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h2 id="其他"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#其他"><span class="icon icon-link"></span></a>其他</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7358709354424860707">工作流【效率小技巧】让alfred帮我启动所有项目，nice<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7352045198854406183">GPT4前端食用指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h1 id="-写在最后"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//01docs/00actual_combat/10auto_npm_publish#-写在最后"><span class="icon icon-link"></span></a>🍋 写在最后</h1><p>如果您看到这里了，并且觉得这篇文章对您有所帮助，希望您能够点赞👍和收藏⭐支持一下作者🙇🙇🙇，感谢🍺🍺！如果文中有任何不准确之处，也欢迎您指正，共同进步。感谢您的阅读，期待您的点赞👍和收藏⭐！</p><p>感兴趣的同学可以关注下我的公众号ObjectX前端实验室</p><p>🌟 少走弯路 | ObjectX前端实验室 🛠️「精选资源｜实战经验｜技术洞见」</p></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="Last update: ">6/15/2024 07:19:04</span></div></article></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/front_end_engineer_book/umi.9ab99bfd.js"></script>
  </body>
</html>
