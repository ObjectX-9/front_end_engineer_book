<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://s21.ax1x.com/2024/06/14/pkdLxmt.png"
    />
    <link rel="stylesheet" href="/front_end_engineer_book/umi.4c36f7fa.css" />
    <script>
      window.routerBase = "/front_end_engineer_book/";
    </script>
    <script>
      //! umi version: 3.5.17
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.indexOf(e) > -1 ? e : r[0]
        );
      })();
    </script>
    <title>虚拟列表的几种实现方式</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/02comp/01virtual-list" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false" data-use-bg="false" style="padding-bottom:50px;overflow:unset;background-size:cover"><div class="__dumi-default-navbar" data-mode="site" data-is-home="false" style="background-color:#212121"><button class="__dumi-default-navbar-toggle"></button><div class="logo_wrapper"><a class="__dumi-default-navbar-logo" href="/front_end_engineer_book//"><img src="https://s21.ax1x.com/2024/06/14/pkdLxmt.png" alt="ObjectX前端工程化实践"/><span class="label">ObjectX前端工程化实践</span></a><div class="search_wrapper"><div class="__dumi-default-search" data-is-home="false"><svg width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="1.0" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="主页-登录页" transform="translate(-337.000000, -20.000000)"><g id="顶部导航" transform="translate(28.000000, 0.000000)"><g id="编组-3" transform="translate(309.000000, 20.000000)"><rect id="矩形" opacity="0.0848214286" x="0" y="0" width="24" height="24"></rect><path d="M7.63246763,7.63246763 C9.80909114,5.45584412 13.3380951,5.45584412 15.5147186,7.63246763 C17.5003311,9.61808009 17.6745798,12.7291297 16.0374649,14.9122691 L17.7667903,16.6407545 C18.0777366,16.9517007 18.0777366,17.4558441 17.7667903,17.7667903 C17.4558441,18.0777366 16.9517007,18.0777366 16.6407545,17.7667903 L14.9122691,16.0374649 C12.7291297,17.6745798 9.61808009,17.5003311 7.63246763,15.5147186 C5.45584412,13.3380951 5.45584412,9.80909114 7.63246763,7.63246763 Z M14.3886828,8.75850349 C12.8339517,7.20377241 10.3132346,7.20377241 8.75850349,8.75850349 C7.20377241,10.3132346 7.20377241,12.8339517 8.75850349,14.3886828 C10.3132346,15.9434138 12.8339517,15.9434138 14.3886828,14.3886828 C15.9434138,12.8339517 15.9434138,10.3132346 14.3886828,8.75850349 Z" id="形状结合" fill="#666666" fill-rule="nonzero"></path></g></g></g></g></svg><input type="search" class="__dumi-default-search-input" placeholder="search document..." value=""/><ul></ul></div></div></div><span><nav class="navbar_links"><span class="navbar_links-item"><a href="/front_end_engineer_book//01docs">🚀 工程化实践指南</a></span><span class="navbar_links-item"><a aria-current="page" class="active" href="/front_end_engineer_book//02comp">📚 常见组件实现</a></span><span class="navbar_links-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/ObjectX-9/front_end_engineer_book">⭐️GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></span></div><ul role="slug-list" class="__dumi-default-layout-toc"><li role="slug-list-title">虚拟列表的几种实现方式</li><li title="虚拟列表的几种实现方式" data-depth="1"><a href="#虚拟列表的几种实现方式" class="active"><span>虚拟列表的几种实现方式</span></a></li><li title="🥑 实现效果&amp;代码" data-depth="2"><a href="#🥑-实现效果代码" class=""><span>🥑 实现效果&amp;代码</span></a></li><li title="定高" data-depth="2"><a href="#定高" class=""><span>定高</span></a></li><li title="不定高" data-depth="2"><a href="#不定高" class=""><span>不定高</span></a></li><li title="动态高度" data-depth="2"><a href="#动态高度" class=""><span>动态高度</span></a></li><li title="工程化" data-depth="1"><a href="#工程化" class=""><span>工程化</span></a></li><li title="一、虚拟列表" data-depth="1"><a href="#一、虚拟列表" class=""><span>一、虚拟列表</span></a></li><li title="什么是虚拟列表" data-depth="2"><a href="#什么是虚拟列表" class=""><span>什么是虚拟列表</span></a></li><li title="1.定高虚拟列表" data-depth="2"><a href="#1定高虚拟列表" class=""><span>1.定高虚拟列表</span></a></li><li title="图示" data-depth="3"><a href="#图示" class=""><span>图示</span></a></li><li title="原理" data-depth="3"><a href="#原理" class=""><span>原理</span></a></li><li title="实现" data-depth="3"><a href="#实现" class=""><span>实现</span></a></li><li title="效果" data-depth="3"><a href="#效果" class=""><span>效果</span></a></li><li title="2.不定高虚拟列表" data-depth="2"><a href="#2不定高虚拟列表" class=""><span>2.不定高虚拟列表</span></a></li><li title="图示" data-depth="3"><a href="#图示-1" class=""><span>图示</span></a></li><li title="原理" data-depth="3"><a href="#原理-1" class=""><span>原理</span></a></li><li title="实现" data-depth="3"><a href="#实现-1" class=""><span>实现</span></a></li><li title="效果" data-depth="3"><a href="#效果-1" class=""><span>效果</span></a></li><li title="3.动态高度虚拟列表" data-depth="2"><a href="#3动态高度虚拟列表" class=""><span>3.动态高度虚拟列表</span></a></li><li title="图示" data-depth="3"><a href="#图示-2" class=""><span>图示</span></a></li><li title="原理" data-depth="3"><a href="#原理-2" class=""><span>原理</span></a></li><li title="实现" data-depth="3"><a href="#实现-2" class=""><span>实现</span></a></li><li title="效果" data-depth="3"><a href="#效果-2" class=""><span>效果</span></a></li><li title="参考文章" data-depth="1"><a href="#参考文章" class=""><span>参考文章</span></a></li><li title="🍎 推荐阅读" data-depth="1"><a href="#-推荐阅读" class=""><span>🍎 推荐阅读</span></a></li><li title="工程化" data-depth="2"><a href="#工程化-1" class=""><span>工程化</span></a></li><li title="常见组件实现" data-depth="2"><a href="#常见组件实现" class=""><span>常见组件实现</span></a></li><li title="面试手写系列" data-depth="2"><a href="#面试手写系列" class=""><span>面试手写系列</span></a></li><li title="react实现原理系列" data-depth="2"><a href="#react实现原理系列" class=""><span>react实现原理系列</span></a></li><li title="其他" data-depth="2"><a href="#其他" class=""><span>其他</span></a></li><li title="🍋 写在最后" data-depth="1"><a href="#-写在最后" class=""><span>🍋 写在最后</span></a></li></ul><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://s21.ax1x.com/2024/06/14/pkdLxmt.png&#x27;)" href="/front_end_engineer_book//"></a><h1>ObjectX前端工程化实践</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/front_end_engineer_book//01docs">🚀 工程化实践指南</a></li><li><a aria-current="page" class="active" href="/front_end_engineer_book//02comp">📚 常见组件实现</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/ObjectX-9/front_end_engineer_book">⭐️GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><ul class="ant-menu ant-menu-root ant-menu-inline ant-menu-light" role="menu" tabindex="0" data-menu-list="true"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">1.瀑布流</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content"><a href="/front_end_engineer_book//02comp/00waterfall"><span>瀑布流的几种实现方式</span></a></span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">2.虚拟列表</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-selected ant-menu-item-only-child"><span class="ant-menu-title-content"><a aria-current="page" class="active" href="/front_end_engineer_book//02comp/01virtual-list"><span>虚拟列表的几种实现方式</span></a></span></li></ul></li></ul><div style="display:none" aria-hidden="true"></div></ul></div></div><div class="__dumi-default-layout-content"><div class="__dumi-default-mobile-content"><article><div class="__dumi-default-content-header markdown no-desc"><h1>虚拟列表的几种实现方式</h1></div><div class="markdown"><h1 id="虚拟列表的几种实现方式"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#虚拟列表的几种实现方式"><span class="icon icon-link"></span></a>虚拟列表的几种实现方式</h1><h2 id="🥑-实现效果代码"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#🥑-实现效果代码"><span class="icon icon-link"></span></a>🥑 实现效果&amp;代码</h2><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/ObjectX-9/react_demo">在线demo体验<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="定高"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#定高"><span class="icon icon-link"></span></a>定高</h2><p><img src="https://cdn.jsdelivr.net/gh/ObjectX-9/DrawingBed/imgMac/%E5%AE%9A%E9%AB%98.gif" alt="2024-05-25 19.39.29.gif"/></p><h2 id="不定高"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#不定高"><span class="icon icon-link"></span></a>不定高</h2><p><img src="https://cdn.jsdelivr.net/gh/ObjectX-9/DrawingBed/imgMac/%E4%B8%8D%E5%AE%9A%E9%AB%98.gif" alt="2024-05-25 19.40.10.gif"/></p><h2 id="动态高度"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#动态高度"><span class="icon icon-link"></span></a>动态高度</h2><p><img src="https://cdn.jsdelivr.net/gh/ObjectX-9/DrawingBed/imgMac/%E5%8A%A8%E6%80%81%E9%AB%98%E5%BA%A6.gif" alt="2024-05-25 19.40.47.gif"/></p><h1 id="工程化"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#工程化"><span class="icon icon-link"></span></a>工程化</h1><p>本系列是一个从0到1的实现过程，如果您有耐心跟着实现，您可以实现一个完整的<code>react18 + ts5 + webpack5 + 代码质量&amp;代码风格检测&amp;自动修复 + storybook8 + rollup + git action</code>实现的一个完整的组件库模板项目。如果您不打算自己配置，也可以直接clone<a target="_blank" rel="noopener noreferrer" href="https://github.com/ObjectX-9/react_demo">组件库仓库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>切换到<code>rollup_comp</code>分支即是完整的项目，当前实现已经足够个人使用，后续我们会新增webpack5优化、按需加载组件、实现一些常见的组件封装：包括但不限于拖拽排序、瀑布流、穿梭框、弹窗等</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7353504333999505408">【前端工程化】项目搭建篇-项目初始化&amp;prettier、eslint、stylelint、lint-staged、husky<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7353561676091097103">【前端工程化】项目搭建篇-配置changelog、webpack5打包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7353963878541246504">【前端工程化】项目搭建篇-引入react、ts、babel解析es6+、配置css module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7355026320088989733">【前端工程化】组件库搭建篇-引入storybook、rollup打包组件、本地测试组件库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7356175306937466916">【前端工程化】包管理器篇-三大包管理器、npm工程管理、npm发布流程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7356815857078157331">【前端工程化】自动化篇-Github Action基本使用、自动部署组件库文档、github3D指标统计<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7366601730426159144">【前端工程化】自动化篇-手写脚本一键自动tag、发包、引导登录npm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><p><strong>常见组件实现</strong></p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7370513151052021787">【组件实现篇】&quot;从零使用react打造瀑布流的四种方式：完美展示动态图片流&quot;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7372488623944728585">【组件实现篇】定高、不定高、动态高度虚拟列表实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h1 id="一、虚拟列表"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#一、虚拟列表"><span class="icon icon-link"></span></a>一、虚拟列表</h1><h2 id="什么是虚拟列表"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#什么是虚拟列表"><span class="icon icon-link"></span></a>什么是虚拟列表</h2><p><code>虚拟列表</code>其实是按需显示的一种实现，即只对<code>可见区域</code>进行渲染，对<code>非可见区域</code>中的数据不渲染或部分渲染，也就是设置缓冲区，从而达到极高的渲染性能。如下图所示，未滚动的时候上缓冲区是没有的，虚拟列表有三种情况</p><ul><li>定高虚拟列表，每一项的高度固定，可以很容易计算</li><li>不定高虚拟列表，每一项的高度是不固定的，但是我们知道整个列表的高度数组</li><li>动态高度虚拟列表，每一项的高度在渲染时确认</li></ul><p>对于所有虚拟列表而言，我们的实现考虑的都是如何计算出可视区域的节点索引范围，即<code>[startIndex, endIndex]</code>，然后加上缓冲区的大小，将此范围内的节点渲染到容器中，我们最根本的目的是计算起始索引<code>startIndex</code>和终止索引<code>endIndex</code>。<img src="https://cdn.jsdelivr.net/gh/ObjectX-9/DrawingBed/imgMac/image-20240615143123946.png" alt="image-20240615143123946"/></p><h2 id="1定高虚拟列表"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#1定高虚拟列表"><span class="icon icon-link"></span></a>1.定高虚拟列表</h2><h3 id="图示"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#图示"><span class="icon icon-link"></span></a>图示</h3><p><img src="/front_end_engineer_book/static/image-20240615143130304.0b480247.png" alt="image-20240615143130304"/></p><h3 id="原理"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#原理"><span class="icon icon-link"></span></a>原理</h3><p><img src="/front_end_engineer_book/static/image-20240615143138122.b5b8efd8.png" alt="image-20240615143138122"/></p><p>定高是最简单的，<code>itemSize</code>值是固定的我们可以直接求出我们需要的几个值，即如下几个值：</p><ul><li>列表总高度: 列表总高度是用于显示滚动条的</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">totalListHeight </span><span class="token operator" style="color:#393A34" data-200-js-token="=-0-16">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34" data-200-js-token=".-0-22">.</span><span class="token property-access" data-200-js-token="length-0-23">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-200-js-token="*-0-30">*</span><span class="token plain"> itemSize</span></div></pre></div><ul><li>可视区域能显示的item数量: 主要是用于，在计算出<code>startIndex</code>后计算出<code>endIndex</code></li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">visibleAreaItemsNum </span><span class="token operator" style="color:#393A34" data-201-js-token="=-0-20">=</span><span class="token plain"> </span><span class="token known-class-name class-name" data-201-js-token="Math-0-22">Math</span><span class="token punctuation" style="color:#393A34" data-201-js-token=".-0-26">.</span><span class="token method function property-access" style="color:#d73a49" data-201-js-token="ceil-0-27">ceil</span><span class="token punctuation" style="color:#393A34" data-201-js-token="(-0-31">(</span><span class="token plain">listHeight </span><span class="token operator" style="color:#393A34" data-201-js-token="/-0-43">/</span><span class="token plain"> itemSize</span><span class="token punctuation" style="color:#393A34" data-201-js-token=")-0-53">)</span></div></pre></div><ul><li>数据的起始索引: 由于高度固定，起始索引可以根据滚动掉的高度<code>scrollTop</code>直接计算出</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">startIndex </span><span class="token operator" style="color:#393A34" data-202-js-token="=-0-11">=</span><span class="token plain"> </span><span class="token known-class-name class-name" data-202-js-token="Math-0-13">Math</span><span class="token punctuation" style="color:#393A34" data-202-js-token=".-0-17">.</span><span class="token method function property-access" style="color:#d73a49" data-202-js-token="floor-0-18">floor</span><span class="token punctuation" style="color:#393A34" data-202-js-token="(-0-23">(</span><span class="token plain">scrollTop </span><span class="token operator" style="color:#393A34" data-202-js-token="/-0-34">/</span><span class="token plain"> itemSize</span><span class="token punctuation" style="color:#393A34" data-202-js-token=")-0-44">)</span></div></pre></div><ul><li>数据的结束索引: 根据起始索引和可视区域显示的item数，我们可以直接计算出结束索引</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">endIndex </span><span class="token operator" style="color:#393A34" data-203-js-token="=-0-9">=</span><span class="token plain"> startIndex </span><span class="token operator" style="color:#393A34" data-203-js-token="+-0-22">+</span><span class="token plain"> visibleAreaItemsNum</span></div></pre></div><ul><li>列表显示数据为，加上了缓冲区域</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token plain">visibleData </span><span class="token operator" style="color:#393A34" data-204-js-token="=-0-12">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34" data-204-js-token=".-0-18">.</span><span class="token method function property-access" style="color:#d73a49" data-204-js-token="slice-0-19">slice</span><span class="token punctuation" style="color:#393A34" data-204-js-token="(-0-24">(</span><span class="token plain">startIndex </span><span class="token operator" style="color:#393A34" data-204-js-token="--0-36">-</span><span class="token plain"> bufferNum</span><span class="token punctuation" style="color:#393A34" data-204-js-token=",-0-47">,</span><span class="token plain"> endIndex </span><span class="token operator" style="color:#393A34" data-204-js-token="+-0-58">+</span><span class="token plain"> bufferNum</span><span class="token punctuation" style="color:#393A34" data-204-js-token=")-0-69">)</span></div></pre></div><h3 id="实现"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#实现"><span class="icon icon-link"></span></a>实现</h3><h4 id="虚拟列表的基本结构"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#虚拟列表的基本结构"><span class="icon icon-link"></span></a>虚拟列表的基本结构</h4><p><code>fixedHeightContainer</code>容器自定义宽高，<code>contentContainer</code>容器用于撑起滚动条</p><div class="__dumi-default-code-block"><pre class="prism-code language-tsx" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 定高</span><span class="token plain" data-205-tsx-token="-0-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-1-0"></span><span class="token keyword" style="color:#00009f" data-205-tsx-token="const-1-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-205-tsx-token="fixedHeightRender-1-6">fixedHeightRender</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=-1-24">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="(-1-26">(</span><span class="token parameter" data-205-tsx-token="options-1-27">options</span><span class="token parameter operator" style="color:#393A34" data-205-tsx-token=":-1-34">:</span><span class="token parameter"> VirtualListProps</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=")-1-52">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=&gt;-1-54">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="{-1-57">{</span><span class="token plain" data-205-tsx-token="-1-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-2-0">	</span><span class="token keyword" style="color:#00009f" data-205-tsx-token="const-2-1">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="{-2-7">{</span><span class="token plain">itemHeight </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=-2-19">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-205-tsx-token="50-2-21">50</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=",-2-23">,</span><span class="token plain"> itemSumCount </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=-2-38">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-205-tsx-token="1000-2-40">1000</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=",-2-44">,</span><span class="token plain"> listWidth</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=",-2-55">,</span><span class="token plain"> listHeight</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="}-2-67">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=-2-69">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=";-2-78">;</span><span class="token plain" data-205-tsx-token="-2-79"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-3-0">	</span><span class="token comment" style="color:#999988;font-style:italic">// 记录滚动掉的高度</span><span class="token plain" data-205-tsx-token="-3-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-4-0">	</span><span class="token keyword" style="color:#00009f" data-205-tsx-token="const-4-1">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="[-4-7">[</span><span class="token plain" data-205-tsx-token="scrollTop-4-8">scrollTop</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=",-4-17">,</span><span class="token plain"> setScrollTop</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="]-4-31">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=-4-33">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49" data-205-tsx-token="useState-4-35">useState</span><span class="token generic-function generic class-name operator" style="color:#393A34" data-205-tsx-token="&lt;-4-43">&lt;</span><span class="token generic-function generic class-name builtin" data-205-tsx-token="number-4-44">number</span><span class="token generic-function generic class-name operator" style="color:#393A34" data-205-tsx-token="&gt;-4-50">&gt;</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="(-4-51">(</span><span class="token number" style="color:#36acaa" data-205-tsx-token="0-4-52">0</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=")-4-53">)</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=";-4-54">;</span><span class="token plain" data-205-tsx-token="-4-55"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-5-0">	</span><span class="token comment" style="color:#999988;font-style:italic">// 自定义的列表高度</span><span class="token plain" data-205-tsx-token="-5-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-6-0">	</span><span class="token keyword" style="color:#00009f" data-205-tsx-token="const-6-1">const</span><span class="token plain"> customContainerStyle</span><span class="token operator" style="color:#393A34" data-205-tsx-token=":-6-27">:</span><span class="token plain"> </span><span class="token maybe-class-name" data-205-tsx-token="CSSProperties-6-29">CSSProperties</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=-6-43">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="{-6-45">{</span><span class="token plain" data-205-tsx-token="-6-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="position-7-0">		position</span><span class="token operator" style="color:#393A34" data-205-tsx-token=":-7-10">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-205-tsx-token="&#x27;relative&#x27;-7-12">&#x27;relative&#x27;</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=",-7-22">,</span><span class="token plain" data-205-tsx-token="-7-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="width-8-0">		width</span><span class="token operator" style="color:#393A34" data-205-tsx-token=":-8-7">:</span><span class="token plain"> listWidth </span><span class="token operator" style="color:#393A34" data-205-tsx-token="??-8-19">??</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-205-tsx-token="400-8-22">400</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=",-8-25">,</span><span class="token plain" data-205-tsx-token="-8-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="height-9-0">		height</span><span class="token operator" style="color:#393A34" data-205-tsx-token=":-9-8">:</span><span class="token plain"> listHeight </span><span class="token operator" style="color:#393A34" data-205-tsx-token="??-9-21">??</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-205-tsx-token="600-9-24">600</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=",-9-27">,</span><span class="token plain" data-205-tsx-token="-9-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-10-0">	</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="}-10-1">}</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=";-10-2">;</span><span class="token plain" data-205-tsx-token="-10-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-11-0">	</span><span class="token comment" style="color:#999988;font-style:italic">// 1000个元素撑起盒子的实际高度</span><span class="token plain" data-205-tsx-token="-11-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-12-0">	</span><span class="token keyword" style="color:#00009f" data-205-tsx-token="const-12-1">const</span><span class="token plain"> contentStyle</span><span class="token operator" style="color:#393A34" data-205-tsx-token=":-12-19">:</span><span class="token plain"> </span><span class="token maybe-class-name" data-205-tsx-token="CSSProperties-12-21">CSSProperties</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=-12-35">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="{-12-37">{</span><span class="token plain" data-205-tsx-token="-12-38"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="height-13-0">		height</span><span class="token operator" style="color:#393A34" data-205-tsx-token=":-13-8">:</span><span class="token plain"> itemHeight </span><span class="token operator" style="color:#393A34" data-205-tsx-token="*-13-21">*</span><span class="token plain"> itemSumCount</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=",-13-35">,</span><span class="token plain" data-205-tsx-token="-13-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="width-14-0">		width</span><span class="token operator" style="color:#393A34" data-205-tsx-token=":-14-7">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-205-tsx-token="&#x27;100%&#x27;-14-9">&#x27;100%&#x27;</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=",-14-15">,</span><span class="token plain" data-205-tsx-token="-14-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-15-0">	</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="}-15-1">}</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=";-15-2">;</span><span class="token plain" data-205-tsx-token="-15-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-16-0">	</span><span class="token comment" style="color:#999988;font-style:italic">// 当触发滚动就重新计算</span><span class="token plain" data-205-tsx-token="-16-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-17-0">	</span><span class="token keyword" style="color:#00009f" data-205-tsx-token="const-17-1">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-205-tsx-token="scrollHandle-17-7">scrollHandle</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=-17-20">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="(-17-22">(</span><span class="token parameter" data-205-tsx-token="event-17-23">event</span><span class="token parameter operator" style="color:#393A34" data-205-tsx-token=":-17-28">:</span><span class="token parameter"> React</span><span class="token parameter punctuation" style="color:#393A34" data-205-tsx-token=".-17-35">.</span><span class="token parameter" data-205-tsx-token="UIEvent-17-36">UIEvent</span><span class="token parameter operator" style="color:#393A34" data-205-tsx-token="&lt;-17-43">&lt;</span><span class="token parameter" data-205-tsx-token="HTMLElement-17-44">HTMLElement</span><span class="token parameter operator" style="color:#393A34" data-205-tsx-token="&gt;-17-55">&gt;</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=")-17-56">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=&gt;-17-58">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="{-17-61">{</span><span class="token plain" data-205-tsx-token="-17-62"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-18-0">		</span><span class="token keyword" style="color:#00009f" data-205-tsx-token="const-18-2">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="{-18-8">{</span><span class="token plain" data-205-tsx-token="scrollTop-18-9">scrollTop</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="}-18-18">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-205-tsx-token="=-18-20">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=".-18-27">.</span><span class="token plain" data-205-tsx-token="currentTarget-18-28">currentTarget</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=";-18-41">;</span><span class="token plain" data-205-tsx-token="-18-42"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-19-0">		</span><span class="token function" style="color:#d73a49" data-205-tsx-token="setScrollTop-19-2">setScrollTop</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="(-19-14">(</span><span class="token plain" data-205-tsx-token="scrollTop-19-15">scrollTop</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=")-19-24">)</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=";-19-25">;</span><span class="token plain" data-205-tsx-token="-19-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-20-0">	</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="}-20-1">}</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=";-20-2">;</span><span class="token plain" data-205-tsx-token="-20-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-205-tsx-token="-21-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-22-0">	</span><span class="token keyword" style="color:#00009f" data-205-tsx-token="return-22-1">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="(-22-8">(</span><span class="token plain" data-205-tsx-token="-22-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-23-0">		</span><span class="token tag punctuation" style="color:#393A34" data-205-tsx-token="&lt;-23-2">&lt;</span><span class="token tag" style="color:#00009f" data-205-tsx-token="div-23-3">div</span><span class="token tag" style="color:#00009f" data-205-tsx-token="-23-6"></span></div><div class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">                </span><span class="token tag attr-name" style="color:#00a4db" data-205-tsx-token="className-24-16">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34" data-205-tsx-token="=-24-25">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token="{-24-26">{</span><span class="token tag script language-javascript" style="color:#00009f" data-205-tsx-token="style-24-27">style</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token=".-24-32">.</span><span class="token tag script language-javascript" style="color:#00009f" data-205-tsx-token="fixedHeightContainer-24-33">fixedHeightContainer</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token="}-24-53">}</span><span class="token tag" style="color:#00009f" data-205-tsx-token="-24-54"></span></div><div class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">                </span><span class="token tag attr-name" style="color:#00a4db" data-205-tsx-token="style-25-16">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34" data-205-tsx-token="=-25-21">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token="{-25-22">{</span><span class="token tag script language-javascript" style="color:#00009f" data-205-tsx-token="customContainerStyle-25-23">customContainerStyle</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token="}-25-43">}</span><span class="token tag" style="color:#00009f" data-205-tsx-token="-25-44"></span></div><div class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">                </span><span class="token tag attr-name" style="color:#00a4db" data-205-tsx-token="onScroll-26-16">onScroll</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34" data-205-tsx-token="=-26-24">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token="{-26-25">{</span><span class="token tag script language-javascript" style="color:#00009f" data-205-tsx-token="scrollHandle-26-26">scrollHandle</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token="}-26-38">}</span><span class="token tag punctuation" style="color:#393A34" data-205-tsx-token="&gt;-26-39">&gt;</span><span class="token plain" data-205-tsx-token="-26-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34" data-205-tsx-token="&lt;-27-16">&lt;</span><span class="token tag" style="color:#00009f" data-205-tsx-token="div-27-17">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db" data-205-tsx-token="className-27-21">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34" data-205-tsx-token="=-27-30">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token="{-27-31">{</span><span class="token tag script language-javascript" style="color:#00009f" data-205-tsx-token="style-27-32">style</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token=".-27-37">.</span><span class="token tag script language-javascript" style="color:#00009f" data-205-tsx-token="contentContainer-27-38">contentContainer</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token="}-27-54">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db" data-205-tsx-token="style-27-56">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34" data-205-tsx-token="=-27-61">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token="{-27-62">{</span><span class="token tag script language-javascript" style="color:#00009f" data-205-tsx-token="contentStyle-27-63">contentStyle</span><span class="token tag script language-javascript punctuation" style="color:#393A34" data-205-tsx-token="}-27-75">}</span><span class="token tag punctuation" style="color:#393A34" data-205-tsx-token="&gt;-27-76">&gt;</span><span class="token plain" data-205-tsx-token="-27-77"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="{-28-24">{</span><span class="token function" style="color:#d73a49" data-205-tsx-token="getCurShowChild-28-25">getCurShowChild</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="(-28-40">(</span><span class="token plain" data-205-tsx-token="options-28-41">options</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=")-28-48">)</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="}-28-49">}</span><span class="token plain" data-205-tsx-token="-28-50"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34" data-205-tsx-token="&lt;/-29-16">&lt;/</span><span class="token tag" style="color:#00009f" data-205-tsx-token="div-29-18">div</span><span class="token tag punctuation" style="color:#393A34" data-205-tsx-token="&gt;-29-21">&gt;</span><span class="token plain" data-205-tsx-token="-29-22"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-30-0">		</span><span class="token tag punctuation" style="color:#393A34" data-205-tsx-token="&lt;/-30-2">&lt;/</span><span class="token tag" style="color:#00009f" data-205-tsx-token="div-30-4">div</span><span class="token tag punctuation" style="color:#393A34" data-205-tsx-token="&gt;-30-7">&gt;</span><span class="token plain" data-205-tsx-token="-30-8"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-31-0">	</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=")-31-1">)</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=";-31-2">;</span><span class="token plain" data-205-tsx-token="-31-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-205-tsx-token="-32-0"></span><span class="token punctuation" style="color:#393A34" data-205-tsx-token="}-32-0">}</span><span class="token punctuation" style="color:#393A34" data-205-tsx-token=";-32-1">;</span></div></pre></div><h4 id="样式"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#样式"><span class="icon icon-link"></span></a>样式</h4><div class="__dumi-default-code-block"><pre class="prism-code language-less" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token selector" style="color:#00009f" data-206-less-token=".fixedHeightContainer-0-0">.fixedHeightContainer</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-206-less-token="{-0-22">{</span><span class="token plain" data-206-less-token="-0-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-206-less-token="-1-0">	</span><span class="token property" style="color:#36acaa" data-206-less-token="display-1-1">display</span><span class="token punctuation" style="color:#393A34" data-206-less-token=":-1-8">:</span><span class="token plain"> block</span><span class="token punctuation" style="color:#393A34" data-206-less-token=";-1-15">;</span><span class="token plain" data-206-less-token="-1-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-206-less-token="-2-0">	</span><span class="token property" style="color:#36acaa" data-206-less-token="width-2-1">width</span><span class="token punctuation" style="color:#393A34" data-206-less-token=":-2-6">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-206-less-token="400-2-8">400</span><span class="token unit" data-206-less-token="px-2-11">px</span><span class="token punctuation" style="color:#393A34" data-206-less-token=";-2-13">;</span><span class="token plain" data-206-less-token="-2-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-206-less-token="-3-0">	</span><span class="token property" style="color:#36acaa" data-206-less-token="height-3-1">height</span><span class="token punctuation" style="color:#393A34" data-206-less-token=":-3-7">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-206-less-token="600-3-9">600</span><span class="token unit" data-206-less-token="px-3-12">px</span><span class="token punctuation" style="color:#393A34" data-206-less-token=";-3-14">;</span><span class="token plain" data-206-less-token="-3-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-206-less-token="-4-0">	</span><span class="token property" style="color:#36acaa" data-206-less-token="overflow-4-1">overflow</span><span class="token punctuation" style="color:#393A34" data-206-less-token=":-4-9">:</span><span class="token plain"> auto</span><span class="token punctuation" style="color:#393A34" data-206-less-token=";-4-15">;</span><span class="token plain" data-206-less-token="-4-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-206-less-token="-5-0">	</span><span class="token property" style="color:#36acaa" data-206-less-token="border-5-1">border</span><span class="token punctuation" style="color:#393A34" data-206-less-token=":-5-7">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-206-less-token="1-5-9">1</span><span class="token unit" data-206-less-token="px-5-10">px</span><span class="token plain"> solid </span><span class="token color" data-206-less-token="tan-5-19">tan</span><span class="token punctuation" style="color:#393A34" data-206-less-token=";-5-22">;</span><span class="token plain" data-206-less-token="-5-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-206-less-token="-6-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-206-less-token="-7-0">	</span><span class="token selector" style="color:#00009f" data-206-less-token=".contentContainer-7-1">.contentContainer</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-206-less-token="{-7-19">{</span><span class="token plain" data-206-less-token="-7-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-206-less-token="-8-0">		</span><span class="token property" style="color:#36acaa" data-206-less-token="display-8-2">display</span><span class="token punctuation" style="color:#393A34" data-206-less-token=":-8-9">:</span><span class="token plain"> block</span><span class="token punctuation" style="color:#393A34" data-206-less-token=";-8-16">;</span><span class="token plain" data-206-less-token="-8-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-206-less-token="-9-0">	</span><span class="token punctuation" style="color:#393A34" data-206-less-token="}-9-1">}</span><span class="token plain" data-206-less-token="-9-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-206-less-token="-10-0"></span><span class="token punctuation" style="color:#393A34" data-206-less-token="}-10-0">}</span></div></pre></div><h4 id="实现核心方法"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#实现核心方法"><span class="icon icon-link"></span></a>实现核心方法</h4><p>解释都在注释中，就是实现原理中的描述，纯计算</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-207-js-token="const-0-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-207-js-token="getCurShowChild-0-6">getCurShowChild</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-207-js-token="=-0-22">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-207-js-token="(-0-24">(</span><span class="token parameter" data-207-js-token="options-0-25">options</span><span class="token parameter operator" style="color:#393A34" data-207-js-token=":-0-32">:</span><span class="token parameter"> VirtualListProps</span><span class="token punctuation" style="color:#393A34" data-207-js-token=")-0-50">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-207-js-token="=&gt;-0-52">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-207-js-token="{-0-55">{</span><span class="token plain" data-207-js-token="-0-56"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-207-js-token="const-1-4">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-207-js-token="{-1-10">{</span><span class="token plain">itemHeight </span><span class="token operator" style="color:#393A34" data-207-js-token="=-1-22">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-207-js-token="50-1-24">50</span><span class="token punctuation" style="color:#393A34" data-207-js-token=",-1-26">,</span><span class="token plain"> itemSumCount </span><span class="token operator" style="color:#393A34" data-207-js-token="=-1-41">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-207-js-token="1000-1-43">1000</span><span class="token punctuation" style="color:#393A34" data-207-js-token=",-1-47">,</span><span class="token plain"> listHeight </span><span class="token operator" style="color:#393A34" data-207-js-token="=-1-60">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-207-js-token="600-1-62">600</span><span class="token punctuation" style="color:#393A34" data-207-js-token="}-1-65">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-207-js-token="=-1-67">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-1-76">;</span><span class="token plain" data-207-js-token="-1-77"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 可视区起始索引</span><span class="token plain" data-207-js-token="-2-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-207-js-token="const-3-4">const</span><span class="token plain"> startIndex </span><span class="token operator" style="color:#393A34" data-207-js-token="=-3-21">=</span><span class="token plain"> </span><span class="token known-class-name class-name" data-207-js-token="Math-3-23">Math</span><span class="token punctuation" style="color:#393A34" data-207-js-token=".-3-27">.</span><span class="token method function property-access" style="color:#d73a49" data-207-js-token="floor-3-28">floor</span><span class="token punctuation" style="color:#393A34" data-207-js-token="(-3-33">(</span><span class="token plain">scrollTop </span><span class="token operator" style="color:#393A34" data-207-js-token="/-3-44">/</span><span class="token plain"> itemHeight</span><span class="token punctuation" style="color:#393A34" data-207-js-token=")-3-56">)</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-3-57">;</span><span class="token plain" data-207-js-token="-3-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 上缓冲区起始索引</span><span class="token plain" data-207-js-token="-4-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-207-js-token="const-5-4">const</span><span class="token plain"> finialStartIndex </span><span class="token operator" style="color:#393A34" data-207-js-token="=-5-27">=</span><span class="token plain"> </span><span class="token known-class-name class-name" data-207-js-token="Math-5-29">Math</span><span class="token punctuation" style="color:#393A34" data-207-js-token=".-5-33">.</span><span class="token method function property-access" style="color:#d73a49" data-207-js-token="max-5-34">max</span><span class="token punctuation" style="color:#393A34" data-207-js-token="(-5-37">(</span><span class="token number" style="color:#36acaa" data-207-js-token="0-5-38">0</span><span class="token punctuation" style="color:#393A34" data-207-js-token=",-5-39">,</span><span class="token plain"> startIndex </span><span class="token operator" style="color:#393A34" data-207-js-token="--5-52">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-207-js-token="2-5-54">2</span><span class="token punctuation" style="color:#393A34" data-207-js-token=")-5-55">)</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-5-56">;</span><span class="token plain" data-207-js-token="-5-57"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 可视区能展示的元素的最大个数</span><span class="token plain" data-207-js-token="-6-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-207-js-token="const-7-4">const</span><span class="token plain"> numVisible </span><span class="token operator" style="color:#393A34" data-207-js-token="=-7-21">=</span><span class="token plain"> </span><span class="token known-class-name class-name" data-207-js-token="Math-7-23">Math</span><span class="token punctuation" style="color:#393A34" data-207-js-token=".-7-27">.</span><span class="token method function property-access" style="color:#d73a49" data-207-js-token="ceil-7-28">ceil</span><span class="token punctuation" style="color:#393A34" data-207-js-token="(-7-32">(</span><span class="token plain">listHeight </span><span class="token operator" style="color:#393A34" data-207-js-token="/-7-44">/</span><span class="token plain"> itemHeight</span><span class="token punctuation" style="color:#393A34" data-207-js-token=")-7-56">)</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-7-57">;</span><span class="token plain" data-207-js-token="-7-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 下缓冲区结束索引</span><span class="token plain" data-207-js-token="-8-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-207-js-token="const-9-4">const</span><span class="token plain"> finialEndIndex </span><span class="token operator" style="color:#393A34" data-207-js-token="=-9-25">=</span><span class="token plain"> </span><span class="token known-class-name class-name" data-207-js-token="Math-9-27">Math</span><span class="token punctuation" style="color:#393A34" data-207-js-token=".-9-31">.</span><span class="token method function property-access" style="color:#d73a49" data-207-js-token="min-9-32">min</span><span class="token punctuation" style="color:#393A34" data-207-js-token="(-9-35">(</span><span class="token plain" data-207-js-token="itemSumCount-9-36">itemSumCount</span><span class="token punctuation" style="color:#393A34" data-207-js-token=",-9-48">,</span><span class="token plain"> startIndex </span><span class="token operator" style="color:#393A34" data-207-js-token="+-9-61">+</span><span class="token plain"> numVisible </span><span class="token operator" style="color:#393A34" data-207-js-token="+-9-74">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-207-js-token="2-9-76">2</span><span class="token punctuation" style="color:#393A34" data-207-js-token=")-9-77">)</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-9-78">;</span><span class="token plain" data-207-js-token="-9-79"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-207-js-token="const-10-4">const</span><span class="token plain"> items </span><span class="token operator" style="color:#393A34" data-207-js-token="=-10-16">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-207-js-token="[-10-18">[</span><span class="token punctuation" style="color:#393A34" data-207-js-token="]-10-19">]</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-10-20">;</span><span class="token plain" data-207-js-token="-10-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 根据上面计算的索引值，不断添加元素给container</span><span class="token plain" data-207-js-token="-11-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-207-js-token="for-12-4">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-207-js-token="(-12-8">(</span><span class="token keyword" style="color:#00009f" data-207-js-token="let-12-9">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-207-js-token="=-12-15">=</span><span class="token plain"> finialStartIndex</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-12-33">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-207-js-token="&lt;-12-37">&lt;</span><span class="token plain"> finialEndIndex</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-12-53">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34" data-207-js-token="++-12-56">++</span><span class="token punctuation" style="color:#393A34" data-207-js-token=")-12-58">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-207-js-token="{-12-60">{</span><span class="token plain" data-207-js-token="-12-61"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            items</span><span class="token punctuation" style="color:#393A34" data-207-js-token=".-13-17">.</span><span class="token method function property-access" style="color:#d73a49" data-207-js-token="push-13-18">push</span><span class="token punctuation" style="color:#393A34" data-207-js-token="(-13-22">(</span><span class="token plain" data-207-js-token="-13-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function maybe-class-name" style="color:#d73a49" data-207-js-token="ChildItem-14-20">ChildItem</span><span class="token punctuation" style="color:#393A34" data-207-js-token="(-14-29">(</span><span class="token punctuation" style="color:#393A34" data-207-js-token="{-14-30">{</span><span class="token plain" data-207-js-token="-14-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            childHeight</span><span class="token operator" style="color:#393A34" data-207-js-token=":-15-39">:</span><span class="token plain"> itemHeight</span><span class="token punctuation" style="color:#393A34" data-207-js-token=",-15-51">,</span><span class="token plain" data-207-js-token="-15-52"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            childIndex</span><span class="token operator" style="color:#393A34" data-207-js-token=":-16-38">:</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34" data-207-js-token=",-16-41">,</span><span class="token plain" data-207-js-token="-16-42"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34" data-207-js-token="}-17-20">}</span><span class="token punctuation" style="color:#393A34" data-207-js-token=")-17-21">)</span><span class="token punctuation" style="color:#393A34" data-207-js-token=",-17-22">,</span><span class="token plain" data-207-js-token="-17-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-207-js-token=")-18-12">)</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-18-13">;</span><span class="token plain" data-207-js-token="-18-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-207-js-token="}-19-4">}</span><span class="token plain" data-207-js-token="-19-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-207-js-token="return-20-4">return</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-20-16">;</span><span class="token plain" data-207-js-token="-20-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-207-js-token="-21-0"></span><span class="token punctuation" style="color:#393A34" data-207-js-token="}-21-0">}</span><span class="token punctuation" style="color:#393A34" data-207-js-token=";-21-1">;</span></div></pre></div><h3 id="效果"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#效果"><span class="icon icon-link"></span></a>效果</h3><p><a target="_blank" rel="noopener noreferrer" href="https://zhuling904.github.io/react_demo/?path=/story/%E9%80%9A%E7%94%A8-virtuallist%E8%99%9A%E6%8B%9F%E5%88%97%E8%A1%A8--fixed-height">在线demo体验<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><img src="https://cdn.jsdelivr.net/gh/ObjectX-9/DrawingBed/imgMac/%E5%AE%9A%E9%AB%98.gif" alt="2024-05-25 19.39.29.gif"/></p><h2 id="2不定高虚拟列表"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#2不定高虚拟列表"><span class="icon icon-link"></span></a>2.不定高虚拟列表</h2><h3 id="图示-1"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#图示-1"><span class="icon icon-link"></span></a>图示</h3><p>因为每一项的高度不固定，所以我们需要的<code>startIndex</code>和<code>visibleAreaItemsNum</code>无法直接根据项目高度直接计算出来，也就意味着<code>endIndex</code>我们也计算不出来</p><p><img src="/front_end_engineer_book/static/image-20240615143310445.0e4935f7.png" alt="image-20240615143310445"/></p><h3 id="原理-1"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#原理-1"><span class="icon icon-link"></span></a>原理</h3><p><strong>我们有什么？</strong></p><ul><li>一个包含所有容器高度的高度列表？</li></ul><p><strong>知道这个能做什么？</strong></p><ul><li>可以知道总容器的高度</li></ul><p><strong>我们需要什么？</strong></p><ul><li>第一：可视区域：我们的目标仍然是如何计算出可视区域的节点索引范围，即<code>[startIndex, endIndex]</code>，然后加上缓冲区的大小，将此范围内的节点渲染到容器中，我们最根本的目的是计算起始索引<code>startIndex</code>和终止索引<code>endIndex</code>。</li><li>第二：容器的总高度：我们无需精确计算全部数据容器到底有多高，需要需要这个是、是因为需要滚动条，滚动区域。我们可以简单给出一个粗略的高度</li></ul><p><strong>如何计算</strong>我们可以设计一个数据结构保存已经展示过的item的高度，偏移值信息如下，这样我们就可以计算出起始索引，终止索引了</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 每一项的数据结构</span><span class="token plain" data-208-js-token="-0-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="-1-0"></span><span class="token keyword" style="color:#00009f" data-208-js-token="interface-1-0">interface</span><span class="token plain"> </span><span class="token class-name" data-208-js-token="MeasuredDataMap-1-10">MeasuredDataMap</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-208-js-token="{-1-26">{</span><span class="token plain" data-208-js-token="-1-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="height-2-0">	height</span><span class="token operator" style="color:#393A34" data-208-js-token=":-2-7">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34" data-208-js-token=";-2-15">;</span><span class="token plain" data-208-js-token="-2-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="topOffset-3-0">	topOffset</span><span class="token operator" style="color:#393A34" data-208-js-token=":-3-10">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34" data-208-js-token=";-3-18">;</span><span class="token plain" data-208-js-token="-3-19"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="-4-0"></span><span class="token punctuation" style="color:#393A34" data-208-js-token="}-4-0">}</span><span class="token plain" data-208-js-token="-4-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-208-js-token="-5-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="-6-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 缓存映射的数据结构</span><span class="token plain" data-208-js-token="-6-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="-7-0"></span><span class="token keyword" style="color:#00009f" data-208-js-token="interface-7-0">interface</span><span class="token plain"> </span><span class="token class-name" data-208-js-token="MeasuredDataList-7-10">MeasuredDataList</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-208-js-token="{-7-27">{</span><span class="token plain" data-208-js-token="-7-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="measuredDataMap-8-0">	measuredDataMap</span><span class="token operator" style="color:#393A34" data-208-js-token=":-8-16">:</span><span class="token plain"> </span><span class="token maybe-class-name" data-208-js-token="MeasuredDataMap-8-18">MeasuredDataMap</span><span class="token punctuation" style="color:#393A34" data-208-js-token="[-8-33">[</span><span class="token punctuation" style="color:#393A34" data-208-js-token="]-8-34">]</span><span class="token punctuation" style="color:#393A34" data-208-js-token=";-8-35">;</span><span class="token plain" data-208-js-token="-8-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 当前已经记录的最后一个index</span><span class="token plain" data-208-js-token="-9-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="-10-0">	</span><span class="token maybe-class-name" data-208-js-token="LastMeasuredItemIndex-10-1">LastMeasuredItemIndex</span><span class="token operator" style="color:#393A34" data-208-js-token=":-10-22">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34" data-208-js-token=";-10-30">;</span><span class="token plain" data-208-js-token="-10-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="-11-0"></span><span class="token punctuation" style="color:#393A34" data-208-js-token="}-11-0">}</span><span class="token plain" data-208-js-token="-11-1"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-208-js-token="-12-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="-13-0"></span><span class="token keyword" style="color:#00009f" data-208-js-token="const-13-0">const</span><span class="token plain"> measuredData</span><span class="token operator" style="color:#393A34" data-208-js-token=":-13-18">:</span><span class="token plain"> </span><span class="token maybe-class-name" data-208-js-token="MeasuredDataList-13-20">MeasuredDataList</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-208-js-token="=-13-37">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-208-js-token="{-13-39">{</span><span class="token plain" data-208-js-token="-13-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        measuredDataMap</span><span class="token operator" style="color:#393A34" data-208-js-token=":-14-23">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-208-js-token="[-14-25">[</span><span class="token punctuation" style="color:#393A34" data-208-js-token="]-14-26">]</span><span class="token punctuation" style="color:#393A34" data-208-js-token=",-14-27">,</span><span class="token plain" data-208-js-token="-14-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name" data-208-js-token="LastMeasuredItemIndex-15-8">LastMeasuredItemIndex</span><span class="token operator" style="color:#393A34" data-208-js-token=":-15-29">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-208-js-token="--15-31">-</span><span class="token number" style="color:#36acaa" data-208-js-token="1-15-32">1</span><span class="token punctuation" style="color:#393A34" data-208-js-token=",-15-33">,</span><span class="token plain" data-208-js-token="-15-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-208-js-token="-16-0"></span><span class="token punctuation" style="color:#393A34" data-208-js-token="}-16-0">}</span><span class="token punctuation" style="color:#393A34" data-208-js-token=";-16-1">;</span></div></pre></div><p><img src="/front_end_engineer_book/static/image-20240615143316122.f2269382.png" alt="image-20240615143316122"/></p><ul><li>预测列表总高度: 我们无需获取精确的全部数量的容器高度，仅需要通过当前已记录的总高度+当前未记录的总高度，预估列表总高度</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-209-js-token="const-0-0">const</span><span class="token plain"> totalEstimatedHeight </span><span class="token operator" style="color:#393A34" data-209-js-token="=-0-27">=</span><span class="token plain" data-209-js-token="-0-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">			measuredHeight </span><span class="token operator" style="color:#393A34" data-209-js-token="+-1-18">+</span><span class="token plain"> unMeasuredItemsCount </span><span class="token operator" style="color:#393A34" data-209-js-token="*-1-41">*</span><span class="token plain"> defaultItemHeight</span><span class="token punctuation" style="color:#393A34" data-209-js-token=";-1-60">;</span></div></pre></div><ul><li>最大索引偏移值: 现在我们无法通过列表项高度直接算出，但是我们可以通过起始项的偏移值加上列表的总高度，计算出最大偏移值，从而计算出结束索引。</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-210-js-token="const-0-0">const</span><span class="token plain"> maxOffset </span><span class="token operator" style="color:#393A34" data-210-js-token="=-0-16">=</span><span class="token plain"> startItem</span><span class="token punctuation" style="color:#393A34" data-210-js-token=".-0-27">.</span><span class="token property-access" data-210-js-token="topOffset-0-28">topOffset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-210-js-token="+-0-38">+</span><span class="token plain"> listHeight</span><span class="token punctuation" style="color:#393A34" data-210-js-token=";-0-50">;</span></div></pre></div><ul><li>数据的起始索引: 我们可以通过二分法在已经记录的项中找到<code>topOffset &gt;= srcollTop</code>的项就是第一项</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-211-js-token="const-0-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-211-js-token="getStartIndex-0-6">getStartIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-211-js-token="=-0-20">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-211-js-token="(-0-22">(</span><span class="token parameter" data-211-js-token="options-0-23">options</span><span class="token parameter operator" style="color:#393A34" data-211-js-token=":-0-30">:</span><span class="token parameter"> VirtualListProps</span><span class="token parameter punctuation" style="color:#393A34" data-211-js-token=",-0-48">,</span><span class="token parameter"> scrollOffset</span><span class="token parameter operator" style="color:#393A34" data-211-js-token=":-0-62">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34" data-211-js-token=")-0-70">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-211-js-token="=&gt;-0-72">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-211-js-token="{-0-75">{</span><span class="token plain" data-211-js-token="-0-76"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-211-js-token="const-1-4">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-211-js-token="{-1-10">{</span><span class="token plain">itemSumCount </span><span class="token operator" style="color:#393A34" data-211-js-token="=-1-24">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-211-js-token="1000-1-26">1000</span><span class="token punctuation" style="color:#393A34" data-211-js-token="}-1-30">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-211-js-token="=-1-32">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34" data-211-js-token=";-1-41">;</span><span class="token plain" data-211-js-token="-1-42"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-211-js-token="let-2-4">let</span><span class="token plain"> low </span><span class="token operator" style="color:#393A34" data-211-js-token="=-2-12">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-211-js-token="0-2-14">0</span><span class="token punctuation" style="color:#393A34" data-211-js-token=";-2-15">;</span><span class="token plain" data-211-js-token="-2-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-211-js-token="let-3-4">let</span><span class="token plain"> high </span><span class="token operator" style="color:#393A34" data-211-js-token="=-3-13">=</span><span class="token plain"> itemSumCount </span><span class="token operator" style="color:#393A34" data-211-js-token="--3-28">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-211-js-token="1-3-30">1</span><span class="token punctuation" style="color:#393A34" data-211-js-token=";-3-31">;</span><span class="token plain" data-211-js-token="-3-32"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-211-js-token="-4-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-211-js-token="while-5-4">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-211-js-token="(-5-10">(</span><span class="token plain">low </span><span class="token operator" style="color:#393A34" data-211-js-token="&lt;=-5-15">&lt;=</span><span class="token plain"> high</span><span class="token punctuation" style="color:#393A34" data-211-js-token=")-5-22">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-211-js-token="{-5-24">{</span><span class="token plain" data-211-js-token="-5-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-211-js-token="const-6-12">const</span><span class="token plain"> mid </span><span class="token operator" style="color:#393A34" data-211-js-token="=-6-22">=</span><span class="token plain"> </span><span class="token known-class-name class-name" data-211-js-token="Math-6-24">Math</span><span class="token punctuation" style="color:#393A34" data-211-js-token=".-6-28">.</span><span class="token method function property-access" style="color:#d73a49" data-211-js-token="floor-6-29">floor</span><span class="token punctuation" style="color:#393A34" data-211-js-token="(-6-34">(</span><span class="token punctuation" style="color:#393A34" data-211-js-token="(-6-35">(</span><span class="token plain">low </span><span class="token operator" style="color:#393A34" data-211-js-token="+-6-40">+</span><span class="token plain"> high</span><span class="token punctuation" style="color:#393A34" data-211-js-token=")-6-46">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-211-js-token="/-6-48">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-211-js-token="2-6-50">2</span><span class="token punctuation" style="color:#393A34" data-211-js-token=")-6-51">)</span><span class="token punctuation" style="color:#393A34" data-211-js-token=";-6-52">;</span><span class="token plain" data-211-js-token="-6-53"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-211-js-token="const-7-12">const</span><span class="token plain"> currentOffset </span><span class="token operator" style="color:#393A34" data-211-js-token="=-7-32">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-211-js-token="getItemMetaData-7-34">getItemMetaData</span><span class="token punctuation" style="color:#393A34" data-211-js-token="(-7-49">(</span><span class="token plain" data-211-js-token="mid-7-50">mid</span><span class="token punctuation" style="color:#393A34" data-211-js-token=")-7-53">)</span><span class="token punctuation" style="color:#393A34" data-211-js-token=".-7-54">.</span><span class="token property-access" data-211-js-token="topOffset-7-55">topOffset</span><span class="token punctuation" style="color:#393A34" data-211-js-token=";-7-64">;</span><span class="token plain" data-211-js-token="-7-65"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f" data-211-js-token="if-8-12">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-211-js-token="(-8-15">(</span><span class="token plain">currentOffset </span><span class="token operator" style="color:#393A34" data-211-js-token="===-8-30">===</span><span class="token plain"> scrollOffset</span><span class="token punctuation" style="color:#393A34" data-211-js-token=")-8-46">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-211-js-token="{-8-48">{</span><span class="token plain" data-211-js-token="-8-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:#00009f" data-211-js-token="return-9-20">return</span><span class="token plain"> mid</span><span class="token punctuation" style="color:#393A34" data-211-js-token=";-9-30">;</span><span class="token plain" data-211-js-token="-9-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-211-js-token="}-10-12">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-211-js-token="else-10-14">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-211-js-token="if-10-19">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-211-js-token="(-10-22">(</span><span class="token plain">currentOffset </span><span class="token operator" style="color:#393A34" data-211-js-token="&lt;-10-37">&lt;</span><span class="token plain"> scrollOffset</span><span class="token punctuation" style="color:#393A34" data-211-js-token=")-10-51">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-211-js-token="{-10-53">{</span><span class="token plain" data-211-js-token="-10-54"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    low </span><span class="token operator" style="color:#393A34" data-211-js-token="=-11-24">=</span><span class="token plain"> mid </span><span class="token operator" style="color:#393A34" data-211-js-token="+-11-30">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-211-js-token="1-11-32">1</span><span class="token punctuation" style="color:#393A34" data-211-js-token=";-11-33">;</span><span class="token plain" data-211-js-token="-11-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-211-js-token="}-12-12">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-211-js-token="else-12-14">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-211-js-token="{-12-19">{</span><span class="token plain" data-211-js-token="-12-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    high </span><span class="token operator" style="color:#393A34" data-211-js-token="=-13-25">=</span><span class="token plain"> mid </span><span class="token operator" style="color:#393A34" data-211-js-token="--13-31">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-211-js-token="1-13-33">1</span><span class="token punctuation" style="color:#393A34" data-211-js-token=";-13-34">;</span><span class="token plain" data-211-js-token="-13-35"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-211-js-token="}-14-12">}</span><span class="token plain" data-211-js-token="-14-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-211-js-token="}-15-4">}</span><span class="token plain" data-211-js-token="-15-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-211-js-token="return-16-4">return</span><span class="token plain"> low</span><span class="token punctuation" style="color:#393A34" data-211-js-token=";-16-14">;</span><span class="token plain" data-211-js-token="-16-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-211-js-token="-17-0"></span><span class="token punctuation" style="color:#393A34" data-211-js-token="}-17-0">}</span><span class="token punctuation" style="color:#393A34" data-211-js-token=";-17-1">;</span></div></pre></div><ul><li>数据的结束索引: 从<code>startItem</code>一直遍历加上每一项的<code>height</code>，直到<code>topOffset &gt;= maxOffset</code>，就是结束项的索引</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 查找终止索引：通过起始item的topOffset+自定义的listHeight可以计算出当前能显示的最大偏移值maxOffset</span><span class="token plain" data-212-js-token="-0-68"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-212-js-token="-1-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 从startItem一直遍历加上height，直到offset &gt;= maxOffset</span><span class="token plain" data-212-js-token="-1-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-212-js-token="-2-0"></span><span class="token keyword" style="color:#00009f" data-212-js-token="const-2-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-212-js-token="getEndIndex-2-6">getEndIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-212-js-token="=-2-18">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-212-js-token="(-2-20">(</span><span class="token parameter" data-212-js-token="options-2-21">options</span><span class="token parameter operator" style="color:#393A34" data-212-js-token=":-2-28">:</span><span class="token parameter"> VirtualListProps</span><span class="token parameter punctuation" style="color:#393A34" data-212-js-token=",-2-46">,</span><span class="token parameter"> startIndex</span><span class="token parameter operator" style="color:#393A34" data-212-js-token=":-2-58">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34" data-212-js-token=")-2-66">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-212-js-token="=&gt;-2-68">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-212-js-token="{-2-71">{</span><span class="token plain" data-212-js-token="-2-72"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-212-js-token="const-3-4">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-212-js-token="{-3-10">{</span><span class="token plain">listHeight </span><span class="token operator" style="color:#393A34" data-212-js-token="=-3-22">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-212-js-token="600-3-24">600</span><span class="token punctuation" style="color:#393A34" data-212-js-token=",-3-27">,</span><span class="token plain"> itemSumCount </span><span class="token operator" style="color:#393A34" data-212-js-token="=-3-42">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-212-js-token="1000-3-44">1000</span><span class="token punctuation" style="color:#393A34" data-212-js-token="}-3-48">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-212-js-token="=-3-50">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34" data-212-js-token=";-3-59">;</span><span class="token plain" data-212-js-token="-3-60"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-212-js-token="const-4-4">const</span><span class="token plain"> startItem </span><span class="token operator" style="color:#393A34" data-212-js-token="=-4-20">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-212-js-token="getItemMetaData-4-22">getItemMetaData</span><span class="token punctuation" style="color:#393A34" data-212-js-token="(-4-37">(</span><span class="token plain" data-212-js-token="startIndex-4-38">startIndex</span><span class="token punctuation" style="color:#393A34" data-212-js-token=")-4-48">)</span><span class="token punctuation" style="color:#393A34" data-212-js-token=";-4-49">;</span><span class="token plain" data-212-js-token="-4-50"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-212-js-token="const-5-4">const</span><span class="token plain"> maxOffset </span><span class="token operator" style="color:#393A34" data-212-js-token="=-5-20">=</span><span class="token plain"> startItem</span><span class="token punctuation" style="color:#393A34" data-212-js-token=".-5-31">.</span><span class="token property-access" data-212-js-token="topOffset-5-32">topOffset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-212-js-token="+-5-42">+</span><span class="token plain"> listHeight</span><span class="token punctuation" style="color:#393A34" data-212-js-token=";-5-54">;</span><span class="token plain" data-212-js-token="-5-55"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-212-js-token="let-6-4">let</span><span class="token plain"> offset </span><span class="token operator" style="color:#393A34" data-212-js-token="=-6-15">=</span><span class="token plain"> startItem</span><span class="token punctuation" style="color:#393A34" data-212-js-token=".-6-26">.</span><span class="token property-access" data-212-js-token="topOffset-6-27">topOffset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-212-js-token="+-6-37">+</span><span class="token plain"> startItem</span><span class="token punctuation" style="color:#393A34" data-212-js-token=".-6-48">.</span><span class="token property-access" data-212-js-token="height-6-49">height</span><span class="token punctuation" style="color:#393A34" data-212-js-token=";-6-55">;</span><span class="token plain" data-212-js-token="-6-56"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-212-js-token="let-7-4">let</span><span class="token plain"> endIndex </span><span class="token operator" style="color:#393A34" data-212-js-token="=-7-17">=</span><span class="token plain"> startIndex</span><span class="token punctuation" style="color:#393A34" data-212-js-token=";-7-29">;</span><span class="token plain" data-212-js-token="-7-30"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-212-js-token="-8-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-212-js-token="while-9-4">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-212-js-token="(-9-10">(</span><span class="token plain">offset </span><span class="token operator" style="color:#393A34" data-212-js-token="&lt;=-9-18">&lt;=</span><span class="token plain"> maxOffset </span><span class="token operator" style="color:#393A34" data-212-js-token="&amp;&amp;-9-31">&amp;&amp;</span><span class="token plain"> endIndex </span><span class="token operator" style="color:#393A34" data-212-js-token="&lt;-9-43">&lt;</span><span class="token plain"> itemSumCount </span><span class="token operator" style="color:#393A34" data-212-js-token="--9-58">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-212-js-token="1-9-60">1</span><span class="token punctuation" style="color:#393A34" data-212-js-token=")-9-61">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-212-js-token="{-9-63">{</span><span class="token plain" data-212-js-token="-9-64"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            endIndex</span><span class="token operator" style="color:#393A34" data-212-js-token="++-10-20">++</span><span class="token punctuation" style="color:#393A34" data-212-js-token=";-10-22">;</span><span class="token plain" data-212-js-token="-10-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-212-js-token="const-11-12">const</span><span class="token plain"> currentItem </span><span class="token operator" style="color:#393A34" data-212-js-token="=-11-30">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-212-js-token="getItemMetaData-11-32">getItemMetaData</span><span class="token punctuation" style="color:#393A34" data-212-js-token="(-11-47">(</span><span class="token plain" data-212-js-token="endIndex-11-48">endIndex</span><span class="token punctuation" style="color:#393A34" data-212-js-token=")-11-56">)</span><span class="token punctuation" style="color:#393A34" data-212-js-token=";-11-57">;</span><span class="token plain" data-212-js-token="-11-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            offset </span><span class="token operator" style="color:#393A34" data-212-js-token="+=-12-19">+=</span><span class="token plain"> currentItem</span><span class="token punctuation" style="color:#393A34" data-212-js-token=".-12-33">.</span><span class="token property-access" data-212-js-token="height-12-34">height</span><span class="token punctuation" style="color:#393A34" data-212-js-token=";-12-40">;</span><span class="token plain" data-212-js-token="-12-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-212-js-token="}-13-4">}</span><span class="token plain" data-212-js-token="-13-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-212-js-token="return-14-4">return</span><span class="token plain"> endIndex</span><span class="token punctuation" style="color:#393A34" data-212-js-token=";-14-19">;</span><span class="token plain" data-212-js-token="-14-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-212-js-token="-15-0"></span><span class="token punctuation" style="color:#393A34" data-212-js-token="}-15-0">}</span><span class="token punctuation" style="color:#393A34" data-212-js-token=";-15-1">;</span></div></pre></div><h3 id="实现-1"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#实现-1"><span class="icon icon-link"></span></a>实现</h3><h4 id="定义缓存数据结构"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#定义缓存数据结构"><span class="icon icon-link"></span></a>定义缓存数据结构</h4><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 使用useRef保存itemHeightList，确保在组件生命周期内不变</span><span class="token plain" data-213-js-token="-0-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-213-js-token="-1-0"></span><span class="token keyword" style="color:#00009f" data-213-js-token="const-1-0">const</span><span class="token plain"> itemHeightListRef </span><span class="token operator" style="color:#393A34" data-213-js-token="=-1-24">=</span><span class="token plain"> useRef</span><span class="token operator" style="color:#393A34" data-213-js-token="&lt;-1-32">&lt;</span><span class="token plain" data-213-js-token="number-1-33">number</span><span class="token punctuation" style="color:#393A34" data-213-js-token="[-1-39">[</span><span class="token punctuation" style="color:#393A34" data-213-js-token="]-1-40">]</span><span class="token operator" style="color:#393A34" data-213-js-token="&gt;-1-41">&gt;</span><span class="token punctuation" style="color:#393A34" data-213-js-token="(-1-42">(</span><span class="token plain" data-213-js-token="-1-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-213-js-token="new-2-8">new</span><span class="token plain"> </span><span class="token class-name" data-213-js-token="Array-2-12">Array</span><span class="token punctuation" style="color:#393A34" data-213-js-token="(-2-17">(</span><span class="token plain" data-213-js-token="itemSumCount-2-18">itemSumCount</span><span class="token punctuation" style="color:#393A34" data-213-js-token=")-2-30">)</span><span class="token punctuation" style="color:#393A34" data-213-js-token=".-2-31">.</span><span class="token method function property-access" style="color:#d73a49" data-213-js-token="fill-2-32">fill</span><span class="token punctuation" style="color:#393A34" data-213-js-token="(-2-36">(</span><span class="token number" style="color:#36acaa" data-213-js-token="0-2-37">0</span><span class="token punctuation" style="color:#393A34" data-213-js-token=")-2-38">)</span><span class="token punctuation" style="color:#393A34" data-213-js-token=".-2-39">.</span><span class="token method function property-access" style="color:#d73a49" data-213-js-token="map-2-40">map</span><span class="token punctuation" style="color:#393A34" data-213-js-token="(-2-43">(</span><span class="token punctuation" style="color:#393A34" data-213-js-token="(-2-44">(</span><span class="token punctuation" style="color:#393A34" data-213-js-token=")-2-45">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-213-js-token="=&gt;-2-47">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-213-js-token="{-2-50">{</span><span class="token plain" data-213-js-token="-2-51"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-213-js-token="return-3-16">return</span><span class="token plain"> itemHeight </span><span class="token operator" style="color:#393A34" data-213-js-token="+-3-34">+</span><span class="token plain"> </span><span class="token known-class-name class-name" data-213-js-token="Math-3-36">Math</span><span class="token punctuation" style="color:#393A34" data-213-js-token=".-3-40">.</span><span class="token method function property-access" style="color:#d73a49" data-213-js-token="round-3-41">round</span><span class="token punctuation" style="color:#393A34" data-213-js-token="(-3-46">(</span><span class="token known-class-name class-name" data-213-js-token="Math-3-47">Math</span><span class="token punctuation" style="color:#393A34" data-213-js-token=".-3-51">.</span><span class="token method function property-access" style="color:#d73a49" data-213-js-token="random-3-52">random</span><span class="token punctuation" style="color:#393A34" data-213-js-token="(-3-58">(</span><span class="token punctuation" style="color:#393A34" data-213-js-token=")-3-59">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-213-js-token="*-3-61">*</span><span class="token plain"> itemHeight</span><span class="token punctuation" style="color:#393A34" data-213-js-token=")-3-73">)</span><span class="token punctuation" style="color:#393A34" data-213-js-token=";-3-74">;</span><span class="token plain" data-213-js-token="-3-75"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34" data-213-js-token="}-4-8">}</span><span class="token punctuation" style="color:#393A34" data-213-js-token=")-4-9">)</span><span class="token punctuation" style="color:#393A34" data-213-js-token=",-4-10">,</span><span class="token plain" data-213-js-token="-4-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-213-js-token="-5-0"></span><span class="token punctuation" style="color:#393A34" data-213-js-token=")-5-0">)</span><span class="token punctuation" style="color:#393A34" data-213-js-token=";-5-1">;</span><span class="token plain" data-213-js-token="-5-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-213-js-token="-6-0"></span><span class="token keyword" style="color:#00009f" data-213-js-token="const-6-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-213-js-token="getItemHeightByIndex-6-6">getItemHeightByIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-213-js-token="=-6-27">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-213-js-token="(-6-29">(</span><span class="token parameter" data-213-js-token="index-6-30">index</span><span class="token parameter operator" style="color:#393A34" data-213-js-token=":-6-35">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34" data-213-js-token=")-6-43">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-213-js-token="=&gt;-6-45">=&gt;</span><span class="token plain" data-213-js-token="-6-47"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        itemHeightListRef</span><span class="token punctuation" style="color:#393A34" data-213-js-token=".-7-25">.</span><span class="token property-access" data-213-js-token="current-7-26">current</span><span class="token punctuation" style="color:#393A34" data-213-js-token="[-7-33">[</span><span class="token plain" data-213-js-token="index-7-34">index</span><span class="token punctuation" style="color:#393A34" data-213-js-token="]-7-39">]</span><span class="token punctuation" style="color:#393A34" data-213-js-token=";-7-40">;</span><span class="token plain" data-213-js-token="-7-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-213-js-token="-8-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-213-js-token="-9-0"></span><span class="token keyword" style="color:#00009f" data-213-js-token="const-9-0">const</span><span class="token plain"> measuredData</span><span class="token operator" style="color:#393A34" data-213-js-token=":-9-18">:</span><span class="token plain"> </span><span class="token maybe-class-name" data-213-js-token="MeasuredDataList-9-20">MeasuredDataList</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-213-js-token="=-9-37">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-213-js-token="{-9-39">{</span><span class="token plain" data-213-js-token="-9-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        measuredDataMap</span><span class="token operator" style="color:#393A34" data-213-js-token=":-10-23">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-213-js-token="[-10-25">[</span><span class="token punctuation" style="color:#393A34" data-213-js-token="]-10-26">]</span><span class="token punctuation" style="color:#393A34" data-213-js-token=",-10-27">,</span><span class="token plain" data-213-js-token="-10-28"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name" data-213-js-token="LastMeasuredItemIndex-11-8">LastMeasuredItemIndex</span><span class="token operator" style="color:#393A34" data-213-js-token=":-11-29">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-213-js-token="--11-31">-</span><span class="token number" style="color:#36acaa" data-213-js-token="1-11-32">1</span><span class="token punctuation" style="color:#393A34" data-213-js-token=",-11-33">,</span><span class="token plain" data-213-js-token="-11-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-213-js-token="-12-0"></span><span class="token punctuation" style="color:#393A34" data-213-js-token="}-12-0">}</span><span class="token punctuation" style="color:#393A34" data-213-js-token=";-12-1">;</span></div></pre></div><h4 id="获取每一项的数据"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#获取每一项的数据"><span class="icon icon-link"></span></a>获取每一项的数据</h4><p>根据<code>LastMeasuredItemIndex</code></p><ul><li>如果小于<code>LastMeasuredItemIndex</code>的都是被缓存过的项，直接获取</li><li>如果大于<code>LastMeasuredItemIndex</code>则是未被缓存过的项，从<code>LastMeasuredItemIndex</code>开始，遍历到<code>index</code>，将遍历的所有项的<code>height</code>相加，即为当前项的<code>index</code></li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// LastMeasuredItemIndex是已经被记录的滚动到的最大索引，如果是大于LastMeasuredItemIndex，</span><span class="token plain" data-214-js-token="-0-67"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-214-js-token="-1-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 则可以通过一项一项的相加，加到index就是当前项的最大偏移值</span><span class="token plain" data-214-js-token="-1-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-214-js-token="-2-0"></span><span class="token keyword" style="color:#00009f" data-214-js-token="const-2-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-214-js-token="getItemMetaData-2-6">getItemMetaData</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-214-js-token="=-2-22">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-214-js-token="(-2-24">(</span><span class="token parameter" data-214-js-token="index-2-25">index</span><span class="token parameter operator" style="color:#393A34" data-214-js-token=":-2-30">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34" data-214-js-token=")-2-38">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-214-js-token="=&gt;-2-40">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-214-js-token="{-2-43">{</span><span class="token plain" data-214-js-token="-2-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-214-js-token="const-3-8">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-214-js-token="{-3-14">{</span><span class="token plain" data-214-js-token="measuredDataMap-3-15">measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-214-js-token=",-3-30">,</span><span class="token plain"> </span><span class="token maybe-class-name" data-214-js-token="LastMeasuredItemIndex-3-32">LastMeasuredItemIndex</span><span class="token punctuation" style="color:#393A34" data-214-js-token="}-3-53">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-214-js-token="=-3-55">=</span><span class="token plain"> measuredData</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-3-69">;</span><span class="token plain" data-214-js-token="-3-70"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f" data-214-js-token="if-4-8">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-214-js-token="(-4-11">(</span><span class="token plain">index </span><span class="token operator" style="color:#393A34" data-214-js-token="&gt;-4-18">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name" data-214-js-token="LastMeasuredItemIndex-4-20">LastMeasuredItemIndex</span><span class="token punctuation" style="color:#393A34" data-214-js-token=")-4-41">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-214-js-token="{-4-43">{</span><span class="token plain" data-214-js-token="-4-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f" data-214-js-token="let-5-16">let</span><span class="token plain"> topOffset </span><span class="token operator" style="color:#393A34" data-214-js-token="=-5-30">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-214-js-token="0-5-32">0</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-5-33">;</span><span class="token plain" data-214-js-token="-5-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 先获取到最底部新增的一项的topOffset</span><span class="token plain" data-214-js-token="-6-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-214-js-token="if-7-16">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-214-js-token="(-7-19">(</span><span class="token maybe-class-name" data-214-js-token="LastMeasuredItemIndex-7-20">LastMeasuredItemIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-214-js-token="&gt;=-7-42">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-214-js-token="0-7-45">0</span><span class="token punctuation" style="color:#393A34" data-214-js-token=")-7-46">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-214-js-token="{-7-48">{</span><span class="token plain" data-214-js-token="-7-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f" data-214-js-token="const-8-24">const</span><span class="token plain"> lastMeasuredItem </span><span class="token operator" style="color:#393A34" data-214-js-token="=-8-47">=</span><span class="token plain"> measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-214-js-token="[-8-64">[</span><span class="token maybe-class-name" data-214-js-token="LastMeasuredItemIndex-8-65">LastMeasuredItemIndex</span><span class="token punctuation" style="color:#393A34" data-214-js-token="]-8-86">]</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-8-87">;</span><span class="token plain" data-214-js-token="-8-88"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        topOffset </span><span class="token operator" style="color:#393A34" data-214-js-token="+=-9-34">+=</span><span class="token plain"> lastMeasuredItem</span><span class="token punctuation" style="color:#393A34" data-214-js-token=".-9-53">.</span><span class="token property-access" data-214-js-token="topOffset-9-54">topOffset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-214-js-token="+-9-64">+</span><span class="token plain"> lastMeasuredItem</span><span class="token punctuation" style="color:#393A34" data-214-js-token=".-9-82">.</span><span class="token property-access" data-214-js-token="height-9-83">height</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-9-89">;</span><span class="token plain" data-214-js-token="-9-90"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34" data-214-js-token="}-10-16">}</span><span class="token plain" data-214-js-token="-10-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 遍历记录，直到index</span><span class="token plain" data-214-js-token="-11-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f" data-214-js-token="for-12-16">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-214-js-token="(-12-20">(</span><span class="token keyword" style="color:#00009f" data-214-js-token="let-12-21">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-214-js-token="=-12-27">=</span><span class="token plain"> </span><span class="token maybe-class-name" data-214-js-token="LastMeasuredItemIndex-12-29">LastMeasuredItemIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-214-js-token="+-12-51">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-214-js-token="1-12-53">1</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-12-54">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-214-js-token="&lt;=-12-58">&lt;=</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-12-66">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34" data-214-js-token="++-12-69">++</span><span class="token punctuation" style="color:#393A34" data-214-js-token=")-12-71">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-214-js-token="{-12-73">{</span><span class="token plain" data-214-js-token="-12-74"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f" data-214-js-token="const-13-24">const</span><span class="token plain"> currentItemSize </span><span class="token operator" style="color:#393A34" data-214-js-token="=-13-46">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-214-js-token="getItemHeightByIndex-13-48">getItemHeightByIndex</span><span class="token punctuation" style="color:#393A34" data-214-js-token="(-13-68">(</span><span class="token plain" data-214-js-token="i-13-69">i</span><span class="token punctuation" style="color:#393A34" data-214-js-token=")-13-70">)</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-13-71">;</span><span class="token plain" data-214-js-token="-13-72"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-214-js-token="[-14-39">[</span><span class="token plain" data-214-js-token="i-14-40">i</span><span class="token punctuation" style="color:#393A34" data-214-js-token="]-14-41">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-214-js-token="=-14-43">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-214-js-token="{-14-45">{</span><span class="token plain" data-214-js-token="height-14-46">height</span><span class="token operator" style="color:#393A34" data-214-js-token=":-14-52">:</span><span class="token plain"> currentItemSize</span><span class="token punctuation" style="color:#393A34" data-214-js-token=",-14-69">,</span><span class="token plain"> topOffset</span><span class="token punctuation" style="color:#393A34" data-214-js-token="}-14-80">}</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-14-81">;</span><span class="token plain" data-214-js-token="-14-82"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        topOffset </span><span class="token operator" style="color:#393A34" data-214-js-token="+=-15-34">+=</span><span class="token plain"> currentItemSize</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-15-52">;</span><span class="token plain" data-214-js-token="-15-53"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34" data-214-js-token="}-16-16">}</span><span class="token plain" data-214-js-token="-16-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                measuredData</span><span class="token punctuation" style="color:#393A34" data-214-js-token=".-17-28">.</span><span class="token property-access maybe-class-name" data-214-js-token="LastMeasuredItemIndex-17-29">LastMeasuredItemIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-214-js-token="=-17-51">=</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-17-58">;</span><span class="token plain" data-214-js-token="-17-59"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34" data-214-js-token="}-18-8">}</span><span class="token plain" data-214-js-token="-18-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f" data-214-js-token="return-19-8">return</span><span class="token plain"> measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-214-js-token="[-19-30">[</span><span class="token plain" data-214-js-token="index-19-31">index</span><span class="token punctuation" style="color:#393A34" data-214-js-token="]-19-36">]</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-19-37">;</span><span class="token plain" data-214-js-token="-19-38"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-214-js-token="-20-0"></span><span class="token punctuation" style="color:#393A34" data-214-js-token="}-20-0">}</span><span class="token punctuation" style="color:#393A34" data-214-js-token=";-20-1">;</span></div></pre></div><h4 id="获取开始索引"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#获取开始索引"><span class="icon icon-link"></span></a>获取开始索引</h4><p>查找起始索引，从记录的数据结构中查找，第一项就是<code>topOffset &gt;= srcollTop</code>这里我们用二分法进行优化</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-215-js-token="const-0-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-215-js-token="getStartIndex-0-6">getStartIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-215-js-token="=-0-20">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-215-js-token="(-0-22">(</span><span class="token parameter" data-215-js-token="options-0-23">options</span><span class="token parameter operator" style="color:#393A34" data-215-js-token=":-0-30">:</span><span class="token parameter"> VirtualListProps</span><span class="token parameter punctuation" style="color:#393A34" data-215-js-token=",-0-48">,</span><span class="token parameter"> scrollOffset</span><span class="token parameter operator" style="color:#393A34" data-215-js-token=":-0-62">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34" data-215-js-token=")-0-70">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-215-js-token="=&gt;-0-72">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-215-js-token="{-0-75">{</span><span class="token plain" data-215-js-token="-0-76"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-215-js-token="const-1-4">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-215-js-token="{-1-10">{</span><span class="token plain">itemSumCount </span><span class="token operator" style="color:#393A34" data-215-js-token="=-1-24">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-215-js-token="1000-1-26">1000</span><span class="token punctuation" style="color:#393A34" data-215-js-token="}-1-30">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-215-js-token="=-1-32">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34" data-215-js-token=";-1-41">;</span><span class="token plain" data-215-js-token="-1-42"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-215-js-token="let-2-4">let</span><span class="token plain"> low </span><span class="token operator" style="color:#393A34" data-215-js-token="=-2-12">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-215-js-token="0-2-14">0</span><span class="token punctuation" style="color:#393A34" data-215-js-token=";-2-15">;</span><span class="token plain" data-215-js-token="-2-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-215-js-token="let-3-4">let</span><span class="token plain"> high </span><span class="token operator" style="color:#393A34" data-215-js-token="=-3-13">=</span><span class="token plain"> itemSumCount </span><span class="token operator" style="color:#393A34" data-215-js-token="--3-28">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-215-js-token="1-3-30">1</span><span class="token punctuation" style="color:#393A34" data-215-js-token=";-3-31">;</span><span class="token plain" data-215-js-token="-3-32"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-215-js-token="-4-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-215-js-token="while-5-4">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-215-js-token="(-5-10">(</span><span class="token plain">low </span><span class="token operator" style="color:#393A34" data-215-js-token="&lt;=-5-15">&lt;=</span><span class="token plain"> high</span><span class="token punctuation" style="color:#393A34" data-215-js-token=")-5-22">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-215-js-token="{-5-24">{</span><span class="token plain" data-215-js-token="-5-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-215-js-token="const-6-12">const</span><span class="token plain"> mid </span><span class="token operator" style="color:#393A34" data-215-js-token="=-6-22">=</span><span class="token plain"> </span><span class="token known-class-name class-name" data-215-js-token="Math-6-24">Math</span><span class="token punctuation" style="color:#393A34" data-215-js-token=".-6-28">.</span><span class="token method function property-access" style="color:#d73a49" data-215-js-token="floor-6-29">floor</span><span class="token punctuation" style="color:#393A34" data-215-js-token="(-6-34">(</span><span class="token punctuation" style="color:#393A34" data-215-js-token="(-6-35">(</span><span class="token plain">low </span><span class="token operator" style="color:#393A34" data-215-js-token="+-6-40">+</span><span class="token plain"> high</span><span class="token punctuation" style="color:#393A34" data-215-js-token=")-6-46">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-215-js-token="/-6-48">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-215-js-token="2-6-50">2</span><span class="token punctuation" style="color:#393A34" data-215-js-token=")-6-51">)</span><span class="token punctuation" style="color:#393A34" data-215-js-token=";-6-52">;</span><span class="token plain" data-215-js-token="-6-53"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-215-js-token="const-7-12">const</span><span class="token plain"> currentOffset </span><span class="token operator" style="color:#393A34" data-215-js-token="=-7-32">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-215-js-token="getItemMetaData-7-34">getItemMetaData</span><span class="token punctuation" style="color:#393A34" data-215-js-token="(-7-49">(</span><span class="token plain" data-215-js-token="mid-7-50">mid</span><span class="token punctuation" style="color:#393A34" data-215-js-token=")-7-53">)</span><span class="token punctuation" style="color:#393A34" data-215-js-token=".-7-54">.</span><span class="token property-access" data-215-js-token="topOffset-7-55">topOffset</span><span class="token punctuation" style="color:#393A34" data-215-js-token=";-7-64">;</span><span class="token plain" data-215-js-token="-7-65"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f" data-215-js-token="if-8-12">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-215-js-token="(-8-15">(</span><span class="token plain">currentOffset </span><span class="token operator" style="color:#393A34" data-215-js-token="===-8-30">===</span><span class="token plain"> scrollOffset</span><span class="token punctuation" style="color:#393A34" data-215-js-token=")-8-46">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-215-js-token="{-8-48">{</span><span class="token plain" data-215-js-token="-8-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:#00009f" data-215-js-token="return-9-20">return</span><span class="token plain"> mid</span><span class="token punctuation" style="color:#393A34" data-215-js-token=";-9-30">;</span><span class="token plain" data-215-js-token="-9-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-215-js-token="}-10-12">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-215-js-token="else-10-14">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-215-js-token="if-10-19">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-215-js-token="(-10-22">(</span><span class="token plain">currentOffset </span><span class="token operator" style="color:#393A34" data-215-js-token="&lt;-10-37">&lt;</span><span class="token plain"> scrollOffset</span><span class="token punctuation" style="color:#393A34" data-215-js-token=")-10-51">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-215-js-token="{-10-53">{</span><span class="token plain" data-215-js-token="-10-54"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    low </span><span class="token operator" style="color:#393A34" data-215-js-token="=-11-24">=</span><span class="token plain"> mid </span><span class="token operator" style="color:#393A34" data-215-js-token="+-11-30">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-215-js-token="1-11-32">1</span><span class="token punctuation" style="color:#393A34" data-215-js-token=";-11-33">;</span><span class="token plain" data-215-js-token="-11-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-215-js-token="}-12-12">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-215-js-token="else-12-14">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-215-js-token="{-12-19">{</span><span class="token plain" data-215-js-token="-12-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    high </span><span class="token operator" style="color:#393A34" data-215-js-token="=-13-25">=</span><span class="token plain"> mid </span><span class="token operator" style="color:#393A34" data-215-js-token="--13-31">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-215-js-token="1-13-33">1</span><span class="token punctuation" style="color:#393A34" data-215-js-token=";-13-34">;</span><span class="token plain" data-215-js-token="-13-35"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-215-js-token="}-14-12">}</span><span class="token plain" data-215-js-token="-14-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-215-js-token="}-15-4">}</span><span class="token plain" data-215-js-token="-15-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-215-js-token="return-16-4">return</span><span class="token plain"> low</span><span class="token punctuation" style="color:#393A34" data-215-js-token=";-16-14">;</span><span class="token plain" data-215-js-token="-16-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-215-js-token="-17-0"></span><span class="token punctuation" style="color:#393A34" data-215-js-token="}-17-0">}</span><span class="token punctuation" style="color:#393A34" data-215-js-token=";-17-1">;</span></div></pre></div><h4 id="获取结束索引"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#获取结束索引"><span class="icon icon-link"></span></a>获取结束索引</h4><p>我们虽然不知道可视区能显示多少个列表项，但是我们可以根据第一个的偏移值加上虚拟列表的高度，计算出最大偏移值，这样我们就可以查找终止索引：通过起始item的<code>topOffset</code>+自定义的<code>listHeight</code>可以计算出当前能显示的最大偏移值<code>maxOffset</code>，从<code>startItem</code>一直遍历加上<code>height</code>，直到<code>offset &gt;= maxOffset</code>就是结束索引的位置</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f" data-216-js-token="const-0-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-216-js-token="getEndIndex-0-6">getEndIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-216-js-token="=-0-18">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-216-js-token="(-0-20">(</span><span class="token parameter" data-216-js-token="options-0-21">options</span><span class="token parameter operator" style="color:#393A34" data-216-js-token=":-0-28">:</span><span class="token parameter"> VirtualListProps</span><span class="token parameter punctuation" style="color:#393A34" data-216-js-token=",-0-46">,</span><span class="token parameter"> startIndex</span><span class="token parameter operator" style="color:#393A34" data-216-js-token=":-0-58">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34" data-216-js-token=")-0-66">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-216-js-token="=&gt;-0-68">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-216-js-token="{-0-71">{</span><span class="token plain" data-216-js-token="-0-72"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-216-js-token="const-1-4">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-216-js-token="{-1-10">{</span><span class="token plain">listHeight </span><span class="token operator" style="color:#393A34" data-216-js-token="=-1-22">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-216-js-token="600-1-24">600</span><span class="token punctuation" style="color:#393A34" data-216-js-token=",-1-27">,</span><span class="token plain"> itemSumCount </span><span class="token operator" style="color:#393A34" data-216-js-token="=-1-42">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-216-js-token="1000-1-44">1000</span><span class="token punctuation" style="color:#393A34" data-216-js-token="}-1-48">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-216-js-token="=-1-50">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34" data-216-js-token=";-1-59">;</span><span class="token plain" data-216-js-token="-1-60"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-216-js-token="const-2-4">const</span><span class="token plain"> startItem </span><span class="token operator" style="color:#393A34" data-216-js-token="=-2-20">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-216-js-token="getItemMetaData-2-22">getItemMetaData</span><span class="token punctuation" style="color:#393A34" data-216-js-token="(-2-37">(</span><span class="token plain" data-216-js-token="startIndex-2-38">startIndex</span><span class="token punctuation" style="color:#393A34" data-216-js-token=")-2-48">)</span><span class="token punctuation" style="color:#393A34" data-216-js-token=";-2-49">;</span><span class="token plain" data-216-js-token="-2-50"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-216-js-token="const-3-4">const</span><span class="token plain"> maxOffset </span><span class="token operator" style="color:#393A34" data-216-js-token="=-3-20">=</span><span class="token plain"> startItem</span><span class="token punctuation" style="color:#393A34" data-216-js-token=".-3-31">.</span><span class="token property-access" data-216-js-token="topOffset-3-32">topOffset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-216-js-token="+-3-42">+</span><span class="token plain"> listHeight</span><span class="token punctuation" style="color:#393A34" data-216-js-token=";-3-54">;</span><span class="token plain" data-216-js-token="-3-55"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-216-js-token="let-4-4">let</span><span class="token plain"> offset </span><span class="token operator" style="color:#393A34" data-216-js-token="=-4-15">=</span><span class="token plain"> startItem</span><span class="token punctuation" style="color:#393A34" data-216-js-token=".-4-26">.</span><span class="token property-access" data-216-js-token="topOffset-4-27">topOffset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-216-js-token="+-4-37">+</span><span class="token plain"> startItem</span><span class="token punctuation" style="color:#393A34" data-216-js-token=".-4-48">.</span><span class="token property-access" data-216-js-token="height-4-49">height</span><span class="token punctuation" style="color:#393A34" data-216-js-token=";-4-55">;</span><span class="token plain" data-216-js-token="-4-56"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-216-js-token="let-5-4">let</span><span class="token plain"> endIndex </span><span class="token operator" style="color:#393A34" data-216-js-token="=-5-17">=</span><span class="token plain"> startIndex</span><span class="token punctuation" style="color:#393A34" data-216-js-token=";-5-29">;</span><span class="token plain" data-216-js-token="-5-30"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-216-js-token="-6-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-216-js-token="while-7-4">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-216-js-token="(-7-10">(</span><span class="token plain">offset </span><span class="token operator" style="color:#393A34" data-216-js-token="&lt;=-7-18">&lt;=</span><span class="token plain"> maxOffset </span><span class="token operator" style="color:#393A34" data-216-js-token="&amp;&amp;-7-31">&amp;&amp;</span><span class="token plain"> endIndex </span><span class="token operator" style="color:#393A34" data-216-js-token="&lt;-7-43">&lt;</span><span class="token plain"> itemSumCount </span><span class="token operator" style="color:#393A34" data-216-js-token="--7-58">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-216-js-token="1-7-60">1</span><span class="token punctuation" style="color:#393A34" data-216-js-token=")-7-61">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-216-js-token="{-7-63">{</span><span class="token plain" data-216-js-token="-7-64"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            endIndex</span><span class="token operator" style="color:#393A34" data-216-js-token="++-8-20">++</span><span class="token punctuation" style="color:#393A34" data-216-js-token=";-8-22">;</span><span class="token plain" data-216-js-token="-8-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-216-js-token="const-9-12">const</span><span class="token plain"> currentItem </span><span class="token operator" style="color:#393A34" data-216-js-token="=-9-30">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-216-js-token="getItemMetaData-9-32">getItemMetaData</span><span class="token punctuation" style="color:#393A34" data-216-js-token="(-9-47">(</span><span class="token plain" data-216-js-token="endIndex-9-48">endIndex</span><span class="token punctuation" style="color:#393A34" data-216-js-token=")-9-56">)</span><span class="token punctuation" style="color:#393A34" data-216-js-token=";-9-57">;</span><span class="token plain" data-216-js-token="-9-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            offset </span><span class="token operator" style="color:#393A34" data-216-js-token="+=-10-19">+=</span><span class="token plain"> currentItem</span><span class="token punctuation" style="color:#393A34" data-216-js-token=".-10-33">.</span><span class="token property-access" data-216-js-token="height-10-34">height</span><span class="token punctuation" style="color:#393A34" data-216-js-token=";-10-40">;</span><span class="token plain" data-216-js-token="-10-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-216-js-token="}-11-4">}</span><span class="token plain" data-216-js-token="-11-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-216-js-token="return-12-4">return</span><span class="token plain"> endIndex</span><span class="token punctuation" style="color:#393A34" data-216-js-token=";-12-19">;</span><span class="token plain" data-216-js-token="-12-20"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-216-js-token="-13-0"></span><span class="token punctuation" style="color:#393A34" data-216-js-token="}-13-0">}</span><span class="token punctuation" style="color:#393A34" data-216-js-token=";-13-1">;</span></div></pre></div><h4 id="可视区项目获取"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#可视区项目获取"><span class="icon icon-link"></span></a>可视区项目获取</h4><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 获取当前可现实的范围</span><span class="token plain" data-217-js-token="-0-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-217-js-token="-1-0"></span><span class="token keyword" style="color:#00009f" data-217-js-token="const-1-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-217-js-token="getChildShowRange-1-6">getChildShowRange</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-217-js-token="=-1-24">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-1-26">(</span><span class="token plain" data-217-js-token="-1-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token parameter" data-217-js-token="options-2-8">options</span><span class="token parameter operator" style="color:#393A34" data-217-js-token=":-2-15">:</span><span class="token parameter"> VirtualListProps</span><span class="token parameter punctuation" style="color:#393A34" data-217-js-token=",-2-33">,</span><span class="token parameter" data-217-js-token="-2-34"></span></div><div class="token-line" style="color:#393A34"><span class="token parameter">        scrollOffset</span><span class="token parameter operator" style="color:#393A34" data-217-js-token=":-3-20">:</span><span class="token parameter"> number</span><span class="token parameter punctuation" style="color:#393A34" data-217-js-token=",-3-28">,</span><span class="token plain" data-217-js-token="-3-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-217-js-token="-4-0"></span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-4-0">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-217-js-token="=&gt;-4-2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="{-4-5">{</span><span class="token plain" data-217-js-token="-4-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-217-js-token="const-5-8">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="{-5-14">{</span><span class="token plain">itemSumCount </span><span class="token operator" style="color:#393A34" data-217-js-token="=-5-28">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-217-js-token="1000-5-30">1000</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-5-34">,</span><span class="token plain"> bufferNum </span><span class="token operator" style="color:#393A34" data-217-js-token="=-5-46">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-217-js-token="4-5-48">4</span><span class="token punctuation" style="color:#393A34" data-217-js-token="}-5-49">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-217-js-token="=-5-51">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-5-60">;</span><span class="token plain" data-217-js-token="-5-61"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-217-js-token="const-6-8">const</span><span class="token plain"> startIndex </span><span class="token operator" style="color:#393A34" data-217-js-token="=-6-25">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-217-js-token="getStartIndex-6-27">getStartIndex</span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-6-40">(</span><span class="token plain" data-217-js-token="options-6-41">options</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-6-48">,</span><span class="token plain"> scrollOffset</span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-6-62">)</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-6-63">;</span><span class="token plain" data-217-js-token="-6-64"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-217-js-token="const-7-8">const</span><span class="token plain"> endIndex </span><span class="token operator" style="color:#393A34" data-217-js-token="=-7-23">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-217-js-token="getEndIndex-7-25">getEndIndex</span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-7-36">(</span><span class="token plain" data-217-js-token="options-7-37">options</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-7-44">,</span><span class="token plain"> startIndex</span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-7-56">)</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-7-57">;</span><span class="token plain" data-217-js-token="-7-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f" data-217-js-token="return-8-8">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="{-8-15">{</span><span class="token plain" data-217-js-token="-8-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                bufferStartIndex</span><span class="token operator" style="color:#393A34" data-217-js-token=":-9-32">:</span><span class="token plain"> </span><span class="token known-class-name class-name" data-217-js-token="Math-9-34">Math</span><span class="token punctuation" style="color:#393A34" data-217-js-token=".-9-38">.</span><span class="token method function property-access" style="color:#d73a49" data-217-js-token="max-9-39">max</span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-9-42">(</span><span class="token number" style="color:#36acaa" data-217-js-token="0-9-43">0</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-9-44">,</span><span class="token plain"> startIndex </span><span class="token operator" style="color:#393A34" data-217-js-token="--9-57">-</span><span class="token plain"> bufferNum</span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-9-68">)</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-9-69">,</span><span class="token plain" data-217-js-token="-9-70"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                bufferEndIndex</span><span class="token operator" style="color:#393A34" data-217-js-token=":-10-30">:</span><span class="token plain"> </span><span class="token known-class-name class-name" data-217-js-token="Math-10-32">Math</span><span class="token punctuation" style="color:#393A34" data-217-js-token=".-10-36">.</span><span class="token method function property-access" style="color:#d73a49" data-217-js-token="min-10-37">min</span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-10-40">(</span><span class="token plain">itemSumCount </span><span class="token operator" style="color:#393A34" data-217-js-token="--10-54">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-217-js-token="1-10-56">1</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-10-57">,</span><span class="token plain"> endIndex </span><span class="token operator" style="color:#393A34" data-217-js-token="+-10-68">+</span><span class="token plain"> bufferNum</span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-10-79">)</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-10-80">,</span><span class="token plain" data-217-js-token="-10-81"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                startIndex</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-11-26">,</span><span class="token plain" data-217-js-token="-11-27"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                endIndex</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-12-24">,</span><span class="token plain" data-217-js-token="-12-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34" data-217-js-token="}-13-8">}</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-13-9">;</span><span class="token plain" data-217-js-token="-13-10"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-217-js-token="-14-0"></span><span class="token punctuation" style="color:#393A34" data-217-js-token="}-14-0">}</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-14-1">;</span><span class="token plain" data-217-js-token="-14-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-217-js-token="-15-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-217-js-token="-16-0"></span><span class="token keyword" style="color:#00009f" data-217-js-token="const-16-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-217-js-token="getCurShowChild-16-6">getCurShowChild</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-217-js-token="=-16-22">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-16-24">(</span><span class="token parameter" data-217-js-token="options-16-25">options</span><span class="token parameter operator" style="color:#393A34" data-217-js-token=":-16-32">:</span><span class="token parameter"> VirtualListProps</span><span class="token parameter punctuation" style="color:#393A34" data-217-js-token=",-16-50">,</span><span class="token parameter"> scrollTop</span><span class="token parameter operator" style="color:#393A34" data-217-js-token=":-16-61">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-16-69">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-217-js-token="=&gt;-16-71">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="{-16-74">{</span><span class="token plain" data-217-js-token="-16-75"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-217-js-token="const-17-8">const</span><span class="token plain"> items </span><span class="token operator" style="color:#393A34" data-217-js-token="=-17-20">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="[-17-22">[</span><span class="token punctuation" style="color:#393A34" data-217-js-token="]-17-23">]</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-17-24">;</span><span class="token plain" data-217-js-token="-17-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-217-js-token="const-18-8">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="{-18-14">{</span><span class="token plain" data-217-js-token="bufferStartIndex-18-15">bufferStartIndex</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-18-31">,</span><span class="token plain"> bufferEndIndex</span><span class="token punctuation" style="color:#393A34" data-217-js-token="}-18-47">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-217-js-token="=-18-49">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-217-js-token="getChildShowRange-18-51">getChildShowRange</span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-18-68">(</span><span class="token plain" data-217-js-token="-18-69"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                options</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-19-23">,</span><span class="token plain" data-217-js-token="-19-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                scrollTop</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-20-25">,</span><span class="token plain" data-217-js-token="-20-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-21-8">)</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-21-9">;</span><span class="token plain" data-217-js-token="-21-10"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f" data-217-js-token="for-22-8">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-22-12">(</span><span class="token keyword" style="color:#00009f" data-217-js-token="let-22-13">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-217-js-token="=-22-19">=</span><span class="token plain"> bufferStartIndex</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-22-37">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-217-js-token="&lt;=-22-41">&lt;=</span><span class="token plain"> bufferEndIndex</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-22-58">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34" data-217-js-token="++-22-61">++</span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-22-63">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="{-22-65">{</span><span class="token plain" data-217-js-token="-22-66"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f" data-217-js-token="const-23-16">const</span><span class="token plain"> item </span><span class="token operator" style="color:#393A34" data-217-js-token="=-23-27">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-217-js-token="getItemMetaData-23-29">getItemMetaData</span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-23-44">(</span><span class="token plain" data-217-js-token="i-23-45">i</span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-23-46">)</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-23-47">;</span><span class="token plain" data-217-js-token="-23-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f" data-217-js-token="const-24-16">const</span><span class="token plain"> itemStyle</span><span class="token operator" style="color:#393A34" data-217-js-token=":-24-31">:</span><span class="token plain"> </span><span class="token maybe-class-name" data-217-js-token="CSSProperties-24-33">CSSProperties</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-217-js-token="=-24-47">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-217-js-token="{-24-49">{</span><span class="token plain" data-217-js-token="-24-50"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        position</span><span class="token operator" style="color:#393A34" data-217-js-token=":-25-32">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-217-js-token="&#x27;absolute&#x27;-25-34">&#x27;absolute&#x27;</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-25-44">,</span><span class="token plain" data-217-js-token="-25-45"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        height</span><span class="token operator" style="color:#393A34" data-217-js-token=":-26-30">:</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34" data-217-js-token=".-26-36">.</span><span class="token property-access" data-217-js-token="height-26-37">height</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-26-43">,</span><span class="token plain" data-217-js-token="-26-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        width</span><span class="token operator" style="color:#393A34" data-217-js-token=":-27-29">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-217-js-token="&#x27;100%&#x27;-27-31">&#x27;100%&#x27;</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-27-37">,</span><span class="token plain" data-217-js-token="-27-38"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        top</span><span class="token operator" style="color:#393A34" data-217-js-token=":-28-27">:</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34" data-217-js-token=".-28-33">.</span><span class="token property-access" data-217-js-token="topOffset-28-34">topOffset</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-28-43">,</span><span class="token plain" data-217-js-token="-28-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34" data-217-js-token="}-29-16">}</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-29-17">;</span><span class="token plain" data-217-js-token="-29-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                items</span><span class="token punctuation" style="color:#393A34" data-217-js-token=".-30-21">.</span><span class="token method function property-access" style="color:#d73a49" data-217-js-token="push-30-22">push</span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-30-26">(</span><span class="token operator" style="color:#393A34" data-217-js-token="&lt;-30-27">&lt;</span><span class="token maybe-class-name" data-217-js-token="ChildItem-30-28">ChildItem</span><span class="token plain"> key</span><span class="token operator" style="color:#393A34" data-217-js-token="=-30-41">=</span><span class="token punctuation" style="color:#393A34" data-217-js-token="{-30-42">{</span><span class="token plain" data-217-js-token="i-30-43">i</span><span class="token punctuation" style="color:#393A34" data-217-js-token="}-30-44">}</span><span class="token plain"> childIndex</span><span class="token operator" style="color:#393A34" data-217-js-token="=-30-56">=</span><span class="token punctuation" style="color:#393A34" data-217-js-token="{-30-57">{</span><span class="token plain" data-217-js-token="i-30-58">i</span><span class="token punctuation" style="color:#393A34" data-217-js-token="}-30-59">}</span><span class="token plain"> itemStyle</span><span class="token operator" style="color:#393A34" data-217-js-token="=-30-70">=</span><span class="token punctuation" style="color:#393A34" data-217-js-token="{-30-71">{</span><span class="token plain" data-217-js-token="itemStyle-30-72">itemStyle</span><span class="token punctuation" style="color:#393A34" data-217-js-token="}-30-81">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-217-js-token="/-30-83">/</span><span class="token operator" style="color:#393A34" data-217-js-token="&gt;-30-84">&gt;</span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-30-85">)</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-30-86">;</span><span class="token plain" data-217-js-token="-30-87"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34" data-217-js-token="}-31-8">}</span><span class="token plain" data-217-js-token="-31-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name" data-217-js-token="console-32-8">console</span><span class="token punctuation" style="color:#393A34" data-217-js-token=".-32-15">.</span><span class="token method function property-access" style="color:#d73a49" data-217-js-token="log-32-16">log</span><span class="token punctuation" style="color:#393A34" data-217-js-token="(-32-19">(</span><span class="token string" style="color:#e3116c">&#x27;✅ ~ measuredData:&#x27;</span><span class="token punctuation" style="color:#393A34" data-217-js-token=",-32-39">,</span><span class="token plain"> measuredData</span><span class="token punctuation" style="color:#393A34" data-217-js-token=")-32-53">)</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-32-54">;</span><span class="token plain" data-217-js-token="-32-55"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-217-js-token="-33-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f" data-217-js-token="return-34-8">return</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-34-20">;</span><span class="token plain" data-217-js-token="-34-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-217-js-token="-35-0"></span><span class="token punctuation" style="color:#393A34" data-217-js-token="}-35-0">}</span><span class="token punctuation" style="color:#393A34" data-217-js-token=";-35-1">;</span></div></pre></div><h3 id="效果-1"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#效果-1"><span class="icon icon-link"></span></a>效果</h3><p><a target="_blank" rel="noopener noreferrer" href="https://zhuling904.github.io/react_demo/?path=/story/%E9%80%9A%E7%94%A8-virtuallist%E8%99%9A%E6%8B%9F%E5%88%97%E8%A1%A8--uncertain-height">在线demo体验<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><img src="https://cdn.jsdelivr.net/gh/ObjectX-9/DrawingBed/imgMac/%E4%B8%8D%E5%AE%9A%E9%AB%98.gif" alt="2024-05-25 19.40.10.gif"/></p><h2 id="3动态高度虚拟列表"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#3动态高度虚拟列表"><span class="icon icon-link"></span></a>3.动态高度虚拟列表</h2><h3 id="图示-2"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#图示-2"><span class="icon icon-link"></span></a>图示</h3><p>大部分原理是跟不定高一致的，区别是我们连一个高度列表都没有，无法知道每一项的高度是多少，每一项的高度是在渲染时确定的，为了防止抖动，我们设置了一个默认高度。<img src="/front_end_engineer_book/static/image-20240615143354271.ec80b1b4.png" alt="image-20240615143354271"/></p><h3 id="原理-2"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#原理-2"><span class="icon icon-link"></span></a>原理</h3><p>原理主要是设置先设置一个默认的高度，并记录到缓存数据结构中，我们去监听节点的高度变换，在发生变化后重新计算缓存数据，然后更新列表。</p><h3 id="实现-2"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#实现-2"><span class="icon icon-link"></span></a>实现</h3><h4 id="定义默认高度"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#定义默认高度"><span class="icon icon-link"></span></a>定义默认高度</h4><p>在不定高的基础上我们更改代码如下 这里我们用的都是默认高度，因为后面渲染时监听节点变化会更新缓存数据</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 获取每一项的元数据</span><span class="token plain" data-218-js-token="-0-12"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-218-js-token="-1-0"></span><span class="token keyword" style="color:#00009f" data-218-js-token="const-1-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-218-js-token="getItemMetaData-1-6">getItemMetaData</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-218-js-token="=-1-22">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-218-js-token="(-1-24">(</span><span class="token parameter" data-218-js-token="index-1-25">index</span><span class="token parameter operator" style="color:#393A34" data-218-js-token=":-1-30">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34" data-218-js-token=")-1-38">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-218-js-token="=&gt;-1-40">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-218-js-token="{-1-43">{</span><span class="token plain" data-218-js-token="-1-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-218-js-token="const-2-4">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-218-js-token="{-2-10">{</span><span class="token plain" data-218-js-token="measuredDataMap-2-11">measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-218-js-token=",-2-26">,</span><span class="token plain"> </span><span class="token maybe-class-name" data-218-js-token="LastMeasuredItemIndex-2-28">LastMeasuredItemIndex</span><span class="token punctuation" style="color:#393A34" data-218-js-token="}-2-49">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-218-js-token="=-2-51">=</span><span class="token plain"> measuredData</span><span class="token punctuation" style="color:#393A34" data-218-js-token=";-2-65">;</span><span class="token plain" data-218-js-token="-2-66"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 如果index大于当前记录的最大值，挨个计算到index去，用top+height一个一个计算</span><span class="token plain" data-218-js-token="-3-54"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-218-js-token="if-4-4">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-218-js-token="(-4-7">(</span><span class="token plain">index </span><span class="token operator" style="color:#393A34" data-218-js-token="&gt;-4-14">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name" data-218-js-token="LastMeasuredItemIndex-4-16">LastMeasuredItemIndex</span><span class="token punctuation" style="color:#393A34" data-218-js-token=")-4-37">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-218-js-token="{-4-39">{</span><span class="token plain" data-218-js-token="-4-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f" data-218-js-token="let-5-8">let</span><span class="token plain"> topOffset </span><span class="token operator" style="color:#393A34" data-218-js-token="=-5-22">=</span><span class="token plain" data-218-js-token="-5-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token maybe-class-name" data-218-js-token="LastMeasuredItemIndex-6-16">LastMeasuredItemIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-218-js-token="&gt;=-6-38">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-218-js-token="0-6-41">0</span><span class="token plain" data-218-js-token="-6-42"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token operator" style="color:#393A34" data-218-js-token="?-7-24">?</span><span class="token plain"> measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-218-js-token="[-7-41">[</span><span class="token maybe-class-name" data-218-js-token="LastMeasuredItemIndex-7-42">LastMeasuredItemIndex</span><span class="token punctuation" style="color:#393A34" data-218-js-token="]-7-63">]</span><span class="token punctuation" style="color:#393A34" data-218-js-token=".-7-64">.</span><span class="token property-access" data-218-js-token="topOffset-7-65">topOffset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-218-js-token="+-7-75">+</span><span class="token plain" data-218-js-token="-7-76"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-218-js-token="[-8-47">[</span><span class="token maybe-class-name" data-218-js-token="LastMeasuredItemIndex-8-48">LastMeasuredItemIndex</span><span class="token punctuation" style="color:#393A34" data-218-js-token="]-8-69">]</span><span class="token punctuation" style="color:#393A34" data-218-js-token=".-8-70">.</span><span class="token property-access" data-218-js-token="height-8-71">height</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-218-js-token=":-8-78">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-218-js-token="0-8-80">0</span><span class="token punctuation" style="color:#393A34" data-218-js-token=";-8-81">;</span><span class="token plain" data-218-js-token="-8-82"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f" data-218-js-token="for-9-8">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-218-js-token="(-9-12">(</span><span class="token keyword" style="color:#00009f" data-218-js-token="let-9-13">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-218-js-token="=-9-19">=</span><span class="token plain"> </span><span class="token maybe-class-name" data-218-js-token="LastMeasuredItemIndex-9-21">LastMeasuredItemIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-218-js-token="+-9-43">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-218-js-token="1-9-45">1</span><span class="token punctuation" style="color:#393A34" data-218-js-token=";-9-46">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-218-js-token="&lt;=-9-50">&lt;=</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34" data-218-js-token=";-9-58">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34" data-218-js-token="++-9-61">++</span><span class="token punctuation" style="color:#393A34" data-218-js-token=")-9-63">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-218-js-token="{-9-65">{</span><span class="token plain" data-218-js-token="-9-66"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 这里用的都是默认高度，因为后面渲染时会更新缓存数据</span><span class="token plain" data-218-js-token="-10-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-218-js-token="[-11-31">[</span><span class="token plain" data-218-js-token="i-11-32">i</span><span class="token punctuation" style="color:#393A34" data-218-js-token="]-11-33">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-218-js-token="=-11-35">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-218-js-token="{-11-37">{</span><span class="token plain" data-218-js-token="height-11-38">height</span><span class="token operator" style="color:#393A34" data-218-js-token=":-11-44">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-218-js-token="50-11-46">50</span><span class="token punctuation" style="color:#393A34" data-218-js-token=",-11-48">,</span><span class="token plain"> topOffset</span><span class="token punctuation" style="color:#393A34" data-218-js-token="}-11-59">}</span><span class="token punctuation" style="color:#393A34" data-218-js-token=";-11-60">;</span><span class="token plain" data-218-js-token="-11-61"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                topOffset </span><span class="token operator" style="color:#393A34" data-218-js-token="+=-12-26">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-218-js-token="50-12-29">50</span><span class="token punctuation" style="color:#393A34" data-218-js-token=";-12-31">;</span><span class="token plain" data-218-js-token="-12-32"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34" data-218-js-token="}-13-8">}</span><span class="token plain" data-218-js-token="-13-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        measuredData</span><span class="token punctuation" style="color:#393A34" data-218-js-token=".-14-20">.</span><span class="token property-access maybe-class-name" data-218-js-token="LastMeasuredItemIndex-14-21">LastMeasuredItemIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-218-js-token="=-14-43">=</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34" data-218-js-token=";-14-50">;</span><span class="token plain" data-218-js-token="-14-51"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-218-js-token="}-15-4">}</span><span class="token plain" data-218-js-token="-15-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-218-js-token="return-16-4">return</span><span class="token plain"> measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-218-js-token="[-16-26">[</span><span class="token plain" data-218-js-token="index-16-27">index</span><span class="token punctuation" style="color:#393A34" data-218-js-token="]-16-32">]</span><span class="token punctuation" style="color:#393A34" data-218-js-token=";-16-33">;</span><span class="token plain" data-218-js-token="-16-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-218-js-token="-17-0"></span><span class="token punctuation" style="color:#393A34" data-218-js-token="}-17-0">}</span><span class="token punctuation" style="color:#393A34" data-218-js-token=";-17-1">;</span></div></pre></div><h4 id="动态获取任意高度的项目"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#动态获取任意高度的项目"><span class="icon icon-link"></span></a>动态获取任意高度的项目</h4><p>这里所有项目的高度都是通过<code>getOneChildItem</code>在渲染的时候动态获取到的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 获取任意高度的item</span><span class="token plain" data-219-js-token="-0-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-1-0"></span><span class="token keyword" style="color:#00009f" data-219-js-token="const-1-0">const</span><span class="token plain"> getRandomHeightItem </span><span class="token operator" style="color:#393A34" data-219-js-token="=-1-26">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-1-28">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-1-29">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-1-30">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-219-js-token="=&gt;-1-32">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-1-35">{</span><span class="token plain" data-219-js-token="-1-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-2-0">	</span><span class="token keyword" style="color:#00009f" data-219-js-token="let-2-1">let</span><span class="token plain"> items</span><span class="token operator" style="color:#393A34" data-219-js-token=":-2-10">:</span><span class="token plain"> </span><span class="token maybe-class-name" data-219-js-token="ReactNode-2-12">ReactNode</span><span class="token punctuation" style="color:#393A34" data-219-js-token="[-2-21">[</span><span class="token punctuation" style="color:#393A34" data-219-js-token="]-2-22">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="|-2-24">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f" data-219-js-token="null-2-26">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="=-2-31">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f" data-219-js-token="null-2-33">null</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-2-37">;</span><span class="token plain" data-219-js-token="-2-38"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-3-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-219-js-token="return-3-1">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-3-8">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-3-9">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-219-js-token="=&gt;-3-11">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-3-14">{</span><span class="token plain" data-219-js-token="-3-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-4-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-219-js-token="if-4-2">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-4-5">(</span><span class="token plain" data-219-js-token="items-4-6">items</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-4-11">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f" data-219-js-token="return-4-13">return</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-4-25">;</span><span class="token plain" data-219-js-token="-4-26"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">		items </span><span class="token operator" style="color:#393A34" data-219-js-token="=-5-8">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="[-5-10">[</span><span class="token punctuation" style="color:#393A34" data-219-js-token="]-5-11">]</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-5-12">;</span><span class="token plain" data-219-js-token="-5-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-6-0">		</span><span class="token keyword" style="color:#00009f" data-219-js-token="const-6-2">const</span><span class="token plain"> itemCount </span><span class="token operator" style="color:#393A34" data-219-js-token="=-6-18">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-219-js-token="1000-6-20">1000</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-6-24">;</span><span class="token plain" data-219-js-token="-6-25"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-7-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-219-js-token="for-7-2">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-7-6">(</span><span class="token keyword" style="color:#00009f" data-219-js-token="let-7-7">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-219-js-token="=-7-13">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-219-js-token="0-7-15">0</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-7-16">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-219-js-token="&lt;-7-20">&lt;</span><span class="token plain"> itemCount</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-7-31">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34" data-219-js-token="++-7-34">++</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-7-36">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-7-38">{</span><span class="token plain" data-219-js-token="-7-39"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-8-0">			</span><span class="token keyword" style="color:#00009f" data-219-js-token="const-8-3">const</span><span class="token plain"> height </span><span class="token operator" style="color:#393A34" data-219-js-token="=-8-16">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-219-js-token="30-8-18">30</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="+-8-21">+</span><span class="token plain"> </span><span class="token known-class-name class-name" data-219-js-token="Math-8-23">Math</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-8-27">.</span><span class="token method function property-access" style="color:#d73a49" data-219-js-token="floor-8-28">floor</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-8-33">(</span><span class="token known-class-name class-name" data-219-js-token="Math-8-34">Math</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-8-38">.</span><span class="token method function property-access" style="color:#d73a49" data-219-js-token="random-8-39">random</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-8-45">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-8-46">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="*-8-48">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-219-js-token="30-8-50">30</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-8-52">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-8-53">;</span><span class="token plain" data-219-js-token="-8-54"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-9-0">			</span><span class="token keyword" style="color:#00009f" data-219-js-token="const-9-3">const</span><span class="token plain"> style </span><span class="token operator" style="color:#393A34" data-219-js-token="=-9-15">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-9-17">{</span><span class="token plain" data-219-js-token="-9-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="height-10-0">				height</span><span class="token punctuation" style="color:#393A34" data-219-js-token=",-10-10">,</span><span class="token plain" data-219-js-token="-10-11"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="width-11-0">				width</span><span class="token operator" style="color:#393A34" data-219-js-token=":-11-9">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-219-js-token="&#x27;100%&#x27;-11-11">&#x27;100%&#x27;</span><span class="token punctuation" style="color:#393A34" data-219-js-token=",-11-17">,</span><span class="token plain" data-219-js-token="-11-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-12-0">			</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-12-3">}</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-12-4">;</span><span class="token plain" data-219-js-token="-12-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="items-13-0">			items</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-13-8">.</span><span class="token method function property-access" style="color:#d73a49" data-219-js-token="push-13-9">push</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-13-13">(</span><span class="token operator" style="color:#393A34" data-219-js-token="&lt;-13-14">&lt;</span><span class="token maybe-class-name" data-219-js-token="ChildItem-13-15">ChildItem</span><span class="token plain"> key</span><span class="token operator" style="color:#393A34" data-219-js-token="=-13-28">=</span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-13-29">{</span><span class="token plain" data-219-js-token="i-13-30">i</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-13-31">}</span><span class="token plain"> childIndex</span><span class="token operator" style="color:#393A34" data-219-js-token="=-13-43">=</span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-13-44">{</span><span class="token plain" data-219-js-token="i-13-45">i</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-13-46">}</span><span class="token plain"> itemStyle</span><span class="token operator" style="color:#393A34" data-219-js-token="=-13-57">=</span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-13-58">{</span><span class="token plain" data-219-js-token="style-13-59">style</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-13-64">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="/-13-66">/</span><span class="token operator" style="color:#393A34" data-219-js-token="&gt;-13-67">&gt;</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-13-68">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-13-69">;</span><span class="token plain" data-219-js-token="-13-70"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-14-0">		</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-14-2">}</span><span class="token plain" data-219-js-token="-14-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-15-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-219-js-token="return-15-2">return</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-15-14">;</span><span class="token plain" data-219-js-token="-15-15"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-16-0">	</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-16-1">}</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-16-2">;</span><span class="token plain" data-219-js-token="-16-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-17-0"></span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-17-0">}</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-17-1">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-17-2">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-17-3">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-17-4">;</span><span class="token plain" data-219-js-token="-17-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-219-js-token="-18-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-19-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 动态获取子集</span><span class="token plain" data-219-js-token="-19-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-20-0"></span><span class="token keyword" style="color:#00009f" data-219-js-token="const-20-0">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#d73a49" data-219-js-token="DynamicChildItem-20-6">DynamicChildItem</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="=-20-23">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-20-25">(</span><span class="token parameter" data-219-js-token="options-20-26">options</span><span class="token parameter operator" style="color:#393A34" data-219-js-token=":-20-33">:</span><span class="token parameter"> DynamicChildItemProps</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-20-56">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-219-js-token="=&gt;-20-58">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-20-61">{</span><span class="token plain" data-219-js-token="-20-62"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-21-0">	</span><span class="token keyword" style="color:#00009f" data-219-js-token="const-21-1">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-21-7">{</span><span class="token plain" data-219-js-token="itemStyle-21-8">itemStyle</span><span class="token punctuation" style="color:#393A34" data-219-js-token=",-21-17">,</span><span class="token plain"> getChildItem</span><span class="token punctuation" style="color:#393A34" data-219-js-token=",-21-31">,</span><span class="token plain"> onSizeChange</span><span class="token punctuation" style="color:#393A34" data-219-js-token=",-21-45">,</span><span class="token plain"> childIndex</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-21-57">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="=-21-59">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-21-68">;</span><span class="token plain" data-219-js-token="-21-69"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-22-0">	</span><span class="token keyword" style="color:#00009f" data-219-js-token="const-22-1">const</span><span class="token plain"> childRef </span><span class="token operator" style="color:#393A34" data-219-js-token="=-22-16">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-219-js-token="useRef-22-18">useRef</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-22-24">(</span><span class="token keyword null nil" style="color:#00009f" data-219-js-token="null-22-25">null</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-22-29">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-22-30">;</span><span class="token plain" data-219-js-token="-22-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-23-0">	</span><span class="token keyword" style="color:#00009f" data-219-js-token="const-23-1">const</span><span class="token plain"> resizeObserverRef </span><span class="token operator" style="color:#393A34" data-219-js-token="=-23-25">=</span><span class="token plain"> useRef</span><span class="token operator" style="color:#393A34" data-219-js-token="&lt;-23-33">&lt;</span><span class="token maybe-class-name" data-219-js-token="ResizeObserver-23-34">ResizeObserver</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="|-23-49">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f" data-219-js-token="null-23-51">null</span><span class="token operator" style="color:#393A34" data-219-js-token="&gt;-23-55">&gt;</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-23-56">(</span><span class="token keyword null nil" style="color:#00009f" data-219-js-token="null-23-57">null</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-23-61">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-23-62">;</span><span class="token plain" data-219-js-token="-23-63"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-219-js-token="-24-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-25-0">	</span><span class="token function" style="color:#d73a49" data-219-js-token="useEffect-25-1">useEffect</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-25-10">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-25-11">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-25-12">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-219-js-token="=&gt;-25-14">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-25-17">{</span><span class="token plain" data-219-js-token="-25-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-26-0">		</span><span class="token keyword" style="color:#00009f" data-219-js-token="const-26-2">const</span><span class="token plain"> domNode </span><span class="token operator" style="color:#393A34" data-219-js-token="=-26-16">=</span><span class="token plain"> childRef</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-26-26">.</span><span class="token property-access" data-219-js-token="current-26-27">current</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-26-34">;</span><span class="token plain" data-219-js-token="-26-35"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-27-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-219-js-token="if-27-2">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-27-5">(</span><span class="token plain" data-219-js-token="domNode-27-6">domNode</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-27-13">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-27-15">{</span><span class="token plain" data-219-js-token="-27-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-28-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-219-js-token="if-28-3">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-28-6">(</span><span class="token operator" style="color:#393A34" data-219-js-token="!-28-7">!</span><span class="token plain" data-219-js-token="resizeObserverRef-28-8">resizeObserverRef</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-28-25">.</span><span class="token property-access" data-219-js-token="current-28-26">current</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-28-33">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-28-35">{</span><span class="token plain" data-219-js-token="-28-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="resizeObserverRef-29-0">				resizeObserverRef</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-29-21">.</span><span class="token property-access" data-219-js-token="current-29-22">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="=-29-30">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-219-js-token="new-29-32">new</span><span class="token plain"> </span><span class="token class-name" data-219-js-token="ResizeObserver-29-36">ResizeObserver</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-29-50">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-29-51">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-29-52">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-219-js-token="=&gt;-29-54">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-29-57">{</span><span class="token plain" data-219-js-token="-29-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-30-0">					</span><span class="token function" style="color:#d73a49" data-219-js-token="onSizeChange-30-5">onSizeChange</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-30-17">(</span><span class="token plain" data-219-js-token="childIndex-30-18">childIndex</span><span class="token punctuation" style="color:#393A34" data-219-js-token=",-30-28">,</span><span class="token plain"> domNode</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-30-37">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-30-38">;</span><span class="token plain" data-219-js-token="-30-39"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-31-0">				</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-31-4">}</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-31-5">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-31-6">;</span><span class="token plain" data-219-js-token="-31-7"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-32-0">			</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-32-3">}</span><span class="token plain" data-219-js-token="-32-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="resizeObserverRef-33-0">			resizeObserverRef</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-33-20">.</span><span class="token property-access" data-219-js-token="current-33-21">current</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-33-28">.</span><span class="token method function property-access" style="color:#d73a49" data-219-js-token="observe-33-29">observe</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-33-36">(</span><span class="token plain" data-219-js-token="domNode-33-37">domNode</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-33-44">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-33-45">;</span><span class="token plain" data-219-js-token="-33-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-34-0">		</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-34-2">}</span><span class="token plain" data-219-js-token="-34-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-35-0">		</span><span class="token keyword control-flow" style="color:#00009f" data-219-js-token="return-35-2">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-35-9">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-35-10">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-219-js-token="=&gt;-35-12">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-35-15">{</span><span class="token plain" data-219-js-token="-35-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-36-0">			</span><span class="token keyword control-flow" style="color:#00009f" data-219-js-token="if-36-3">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-36-6">(</span><span class="token plain" data-219-js-token="resizeObserverRef-36-7">resizeObserverRef</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-36-24">.</span><span class="token property-access" data-219-js-token="current-36-25">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="&amp;&amp;-36-33">&amp;&amp;</span><span class="token plain"> domNode</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-36-43">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-36-45">{</span><span class="token plain" data-219-js-token="-36-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="resizeObserverRef-37-0">				resizeObserverRef</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-37-21">.</span><span class="token property-access" data-219-js-token="current-37-22">current</span><span class="token punctuation" style="color:#393A34" data-219-js-token=".-37-29">.</span><span class="token method function property-access" style="color:#d73a49" data-219-js-token="unobserve-37-30">unobserve</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-37-39">(</span><span class="token plain" data-219-js-token="domNode-37-40">domNode</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-37-47">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-37-48">;</span><span class="token plain" data-219-js-token="-37-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-38-0">			</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-38-3">}</span><span class="token plain" data-219-js-token="-38-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-39-0">		</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-39-2">}</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-39-3">;</span><span class="token plain" data-219-js-token="-39-4"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-40-0">	</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-40-1">}</span><span class="token punctuation" style="color:#393A34" data-219-js-token=",-40-2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="[-40-4">[</span><span class="token plain" data-219-js-token="childIndex-40-5">childIndex</span><span class="token punctuation" style="color:#393A34" data-219-js-token=",-40-15">,</span><span class="token plain"> onSizeChange</span><span class="token punctuation" style="color:#393A34" data-219-js-token="]-40-29">]</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-40-30">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-40-31">;</span><span class="token plain" data-219-js-token="-40-32"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-219-js-token="-41-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-42-0">	</span><span class="token keyword control-flow" style="color:#00009f" data-219-js-token="return-42-1">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-42-8">(</span><span class="token plain" data-219-js-token="-42-9"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-43-0">		</span><span class="token operator" style="color:#393A34" data-219-js-token="&lt;-43-2">&lt;</span><span class="token plain">div ref</span><span class="token operator" style="color:#393A34" data-219-js-token="=-43-10">=</span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-43-11">{</span><span class="token plain" data-219-js-token="childRef-43-12">childRef</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-43-20">}</span><span class="token plain"> style</span><span class="token operator" style="color:#393A34" data-219-js-token="=-43-27">=</span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-43-28">{</span><span class="token plain" data-219-js-token="itemStyle-43-29">itemStyle</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-43-38">}</span><span class="token operator" style="color:#393A34" data-219-js-token="&gt;-43-39">&gt;</span><span class="token plain" data-219-js-token="-43-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-44-0">			</span><span class="token punctuation" style="color:#393A34" data-219-js-token="{-44-3">{</span><span class="token function" style="color:#d73a49" data-219-js-token="getChildItem-44-4">getChildItem</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-44-16">(</span><span class="token plain" data-219-js-token="childIndex-44-17">childIndex</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-44-27">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-44-28">}</span><span class="token plain" data-219-js-token="-44-29"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-45-0">		</span><span class="token operator" style="color:#393A34" data-219-js-token="&lt;-45-2">&lt;</span><span class="token operator" style="color:#393A34" data-219-js-token="/-45-3">/</span><span class="token plain" data-219-js-token="div-45-4">div</span><span class="token operator" style="color:#393A34" data-219-js-token="&gt;-45-7">&gt;</span><span class="token plain" data-219-js-token="-45-8"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-46-0">	</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-46-1">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-46-2">;</span><span class="token plain" data-219-js-token="-46-3"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-47-0"></span><span class="token punctuation" style="color:#393A34" data-219-js-token="}-47-0">}</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-47-1">;</span><span class="token plain" data-219-js-token="-47-2"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-219-js-token="-48-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-219-js-token="-49-0"></span><span class="token keyword" style="color:#00009f" data-219-js-token="const-49-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-219-js-token="getOneChildItem-49-6">getOneChildItem</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-219-js-token="=-49-22">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-49-24">(</span><span class="token parameter" data-219-js-token="index-49-25">index</span><span class="token parameter operator" style="color:#393A34" data-219-js-token=":-49-30">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-49-38">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-219-js-token="=&gt;-49-40">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-219-js-token="getRandomHeightItem-49-43">getRandomHeightItem</span><span class="token punctuation" style="color:#393A34" data-219-js-token="(-49-62">(</span><span class="token punctuation" style="color:#393A34" data-219-js-token=")-49-63">)</span><span class="token punctuation" style="color:#393A34" data-219-js-token="[-49-64">[</span><span class="token plain" data-219-js-token="index-49-65">index</span><span class="token punctuation" style="color:#393A34" data-219-js-token="]-49-70">]</span><span class="token punctuation" style="color:#393A34" data-219-js-token=";-49-71">;</span></div></pre></div><p>调用</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 根据当前显示范围，插入节点，节点通过getOneChildItem动态获取</span><span class="token plain" data-220-js-token="-0-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-220-js-token="-1-0"></span><span class="token keyword" style="color:#00009f" data-220-js-token="const-1-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-220-js-token="getCurShowChild-1-6">getCurShowChild</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-220-js-token="=-1-22">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-220-js-token="(-1-24">(</span><span class="token parameter" data-220-js-token="scrollTop-1-25">scrollTop</span><span class="token parameter operator" style="color:#393A34" data-220-js-token=":-1-34">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34" data-220-js-token=")-1-42">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-220-js-token="=&gt;-1-44">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-220-js-token="{-1-47">{</span><span class="token plain" data-220-js-token="-1-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-220-js-token="const-2-4">const</span><span class="token plain"> items </span><span class="token operator" style="color:#393A34" data-220-js-token="=-2-16">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-220-js-token="[-2-18">[</span><span class="token punctuation" style="color:#393A34" data-220-js-token="]-2-19">]</span><span class="token punctuation" style="color:#393A34" data-220-js-token=";-2-20">;</span><span class="token plain" data-220-js-token="-2-21"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-220-js-token="const-3-4">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-220-js-token="{-3-10">{</span><span class="token plain" data-220-js-token="bufferStartIndex-3-11">bufferStartIndex</span><span class="token punctuation" style="color:#393A34" data-220-js-token=",-3-27">,</span><span class="token plain"> bufferEndIndex</span><span class="token punctuation" style="color:#393A34" data-220-js-token="}-3-43">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-220-js-token="=-3-45">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-220-js-token="getChildShowRange-3-47">getChildShowRange</span><span class="token punctuation" style="color:#393A34" data-220-js-token="(-3-64">(</span><span class="token plain" data-220-js-token="scrollTop-3-65">scrollTop</span><span class="token punctuation" style="color:#393A34" data-220-js-token=")-3-74">)</span><span class="token punctuation" style="color:#393A34" data-220-js-token=";-3-75">;</span><span class="token plain" data-220-js-token="-3-76"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-220-js-token="for-4-4">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-220-js-token="(-4-8">(</span><span class="token keyword" style="color:#00009f" data-220-js-token="let-4-9">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-220-js-token="=-4-15">=</span><span class="token plain"> bufferStartIndex</span><span class="token punctuation" style="color:#393A34" data-220-js-token=";-4-33">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-220-js-token="&lt;=-4-37">&lt;=</span><span class="token plain"> bufferEndIndex</span><span class="token punctuation" style="color:#393A34" data-220-js-token=";-4-54">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34" data-220-js-token="++-4-57">++</span><span class="token punctuation" style="color:#393A34" data-220-js-token=")-4-59">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-220-js-token="{-4-61">{</span><span class="token plain" data-220-js-token="-4-62"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-220-js-token="const-5-12">const</span><span class="token plain"> item </span><span class="token operator" style="color:#393A34" data-220-js-token="=-5-23">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49" data-220-js-token="getItemMetaData-5-25">getItemMetaData</span><span class="token punctuation" style="color:#393A34" data-220-js-token="(-5-40">(</span><span class="token plain" data-220-js-token="i-5-41">i</span><span class="token punctuation" style="color:#393A34" data-220-js-token=")-5-42">)</span><span class="token punctuation" style="color:#393A34" data-220-js-token=";-5-43">;</span><span class="token plain" data-220-js-token="-5-44"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f" data-220-js-token="const-6-12">const</span><span class="token plain"> itemStyle</span><span class="token operator" style="color:#393A34" data-220-js-token=":-6-27">:</span><span class="token plain"> </span><span class="token maybe-class-name" data-220-js-token="CSSProperties-6-29">CSSProperties</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-220-js-token="=-6-43">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-220-js-token="{-6-45">{</span><span class="token plain" data-220-js-token="-6-46"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    position</span><span class="token operator" style="color:#393A34" data-220-js-token=":-7-28">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-220-js-token="&#x27;absolute&#x27;-7-30">&#x27;absolute&#x27;</span><span class="token punctuation" style="color:#393A34" data-220-js-token=",-7-40">,</span><span class="token plain" data-220-js-token="-7-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    height</span><span class="token operator" style="color:#393A34" data-220-js-token=":-8-26">:</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34" data-220-js-token=".-8-32">.</span><span class="token property-access" data-220-js-token="height-8-33">height</span><span class="token punctuation" style="color:#393A34" data-220-js-token=",-8-39">,</span><span class="token plain" data-220-js-token="-8-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    width</span><span class="token operator" style="color:#393A34" data-220-js-token=":-9-25">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-220-js-token="&#x27;100%&#x27;-9-27">&#x27;100%&#x27;</span><span class="token punctuation" style="color:#393A34" data-220-js-token=",-9-33">,</span><span class="token plain" data-220-js-token="-9-34"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    top</span><span class="token operator" style="color:#393A34" data-220-js-token=":-10-23">:</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34" data-220-js-token=".-10-29">.</span><span class="token property-access" data-220-js-token="topOffset-10-30">topOffset</span><span class="token punctuation" style="color:#393A34" data-220-js-token=",-10-39">,</span><span class="token plain" data-220-js-token="-10-40"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-220-js-token="}-11-12">}</span><span class="token punctuation" style="color:#393A34" data-220-js-token=";-11-13">;</span><span class="token plain" data-220-js-token="-11-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            items</span><span class="token punctuation" style="color:#393A34" data-220-js-token=".-12-17">.</span><span class="token method function property-access" style="color:#d73a49" data-220-js-token="push-12-18">push</span><span class="token punctuation" style="color:#393A34" data-220-js-token="(-12-22">(</span><span class="token plain" data-220-js-token="-12-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token operator" style="color:#393A34" data-220-js-token="&lt;-13-20">&lt;</span><span class="token maybe-class-name" data-220-js-token="DynamicChildItem-13-21">DynamicChildItem</span><span class="token plain" data-220-js-token="-13-37"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            key</span><span class="token operator" style="color:#393A34" data-220-js-token="=-14-31">=</span><span class="token punctuation" style="color:#393A34" data-220-js-token="{-14-32">{</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-220-js-token="`-14-33">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-220-js-token="${-14-34">${</span><span class="token template-string interpolation" data-220-js-token="i-14-36">i</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-220-js-token="}-14-37">}</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-220-js-token="${-14-38">${</span><span class="token template-string interpolation" data-220-js-token="item-14-40">item</span><span class="token template-string interpolation punctuation" style="color:#393A34" data-220-js-token=".-14-44">.</span><span class="token template-string interpolation" data-220-js-token="topOffset-14-45">topOffset</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34" data-220-js-token="}-14-54">}</span><span class="token template-string template-punctuation string" style="color:#e3116c" data-220-js-token="`-14-55">`</span><span class="token punctuation" style="color:#393A34" data-220-js-token="}-14-56">}</span><span class="token plain" data-220-js-token="-14-57"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            childIndex</span><span class="token operator" style="color:#393A34" data-220-js-token="=-15-38">=</span><span class="token punctuation" style="color:#393A34" data-220-js-token="{-15-39">{</span><span class="token plain" data-220-js-token="i-15-40">i</span><span class="token punctuation" style="color:#393A34" data-220-js-token="}-15-41">}</span><span class="token plain" data-220-js-token="-15-42"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            getChildItem</span><span class="token operator" style="color:#393A34" data-220-js-token="=-16-40">=</span><span class="token punctuation" style="color:#393A34" data-220-js-token="{-16-41">{</span><span class="token plain" data-220-js-token="getOneChildItem-16-42">getOneChildItem</span><span class="token punctuation" style="color:#393A34" data-220-js-token="}-16-57">}</span><span class="token plain" data-220-js-token="-16-58"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            onSizeChange</span><span class="token operator" style="color:#393A34" data-220-js-token="=-17-40">=</span><span class="token punctuation" style="color:#393A34" data-220-js-token="{-17-41">{</span><span class="token plain" data-220-js-token="sizeChangeHandle-17-42">sizeChangeHandle</span><span class="token punctuation" style="color:#393A34" data-220-js-token="}-17-58">}</span><span class="token plain" data-220-js-token="-17-59"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            itemStyle</span><span class="token operator" style="color:#393A34" data-220-js-token="=-18-37">=</span><span class="token punctuation" style="color:#393A34" data-220-js-token="{-18-38">{</span><span class="token plain" data-220-js-token="itemStyle-18-39">itemStyle</span><span class="token punctuation" style="color:#393A34" data-220-js-token="}-18-48">}</span><span class="token plain" data-220-js-token="-18-49"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token operator" style="color:#393A34" data-220-js-token="/-19-20">/</span><span class="token operator" style="color:#393A34" data-220-js-token="&gt;-19-21">&gt;</span><span class="token punctuation" style="color:#393A34" data-220-js-token=",-19-22">,</span><span class="token plain" data-220-js-token="-19-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-220-js-token=")-20-12">)</span><span class="token punctuation" style="color:#393A34" data-220-js-token=";-20-13">;</span><span class="token plain" data-220-js-token="-20-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-220-js-token="}-21-4">}</span><span class="token plain" data-220-js-token="-21-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-220-js-token="return-22-4">return</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34" data-220-js-token=";-22-16">;</span><span class="token plain" data-220-js-token="-22-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-220-js-token="-23-0"></span><span class="token punctuation" style="color:#393A34" data-220-js-token="}-23-0">}</span><span class="token punctuation" style="color:#393A34" data-220-js-token=";-23-1">;</span></div></pre></div><h4 id="监听节点宽高变化"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#监听节点宽高变化"><span class="icon icon-link"></span></a>监听节点宽高变化</h4><p>通过监听节点的尺寸变化去更新缓存数据，然后触发虚拟列表重新渲染，实现动态高度渲染</p><div class="__dumi-default-code-block"><pre class="prism-code language-js" style="color:#393A34;background-color:#f6f8fa"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49" data-221-js-token="useEffect-0-0">useEffect</span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-0-9">(</span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-0-10">(</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-0-11">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-221-js-token="=&gt;-0-13">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="{-0-16">{</span><span class="token plain" data-221-js-token="-0-17"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-221-js-token="const-1-4">const</span><span class="token plain"> domNode </span><span class="token operator" style="color:#393A34" data-221-js-token="=-1-18">=</span><span class="token plain"> childRef</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-1-28">.</span><span class="token property-access" data-221-js-token="current-1-29">current</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-1-36">;</span><span class="token plain" data-221-js-token="-1-37"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-221-js-token="if-2-4">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-2-7">(</span><span class="token plain" data-221-js-token="domNode-2-8">domNode</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-2-15">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="{-2-17">{</span><span class="token plain" data-221-js-token="-2-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f" data-221-js-token="if-3-12">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-3-15">(</span><span class="token operator" style="color:#393A34" data-221-js-token="!-3-16">!</span><span class="token plain" data-221-js-token="resizeObserverRef-3-17">resizeObserverRef</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-3-34">.</span><span class="token property-access" data-221-js-token="current-3-35">current</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-3-42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="{-3-44">{</span><span class="token plain" data-221-js-token="-3-45"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    resizeObserverRef</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-4-37">.</span><span class="token property-access" data-221-js-token="current-4-38">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-221-js-token="=-4-46">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f" data-221-js-token="new-4-48">new</span><span class="token plain"> </span><span class="token class-name" data-221-js-token="ResizeObserver-4-52">ResizeObserver</span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-4-66">(</span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-4-67">(</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-4-68">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-221-js-token="=&gt;-4-70">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="{-4-73">{</span><span class="token plain" data-221-js-token="-4-74"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token function" style="color:#d73a49" data-221-js-token="onSizeChange-5-28">onSizeChange</span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-5-40">(</span><span class="token plain" data-221-js-token="childIndex-5-41">childIndex</span><span class="token punctuation" style="color:#393A34" data-221-js-token=",-5-51">,</span><span class="token plain"> domNode</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-5-60">)</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-5-61">;</span><span class="token plain" data-221-js-token="-5-62"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34" data-221-js-token="}-6-20">}</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-6-21">)</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-6-22">;</span><span class="token plain" data-221-js-token="-6-23"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-221-js-token="}-7-12">}</span><span class="token plain" data-221-js-token="-7-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            resizeObserverRef</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-8-29">.</span><span class="token property-access" data-221-js-token="current-8-30">current</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-8-37">.</span><span class="token method function property-access" style="color:#d73a49" data-221-js-token="observe-8-38">observe</span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-8-45">(</span><span class="token plain" data-221-js-token="domNode-8-46">domNode</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-8-53">)</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-8-54">;</span><span class="token plain" data-221-js-token="-8-55"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-221-js-token="}-9-4">}</span><span class="token plain" data-221-js-token="-9-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-221-js-token="return-10-4">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-10-11">(</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-10-12">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-221-js-token="=&gt;-10-14">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="{-10-17">{</span><span class="token plain" data-221-js-token="-10-18"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f" data-221-js-token="if-11-12">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-11-15">(</span><span class="token plain" data-221-js-token="resizeObserverRef-11-16">resizeObserverRef</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-11-33">.</span><span class="token property-access" data-221-js-token="current-11-34">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-221-js-token="&amp;&amp;-11-42">&amp;&amp;</span><span class="token plain"> domNode</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-11-52">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="{-11-54">{</span><span class="token plain" data-221-js-token="-11-55"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    resizeObserverRef</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-12-37">.</span><span class="token property-access" data-221-js-token="current-12-38">current</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-12-45">.</span><span class="token method function property-access" style="color:#d73a49" data-221-js-token="unobserve-12-46">unobserve</span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-12-55">(</span><span class="token plain" data-221-js-token="domNode-12-56">domNode</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-12-63">)</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-12-64">;</span><span class="token plain" data-221-js-token="-12-65"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34" data-221-js-token="}-13-12">}</span><span class="token plain" data-221-js-token="-13-13"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-221-js-token="}-14-4">}</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-14-5">;</span><span class="token plain" data-221-js-token="-14-6"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-221-js-token="-15-0"></span><span class="token punctuation" style="color:#393A34" data-221-js-token="}-15-0">}</span><span class="token punctuation" style="color:#393A34" data-221-js-token=",-15-1">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="[-15-3">[</span><span class="token plain" data-221-js-token="childIndex-15-4">childIndex</span><span class="token punctuation" style="color:#393A34" data-221-js-token=",-15-14">,</span><span class="token plain"> onSizeChange</span><span class="token punctuation" style="color:#393A34" data-221-js-token="]-15-28">]</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-15-29">)</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-15-30">;</span><span class="token plain" data-221-js-token="-15-31"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-221-js-token="-16-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block" data-221-js-token="-17-0">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-221-js-token="-18-0"></span><span class="token comment" style="color:#999988;font-style:italic">// 监听节点尺寸变化，更新measuredDataMap，触发重新渲染</span><span class="token plain" data-221-js-token="-18-36"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-221-js-token="-19-0"></span><span class="token keyword" style="color:#00009f" data-221-js-token="const-19-0">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49" data-221-js-token="sizeChangeHandle-19-6">sizeChangeHandle</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-221-js-token="=-19-23">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-19-25">(</span><span class="token parameter" data-221-js-token="index-19-26">index</span><span class="token parameter operator" style="color:#393A34" data-221-js-token=":-19-31">:</span><span class="token parameter"> number</span><span class="token parameter punctuation" style="color:#393A34" data-221-js-token=",-19-39">,</span><span class="token parameter"> domNode</span><span class="token parameter operator" style="color:#393A34" data-221-js-token=":-19-48">:</span><span class="token parameter"> HTMLDivElement</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-19-64">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34" data-221-js-token="=&gt;-19-66">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="{-19-69">{</span><span class="token plain" data-221-js-token="-19-70"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-221-js-token="const-20-4">const</span><span class="token plain"> height </span><span class="token operator" style="color:#393A34" data-221-js-token="=-20-17">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-20-19">(</span><span class="token plain" data-221-js-token="domNode-20-20">domNode</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-20-27">.</span><span class="token property-access" data-221-js-token="children-20-28">children</span><span class="token punctuation" style="color:#393A34" data-221-js-token="[-20-36">[</span><span class="token number" style="color:#36acaa" data-221-js-token="0-20-37">0</span><span class="token punctuation" style="color:#393A34" data-221-js-token="]-20-38">]</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f" data-221-js-token="as-20-40">as</span><span class="token plain"> </span><span class="token maybe-class-name" data-221-js-token="HTMLDivElement-20-43">HTMLDivElement</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-20-57">)</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-20-58">.</span><span class="token property-access" data-221-js-token="offsetHeight-20-59">offsetHeight</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-20-71">;</span><span class="token plain" data-221-js-token="-20-72"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-221-js-token="const-21-4">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="{-21-10">{</span><span class="token plain" data-221-js-token="measuredDataMap-21-11">measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-221-js-token=",-21-26">,</span><span class="token plain"> </span><span class="token maybe-class-name" data-221-js-token="LastMeasuredItemIndex-21-28">LastMeasuredItemIndex</span><span class="token punctuation" style="color:#393A34" data-221-js-token="}-21-49">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-221-js-token="=-21-51">=</span><span class="token plain"> measuredData</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-21-65">;</span><span class="token plain" data-221-js-token="-21-66"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-221-js-token="[-22-19">[</span><span class="token plain" data-221-js-token="index-22-20">index</span><span class="token punctuation" style="color:#393A34" data-221-js-token="]-22-25">]</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-22-26">.</span><span class="token property-access" data-221-js-token="height-22-27">height</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-221-js-token="=-22-34">=</span><span class="token plain"> height</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-22-42">;</span><span class="token plain" data-221-js-token="-22-43"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f" data-221-js-token="let-23-4">let</span><span class="token plain"> offset </span><span class="token operator" style="color:#393A34" data-221-js-token="=-23-15">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-221-js-token="0-23-17">0</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-23-18">;</span><span class="token plain" data-221-js-token="-23-19"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 重新计算偏移值</span><span class="token plain" data-221-js-token="-24-14"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f" data-221-js-token="for-25-4">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-25-8">(</span><span class="token keyword" style="color:#00009f" data-221-js-token="let-25-9">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-221-js-token="=-25-15">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa" data-221-js-token="0-25-17">0</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-25-18">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34" data-221-js-token="&lt;=-25-22">&lt;=</span><span class="token plain"> </span><span class="token maybe-class-name" data-221-js-token="LastMeasuredItemIndex-25-25">LastMeasuredItemIndex</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-25-46">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34" data-221-js-token="++-25-49">++</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-25-51">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34" data-221-js-token="{-25-53">{</span><span class="token plain" data-221-js-token="-25-54"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-221-js-token="[-26-27">[</span><span class="token plain" data-221-js-token="i-26-28">i</span><span class="token punctuation" style="color:#393A34" data-221-js-token="]-26-29">]</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-26-30">.</span><span class="token property-access" data-221-js-token="topOffset-26-31">topOffset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-221-js-token="=-26-41">=</span><span class="token plain"> offset</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-26-49">;</span><span class="token plain" data-221-js-token="-26-50"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            offset </span><span class="token operator" style="color:#393A34" data-221-js-token="+=-27-19">+=</span><span class="token plain"> measuredDataMap</span><span class="token punctuation" style="color:#393A34" data-221-js-token="[-27-37">[</span><span class="token plain" data-221-js-token="i-27-38">i</span><span class="token punctuation" style="color:#393A34" data-221-js-token="]-27-39">]</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-27-40">.</span><span class="token property-access" data-221-js-token="height-27-41">height</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-27-47">;</span><span class="token plain" data-221-js-token="-27-48"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34" data-221-js-token="}-28-4">}</span><span class="token plain" data-221-js-token="-28-5"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    domNode</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-29-11">.</span><span class="token property-access" data-221-js-token="style-29-12">style</span><span class="token punctuation" style="color:#393A34" data-221-js-token=".-29-17">.</span><span class="token property-access" data-221-js-token="height-29-18">height</span><span class="token plain"> </span><span class="token operator" style="color:#393A34" data-221-js-token="=-29-25">=</span><span class="token plain"> height </span><span class="token operator" style="color:#393A34" data-221-js-token="+-29-34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c" data-221-js-token="&#x27;px&#x27;-29-36">&#x27;px&#x27;</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-29-40">;</span><span class="token plain" data-221-js-token="-29-41"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 触发列表的一次更新</span><span class="token plain" data-221-js-token="-30-16"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49" data-221-js-token="setNeedUpdate-31-4">setNeedUpdate</span><span class="token punctuation" style="color:#393A34" data-221-js-token="(-31-17">(</span><span class="token boolean" style="color:#36acaa" data-221-js-token="true-31-18">true</span><span class="token punctuation" style="color:#393A34" data-221-js-token=")-31-22">)</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-31-23">;</span><span class="token plain" data-221-js-token="-31-24"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" data-221-js-token="-32-0"></span><span class="token punctuation" style="color:#393A34" data-221-js-token="}-32-0">}</span><span class="token punctuation" style="color:#393A34" data-221-js-token=";-32-1">;</span></div></pre></div><h3 id="效果-2"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#效果-2"><span class="icon icon-link"></span></a>效果</h3><p><a target="_blank" rel="noopener noreferrer" href="https://zhuling904.github.io/react_demo/?path=/story/%E9%80%9A%E7%94%A8-virtuallist%E8%99%9A%E6%8B%9F%E5%88%97%E8%A1%A8--dynamic-height">在线demo体验<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><img src="https://cdn.jsdelivr.net/gh/ObjectX-9/DrawingBed/imgMac/%E5%8A%A8%E6%80%81%E9%AB%98%E5%BA%A6.gif" alt="2024-05-25 19.40.47.gif"/></p><h1 id="参考文章"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#参考文章"><span class="icon icon-link"></span></a>参考文章</h1><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/6844903982742110216?searchId=202405151054293D6A8B7D5246CA76F132">「前端进阶」高性能渲染十万条数据(虚拟列表)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7085941958228574215?searchId=202405151054293D6A8B7D5246CA76F132">虚拟列表，我真的会了！！！<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7232856799170805820?searchId=20240525194501C3EF4D0CAEAB585C40C9#heading-17">三种虚拟列表原理与实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h1 id="-推荐阅读"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#-推荐阅读"><span class="icon icon-link"></span></a>🍎 推荐阅读</h1><h2 id="工程化-1"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#工程化-1"><span class="icon icon-link"></span></a>工程化</h2><p>本系列是一个从0到1的实现过程，如果您有耐心跟着实现，您可以实现一个完整的<code>react18 + ts5 + webpack5 + 代码质量&amp;代码风格检测&amp;自动修复 + storybook8 + rollup + git action</code>实现的一个完整的组件库模板项目。如果您不打算自己配置，也可以直接clone<a target="_blank" rel="noopener noreferrer" href="https://github.com/zhuling904/react_demo/tree/rollup_comp">组件库仓库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>切换到<code>rollup_comp</code>分支即是完整的项目，当前实现已经足够个人使用，后续我们会新增webpack5优化、按需加载组件、实现一些常见的组件封装：包括但不限于拖拽排序、瀑布流、穿梭框、弹窗等</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7353504333999505408">【前端工程化】项目搭建篇-项目初始化&amp;prettier、eslint、stylelint、lint-staged、husky<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7353561676091097103">【前端工程化】项目搭建篇-配置changelog、webpack5打包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7353963878541246504">【前端工程化】项目搭建篇-引入react、ts、babel解析es6+、配置css module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7355026320088989733">【前端工程化】组件库搭建篇-引入storybook、rollup打包组件、本地测试组件库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7356175306937466916">【前端工程化】包管理器篇-三大包管理器、npm工程管理、npm发布流程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7356815857078157331">【前端工程化】自动化篇-Github Action基本使用、自动部署组件库文档、github3D指标统计<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7366601730426159144">【前端工程化】自动化篇-手写脚本一键自动tag、发包、引导登录npm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h2 id="常见组件实现"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#常见组件实现"><span class="icon icon-link"></span></a>常见组件实现</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7370513151052021787">【组件实现篇】&quot;从零使用react打造瀑布流的四种方式：完美展示动态图片流&quot;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/spost/7372488623944728585#heading-36">【组件实现篇】定高、不定高、动态高度虚拟列表实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h2 id="面试手写系列"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#面试手写系列"><span class="icon icon-link"></span></a>面试手写系列</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7353504333999505408">前端面试手写必备【实现常见八大数据结构一】<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7359877430340157503">手写哈希表【银四末尾，你上岸了吗？】哈希表，快速计算、均匀分布、扩容实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7370513151052038171">【前端面试手写必备】树🌲&amp;实现树结构<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h2 id="react实现原理系列"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#react实现原理系列"><span class="icon icon-link"></span></a>react实现原理系列</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/spost/7360512664316117026">【react原理实践】使用babel手搓探索下jsx的原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/spost/7361284455535345699">【喂饭式调试react源码】上手调试源码探究jsx原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/spost/7363220284503097354#heading-0">【上手调试源码系列】图解react几个核心包之间的关联<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7363193808521199655#heading-1">【上手调试源码系列】react启动流程，其实就是创建三大全局对象<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h2 id="其他"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#其他"><span class="icon icon-link"></span></a>其他</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7358709354424860707">工作流【效率小技巧】让alfred帮我启动所有项目，nice<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7352045198854406183">GPT4前端食用指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h1 id="-写在最后"><a aria-hidden="true" tabindex="-1" href="/front_end_engineer_book//02comp/01virtual-list#-写在最后"><span class="icon icon-link"></span></a>🍋 写在最后</h1><p>如果您看到这里了，并且觉得这篇文章对您有所帮助，希望您能够点赞👍和收藏⭐支持一下作者🙇🙇🙇，感谢🍺🍺！如果文中有任何不准确之处，也欢迎您指正，共同进步。感谢您的阅读，期待您的点赞👍和收藏⭐！</p><p>感兴趣的同学可以关注下我的公众号ObjectX前端实验室</p><p>🌟 少走弯路 | ObjectX前端实验室 🛠️「精选资源｜实战经验｜技术洞见」</p></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="Last update: ">6/15/2024 07:19:04</span></div></article></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/front_end_engineer_book/umi.9ab99bfd.js"></script>
  </body>
</html>
